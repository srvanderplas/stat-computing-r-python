<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-07-11">

<title>33&nbsp; Web Scraping – Statistical Computing using R and Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part-advanced-topics/04-xml-json-list-processing.html" rel="next">
<link href="../part-advanced-topics/02-data-doc.html" rel="prev">
<link href="../build_deps/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4ZFBDKXJXP"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4ZFBDKXJXP', { 'anonymize_ip': true});
</script>
<script src="https://kit.fontawesome.com/baac5f0610.js" crossorigin="anonymous"></script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<style>
div.callout-example.callout {
  border-left-color: #f39c12;
}
div.callout-example.callout-style-default > .callout-header {
  background-color: rgba(243, 156, 18, 0.13);
}
div.callout-example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-example.callout-style-default .callout-icon::before, div.callout-example.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f206' !important;
  background-image: none;
}
div.callout-advanced.callout {
  border-left-color: #cbbaf9;
}
div.callout-advanced.callout-style-default > .callout-header {
  background-color: rgba(203, 186, 249, 0.13);
}
div.callout-advanced .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-advanced.callout-style-default .callout-icon::before, div.callout-advanced.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f5dc' !important;
  background-image: none;
}
div.callout-demo.callout {
  border-left-color: #91d5d4;
}
div.callout-demo.callout-style-default > .callout-header {
  background-color: rgba(145, 213, 212, 0.13);
}
div.callout-demo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-demo.callout-style-default .callout-icon::before, div.callout-demo.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f12e' !important;
  background-image: none;
}
div.callout-learnmore.callout {
  border-left-color: #f09bb6;
}
div.callout-learnmore.callout-style-default > .callout-header {
  background-color: rgba(240, 155, 182, 0.13);
}
div.callout-learnmore .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-learnmore.callout-style-default .callout-icon::before, div.callout-learnmore.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f02d' !important;
  background-image: none;
}
div.callout-setup.callout {
  border-left-color: #f3e969;
}
div.callout-setup.callout-style-default > .callout-header {
  background-color: rgba(243, 233, 105, 0.13);
}
div.callout-setup .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-setup.callout-style-default .callout-icon::before, div.callout-setup.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f6e3' !important;
  background-image: none;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../build_deps/style.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-advanced-topics/00-advanced.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../part-advanced-topics/03-web-scraping.html"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Web Scraping</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Computing using R and Python</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/srvanderplas/stat-computing-r-python/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-tools/00-tools-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/01-computer-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/02-setting-up-computer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Computer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/03-Rstudio-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio’s Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/04-scripts-notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scripts and Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/05-git-and-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Version Control with Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/06-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducibility and Professional Communication</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-gen-prog/00-gen-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: General Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01-basic-var-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variables and Basic Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01a-math-logical-operators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mathematical and Logical Operators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/02-prog-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Functions, Packages, and Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/03-data-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/035-matrix-calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matrix Calculations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/04-control-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/05-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/06-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/07-prog-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Programming With Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/99-extra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Other Helpful Programming Resources</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-wrangling/00-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/01-data-input.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Input</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02-basic-data-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Visualization Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02a-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02b-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02c-good-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/03-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/04-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05-data-reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05b-normal-forms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/06-data-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/07-datetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/08-functional-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/09-spatial-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-advanced-topics/00-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/01-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Simulation and Reproducibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/02-data-doc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Data Documentation: Codebooks, Reproducibility, and more</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/03-web-scraping.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/04-xml-json-list-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Record-based Data and List Processing Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/05-APIs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Application Programming Interfaces</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/06-pdf-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Working with PDFs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/07-intro-interactive-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/08-javascript-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/09-big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">“Big” Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/10-databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/11-arrow-parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Efficient Data Access: Arrow and Parquet Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/12-memory-handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Memory and Computational Efficiency</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../graveyard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Other Topics</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">33.1</span> Objectives</a></li>
  <li><a href="#html-and-xml-language-specification" id="toc-html-and-xml-language-specification" class="nav-link" data-scroll-target="#html-and-xml-language-specification"><span class="header-section-number">33.2</span> HTML and XML Language Specification</a>
  <ul class="collapse">
  <li><a href="#xml" id="toc-xml" class="nav-link" data-scroll-target="#xml"><span class="header-section-number">33.2.1</span> XML</a></li>
  <li><a href="#html" id="toc-html" class="nav-link" data-scroll-target="#html"><span class="header-section-number">33.2.2</span> HTML</a></li>
  <li><a href="#reading-html-and-xml-files" id="toc-reading-html-and-xml-files" class="nav-link" data-scroll-target="#reading-html-and-xml-files"><span class="header-section-number">33.2.3</span> Reading HTML and XML files</a></li>
  </ul></li>
  <li><a href="#filtering-data-from-htmlxml-css-and-xpath-selectors" id="toc-filtering-data-from-htmlxml-css-and-xpath-selectors" class="nav-link" data-scroll-target="#filtering-data-from-htmlxml-css-and-xpath-selectors"><span class="header-section-number">33.3</span> Filtering Data from HTML/XML: CSS and XPath Selectors</a>
  <ul class="collapse">
  <li><a href="#selecting-by-element-type" id="toc-selecting-by-element-type" class="nav-link" data-scroll-target="#selecting-by-element-type"><span class="header-section-number">33.3.1</span> Selecting by element type</a></li>
  <li><a href="#selecting-by-element-idclass" id="toc-selecting-by-element-idclass" class="nav-link" data-scroll-target="#selecting-by-element-idclass"><span class="header-section-number">33.3.2</span> Selecting by element ID/Class</a></li>
  <li><a href="#selecting-by-element-attributevalue" id="toc-selecting-by-element-attributevalue" class="nav-link" data-scroll-target="#selecting-by-element-attributevalue"><span class="header-section-number">33.3.3</span> Selecting by element attribute/value</a></li>
  </ul></li>
  <li><a href="#ethical-web-scraping" id="toc-ethical-web-scraping" class="nav-link" data-scroll-target="#ethical-web-scraping"><span class="header-section-number">33.4</span> Ethical Web Scraping</a>
  <ul class="collapse">
  <li><a href="#robots.txt" id="toc-robots.txt" class="nav-link" data-scroll-target="#robots.txt"><span class="header-section-number">33.4.1</span> robots.txt</a></li>
  <li><a href="#sec-user-agents" id="toc-sec-user-agents" class="nav-link" data-scroll-target="#sec-user-agents"><span class="header-section-number">33.4.2</span> User Agents</a></li>
  </ul></li>
  <li><a href="#scraping-static-webpages" id="toc-scraping-static-webpages" class="nav-link" data-scroll-target="#scraping-static-webpages"><span class="header-section-number">33.5</span> Scraping Static Webpages</a>
  <ul class="collapse">
  <li><a href="#sec-html-table-direct" id="toc-sec-html-table-direct" class="nav-link" data-scroll-target="#sec-html-table-direct"><span class="header-section-number">33.5.1</span> Reading in HTML Tables</a></li>
  <li><a href="#sec-html-custom" id="toc-sec-html-custom" class="nav-link" data-scroll-target="#sec-html-custom"><span class="header-section-number">33.5.2</span> Scraping HTML with Custom Functions</a></li>
  </ul></li>
  <li><a href="#scraping-dynamic-webpages" id="toc-scraping-dynamic-webpages" class="nav-link" data-scroll-target="#scraping-dynamic-webpages"><span class="header-section-number">33.6</span> Scraping Dynamic Webpages</a></li>
  <li><a href="#sec-webscraping-refs" id="toc-sec-webscraping-refs" class="nav-link" data-scroll-target="#sec-webscraping-refs"><span class="header-section-number">33.7</span> References</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-advanced-topics/03-web-scraping.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-advanced-topics/00-advanced.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../part-advanced-topics/03-web-scraping.html"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Web Scraping</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-data-web" class="quarto-section-identifier"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="objectives" class="level2 nonumber" data-number="33.1">
<h2 class="nonumber anchored" data-number="33.1" data-anchor-id="objectives"><span class="header-section-number">33.1</span> Objectives</h2>
<ul>
<li>Understand the structure of XML and HTML files</li>
<li>Use developer tools to locate nodes of interest and CSS or XPATH to precisely identify those nodes</li>
<li>Identify web pages that cannot be scraped using simple methods because of content injection</li>
<li>Scrape data from web pages
<ul>
<li>by reading in HTML tables directly using R or Python</li>
<li>by writing custom functions to pull data from individual fields</li>
</ul></li>
</ul>
</section>
<section id="html-and-xml-language-specification" class="level2 page-columns page-full" data-number="33.2">
<h2 data-number="33.2" class="anchored" data-anchor-id="html-and-xml-language-specification"><span class="header-section-number">33.2</span> HTML and XML Language Specification</h2>
<p>Let’s start at the beginning. <strong>eXtensible Markup Language (XML)</strong> was developed in the late 1990s to provide a flexible specification for documents, data files, and various other documents. You’ve (likely) been using XML-based documents for most of your life, either in Microsoft Office (.docx, .xlsx, .pptx - the x is for XML) or in web pages. <strong>HyperText Markup Language (HTML)</strong> is a specific flavor of XML <span class="citation" data-cites="wikimediacontributorsXML2025"><a href="#ref-wikimediacontributorsXML2025" role="doc-biblioref">[1]</a></span> that uses a defined set of fields to specify the composition of a web page<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>If you right click in your browser on this page, and “Inspect Source”, you can see the HTML code that generates this book.</p>
<div id="fig-browser-inspect" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-browser-inspect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/advanced/chromium-inspect-source.png" class="img-fluid figure-img" alt="A screenshot of https://duckduckgo.com in chromium, where the user has right-clicked on the page. The options 'View Page Source' and 'Inspect' are located at the bottom of the pop-up menu and are highlighted."></p>
<figcaption>Chromium right click menu</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/advanced/firefox-inspect-source.png" class="img-fluid figure-img" alt="A screenshot of https://duckduckgo.com in Firefox, where the user has right-clicked on the page. The options 'View Page Source' and 'Inspect' are located towards the bottom of the pop-up menu and are highlighted."></p>
<figcaption>Firefox right click menu</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-browser-inspect-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.1: Right click menu options that allow the user to see the HTML code for a webpage.
</figcaption>
</figure>
</div>
<section id="xml" class="level3 page-columns page-full" data-number="33.2.1">
<h3 data-number="33.2.1" class="anchored" data-anchor-id="xml"><span class="header-section-number">33.2.1</span> XML</h3>
<p>XML documents are composed of a series of tags that look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">tag-type</span><span class="ot"> attribute</span><span class="op">=</span><span class="st">"value"</span><span class="dt">&gt;</span>Tag contents<span class="dt">&lt;/</span><span class="kw">tag-type</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each tag name, <code>tag</code>, is enclosed in angle brackets, <code>&lt;tag&gt;</code>, and has a closing tag that starts with a slash but has the same name, <code>&lt;/tag&gt;</code>. Tags can include additional information that is typically encoded in <code>key="value"</code> pairs - above, there is an <strong>attribute</strong> field (the part before the <code>=</code>) that has <strong>value</strong> <code>"value"</code> (the part after the <code>=</code>). A set of matching tags is called an <strong>element</strong>, and the information within the start and end tags is called the <strong>content</strong>.</p>
<p>The XML 1.0 (5th edition) specification requires that</p>
<ul>
<li><p>The document contains only one element, called the <strong>root</strong> or document element, at the top level. No part of the root element appears in the content of any other element.</p></li>
<li><p>Any other elements</p>
<ul>
<li>are defined by start and end tags, and</li>
<li>nest properly within each other (are well formed)</li>
</ul></li>
<li><p>An element contains <strong>text</strong>, a sequence of characters. Legal characters are tab, carriage return, line feed, and the legal characters of <a href="https://home.unicode.org/">Unicode</a> and <a href="https://unicode.org/L2/L2010/10038-fcd10646-main.pdf">ISO/IEC 10646 (PDF warning)</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p></li>
<li><p>Comments:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This is a valid comment --&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This is not a valid comment ---&gt;</span> (The end must have exactly 2 dashes)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This is not a valid comment </span><span class="er">--</span><span class="co"> </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">     two dashes cannot be included in the string --&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-advanced callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Advanced: Additional XML metadata
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A valid XML document also contains some additional metadata at the start of the file. First, there should be an <strong>XML declaration</strong> that specifies the version of XML being used: <code>&lt;?xml version="1.0"?&gt;</code> (Note the <code>?</code> immediately before and after the angle brackets).</p>
<p>In addition, valid XML documents contain a <strong>Document Type Definition (DTD)</strong> that provides some information about valid tags used within the document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> <span class="dt">Name</span> (ExternalID)? '<span class="dt">[</span>' intSubset '<span class="dt">]</span>' <span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Document Type Definition requirements:</p>
<ul>
<li><code>Name</code> in the DTD has the same value as the root node tag name</li>
<li>An Internal or External Subset of valid entity names (tag names) is provided. It is also possible to specify valid tag attributes, types, and other information within these listings.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode xml code-annotation-code code-with-copy code-annotated"><code class="sourceCode xml"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">"1.0"</span><span class="fu">?&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> <span class="dt">greeting</span> SYSTEM "hello.dtd"<span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">greeting</span>&gt;Hello, world!&lt;/<span class="kw">greeting</span>&gt;</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1" data-code-annotation="1">XML version declaration</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2" data-code-annotation="2">Document Type Definition. <code>greeting</code> is the name, and the root node matches that name. <code>hello.dtd</code> is the system identifier and provides an address leading to an external document type declaration file</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="3" data-code-annotation="3">Root node. <code>greeting</code> is the tag name. <code>Hello, world!</code> is the tag value. The tag is closed with a valid, matching end tag.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode xml code-annotation-code code-with-copy code-annotated"><code class="sourceCode xml"><button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">"1.0"</span><span class="ot"> encoding=</span><span class="st">"UTF-8"</span> <span class="fu">?&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-2" class="code-annotation-target"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> <span class="dt">greeting</span> <span class="dt">[</span></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;!ELEMENT</span> <span class="dt">greeting</span> (#PCDATA)<span class="dt">&gt;</span></span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a><span class="dt">]&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-5" class="code-annotation-target"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">greeting</span>&gt;Hello, world!&lt;/<span class="kw">greeting</span>&gt;</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1" data-code-annotation="1">XML version declaration, specifying the document’s text encoding</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="2" data-code-annotation="2">An internally defined DTD that specifies valid elements (tags) (the only valid element is <code>greeting</code>). Additional tags could be specified within the <code>[</code> <code>]</code> space, if desired.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="5" data-code-annotation="3">The root node with value <code>Hello, world!</code></span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<p>Elements are typically nested in an XML document.</p>
<p>Consider the following set of elements that describe the main characters in the children’s TV show <a href="https://www.youtube.com/channel/UCVzLLZkDuFGAE2BGdBuBNBg">Bluey</a>. Note that the same information about the family could be described in a number of different hierarchical ways.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Bluey</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Bluey Alt 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Bluey Alt 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Bluey Alt 3</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">family</span>&gt;</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">adults</span>&gt;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> sex=</span><span class="st">"M"</span><span class="ot"> coat=</span><span class="st">"blue"</span>&gt;Bandit Heeler&lt;/<span class="kw">person</span>&gt;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"orange"</span>&gt;Chili Heeler&lt;/<span class="kw">person</span>&gt;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">adults</span>&gt;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">kids</span>&gt;</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"blue"</span>&gt;Bluey Heeler&lt;/<span class="kw">person</span>&gt;</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"orange"</span>&gt;Bingo Heeler&lt;/<span class="kw">person</span>&gt;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">kids</span>&gt;</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">family</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>family contains two <strong>child nodes</strong> - ‘adults’, and ‘kids’. Collectively, family has two direct <strong>children</strong>.</li>
<li>‘adults’ contains two <strong>child nodes</strong> - persons - that describe the adults in the family, Chili and Bandit Heeler</li>
<li>‘kids’ contains two <strong>child nodes</strong> - persons - that describe the kids in the family, Bluey and Bingo Heeler.</li>
<li>The <strong>parent</strong> of the element describing Bingo Heeler is ‘kids’</li>
<li>The <strong>parent</strong> of the ‘kids’ element is ‘family’</li>
<li>‘adults’ and ‘kids’ are <strong>sibling</strong> elements</li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">family</span>&gt;</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"adult"</span><span class="ot"> sex=</span><span class="st">"M"</span><span class="ot"> coat=</span><span class="st">"blue"</span>   &gt; Bandit Heeler  &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"adult"</span><span class="ot"> sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"orange"</span> &gt; Chili  Heeler  &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"kid"</span><span class="ot">   sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"blue"</span>   &gt; Bluey  Heeler  &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"kid"</span><span class="ot">   sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"orange"</span> &gt; Bingo  Heeler  &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">family</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">family</span>&gt;</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"adult"</span><span class="ot"> sex=</span><span class="st">"M"</span><span class="ot"> coat=</span><span class="st">"blue"</span>   &gt; </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Bandit&lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"adult"</span><span class="ot"> sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"orange"</span> &gt; </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Chili &lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"kid"</span><span class="ot">   sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"blue"</span>   &gt; </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Bluey &lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span><span class="ot"> status=</span><span class="st">"kid"</span><span class="ot">   sex=</span><span class="st">"F"</span><span class="ot"> coat=</span><span class="st">"orange"</span> &gt; </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Bingo &lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">family</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">family</span>&gt;</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span>&gt;</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Bandit&lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">status</span>&gt;adult&lt;/<span class="kw">status</span>&gt; </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">sex</span>&gt;male&lt;/<span class="kw">sex</span>&gt;   </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">coat</span>&gt;blue&lt;/<span class="kw">coat</span>&gt;</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span>&gt;</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Chili &lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">status</span>&gt;adult&lt;/<span class="kw">status</span>&gt; </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">sex</span>&gt;female&lt;/<span class="kw">sex</span>&gt; </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">coat</span>&gt;orange&lt;/<span class="kw">coat</span>&gt;</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span>&gt;</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Bluey &lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">status</span>&gt;child&lt;/<span class="kw">status</span>&gt; </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">sex</span>&gt;female&lt;/<span class="kw">sex</span>&gt; </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">coat</span>&gt;blue&lt;/<span class="kw">coat</span>&gt;</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">person</span>&gt;</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">name</span>&gt;&lt;<span class="kw">first</span>&gt;Bingo &lt;/<span class="kw">first</span>&gt; &lt;<span class="kw">last</span>&gt;Heeler&lt;/<span class="kw">last</span>&gt;&lt;/<span class="kw">name</span>&gt; </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">status</span>&gt;child&lt;/<span class="kw">status</span>&gt; </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">sex</span>&gt;female&lt;/<span class="kw">sex</span>&gt; </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">coat</span>&gt;orange&lt;/<span class="kw">coat</span>&gt;</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">person</span>&gt;</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">family</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>When working with XML (and HTML), it is important to understand how the data are represented structurally, so that you can get the components of the data back out of this hierarchical format.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Exploring an XML file
</div>
</div>
<div class="callout-body-container callout-body">
<p>The District of Columbia (Washington, DC) local government provides a <a href="https://catalog.data.gov/dataset/grocery-store-locations">dataset of grocery store locations throughout the district</a> using a definition of full service grocery store that requires:</p>
<ul>
<li>Sales of six of the following categories of food:
<ul>
<li>Fresh fruits and vegetables</li>
<li>Fresh and uncooked meats, poultry and seafood</li>
<li>Dairy products</li>
<li>Canned foods</li>
<li>Frozen foods</li>
<li>Dry groceries and baked goods</li>
<li>Non-alcoholic beverages</li>
</ul></li>
<li>Either 50% of the store’s total square footage, or 6000 square feet must be dedicated to selling the food products above.</li>
<li>At least 5% of the selling area must be dedicated to each food category.</li>
</ul>
<p>The city then included some small grocery stores that are very close to meeting the full-service grocery store definition based on <a href="https://dcfoodpolicy.org/wp-content/uploads/2019/06/2018-food-system-assessment-final-6.13.pdf">Appendix D of a city-wide food system assessment</a> (PDF warning).</p>
<p>We can <a href="https://opendata.dc.gov/api/download/v1/items/1d7c9d0e3aac49c1aa88d377a3bae430/kml?layers=4">download the KML file</a> and change the extension to XML so that the file opens in a standard web browser, or we can directly download the KML file as an XML file as in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://opendata.dc.gov/api/download/v1/items/1d7c9d0e3aac49c1aa88d377a3bae430/kml?layers=4"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"../data/DC_Grocery_Stores_2025.xml"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(filename)) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(url, <span class="at">destfile =</span> filename, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>xml_text <span class="ot">&lt;-</span> <span class="fu">readLines</span>(filename)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>xml_tbl <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">line =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(xml_text), </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xml =</span> xml_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8621046de5fc2c35c96e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8621046de5fc2c35c96e">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8,9,10,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,3145,3146,3147,3148,3149,3150,3151],["&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;","&lt;kml xmlns=\"http://www.opengis.net/kml/2.2\"&gt;","&lt;Document id=\"root_doc\"&gt;","&lt;Schema name=\"Grocery_Store_Locations\" id=\"Grocery_Store_Locations\"&gt;","\t&lt;SimpleField name=\"STORENAME\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"ADDRESS\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"ZIPCODE\" type=\"int\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"PHONE\" type=\"float\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"WARD\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"SSL\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"SE_ANNO_CAD_DATA\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"GLOBALID\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"CREATED\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"EDITED\" type=\"string\"&gt;&lt;/SimpleField&gt;","\t&lt;SimpleField name=\"OBJECTID\" type=\"int\"&gt;&lt;/SimpleField&gt;","&lt;/Schema&gt;","&lt;Folder&gt;&lt;name&gt;Grocery_Store_Locations&lt;/name&gt;","  &lt;Placemark&gt;","\t&lt;ExtendedData&gt;&lt;SchemaData schemaUrl=\"#Grocery_Store_Locations\"&gt;","\t\t&lt;SimpleData name=\"STORENAME\"&gt;Target &lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"ADDRESS\"&gt;7828 GEORGIA AVENUE NW&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"ZIPCODE\"&gt;20012&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"PHONE\"&gt;2028923822&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"WARD\"&gt;Ward 4&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"SSL\"&gt;2960    0017&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"PRESENT22\"&gt;Yes&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"PRESENT23\"&gt;Yes&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"PRESENT24\"&gt;Yes&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"PRESENT25\"&gt;Yes&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"GIS_ID\"&gt;GroceryStorePt_1&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"XCOORD\"&gt;397662.57&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"YCOORD\"&gt;146280.07&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"MAR_ID\"&gt;300512&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"GLOBALID\"&gt;{CE302122-4E8D-4DC7-845B-06563B993F66}&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"CREATED\"&gt;2022/09/28 22:04:54+00&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"EDITED\"&gt;2025/01/14 19:33:19+00&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"OBJECTID\"&gt;641&lt;/SimpleData&gt;","\t&lt;/SchemaData&gt;&lt;/ExtendedData&gt;","      &lt;Point&gt;&lt;coordinates&gt;-77.0269805790129,38.9844552988866&lt;/coordinates&gt;&lt;/Point&gt;","  &lt;/Placemark&gt;","\t\t&lt;SimpleData name=\"EDITED\"&gt;2025/01/14 19:33:19+00&lt;/SimpleData&gt;","\t\t&lt;SimpleData name=\"OBJECTID\"&gt;1921&lt;/SimpleData&gt;","\t&lt;/SchemaData&gt;&lt;/ExtendedData&gt;","      &lt;Point&gt;&lt;coordinates&gt;-76.9997257446131,38.9545357353458&lt;/coordinates&gt;&lt;/Point&gt;","  &lt;/Placemark&gt;","&lt;/Folder&gt;","&lt;/Document&gt;&lt;/kml&gt;"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>line<\/th>\n      <th>xml<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"columnDefs":[{"className":"dt-right","targets":0},{"name":"line","targets":0},{"name":"xml","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ul>
<li>The first line contains the document type definition and encoding.</li>
<li>The second line contains a link to the <a href="https://schemas.opengis.net/kml/2.2.0/ogckml22.xsd">KML specification</a>, which is itself another XML document. Note that it is also a valid tag, so at the end of the file, we should find .</li>
<li>The third line is another tag that indicates that this is the start of the document.</li>
<li>Lines 4-40 contain the dataset schema – a list of all of the fields present for each store, along with their data type.</li>
<li>Line 41 defines a folder, which contains Placemarks (Line 42), which contain ExtendedData (Line 43). The <code>\t</code> characters are a text representation of tabs and indicate some indentation.</li>
<li>Each grocery store appears to be described by a Placemark node that contains ExtendedData nodes containing variables, along with a Point node that contains two coordinates (latitude and longitude).</li>
</ul>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/advanced/DC_Grocery_Stores_2025_xml_screenshot_annotated.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="(Click to Enlarge) Screenshot of DC_Grocery_Stores_2025.xml showing the nodes corresponding to the Schema definition and to one individual grocery store."><img src="../images/advanced/DC_Grocery_Stores_2025_xml_screenshot_annotated.png" class="img-fluid figure-img" alt="XML document with schema definition and store data for grocery store locations. The top section, labeled &quot;Schema Definition,&quot; is enclosed in a blue border and contains XML schema elements describing various data fields related to grocery store locations. The fields include store name, address, zip code, phone number, and other identifiers. Each field is defined by a SimpleField tag with a name and type attribute. The bottom section, labeled &quot;Individual Grocery Store Data,&quot; is enclosed in an orange border and provides detailed data about a specific grocery store location using XML tags. This includes the store’s name, address, phone number, GIS coordinates, and several other identifiers. The text &quot;Schema Definition&quot; and &quot;Individual Grocery Store Data&quot; are prominently displayed in larger font sizes within their respective sections."></a></p>
<figcaption>(Click to Enlarge) Screenshot of DC_Grocery_Stores_2025.xml showing the nodes corresponding to the Schema definition and to one individual grocery store.</figcaption>
</figure>
</div>
</div></div></section>
<section id="html" class="level3 page-columns page-full" data-number="33.2.2">
<h3 data-number="33.2.2" class="anchored" data-anchor-id="html"><span class="header-section-number">33.2.2</span> HTML</h3>
<p>HTML is a markup language that appears very similar to XML. Technically, HTML predates XML by a few years (1993 vs 1996) <span class="citation" data-cites="HTMLVsXML2024"><a href="#ref-HTMLVsXML2024" role="doc-biblioref">[2]</a></span>, but they’ve been developed in parallel and there are obvious influences in both directions.</p>
<p>Important differences between HTML and XML <span class="citation" data-cites="HTMLVsXML2024"><a href="#ref-HTMLVsXML2024" role="doc-biblioref">[2]</a></span>:</p>
<ul>
<li>HTML tags <strong>display</strong> information. XML tags <strong>describe</strong> information.</li>
<li>HTML uses <strong>pre-defined</strong> tags instead of XML’s user-defined tags.</li>
<li>HTML doesn’t always require closing tags, while XML does.</li>
<li>HTML is more robust than XML, in that it will ignore small errors.</li>
<li>HTML is not case sensitive, while XML is.</li>
<li>HTML ignores white space, but XML doesn’t <em>necessarily</em> ignore white space.</li>
</ul>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: HTML Document Structure
</div>
</div>
<div class="callout-body-container callout-body">
<p>Like XML, HTML documents have a basic structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode html code-annotation-code code-with-copy code-annotated"><code class="sourceCode html"><button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1">1</button><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2">2</button><span id="annotated-cell-11-2" class="code-annotation-target"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3">3</button><span id="annotated-cell-11-3" class="code-annotation-target"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="4">4</button><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Page Title<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-5"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-6"><a href="#annotated-cell-11-6" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="5">5</button><span id="annotated-cell-11-7" class="code-annotation-target"><a href="#annotated-cell-11-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-8"><a href="#annotated-cell-11-8" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>Level 1 Heading<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-9"><a href="#annotated-cell-11-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>This paragraph provides information about the topic in the L1 heading.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-10"><a href="#annotated-cell-11-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h2</span><span class="dt">&gt;</span>Level 2 Heading<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-11"><a href="#annotated-cell-11-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>This paragraph provides even more information relating the L2 heading to L1.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="6">6</button><span id="annotated-cell-11-12" class="code-annotation-target"><a href="#annotated-cell-11-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-13"><a href="#annotated-cell-11-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-11-14"><a href="#annotated-cell-11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-15"><a href="#annotated-cell-11-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span> </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="1">This indicates that the document is an HTML5 document</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="2" data-code-annotation="2">The root element of an HTML page</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="3" data-code-annotation="3">The head element contains meta information about the page. Most scripts and formatting information (CSS) are also loaded in this element.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="4" data-code-annotation="4">The page title is what will show up in the browser tab.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="7" data-code-annotation="5">The body element contains the actual information rendered on the page.</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="12" data-code-annotation="6">This element creates a line break, but has no content. Empty elements (elements with no content) do not have to have a closing tag (but you can add one if it makes you happy).</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
<p>You can easily see the HTML code that creates any website by right clicking on the web page in your browser and selecting some variant of “Inspect” or “Inspect Source” or “View Source”, as shown in <a href="#fig-browser-inspect" class="quarto-xref">Figure&nbsp;<span>33.1</span></a>. This is an incredibly helpful tool when you want to figure out how to pull data out of a webpage, getting only the parts you want without the rest of the clutter.</p>
<p>The best way to think about a HTML page is that it consists of a series of elements that are best thought of as boxes. Elements like <code>&lt;h1&gt; &lt;/h1&gt;</code> define a box with specific contents. These boxes are then styled and arranged via the “magic” of <em>Cascading Style Sheets (CSS)</em>. When I first learned HTML (circa 2001?), there were a reasonable number of tags and CSS was not really a thing, so it was easier to understand how web pages were laid out, and we could spend our time decking out webpages <a href="https://www.cameronsworld.net/">with neon colors, animated images, and annoying music</a>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-css-awesome" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A mug that says 'CSS is Awesome' with a box around it, but the box cuts off the 'me' in awesome.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-css-awesome-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/advanced/css-mug.jpg" class="img-fluid figure-img" alt="A mug that says 'CSS is Awesome' with a box around it, but the box cuts off the 'me' in awesome.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-css-awesome-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.2: CSS is “magic” … finicky and annoying magic.
</figcaption>
</figure>
</div>
</div></div><p>Now, there are too many valid HTML tags for to cover in an introduction, but first let’s review the anatomy of an XML or HTML element, and then we can look at some of the most important HTML tags.</p>
<section id="html-element-anatomy" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="html-element-anatomy">HTML Element Anatomy</h4>
<p><span class="math display">\[\underbrace{\ \ \overbrace{&lt; \text{p}\ \  \underbrace{\text{class}}_{\text{Attribute}}=\underbrace{\text{'important'}}_{\text{Value}} &gt;}^{\text{Start tag}} \ \ \ \underbrace{\text{This is a paragraph}}_{\text{Content}} \ \ \ \overbrace{&lt;/ \text{p} &gt;}^{\text{End tag}}\ \ \ }_{\text{Element}} \]</span></p>
</section>
<section id="important-html-tags" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="important-html-tags">Important HTML Tags</h4>
<ul>
<li><p><code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, <code>&lt;h3&gt;</code>, <code>&lt;h4&gt;</code>, <code>&lt;h5&gt;</code>, <code>&lt;h6&gt;</code>: Headings.<br>
Headings should be nested, so you should never have content in <code>&lt;h2&gt;This is wrong&lt;/h2&gt;</code> unless there is an <code>&lt;h1&gt; &lt;/h1&gt;</code> element above it in the same block of content.<br>
Corresponds to <code>#</code>, …, <code>######</code> in markdown.</p></li>
<li><p><code>&lt;p&gt;</code>: Paragraphs. All text that isn’t part of some other tag should be contained in paragraph tags.</p></li>
<li><p><code>&lt;a&gt;</code>: links. <code>&lt;a href="https://google.com"&gt;This links to google&lt;/a&gt;</code><br>
<code>href</code> is a tag attribute, and <code>https://google.com</code> is the attribute’s value.</p></li>
<li><p><code>&lt;img&gt;</code>: Images. <code>&lt;img src="path/to/picture.jpg" alt="Alt-text description of the picture"&gt;</code>. As with line breaks, you do not have to have a <code>&lt;/img&gt;</code> tag unless having unclosed tags bothers you.</p></li>
<li><p><code>&lt;table&gt;</code>: Tables. In HTML, tables are constructed by row. Here is a minimal table that has a header:</p></li>
</ul>
<div class="columns">
<div class="column" style="width:45%;">
<p>HTML:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode html code-annotation-code code-with-copy code-annotated"><code class="sourceCode html"><button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">table</span><span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2">2</button><span id="annotated-cell-12-2" class="code-annotation-target"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3">3</button><span id="annotated-cell-12-3" class="code-annotation-target"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">th</span><span class="dt">&gt;</span>Heading Col 1<span class="dt">&lt;/</span><span class="kw">th</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-12-4"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">th</span><span class="dt">&gt;</span>Heading Col 2<span class="dt">&lt;/</span><span class="kw">th</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4">4</button><span id="annotated-cell-12-7" class="code-annotation-target"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>Value 1<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">td</span><span class="dt">&gt;</span>Value 2<span class="dt">&lt;/</span><span class="kw">td</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">tr</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">table</span><span class="dt">&gt;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="1" data-code-annotation="1">The table element contains all table contents</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="2" data-code-annotation="2">The tr element defines a new row of the table</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="3" data-code-annotation="3">The th element defines a header cell</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="7" data-code-annotation="4">The td element defines a normal (body) cell</span>
</dd>
</dl>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<p>Rendered:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Heading Col 1</td>
<td data-quarto-table-cell-role="th">Heading Col 2</td>
</tr>
<tr class="even">
<td>Value 1</td>
<td>Value 2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<ul>
<li><p><code>&lt;ul&gt;</code> and <code>&lt;ol&gt;</code>: Unordered (bulleted) and ordered lists. List elements are included as child elements and start/end with <code>&lt;li&gt;&lt;/li&gt;</code> (for both types of lists).</p></li>
<li><p><code>&lt;span&gt;</code>: a container for inline content – that is, content that is part of another piece of text. Spans are often used to highlight specific text using color or other formatting attributes (font, boldness, size).</p></li>
<li><p><code>&lt;div&gt;</code>: a container for other content. These containers are often used to help style and lay out content using CSS.</p></li>
</ul>
</section>
<section id="common-html-attributes" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="common-html-attributes">Common HTML Attributes</h4>
<p>Some attributes in HTML are special and are used across a number of different tag types.</p>
<ul>
<li>ID: A shorthand name for the element. For instance, the ID for this level 4 section heading is <code>common-html-attributes</code></li>
<li>Class: The category the element belongs to. Often, this is used to help style the element with appropriate CSS - for instance, to ensure that all level 4 headings have the same font size and color. There can be multiple values for the class attribute, separated by spaces. The class value for this level 4 section heading is <code>level4 unnumbered</code>, indicating both the heading level and that I’ve switched off numbering for this sub-sub-sub-sub-section.</li>
<li>Style: Any CSS items which apply only to the specific element. For this section, only the link to this section added by quarto/pandoc has a style attribute specified (because it is applied automatically when the quarto document is compiled)</li>
</ul>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: HTML for the Common HTML Attributes subsection
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I have added line-breaks and indentation for readability, but the rest of the code is copied from my browser.</p>
<pre><code>&lt;section id="common-html-attributes" class="level4 unnumbered"&gt;
  &lt;h4 class="unnumbered anchored" data-anchor-id="common-html-attributes"&gt;
    Common HTML Attributes
    &lt;a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" 
       href="#common-html-attributes" 
       style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; 
              padding-right: 0.1875em; padding-left: 0.1875em;"&gt;&lt;/a&gt;
  &lt;/h4&gt;
  &lt;p&gt;Some attributes in HTML are special and are used across a number of 
     different tag types.&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;ID: A shorthand name for the element. 
        For instance, the ID for this level 4 section heading is 
        &lt;code&gt;common-html-attributes&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;Class: The category the element belongs to. 
        Often, this is used to help style the element with appropriate CSS - 
        for instance, to ensure that all level 4 headings have the same font 
        size and color. 
        There can be multiple values for the class attribute, separated by spaces. 
        The class value for this level 4 section heading is 
        &lt;code&gt;level4 unnumbered&lt;/code&gt;, 
        indicating both the heading level and that I’ve switched off numbering 
        for this sub-sub-sub-sub-section.&lt;/li&gt;
    &lt;li&gt;Style: Any CSS items which apply only to the specific element. 
        For this section, only the link to this section added by quarto/pandoc 
        has a style attribute specified (because it is applied automatically 
        when the quarto document is compiled)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/section&gt;</code></pre>
</div>
</div>
</div>
</section>
</section>
<section id="reading-html-and-xml-files" class="level3" data-number="33.2.3">
<h3 data-number="33.2.3" class="anchored" data-anchor-id="reading-html-and-xml-files"><span class="header-section-number">33.2.3</span> Reading HTML and XML files</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: When searching for help, be sure to specify packages in your query!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are many different packages and approaches in both R and Python to working with HTML and XML. Some people write their own custom parsers with regular expressions (masochists!), and there are multiple versions of packages (<code>xml</code> vs <code>xml2</code>, <code>httr</code> and <code>httr2</code>) as well as packages that have fairly similar syntax (<code>rvest</code>, <code>polite</code>) and packages that operate at very different technical levels (<code>curl</code>, <code>httr2</code>, <code>rvest</code>). In the python ecosystem, there are multiple packages that have different ways to handle files in addition to different mechanisms and syntax for sifting through the HTML/XML nodes.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">33.2.3.1</span> Demo: Reading HTML files from the web
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is the basic syntax for reading in an XML or HTML file in R and python using commonly recommended packages for the job.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki/HTML"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">xml_children</span>(doc)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">## {xml_nodeset (2)}</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &lt;head&gt;\n&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8 ...</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &lt;body class="skin--responsive skin-vector skin-vector-search-vue mediawik ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We use <code>read_html()</code> to read in the document (the syntax is the same whether you’re using a URL or a file path) and then can use <code>xml_children()</code> and other parsing functions to make some sense of the structure of the document – in this case, confirming that it’s a valid HTML document with a head and body node.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests <span class="co"># Gets files from the web</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/HTML"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># response.text # This outputs a ton of stuff</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup <span class="co"># Parses HTML/XML</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(response.text)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>children <span class="op">=</span> soup.html.find_all(recursive<span class="op">=</span><span class="va">False</span>) <span class="co"># get direct children of the HTML tag</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> child <span class="kw">in</span> children:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(child.name) <span class="co"># content is too long to print everything</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">## head</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">## body</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have to request the HTML document using <code>requests.get(url)</code> and then parse the HTML document with <code>bs4.BeautifulSoup</code>.</p>
<p>The remaining code just serves to confirm that we have both a head and a body node.</p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="filtering-data-from-htmlxml-css-and-xpath-selectors" class="level2 page-columns page-full" data-number="33.3">
<h2 data-number="33.3" class="anchored" data-anchor-id="filtering-data-from-htmlxml-css-and-xpath-selectors"><span class="header-section-number">33.3</span> Filtering Data from HTML/XML: CSS and XPath Selectors</h2>
<p>Often, when pulling data from HTML or XML documents, it is useful to be able to navigate to one or more specific elements of the document and extract only those elements. There are two different “languages” for doing this - CSS selectors, which primarily are used with HTML documents, and XPath selectors, which can be used with both HTML and XML.</p>
<div class="callout callout-style-default callout-learnmore callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn More
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You may find it helpful to reference these guides to XPath and CSS selectors directly:</p>
<ul>
<li><a href="https://www.w3schools.com/xml/xpath_syntax.asp">XPath syntax</a></li>
<li><a href="https://www.w3schools.com/cssref/css_selectors.php">CSS selectors</a></li>
</ul>
</div>
</div>
</div>
<section id="selecting-by-element-type" class="level3" data-number="33.3.1">
<h3 data-number="33.3.1" class="anchored" data-anchor-id="selecting-by-element-type"><span class="header-section-number">33.3.1</span> Selecting by element type</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 82%">
<col style="width: 9%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>CSS</th>
<th>XPath</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Select all <code>p</code> elements from the document</td>
<td><code>p</code></td>
<td><code>//p</code></td>
</tr>
<tr class="even">
<td>Select all <code>p</code> elements that are direct descendants of an <code>h1</code> element</td>
<td><code>h1 \&gt; p</code></td>
<td><code>h1/p</code></td>
</tr>
<tr class="odd">
<td>Select all <code>p</code> elements that are descendants of an <code>h1</code> element, no matter where they are under <code>h1</code></td>
<td><code>h1 p</code></td>
<td><code>h1//p</code></td>
</tr>
</tbody>
</table>
<p>CSS elements can be combined using <strong>combinators</strong> - <a href="https://www.w3schools.com/cssref/css_ref_combinators.php">specific combination operators</a>. There are also <a href="https://www.w3schools.com/xml/xpath_axes.asp">XPath axes</a> that provide some useful ways to combine selectors to get specific results.</p>
</section>
<section id="selecting-by-element-idclass" class="level3" data-number="33.3.2">
<h3 data-number="33.3.2" class="anchored" data-anchor-id="selecting-by-element-idclass"><span class="header-section-number">33.3.2</span> Selecting by element ID/Class</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>CSS</th>
<th>XPath</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Select the element with ID “objectives”</td>
<td><code>#objectives</code></td>
<td><code>//[@id='objectives']</code></td>
</tr>
<tr class="even">
<td>Select the <code>&lt;p&gt;</code> element with ID “objectives”</td>
<td><code>p#objectives</code></td>
<td><code>//p[@id='objectives']</code></td>
</tr>
<tr class="odd">
<td>Select the element with class ‘level2’</td>
<td><code>.level2</code></td>
<td><code>//[@class='level2']</code></td>
</tr>
<tr class="even">
<td>Select the <code>&lt;p&gt;</code> element with class ‘level2’</td>
<td><code>p.level2</code></td>
<td><code>//p[@class='level2']</code></td>
</tr>
</tbody>
</table>
<p>Of course, you can chain these selectors together just as in the previous section.</p>
</section>
<section id="selecting-by-element-attributevalue" class="level3 page-columns page-full" data-number="33.3.3">
<h3 data-number="33.3.3" class="anchored" data-anchor-id="selecting-by-element-attributevalue"><span class="header-section-number">33.3.3</span> Selecting by element attribute/value</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>CSS</th>
<th>XPath</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Select all elements with a “dataID” attribute</td>
<td><code>[dataID]</code></td>
<td><code>//@dataID</code></td>
</tr>
<tr class="even">
<td>Select all <code>&lt;p&gt;</code> elements with any attribute</td>
<td>not supported</td>
<td><code>//p[@*]</code></td>
</tr>
<tr class="odd">
<td>Select all <code>&lt;p&gt;</code> elements with a “dataID” attribute</td>
<td><code>p[dataID]</code></td>
<td><code>//p[@dataID]</code></td>
</tr>
<tr class="even">
<td>Select all elements with a “dataID” attribute equal to “mydata”</td>
<td><code>[dataID='mydata']</code></td>
<td><code>//*[@dataID='mydata']</code></td>
</tr>
<tr class="odd">
<td>Select all elements with a “dataID” attribute containing “my”</td>
<td><code>[dataID~='my']</code> or <code>[dataID*='my']</code></td>
<td><code>//*[contains(@dataID, 'mydata')]</code></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Reading in Olympics Medals from HTML
</div>
</div>
<div class="callout-body-container callout-body">
<p>The IOC (International Olympic Committee) publishes medal counts for each Olympics, including the <a href="https://www.olympics.com/en/olympic-games/paris-2024/medals">2024 Paris games</a>. If the code below doesn’t work, try using the <a href="../data/Paris 2024 Olympic Medal Table - Gold, Silver &amp; Bronze.html">archived page</a> instead. A screenshot of the rendered page is available in <a href="#fig-olympic-medal-page" class="quarto-xref">Figure&nbsp;<span>33.3</span></a>. Though the page <em>appears</em> to have a table, in fact, the table does not make use of an HTML table element; instead, each row is a series of <code>div</code> elements</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>If you’re curious about why I’m reading the HTML from a saved version of the webpage, see the explanation in <a href="#sec-user-agents" class="quarto-xref"><span>Section 33.4.2</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="annotated-cell-18-2"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="annotated-cell-18-3"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="annotated-cell-18-4"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="annotated-cell-18-5"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="annotated-cell-18-6"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="annotated-cell-18-7"><a href="#annotated-cell-18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="annotated-cell-18-8"><a href="#annotated-cell-18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-18-9"><a href="#annotated-cell-18-9" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"../data/Paris 2024 Olympic Medal Table - Gold, Silver &amp; Bronze.html"</span>)</span>
<span id="annotated-cell-18-10"><a href="#annotated-cell-18-10" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1">1</button><span id="annotated-cell-18-11" class="code-annotation-target"><a href="#annotated-cell-18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">html_element</span>(doc, <span class="st">"table"</span>)</span>
<span id="annotated-cell-18-12"><a href="#annotated-cell-18-12" aria-hidden="true" tabindex="-1"></a><span class="do">## {xml_missing}</span></span>
<span id="annotated-cell-18-13"><a href="#annotated-cell-18-13" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;NA&gt;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="11" data-code-annotation="1">Search the HTML for <code>&lt;table&gt;</code> – no results</span>
</dd>
</dl>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-19-1"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="annotated-cell-19-2"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1">1</button><span id="annotated-cell-19-3" class="code-annotation-target"><a href="#annotated-cell-19-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup, SoupStrainer</span>
<span id="annotated-cell-19-4"><a href="#annotated-cell-19-4" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="2">2</button><span id="annotated-cell-19-5" class="code-annotation-target"><a href="#annotated-cell-19-5" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> <span class="bu">open</span>(<span class="st">"../data/Paris 2024 Olympic Medal Table - Gold, Silver &amp; Bronze.html"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="3">3</button><span id="annotated-cell-19-6" class="code-annotation-target"><a href="#annotated-cell-19-6" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="bu">file</span>.read()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="3" data-code-annotation="1"><code>bs4</code> is a library for web scraping. <code>BeautifulSoup</code> is its primary function.</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="5" data-code-annotation="2">The HTML page is saved to disk for this example, so we can open that file using <code>open()</code></span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="6" data-code-annotation="3">We can read the HTML using <code>file.read()</code></span>
</dd>
</dl>
</div>
</div>
<p>Pandas has a function that will read in an HTML table from an HTML page and convert it directly to a data frame. Let’s try that first. Pandas expects an HTML file, not the literal HTML, so we pass in <code>file</code> instead of <code>index</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pd.read_html(<span class="bu">file</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">##   File "&lt;string&gt;", line 0</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">## lxml.etree.XMLSyntaxError: no text parsed from document</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well, that didn’t work so well, so let’s look for an actual table element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(index)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> soup.find_all(<span class="st">"table"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>tables</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">## []</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Next, we look at the HTML and see that the table itself is wrapped in an element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"Table-styles__Wrapper-sc-7c5c517a-0 cqlSCS"</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s too much to type, so search for elements with a class that contains “Table”.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>table_nodes <span class="ot">&lt;-</span> <span class="fu">html_element</span>(doc, <span class="at">css =</span> <span class="st">"[class*='Table']"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>table_nodes</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## {html_node}</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;div class="Table-styles__Wrapper-sc-7c5c517a-0 cqlSCS"&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &lt;div data-cy="order-by" class="styles__OrderBy-sc-2eade904-0 kaHofu"&gt;\n&lt;s ...</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &lt;div data-cy="table-header" class="Table-styles__CommonGrid-sc-7c5c517a-1 ...</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] &lt;div data-cy="table-content" class="Table-styles__CommonGrid-sc-7c5c517a- ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1">1</button><span id="annotated-cell-23-1" class="code-annotation-target"><a href="#annotated-cell-23-1" aria-hidden="true" tabindex="-1"></a>table_nodes <span class="op">=</span> soup.select(<span class="st">"*[class*=Table]"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="2">2</button><span id="annotated-cell-23-2" class="code-annotation-target"><a href="#annotated-cell-23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(table_nodes)</span>
<span id="annotated-cell-23-3"><a href="#annotated-cell-23-3" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="3">3</button><span id="annotated-cell-23-4" class="code-annotation-target"><a href="#annotated-cell-23-4" aria-hidden="true" tabindex="-1"></a>[i.<span class="fu">__str__</span>()[<span class="dv">0</span>:<span class="dv">100</span>] <span class="cf">for</span> i <span class="kw">in</span> table_nodes]</span>
<span id="annotated-cell-23-5"><a href="#annotated-cell-23-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 3</span></span>
<span id="annotated-cell-23-6"><a href="#annotated-cell-23-6" aria-hidden="true" tabindex="-1"></a><span class="co">## ['&lt;div class="Table-styles__Wrapper-sc-7c5c517a-0 cqlSCS"&gt;&lt;div class="styles__OrderBy-sc-2eade904-0 ka', '&lt;div class="Table-styles__CommonGrid-sc-7c5c517a-1 Table-styles__Header-sc-7c5c517a-2 dTTMvn bBWhIS"', '&lt;div class="Table-styles__CommonGrid-sc-7c5c517a-1 Table-styles__Content-sc-7c5c517a-3 dTTMvn jfNiTo']</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="1" data-code-annotation="1">Get all nodes that have class that starts with Table</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="2" data-code-annotation="2">How many nodes did we find?</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="4" data-code-annotation="3">Print out the first 100 characters of each element to see what we found without drowning in text.</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<p>It can be hard to get the hang of “reading” HTML to make sense of it – what I usually do is try to find the narrowest set of nodes I can that have the content I want. To identify this, I’ll use a process like that shown in <a href="#fig-olympic-html-gif" class="quarto-xref">Figure&nbsp;<span>33.4</span></a>, where I’ll right click on the web page in the browser, select “Inspect element”, and then interactively hover over various HTML elements until I get a sense of what each component of the rendered page looks like in HTML.</p>
<p>In this case, the ‘minimal node’ is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-cy</span><span class="op">=</span><span class="st">"table-content"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"Table-styles__CommonGrid-sc-7c5c517a-1 Table-styles__Content-sc-7c5c517a-3 dTTMvn jfNiTo"</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It has just the content, without the sortable headers and other stuff that we don’t particularly care about. That is, the headers and such are important for context, but can be added in to the table relatively quickly (and thus aren’t worth the time to scrape).</p>
<p>I also noticed that in each “column” of a single row, there are div elements with attributes that contain the row number (<code>data-row-id</code> or <code>data-medal-id</code>), and that each div element has one or the other of these attributes, but not both. That means that if we can get the row numbers from the attributes and the column numbers based on the relative position of the elements, we can reconstruct the table structure from just a list of disjoint <code>div</code> elements.</p>
<div class="callout callout-style-default callout-learnmore callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Another Approach: Text Editor HTML Magic
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Sometimes, if I’m not feeling the interactive inspection in the browser, or if things are complicated and/or the inspection isn’t going well, I’ll take a more direct approach and copy a subset of the HTML out into a text editor. Then, I do a little bit of find-and-replace magic:</p>
<ol type="1">
<li>Search for <code>&lt;</code> and replace it with <code>\n&lt;</code>, to get each tag on its own line in the text document. HTML may not care much about whitespace between text nodes, but it makes it a lot more human-readable.</li>
<li>Search for <code>\n&lt;/</code> and replace it with <code>&lt;/</code> to get the end tags back on the same line as the corresponding start tag (at least for elements with no children).</li>
</ol>
<p>You can see the result of this find-and-replace magic in <a href="../data/Paris 2024 Olympic Medal Table - Gold, Silver &amp; Bronze - table only.txt">this file</a>.</p>
<p>In my simplified view, I start to notice a pattern of div-span-span. That is, each div element contains a couple of span elements, and there are several div- elements that show up for each row in the table. Some of these elements have attribute <code>data-row-id</code> and some have attribute <code>data-medal-id</code>, but the values of each of these attributes have <code>row-##</code> where <code>##</code> is the row number in the table. As a result, it seems like we might want to focus primarily on the div elements and only work with the span elements if we absolutely have to.</p>
</div>
</div>
</div>
<p>There is always a “prettier” way to do HTML parsing, but in most cases it’s faster and more straightforward to take a quick-and-dirty approach and only make things more complicated if necessary.</p>
<p>Based on the basic structure I’ve described above, let’s try to write code that</p>
<ol type="1">
<li>Looks for the div elements that have attributes <code>data-row-id</code> and <code>data-medal-id</code></li>
<li>Gets the text from these elements</li>
<li>Rearranges the text from (2) into rows and columns using a pivot operation</li>
<li>Converts medal counts to numeric variables, if they are characters, replacing ‘-’ with <code>NA</code></li>
</ol>
<p>Each step in this outline may take more than one line of code.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>The CSS selector we use here is a compound selector - it looks for div elements that have <code>data-row-id</code> or <code>data-medal-id</code> as an attribute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1">1</button><span id="annotated-cell-24-1" class="code-annotation-target"><a href="#annotated-cell-24-1" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> <span class="fu">html_elements</span>(doc, <span class="at">css =</span> <span class="st">"div[data-row-id],div[data-medal-id]"</span>)</span>
<span id="annotated-cell-24-2"><a href="#annotated-cell-24-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="2">2</button><span id="annotated-cell-24-3" class="code-annotation-target"><a href="#annotated-cell-24-3" aria-hidden="true" tabindex="-1"></a>header_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"row"</span>, <span class="st">"flag"</span>, <span class="st">"country_abb"</span>,</span>
<span id="annotated-cell-24-4"><a href="#annotated-cell-24-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"gold"</span>, <span class="st">"silver"</span>, <span class="st">"bronze"</span>, <span class="st">"total"</span>, <span class="st">"country"</span>)</span>
<span id="annotated-cell-24-5"><a href="#annotated-cell-24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-6"><a href="#annotated-cell-24-6" aria-hidden="true" tabindex="-1"></a>medal_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="3">3</button><span id="annotated-cell-24-7" class="code-annotation-target"><a href="#annotated-cell-24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(table_data),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="4">4</button><span id="annotated-cell-24-8" class="code-annotation-target"><a href="#annotated-cell-24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">map_chr</span>(table_data, html_text),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="5">5</button><span id="annotated-cell-24-9" class="code-annotation-target"><a href="#annotated-cell-24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">medal_attributes =</span> <span class="fu">map_chr</span>(table_data, <span class="sc">~</span><span class="fu">html_attr</span>(., <span class="st">"data-medal-id"</span>)),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="6">6</button><span id="annotated-cell-24-10" class="code-annotation-target"><a href="#annotated-cell-24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">row_attributes =</span> <span class="fu">map_chr</span>(table_data, <span class="sc">~</span><span class="fu">html_attr</span>(., <span class="st">"data-row-id"</span>))</span>
<span id="annotated-cell-24-11"><a href="#annotated-cell-24-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="7">7</button><span id="annotated-cell-24-12" class="code-annotation-target"><a href="#annotated-cell-24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(medal_attributes),</span>
<span id="annotated-cell-24-13"><a href="#annotated-cell-24-13" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_extract</span>(row_attributes, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>),</span>
<span id="annotated-cell-24-14"><a href="#annotated-cell-24-14" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_extract</span>(medal_attributes, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>))) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="8">8</button><span id="annotated-cell-24-15" class="code-annotation-target"><a href="#annotated-cell-24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-24-16"><a href="#annotated-cell-24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="1" data-code-annotation="1">Search for <code>div</code> nodes that have either <code>data-row-id</code> or <code>data-medal-id</code> attributes.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="3,4" data-code-annotation="2">Define a header row that corresponds to the 8 <code>div</code> elements in each row.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="7" data-code-annotation="3">Create a table with the index of the nodes in the list created in step 1.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="8" data-code-annotation="4">Convert each HTML node to text (quick and dirty option)</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="9" data-code-annotation="5">Get the <code>data-row-id</code> if it exists</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="10" data-code-annotation="6">Get the <code>data-medal-id</code> if it exists</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="12,13,14" data-code-annotation="7">Get the row number from <code>data-row-id</code> if <code>medal_attributes</code> is <code>NA</code>, and otherwise, get it from <code>data-medal-id.</code></span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="15,16" data-code-annotation="8">Group by row number and create column number, assuming the nodes are in row, column order.</span>
</dd>
</dl>
</div>
</div>
<p>These steps account for the first two steps listed in the outline above. Next, we need to pivot the data to get the table as it is shown visually on the webpage, and then we need to convert the medal totals from character to numeric variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-25"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-25-1"><a href="#annotated-cell-25-1" aria-hidden="true" tabindex="-1"></a>medal_data_wide <span class="ot">&lt;-</span> medal_data <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="1">1</button><span id="annotated-cell-25-2" class="code-annotation-target"><a href="#annotated-cell-25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>idx, <span class="sc">-</span>medal_attributes, <span class="sc">-</span>row_attributes) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="2">2</button><span id="annotated-cell-25-3" class="code-annotation-target"><a href="#annotated-cell-25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> column, <span class="at">values_from =</span> text) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="3">3</button><span id="annotated-cell-25-4" class="code-annotation-target"><a href="#annotated-cell-25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(header_names) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="4">4</button><span id="annotated-cell-25-5" class="code-annotation-target"><a href="#annotated-cell-25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(gold<span class="sc">:</span>total, as.numeric))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-25" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="2" data-code-annotation="1">Remove columns that are no longer necessary so they don’t interfere with pivot operation</span>
</dd>
<dt data-target-cell="annotated-cell-25" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="3" data-code-annotation="2">Pivot to replicate structure of original table, using the <code>column</code> values as column names for now.</span>
</dd>
<dt data-target-cell="annotated-cell-25" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="4" data-code-annotation="3">Set column names to descriptive labels</span>
</dd>
<dt data-target-cell="annotated-cell-25" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="5" data-code-annotation="4">Convert gold, silver, bronze, and total columns to numeric variables, which causes <code>NA</code> to replace ‘-’ in the original table.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">idx</th>
<th style="text-align: left;">text</th>
<th style="text-align: left;">medal_attributes</th>
<th style="text-align: left;">row_attributes</th>
<th style="text-align: left;">row</th>
<th style="text-align: right;">column</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">country-medal-row-1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">MIX AIN</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">country-medal-row-1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">gold-medals-row-1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">silver-medals-row-1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">bronze-medals-row-1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">total-medals-row-1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-26"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="1">1</button><span id="annotated-cell-26-1" class="code-annotation-target"><a href="#annotated-cell-26-1" aria-hidden="true" tabindex="-1"></a>table_nodes <span class="op">=</span> soup.select(<span class="st">"div[data-row-id],div[data-medal-id]"</span>)</span>
<span id="annotated-cell-26-2"><a href="#annotated-cell-26-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="2">2</button><span id="annotated-cell-26-3" class="code-annotation-target"><a href="#annotated-cell-26-3" aria-hidden="true" tabindex="-1"></a>header_names <span class="op">=</span> [<span class="st">"flag"</span>, <span class="st">"country_abb"</span>, <span class="st">"gold"</span>, <span class="st">"silver"</span>, <span class="st">"bronze"</span>, <span class="st">"total"</span>, <span class="st">"country"</span>]</span>
<span id="annotated-cell-26-4"><a href="#annotated-cell-26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-5"><a href="#annotated-cell-26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-6"><a href="#annotated-cell-26-6" aria-hidden="true" tabindex="-1"></a>medal_data <span class="op">=</span> pd.DataFrame({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="3">3</button><span id="annotated-cell-26-7" class="code-annotation-target"><a href="#annotated-cell-26-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"i"</span>: <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(table_nodes)),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="4">4</button><span id="annotated-cell-26-8" class="code-annotation-target"><a href="#annotated-cell-26-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"chr"</span>: [i.get_text() <span class="cf">for</span> i <span class="kw">in</span> table_nodes],</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="5">5</button><span id="annotated-cell-26-9" class="code-annotation-target"><a href="#annotated-cell-26-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"attr"</span>: [<span class="bu">dict</span>(i.attrs) <span class="cf">for</span> i <span class="kw">in</span> table_nodes]</span>
<span id="annotated-cell-26-10"><a href="#annotated-cell-26-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="annotated-cell-26-11"><a href="#annotated-cell-26-11" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="6">6</button><span id="annotated-cell-26-12" class="code-annotation-target"><a href="#annotated-cell-26-12" aria-hidden="true" tabindex="-1"></a>medal_data[<span class="st">"row"</span>] <span class="op">=</span> [medal_data.attr[i][<span class="st">'data-row-id'</span>]</span>
<span id="annotated-cell-26-13"><a href="#annotated-cell-26-13" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">if</span> <span class="st">'data-row-id'</span> <span class="kw">in</span> medal_data.attr[i]</span>
<span id="annotated-cell-26-14"><a href="#annotated-cell-26-14" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">else</span> medal_data.attr[i][<span class="st">'data-medal-id'</span>]</span>
<span id="annotated-cell-26-15"><a href="#annotated-cell-26-15" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">for</span> i <span class="kw">in</span> medal_data.i]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-26" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="1" data-code-annotation="1">This gets all of the <code>div</code> elements with a <code>data-row-id</code> or <code>data-medal-id</code> attribute</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="3" data-code-annotation="2">Create a list of column names (for later)</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="7" data-code-annotation="3">Create an index along <code>table_nodes</code> to match the row number</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="8" data-code-annotation="4">Get the text from <code>table_nodes</code> as it would be rendered in HTML</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="9" data-code-annotation="5">Create a dictionary of attributes for each of the entries in <code>table_nodes</code>. This will allow us to pull values out by attribute name.</span>
</dd>
<dt data-target-cell="annotated-cell-26" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="12,13,14,15" data-code-annotation="6">This is a fairly long list comprehension (sorry). For each of the rows, we’re going to check and see if <code>attr</code> has an entry <code>data-row-id</code>, and if so, we’re going to pull the value out. If not, we’ll pull out the value from <code>data-medal-id</code>.</span>
</dd>
</dl>
</div>
</div>
<p>Next, we need to pivot the data to get the table as it is shown visually on the webpage, and then we need to convert the medal totals from character to numeric variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-27"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="1">1</button><span id="annotated-cell-27-1" class="code-annotation-target"><a href="#annotated-cell-27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="annotated-cell-27-2"><a href="#annotated-cell-27-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="2">2</button><span id="annotated-cell-27-3" class="code-annotation-target"><a href="#annotated-cell-27-3" aria-hidden="true" tabindex="-1"></a>medal_data[<span class="st">'rownum'</span>] <span class="op">=</span> [re.search(<span class="vs">r'\d+'</span>, i).group() <span class="cf">for</span> i <span class="kw">in</span> medal_data.row]</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="3">3</button><span id="annotated-cell-27-4" class="code-annotation-target"><a href="#annotated-cell-27-4" aria-hidden="true" tabindex="-1"></a>medal_data[<span class="st">'colnum'</span>] <span class="op">=</span> medal_data.groupby(<span class="st">'rownum'</span>).cumcount() <span class="op">+</span> <span class="dv">1</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="4">4</button><span id="annotated-cell-27-5" class="code-annotation-target"><a href="#annotated-cell-27-5" aria-hidden="true" tabindex="-1"></a>medal_data_wide <span class="op">=</span> medal_data.loc[:,[<span class="st">'chr'</span>, <span class="st">'rownum'</span>, <span class="st">'colnum'</span>]].pivot(columns<span class="op">=</span><span class="st">'colnum'</span>, index <span class="op">=</span> <span class="st">'rownum'</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="5">5</button><span id="annotated-cell-27-6" class="code-annotation-target"><a href="#annotated-cell-27-6" aria-hidden="true" tabindex="-1"></a>medal_data_wide.columns <span class="op">=</span> header_names</span>
<span id="annotated-cell-27-7"><a href="#annotated-cell-27-7" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="6">6</button><span id="annotated-cell-27-8" class="code-annotation-target"><a href="#annotated-cell-27-8" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> [pd.to_numeric(medal_data_wide[i], errors<span class="op">=</span><span class="st">'coerce'</span>) <span class="cf">for</span> i <span class="kw">in</span> [<span class="st">'gold'</span>, <span class="st">'silver'</span>, <span class="st">'bronze'</span>, <span class="st">'total'</span>]]</span>
<span id="annotated-cell-27-9"><a href="#annotated-cell-27-9" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="7">7</button><span id="annotated-cell-27-10" class="code-annotation-target"><a href="#annotated-cell-27-10" aria-hidden="true" tabindex="-1"></a>tmpfix <span class="op">=</span> pd.DataFrame(tmp).transpose()</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="8">8</button><span id="annotated-cell-27-11" class="code-annotation-target"><a href="#annotated-cell-27-11" aria-hidden="true" tabindex="-1"></a>medal_data_wide[[<span class="st">'gold'</span>, <span class="st">'silver'</span>, <span class="st">'bronze'</span>, <span class="st">'total'</span>]] <span class="op">=</span> tmpfix</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-27" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="1" data-code-annotation="1">Load regular expression library</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="3" data-code-annotation="2">Search for one or more consecutive digits in the row name</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="4" data-code-annotation="3">group by the row number and count the rows in each group to get columns</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="5" data-code-annotation="4">Select only the columns we need - row, col, and the text shown on the HTML page, and then pivot so that rows are rows and cols are cols</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="6" data-code-annotation="5">Set names to be sensible/meaningful.</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="8" data-code-annotation="6">For each of the four columns with medal totals, convert to numeric (coercing ‘-’ to NaN). The result is a list of length <span class="math inline">\(4\)</span>, and each element in the list is a list with <span class="math inline">\(92\)</span> entries.</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="10" data-code-annotation="7">Convert the list of lists to a pandas DataFrame with dimensions <span class="math inline">\(4\times 92\)</span> and then transpose it so that it will fit back in our data frame.</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="11" data-code-annotation="8">Store the numeric variables back into the wide data frame in the correct columns.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">flag</th>
<th style="text-align: left;">country_abb</th>
<th style="text-align: right;">gold</th>
<th style="text-align: right;">silver</th>
<th style="text-align: right;">bronze</th>
<th style="text-align: right;">total</th>
<th style="text-align: left;">country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">MIX AIN</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">AIN</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">BEL Belgium</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Belgium</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">BOT Botswana</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Botswana</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">BRA Brazil</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">Brazil</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">BUL Bulgaria</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Bulgaria</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">CPV Cabo Verde</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Cabo Verde</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-8-contents callout-collapse collapse callout-margin-content">
<div id="fig-olympic-medal-page" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="Screenshot of https://www.olympics.com/en/olympic-games/paris-2024/medals, showing gold, silver, and bronze medal counts for the first 7 countries listed alphabetically.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-olympic-medal-page-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/paris-2024-medal-table.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;33.3: (Click to enlarge) Screenshot of the 2024 Paris Olympics Medal “Table”"><img src="../images/advanced/paris-2024-medal-table.png" class="img-fluid figure-img" alt="Screenshot of https://www.olympics.com/en/olympic-games/paris-2024/medals, showing gold, silver, and bronze medal counts for the first 7 countries listed alphabetically."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-olympic-medal-page-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.3: (Click to enlarge) Screenshot of the 2024 Paris Olympics Medal “Table”
</figcaption>
</figure>
</div>
<div id="fig-olympic-html-gif" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="Screen recording of https://www.olympics.com/en/olympic-games/paris-2024/medals, showing the HTML corresponding to the first row of the table. Each div element has an attribute that contains information on the row of the table, and that information can be used along with the rendered text on the HTML page to reconstruct the table quickly.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-olympic-html-gif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/Paris-2024-HTML-explorer.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;33.4: (Click to enlarge) Screen recording: Using the Developer Console to map web page elements to HTML code in order to identify attributes and document structure that can be parsed."><img src="../images/advanced/Paris-2024-HTML-explorer.gif" class="img-fluid figure-img" alt="Screen recording of https://www.olympics.com/en/olympic-games/paris-2024/medals, showing the HTML corresponding to the first row of the table. Each div element has an attribute that contains information on the row of the table, and that information can be used along with the rendered text on the HTML page to reconstruct the table quickly."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-olympic-html-gif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.4: (Click to enlarge) Screen recording: Using the Developer Console to map web page elements to HTML code in order to identify attributes and document structure that can be parsed.
</figcaption>
</figure>
</div>
</div></div></section>
</section>
<section id="ethical-web-scraping" class="level2 page-columns page-full" data-number="33.4">
<h2 data-number="33.4" class="anchored" data-anchor-id="ethical-web-scraping"><span class="header-section-number">33.4</span> Ethical Web Scraping</h2>
<p>Scraping information off of the web can quickly push you into a zone where you have to worry about legality, privacy, and copyright issues. In addition, not all websites want to be scraped, and scraping a website (even if the website is not actively blocking you) can create unacceptable load on the server hosting the site, if you are not careful and ethical about what you are doing. This section describes a couple of important components of scraping websites ethically, but these components also provide some important technical background that can be useful for debugging why your web scraping script isn’t working the way you expect.</p>
<section id="robots.txt" class="level3" data-number="33.4.1">
<h3 data-number="33.4.1" class="anchored" data-anchor-id="robots.txt"><span class="header-section-number">33.4.1</span> robots.txt</h3>
<p>The <code>robots.txt</code> file is found at the root level of the website, and gives instructions to web crawlers/scrapers as to what areas of the site are allowed to be scraped, and who is allowed to scrape them. Websites identify who you are using a <strong>User-agent</strong> that is transmitted any time your computer requests information from the internet.</p>
<p>When we look at what we’re allowed to scrape, we want to find the <code>User-agent: *</code> section of the <code>robots.txt</code> file that describes what someone with any user agent not otherwise specified is allowed to scrape.</p>
<p>Check out some robots.txt files to see what things they allow and block.</p>
<ul>
<li><p>https://www.google.com/robots.txt<br>
In google’s robots.txt file, they explicitly block scraping search, groups, and other products (patents, citations, scholar, maps), but they allow scraping some books content (related, editions, subject, about).</p></li>
<li><p>https://github.com/robots.txt<br>
Github’s robots.txt file provides some information about their API (which is more convenient than scraping, generally - see <a href="05-APIs.html" class="quarto-xref"><span>Chapter 35</span></a>), but allows all user-agents and disallows most of the “extra” information about repositories - pulse, projects, forks, issues, milestones, commits, etc. - so you can access the main repositories but not the details via scraping, if you choose to scrape. Github also provides a contact email if you want to crawl the entire site – likely not relevant unless you’re writing a search engine, but it’s helpful to know who to contact in any case.</p></li>
<li><p>https://en.wikipedia.org/robots.txt<br>
Wikipedia’s robots.txt file allows some bots and disallows others. They mention paying attention to 429 rate limit response codes and not copying the entire site. Further down, they mention a reasonable request rate of 20 requests per second.</p></li>
<li><p>https://www.olympics.com/robots.txt<br>
This site doesn’t allow scraping /athletes/library/*, search (which just prevents infinite recursive scraping – that’s actually helping bots out), test directories, or syndicated videos. No big deal.</p></li>
<li><p>https://www.juniorrollerderby.org/robots.txt<br>
This site doesn’t allow crawling /users/ or /event sections of the site, but is otherwise fine with being scraped.</p></li>
</ul>
<p><code>robots.txt</code> files will often use a local path - the base site is <code>https://wikipedia.org/</code> or <code>https://google.com/</code> or <code>https://github.com/</code>, so they will list <code>/search/</code> as shorthand for <code>https://google.com/search/</code>. It is fairly common for links to be specified relative to the base site as well, so you will often have to paste the front part of the URL onto the local path to get a valid URL.</p>
<p>The <code>polite</code> R package will ensure that your requests accommodate anything specified in the <code>robots.txt</code> file <span class="citation" data-cites="struckIntroductionWebScraping polite"><a href="#ref-struckIntroductionWebScraping" role="doc-biblioref">[3]</a>, <a href="#ref-polite" role="doc-biblioref">[4]</a></span>. The <code>reppy</code> python package <span class="citation" data-cites="kempRespectingRobotstxtYour2025 b4handReppyReplacementRobotstxt2019"><a href="#ref-kempRespectingRobotstxtYour2025" role="doc-biblioref">[5]</a>, <a href="#ref-b4handReppyReplacementRobotstxt2019" role="doc-biblioref">[6]</a></span> has similar functions to facilitate ethical web scraping.</p>
<p>As with any ethical system, there can be reasons to justify not complying with robots.txt <span class="citation" data-cites="EthicsRobotstxt2013 pierceRiseFallRobotstxt2024"><a href="#ref-EthicsRobotstxt2013" role="doc-biblioref">[7]</a>, <a href="#ref-pierceRiseFallRobotstxt2024" role="doc-biblioref">[8]</a></span>. Journalists often want to archive web pages exactly as they were to ensure that their sources are unimpeachable. More broadly, the Internet Archive announced in 2017 that it would no longer observe robots.txt rules because its archival mission had a different goal than bots that crawl the internet for search indexing purposes. During the 2025 Trump administration directed purge of DEI content from military and government websites <span class="citation" data-cites="baldorPentagonsPurgeOfficials2025"><a href="#ref-baldorPentagonsPurgeOfficials2025" role="doc-biblioref">[9]</a></span>, internet activists often ignored robots.txt files in order to ensure that content was archived and not entirely erased from historical records. However, even under these scenarios, ensuring that scraping does not overload the web server is still important, as overloaded servers don’t respond to requests, and too many requests may get your IP address blocked by the server entirely.</p>
<p><code>robots.txt</code> is also a primary defense against content being stolen and fed into AI applications; as a result, it is important to be aware of the file both as a consumer of web-based information and as someone who may one day publish content on the web.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Checking <code>robots.txt</code> programmatically
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polite)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(<span class="st">"https://wikipedia.org"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;polite session&gt; https://wikipedia.org</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     User-agent: polite R package</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     robots.txt: 464 rules are defined for 34 bots</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    Crawl delay: 5 sec</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   The path is scrapable for this user-agent</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(<span class="st">"https://google.com/search"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;polite session&gt; https://google.com/search</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     User-agent: polite R package</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="do">##     robots.txt: 521 rules are defined for 5 bots</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    Crawl delay: 5 sec</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   The path is not scrapable for this user-agent</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urljoin, urlparse</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.robotparser</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_allowed(url):</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Setup robots.txt parser</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  rp <span class="op">=</span> urllib.robotparser.RobotFileParser()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  rp.set_url(urljoin(url, <span class="st">'/robots.txt'</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  rp.read()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rp.can_fetch(<span class="st">"*"</span>, url)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if you're allowed to scrape the site</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>is_allowed(<span class="st">"https://wikipedia.org"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>is_allowed(<span class="st">"https://google.com/search"</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-example callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it out: Can you scrape these sites?
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Solution (manual)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Solution (R)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">Solution (Python)</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>Determine (using any method you like) whether you’re allowed to scrape the following sites, and whether there are any custom restrictions on the interval between requests:</p>
<ul>
<li>https://linkedin.com</li>
<li>https://lincoln.craigslist.org/mis/</li>
<li>https://reddit.com/r/Aww/</li>
</ul>
<p>Also determine whether the site has a contact point for individual requests, if the data you want is not scrape-able.</p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<ul>
<li>LinkedIn: <a href="https://www.linkedin.com/robots.txt">robots.txt</a></li>
</ul>
<pre><code>User-agent: *
Disallow: /

# Notice: If you would like to crawl LinkedIn,
# please email whitelist-crawl@linkedin.com to apply
# for white listing.</code></pre>
<p>Scraping LinkedIn is not allowed.</p>
<ul>
<li>Craigslist Missed Connections <a href="https://lincoln.craigslist.org/robots.txt">robots.txt</a></li>
</ul>
<pre><code>User-agent: *
Disallow: /reply
Disallow: /fb/
Disallow: /suggest
Disallow: /flag
Disallow: /mf
Disallow: /mailflag
Disallow: /eaf</code></pre>
<p>Scraping Craigslist missed connections is technically allowed. Even so, Craigslist is notorious for banning users for too many requests, even when they’re spaced out over a significant period of time and handled politely.</p>
<ul>
<li>Reddit /r/Aww: <a href="https://www.reddit.com/robots.txt">robots.txt</a></li>
</ul>
<pre><code># Welcome to Reddit's robots.txt
# Reddit believes in an open internet, but not the misuse of public content.
# See https://support.reddithelp.com/hc/en-us/articles/26410290525844-Public-Content-Policy Reddit's Public Content Policy for access and use restrictions to Reddit content.
# See https://www.reddit.com/r/reddit4researchers/ for details on how Reddit continues to support research and non-commercial use.
# policy: https://support.reddithelp.com/hc/en-us/articles/26410290525844-Public-Content-Policy

User-agent: *
Disallow: /</code></pre>
<p>Scraping Reddit is not allowed. Some posts may be accessible via the API.</p>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polite)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(<span class="st">"https://linkedin.com"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;polite session&gt; https://linkedin.com</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     User-agent: polite R package</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     robots.txt: 4319 rules are defined for 42 bots</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    Crawl delay: 5 sec</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   The path is not scrapable for this user-agent</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(<span class="st">"https://lincoln.craigslist.org/mis/"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;polite session&gt; https://lincoln.craigslist.org/mis/</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     User-agent: polite R package</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="do">##     robots.txt: 8 rules are defined for 22 bots</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    Crawl delay: 5 sec</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   The path is scrapable for this user-agent</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu">bow</span>(<span class="st">"https://reddit.com/r/Aww/"</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;polite session&gt; https://reddit.com/r/Aww/</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="do">##     User-agent: polite R package</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="do">##     robots.txt: 1 rules are defined for 1 bots</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="do">##    Crawl delay: 5 sec</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   The path is not scrapable for this user-agent</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urljoin, urlparse</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.robotparser</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_allowed(url):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Setup robots.txt parser</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  rp <span class="op">=</span> urllib.robotparser.RobotFileParser()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  rp.set_url(urljoin(url, <span class="st">'/robots.txt'</span>))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  rp.read()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rp.can_fetch(<span class="st">"*"</span>, url)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if you're allowed to scrape the site</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>is_allowed(<span class="st">"https://linkedin.com"</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>is_allowed(<span class="st">"https://lincoln.craigslist.org/mis/"</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">## True</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>is_allowed(<span class="st">"https://reddit.com/r/Aww/"</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">## False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-user-agents" class="level3 page-columns page-full" data-number="33.4.2">
<h3 data-number="33.4.2" class="anchored" data-anchor-id="sec-user-agents"><span class="header-section-number">33.4.2</span> User Agents</h3>
<p>Web traffic logs on servers include your user agent, which provides information about your operating system and browser. This information can help server administrators understand who is accessing their site, and can lead to decisions to e.g.&nbsp;upgrade the web page to no longer accommodate Internet Explorer users, since they make up a tiny fraction of all web traffic. From a user perspective, some sites will prevent e.g.&nbsp;Linux users from downloading unsupported software, or increase prices if your user agent indicates you’re using a Mac <span class="citation" data-cites="klosowskiHowWebSites2013"><a href="#ref-klosowskiHowWebSites2013" role="doc-biblioref">[10]</a></span>, so changing your user agent is not just something you might want to do when scraping the web.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/advanced/user-agent-info.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="You can use the site https://whatmyuseragent.com to find out what information you’re providing to websites. Don’t depend on the accuracy of the location – it is often where your internet provider is headquartered, rather than where you’re actually located."><img src="../images/advanced/user-agent-info.png" class="img-fluid figure-img" alt="The image is a screenshot from the website &quot;WhatMyUserAgent.com,&quot; displaying detailed information about the user's browsing and system characteristics. The top section shows the user agent string, highlighted in a blue box, which can be copied. Below that, the &quot;Your IP Address&quot; and &quot;Location&quot; sections provide a partially censored IP address and a geographic location with a Google Earth image depicting a world map. It identifies the city as Bellevue, with latitude 47.6154 and longitude -122.2103. A note on the left states the inaccuracy regarding the actual location. Further down, &quot;Browser Information&quot; details the browser as Firefox with version 139.0, JavaScript and cookies enabled, and screen resolution of 3840x2160 with a window size of 1920x965. The &quot;Opera System Information&quot; section lists &quot;GNU/Linux&quot; as the operating system and the platform as x64. Lastly, the &quot;Device Information&quot; section notes the type as a desktop."></a></p>
<figcaption>You can use the site https://whatmyuseragent.com to find out what information you’re providing to websites. Don’t depend on the accuracy of the location – it is often where your internet provider is headquartered, rather than where you’re actually located.</figcaption>
</figure>
</div>
</div></div><div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
From the Other Side: Examining Access Logs and User Agents
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It’s sometimes helpful to look at what a server administrator might see if you’re scraping the web improperly. To demonstrate, I decided to pull the access logs from my personal website just to see who had been snooping around and what their user agents were. I’ve censored the IP addresses and will primarily focus on the browser type, if it is properly defined.</p>
<div class="cell">
<details class="code-fold">
<summary>Quick and dirty R code to look at the most common User-agents accessing my home website.</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span>(<span class="st">"../data/server-access-log.txt"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_extract</span>(<span class="st">".*</span><span class="sc">\"</span><span class="st">(.*)</span><span class="sc">\"</span><span class="st">$"</span>, <span class="at">group =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing=</span>T) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"User-agent"</span>, <span class="st">"Freq"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 97%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">User-agent</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Scrapy/2.11.2 (+https://scrapy.org)</td>
<td style="text-align: right;">238</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36</td>
<td style="text-align: right;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mozilla/5.0 (compatible; AhrefsBot/7.0; +http://ahrefs.com/robot/)</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">-</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mozilla/5.0 (Linux; Android 10; LIO-AN00 Build/HUAWEILIO-AN00; wv) MicroMessenger Weixin QQ AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/78.0.3904.62 XWEB/2692 MMWEBSDK/200901 Mobile Safari/537.36</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.43</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36 Edg/90.0.818.46</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">‘Mozilla/5.0 (compatible; GenomeCrawlerd/1.0; +https://www.nokia.com/genomecrawler)’</td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>It looks like the most common user agent is <code>scrapy</code>, a python library for web scraping, and the second most common is some variant of Mozilla/5.0 on various operating systems and platforms. As a result of this investigation, I blocked <code>scrapy</code> using <code>robots.txt</code>, because I don’t know what that’s being used for but there is literally nothing of interest to the wider internet, data-wise, on my personal website. I also blocked a bunch of different AI bots because I don’t want them indexing my personal site either.</p>
<p>It’s important to note from a server administrator side that <code>robots.txt</code> doesn’t provide any additional security, as malicious actors can and will ignore ethical/polite web scraping conventions.</p>
</div>
</div>
</div>
<p>Convention dictates that your user agent when scraping should provide some contact information and reasoning, such as “Graduate student scraping for research on underwater basketweaving. Contact me at name@myuni.edu for more info.” However, some sites will block user agents that do not appear to be a normal browser, even if scraping is explicitly allowed. In these cases, you will want to set a header that mimics a browser (Consult this <a href="https://techblog.willshouse.com/2012/01/03/most-common-user-agents/">up-to-date list of common user agents</a> for a few good choices).</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setting a User Agent
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R: <code>rvest</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">R: <code>polite</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>You may have noticed in <span class="quarto-unresolved-ref">?sec-demo-olympic-medals</span> that the R code read the file in from a saved version instead of from the web directly. When we try to read from the web directly, we get this message:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.olympics.com/en/olympic-games/paris-2024/medals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, <code>rvest</code> uses the default user agent specified in the <code>curl</code> package<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, which is <code>NULL</code>. So, let’s try setting an informative user agent, instead of NULL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-37"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="1">1</button><span id="annotated-cell-37-1" class="code-annotation-target"><a href="#annotated-cell-37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="annotated-cell-37-2"><a href="#annotated-cell-37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-37-3"><a href="#annotated-cell-37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the UA to describe what we're doing</span></span>
<span id="annotated-cell-37-4"><a href="#annotated-cell-37-4" aria-hidden="true" tabindex="-1"></a>ua <span class="ot">&lt;-</span> <span class="st">"Demonstrating web scraping for educational purposes. Contact svanderplas2@unl.edu for more info."</span></span>
<span id="annotated-cell-37-5"><a href="#annotated-cell-37-5" aria-hidden="true" tabindex="-1"></a>olympics <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://www.olympics.com/en/olympic-games/paris-2024/medals"</span>, </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="2">2</button><span id="annotated-cell-37-6" class="code-annotation-target"><a href="#annotated-cell-37-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">user_agent</span>(ua))</span>
<span id="annotated-cell-37-7"><a href="#annotated-cell-37-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in curl::curl_fetch_memory(url, handle = handle): Stream error in the HTTP/2 framing layer [www.olympics.com]: HTTP/2 stream 1 was not closed cleanly: INTERNAL_ERROR (err 2)</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-37" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="1" data-code-annotation="1"><code>httr</code> is used to specify a user agent directly</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="6" data-code-annotation="2">Use a <code>GET</code> request to acquire the HTML page code from the server, instead of reading the HTML directly</span>
</dd>
</dl>
</div>
</div>
<p>Ok, well, that doesn’t appear to work - we’re still getting blocked by the server and can’t even read the HTML file properly. The <code>robots.txt</code> file for this site allows scraping as long as we’re not looking at <code>/athletes/library/</code> or <code>/search/</code>, so we’re in compliance with the rules they’ve set… but maybe we just need to set a user agent that makes us look like a browser?</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-38"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="1">1</button><span id="annotated-cell-38-1" class="code-annotation-target"><a href="#annotated-cell-38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="annotated-cell-38-2"><a href="#annotated-cell-38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-3"><a href="#annotated-cell-38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the user agent to a super common one</span></span>
<span id="annotated-cell-38-4"><a href="#annotated-cell-38-4" aria-hidden="true" tabindex="-1"></a>ua <span class="ot">&lt;-</span> <span class="st">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36"</span></span>
<span id="annotated-cell-38-5"><a href="#annotated-cell-38-5" aria-hidden="true" tabindex="-1"></a>olympics <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://www.olympics.com/en/olympic-games/paris-2024/medals"</span>, </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="2">2</button><span id="annotated-cell-38-6" class="code-annotation-target"><a href="#annotated-cell-38-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">user_agent</span>(ua))</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="3">3</button><span id="annotated-cell-38-7" class="code-annotation-target"><a href="#annotated-cell-38-7" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(olympics)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-38" data-target-annotation="4">4</button><span id="annotated-cell-38-8" class="code-annotation-target"><a href="#annotated-cell-38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">html_element</span>(doc, <span class="st">"[data-cy=</span><span class="sc">\"</span><span class="st">table-content</span><span class="sc">\"</span><span class="st">]"</span>)</span>
<span id="annotated-cell-38-9"><a href="#annotated-cell-38-9" aria-hidden="true" tabindex="-1"></a><span class="do">## {html_node}</span></span>
<span id="annotated-cell-38-10"><a href="#annotated-cell-38-10" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;div data-cy="table-content" class="Table-styles__CommonGrid-sc-7c5c517a-1 Table-styles__Content-sc-7c5c517a-3 dTTMvn jfNiTo"&gt;</span></span>
<span id="annotated-cell-38-11"><a href="#annotated-cell-38-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &lt;div class="line"&gt;&lt;/div&gt;\n</span></span>
<span id="annotated-cell-38-12"><a href="#annotated-cell-38-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2] &lt;div data-row-id="country-medal-row-1" class="sc-26c0a561-2 bNqscu"&gt;&lt;pic ...</span></span>
<span id="annotated-cell-38-13"><a href="#annotated-cell-38-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3] &lt;div data-row-id="country-medal-row-1" class="sc-26c0a561-4 kaSJtG"&gt;\n&lt;d ...</span></span>
<span id="annotated-cell-38-14"><a href="#annotated-cell-38-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4] &lt;div data-cy="medal-module" data-medal-id="gold-medals-row-1" title="Gol ...</span></span>
<span id="annotated-cell-38-15"><a href="#annotated-cell-38-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5] &lt;div data-cy="medal-module" data-medal-id="silver-medals-row-1" title="S ...</span></span>
<span id="annotated-cell-38-16"><a href="#annotated-cell-38-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6] &lt;div data-cy="medal-module" data-medal-id="bronze-medals-row-1" title="B ...</span></span>
<span id="annotated-cell-38-17"><a href="#annotated-cell-38-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] &lt;span class="mobile-hidden"&gt;&lt;/span&gt;</span></span>
<span id="annotated-cell-38-18"><a href="#annotated-cell-38-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8] &lt;div data-cy="medal-module" data-medal-id="total-medals-row-1" title=""  ...</span></span>
<span id="annotated-cell-38-19"><a href="#annotated-cell-38-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9] &lt;div data-cy="country-complete-name" data-row-id="country-medal-row-1" c ...</span></span>
<span id="annotated-cell-38-20"><a href="#annotated-cell-38-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [10] &lt;div class="line"&gt;&lt;/div&gt;\n</span></span>
<span id="annotated-cell-38-21"><a href="#annotated-cell-38-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [11] &lt;div data-row-id="country-medal-row-2" class="sc-26c0a561-2 bNqscu"&gt;&lt;pic ...</span></span>
<span id="annotated-cell-38-22"><a href="#annotated-cell-38-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [12] &lt;div data-row-id="country-medal-row-2" class="sc-26c0a561-4 kaSJtG"&gt;\n&lt;d ...</span></span>
<span id="annotated-cell-38-23"><a href="#annotated-cell-38-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &lt;div data-cy="medal-module" data-medal-id="gold-medals-row-2" title="Gol ...</span></span>
<span id="annotated-cell-38-24"><a href="#annotated-cell-38-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [14] &lt;div data-cy="medal-module" data-medal-id="silver-medals-row-2" title="S ...</span></span>
<span id="annotated-cell-38-25"><a href="#annotated-cell-38-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [15] &lt;div data-cy="medal-module" data-medal-id="bronze-medals-row-2" title="B ...</span></span>
<span id="annotated-cell-38-26"><a href="#annotated-cell-38-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [16] &lt;span class="mobile-hidden"&gt;&lt;/span&gt;</span></span>
<span id="annotated-cell-38-27"><a href="#annotated-cell-38-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [17] &lt;div data-cy="medal-module" data-medal-id="total-medals-row-2" title=""  ...</span></span>
<span id="annotated-cell-38-28"><a href="#annotated-cell-38-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [18] &lt;div data-cy="country-complete-name" data-row-id="country-medal-row-2" c ...</span></span>
<span id="annotated-cell-38-29"><a href="#annotated-cell-38-29" aria-hidden="true" tabindex="-1"></a><span class="do">## [19] &lt;div class="line"&gt;&lt;/div&gt;\n</span></span>
<span id="annotated-cell-38-30"><a href="#annotated-cell-38-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [20] &lt;div data-row-id="country-medal-row-3" class="sc-26c0a561-2 bNqscu"&gt;&lt;pic ...</span></span>
<span id="annotated-cell-38-31"><a href="#annotated-cell-38-31" aria-hidden="true" tabindex="-1"></a><span class="do">## ...</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-38" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-lines="1" data-code-annotation="1"><code>httr</code> is used to specify a user agent directly</span>
</dd>
<dt data-target-cell="annotated-cell-38" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-lines="6" data-code-annotation="2">Use a <code>GET</code> request to acquire the HTML page code from the server, instead of reading the HTML directly</span>
</dd>
<dt data-target-cell="annotated-cell-38" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-lines="7" data-code-annotation="3">Use <code>read_html</code> to parse the HTML code that the server provided</span>
</dd>
<dt data-target-cell="annotated-cell-38" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-38" data-code-lines="8" data-code-annotation="4">Check to make sure the information we wanted is present.</span>
</dd>
</dl>
</div>
</div>
<p>And, lo and behold, we can scrape the site properly once our user agent is set.</p>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-39"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="1">1</button><span id="annotated-cell-39-1" class="code-annotation-target"><a href="#annotated-cell-39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(polite)</span>
<span id="annotated-cell-39-2"><a href="#annotated-cell-39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-3"><a href="#annotated-cell-39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the user agent to a super common one</span></span>
<span id="annotated-cell-39-4"><a href="#annotated-cell-39-4" aria-hidden="true" tabindex="-1"></a>ua <span class="ot">&lt;-</span> <span class="st">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36"</span></span>
<span id="annotated-cell-39-5"><a href="#annotated-cell-39-5" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.olympics.com/en/olympic-games/paris-2024/medals"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="2">2</button><span id="annotated-cell-39-6" class="code-annotation-target"><a href="#annotated-cell-39-6" aria-hidden="true" tabindex="-1"></a>olympics <span class="ot">&lt;-</span> <span class="fu">bow</span>(url, <span class="at">user_agent =</span> ua)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="3">3</button><span id="annotated-cell-39-7" class="code-annotation-target"><a href="#annotated-cell-39-7" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">scrape</span>(olympics)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="4">4</button><span id="annotated-cell-39-8" class="code-annotation-target"><a href="#annotated-cell-39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">html_element</span>(doc, <span class="st">"[data-cy=</span><span class="sc">\"</span><span class="st">table-content</span><span class="sc">\"</span><span class="st">]"</span>)</span>
<span id="annotated-cell-39-9"><a href="#annotated-cell-39-9" aria-hidden="true" tabindex="-1"></a><span class="do">## {html_node}</span></span>
<span id="annotated-cell-39-10"><a href="#annotated-cell-39-10" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;div data-cy="table-content" class="Table-styles__CommonGrid-sc-7c5c517a-1 Table-styles__Content-sc-7c5c517a-3 dTTMvn jfNiTo"&gt;</span></span>
<span id="annotated-cell-39-11"><a href="#annotated-cell-39-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &lt;div class="line"&gt;&lt;/div&gt;\n</span></span>
<span id="annotated-cell-39-12"><a href="#annotated-cell-39-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  [2] &lt;div data-row-id="country-medal-row-1" class="sc-26c0a561-2 bNqscu"&gt;&lt;pic ...</span></span>
<span id="annotated-cell-39-13"><a href="#annotated-cell-39-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3] &lt;div data-row-id="country-medal-row-1" class="sc-26c0a561-4 kaSJtG"&gt;\n&lt;d ...</span></span>
<span id="annotated-cell-39-14"><a href="#annotated-cell-39-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4] &lt;div data-cy="medal-module" data-medal-id="gold-medals-row-1" title="Gol ...</span></span>
<span id="annotated-cell-39-15"><a href="#annotated-cell-39-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5] &lt;div data-cy="medal-module" data-medal-id="silver-medals-row-1" title="S ...</span></span>
<span id="annotated-cell-39-16"><a href="#annotated-cell-39-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  [6] &lt;div data-cy="medal-module" data-medal-id="bronze-medals-row-1" title="B ...</span></span>
<span id="annotated-cell-39-17"><a href="#annotated-cell-39-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] &lt;span class="mobile-hidden"&gt;&lt;/span&gt;</span></span>
<span id="annotated-cell-39-18"><a href="#annotated-cell-39-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8] &lt;div data-cy="medal-module" data-medal-id="total-medals-row-1" title=""  ...</span></span>
<span id="annotated-cell-39-19"><a href="#annotated-cell-39-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9] &lt;div data-cy="country-complete-name" data-row-id="country-medal-row-1" c ...</span></span>
<span id="annotated-cell-39-20"><a href="#annotated-cell-39-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [10] &lt;div class="line"&gt;&lt;/div&gt;\n</span></span>
<span id="annotated-cell-39-21"><a href="#annotated-cell-39-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [11] &lt;div data-row-id="country-medal-row-2" class="sc-26c0a561-2 bNqscu"&gt;&lt;pic ...</span></span>
<span id="annotated-cell-39-22"><a href="#annotated-cell-39-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [12] &lt;div data-row-id="country-medal-row-2" class="sc-26c0a561-4 kaSJtG"&gt;\n&lt;d ...</span></span>
<span id="annotated-cell-39-23"><a href="#annotated-cell-39-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &lt;div data-cy="medal-module" data-medal-id="gold-medals-row-2" title="Gol ...</span></span>
<span id="annotated-cell-39-24"><a href="#annotated-cell-39-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [14] &lt;div data-cy="medal-module" data-medal-id="silver-medals-row-2" title="S ...</span></span>
<span id="annotated-cell-39-25"><a href="#annotated-cell-39-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [15] &lt;div data-cy="medal-module" data-medal-id="bronze-medals-row-2" title="B ...</span></span>
<span id="annotated-cell-39-26"><a href="#annotated-cell-39-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [16] &lt;span class="mobile-hidden"&gt;&lt;/span&gt;</span></span>
<span id="annotated-cell-39-27"><a href="#annotated-cell-39-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [17] &lt;div data-cy="medal-module" data-medal-id="total-medals-row-2" title=""  ...</span></span>
<span id="annotated-cell-39-28"><a href="#annotated-cell-39-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [18] &lt;div data-cy="country-complete-name" data-row-id="country-medal-row-2" c ...</span></span>
<span id="annotated-cell-39-29"><a href="#annotated-cell-39-29" aria-hidden="true" tabindex="-1"></a><span class="do">## [19] &lt;div class="line"&gt;&lt;/div&gt;\n</span></span>
<span id="annotated-cell-39-30"><a href="#annotated-cell-39-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [20] &lt;div data-row-id="country-medal-row-3" class="sc-26c0a561-2 bNqscu"&gt;&lt;pic ...</span></span>
<span id="annotated-cell-39-31"><a href="#annotated-cell-39-31" aria-hidden="true" tabindex="-1"></a><span class="do">## ...</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-39" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="1" data-code-annotation="1"><code>polite</code> allows you to specify a user agent directly</span>
</dd>
<dt data-target-cell="annotated-cell-39" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="6" data-code-annotation="2"><code>bow</code> acquires the HTML page code from the server</span>
</dd>
<dt data-target-cell="annotated-cell-39" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="7" data-code-annotation="3"><code>scrape</code> parses the HTML code that the server provided, at which point we can use various <code>rvest</code> and <code>xml2</code> functions to pull out relevant information.</span>
</dd>
<dt data-target-cell="annotated-cell-39" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="8" data-code-annotation="4">Check to make sure the information we wanted is present.</span>
</dd>
</dl>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-40"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-40-1"><a href="#annotated-cell-40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="annotated-cell-40-2"><a href="#annotated-cell-40-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="1">1</button><span id="annotated-cell-40-3" class="code-annotation-target"><a href="#annotated-cell-40-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup, SoupStrainer</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="2">2</button><span id="annotated-cell-40-4" class="code-annotation-target"><a href="#annotated-cell-40-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="annotated-cell-40-5"><a href="#annotated-cell-40-5" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="3">3</button><span id="annotated-cell-40-6" class="code-annotation-target"><a href="#annotated-cell-40-6" aria-hidden="true" tabindex="-1"></a>req <span class="op">=</span> urllib.request.Request(</span>
<span id="annotated-cell-40-7"><a href="#annotated-cell-40-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.olympics.com/en/olympic-games/paris-2024/medals"</span>,</span>
<span id="annotated-cell-40-8"><a href="#annotated-cell-40-8" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> <span class="va">None</span>,</span>
<span id="annotated-cell-40-9"><a href="#annotated-cell-40-9" aria-hidden="true" tabindex="-1"></a>  headers <span class="op">=</span> {<span class="st">'User-Agent'</span>:<span class="st">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:131.0) Gecko/20100101 Firefox/131.0'</span>}</span>
<span id="annotated-cell-40-10"><a href="#annotated-cell-40-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-40-11"><a href="#annotated-cell-40-11" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="4">4</button><span id="annotated-cell-40-12" class="code-annotation-target"><a href="#annotated-cell-40-12" aria-hidden="true" tabindex="-1"></a>page_bytearray <span class="op">=</span> urllib.request.urlopen(req)</span>
<span id="annotated-cell-40-13"><a href="#annotated-cell-40-13" aria-hidden="true" tabindex="-1"></a>page <span class="op">=</span> page_bytearray.read()</span>
<span id="annotated-cell-40-14"><a href="#annotated-cell-40-14" aria-hidden="true" tabindex="-1"></a>page_bytearray.close()</span>
<span id="annotated-cell-40-15"><a href="#annotated-cell-40-15" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="5">5</button><span id="annotated-cell-40-16" class="code-annotation-target"><a href="#annotated-cell-40-16" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(page)</span>
<span id="annotated-cell-40-17"><a href="#annotated-cell-40-17" aria-hidden="true" tabindex="-1"></a>table_nodes <span class="op">=</span> soup.select(<span class="st">"div[data-row-id],div[data-medal-id]"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-40" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="3" data-code-annotation="1"><code>bs4</code> is a library for web scraping. <code>BeautifulSoup</code> is its primary function.</span>
</dd>
<dt data-target-cell="annotated-cell-40" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="4" data-code-annotation="2"><code>urllib</code> helps with web calls, and <code>request</code> allows us to set browser headers (so it looks like we’re using e.g.&nbsp;Firefox instead of a programming language to access the web).</span>
</dd>
<dt data-target-cell="annotated-cell-40" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="6,7,8,9,10" data-code-annotation="3">This requests the URL using headers that suggest we’re using an older version of Firefox on Windows.</span>
</dd>
<dt data-target-cell="annotated-cell-40" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="12,13,14" data-code-annotation="4">These lines open the page, read it, and close the open page in memory (which is important because open files in memory can cause memory leaks and other badness)</span>
</dd>
<dt data-target-cell="annotated-cell-40" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="16,17" data-code-annotation="5">Check to make sure the information we wanted is present.</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="scraping-static-webpages" class="level2 page-columns page-full" data-number="33.5">
<h2 data-number="33.5" class="anchored" data-anchor-id="scraping-static-webpages"><span class="header-section-number">33.5</span> Scraping Static Webpages</h2>
<p><strong>Static</strong> web pages have HTML that stays the same as the web page loads – all of the content is specified in the HTML, and it doesn’t change (much). Any scripting changes are cosmetic, in that they might change the appearance of the page somewhat but they don’t e.g.&nbsp;insert a data table during the page loading process. These pages can be scraped using <code>rvest</code> and <code>xml2</code> in R or <code>bs4</code> (BeautifulSoup) in Python.</p>
<section id="sec-html-table-direct" class="level3" data-number="33.5.1">
<h3 data-number="33.5.1" class="anchored" data-anchor-id="sec-html-table-direct"><span class="header-section-number">33.5.1</span> Reading in HTML Tables</h3>
<p>In the simplest possible scenario, the data is already well-organized in a tabular structure (with actual <code>&lt;table&gt;</code> tags, unlike the example in <span class="quarto-unresolved-ref">?sec-demo-olympic-medals</span>).</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Reading HTML Tables Directly
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider the Wikipedia page containing a <a href="https://en.wikipedia.org/wiki/List_of_American_Revolutionary_War_battles">List of American Revolutionary War Battles</a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<p>We would use the <code>html_table()</code> function from <code>rvest</code> to read each of the tables on this webpage into a <code>tibble</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>rev_war_tables <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_American_Revolutionary_War_battles"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(rev_war_tables)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 33</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>33 tables is a few too many to deal with!</p>
<p>Looking at the page source, we can see that actual data tables (as opposed to tables used for formatting and arranging content<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>) are sortable and have class <code>class="sortable wikitable jquery-tablesorter"</code>. This is a good example of a static page that uses JavaScript (JQuery, to be specific) to enhance the page (e.g.&nbsp;making the table sortable) without injecting large amounts of content into the page. We only need the dynamic scraping solutions if the <strong>content</strong> is injected – in this case, the JavaScript is only making modifications to the function/appearance of the page.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>rev_war_battles <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_American_Revolutionary_War_battles"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">".wikitable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rev_war_battles)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 5</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   Battle                             Date                 Location Outcome Ref  </span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                              &lt;chr&gt;                &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Powder Alarm*                      September 1, 1774    Massach… Britis… [1]  </span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Storming of Fort William and Mary* December 14, 1774    New Ham… Americ… [2]  </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Battles of Lexington and Concord   April 19, 1775       Massach… Americ… [3]  </span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Battle of Meriam's Corner          April 19, 1775       Massach… Americ… &lt;NA&gt; </span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Siege of Boston                    April 19, 1775&nbsp;–Mar… Massach… Americ… [4]  </span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Gunpowder Incident*                April 20, 1775       Virginia Virgin… [1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_American_Revolutionary_War_battles"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>rev_war_battles <span class="op">=</span> pd.read_html(url, attrs<span class="op">=</span> {<span class="st">"class"</span>: <span class="st">"sortable wikitable"</span>})[<span class="dv">0</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>rev_war_battles.iloc[:,<span class="dv">0</span>:<span class="dv">3</span>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">##                                  Battle  ...                          Location</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 0                         Powder Alarm*  ...                     Massachusetts</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    Storming of Fort William and Mary*  ...                     New Hampshire</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 2      Battles of Lexington and Concord  ...                     Massachusetts</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 3             Battle of Meriam's Corner  ...                     Massachusetts</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 4                       Siege of Boston  ...                     Massachusetts</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">## ..                                  ...  ...                               ...</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 262           Action of 22 January 1783  ...                          Virginia</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 263          Action of 15 February 1783  ...                        Guadeloupe</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 264          Action of 17 February 1783  ...                              Cuba</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 265            Recapture of the Bahamas  ...                           Bahamas</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 266             Battle of Arkansas Post  ...  Louisiana (present-day Arkansas)</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">## [267 rows x 3 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>If all we wanted was the date of the battle and the state, we could stop here. However, if we want any supplemental information, such as links to the battles or a more specific location that would be suitable for plotting on a map, we will need to use a more customized approach… continue on to <a href="#sec-html-custom" class="quarto-xref"><span>Section 33.5.2</span></a> to augment this data some more!</p>
</div>
</div>
</section>
<section id="sec-html-custom" class="level3 page-columns page-full" data-number="33.5.2">
<h3 data-number="33.5.2" class="anchored" data-anchor-id="sec-html-custom"><span class="header-section-number">33.5.2</span> Scraping HTML with Custom Functions</h3>
<p>Much of the time, the information we want from a website is not directly in tabular form, even if it may have a common structure. Consider, for instance, a school directory listing the names, email addresses, office numbers, and phone numbers of the faculty and staff. This could be formatted as a table (and we probably want the end result to be tabular), but more commonly it’s structured on the web as a set of “Cards” formatted like the one shown in <a href="#fig-cartoon-photo-directory" class="quarto-xref">Figure&nbsp;<span>33.5</span></a>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-cartoon-photo-directory" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A headshot of a cartoon man with grey hair and a grey suit is shown on top. Underneath, the text reads Prof S. Singh. Statistics Chair. 302 Statistics Bldg, City, State, 97389. 123-867-5309.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cartoon-photo-directory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/cartoon-photo-directory.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;33.5: “Cards” are often used to show a combination of image and text information populated from structured data. Image modified from a sample image by Artguru AI"><img src="../images/advanced/cartoon-photo-directory.png" class="img-fluid figure-img" alt="A headshot of a cartoon man with grey hair and a grey suit is shown on top. Underneath, the text reads Prof S. Singh. Statistics Chair. 302 Statistics Bldg, City, State, 97389. 123-867-5309."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cartoon-photo-directory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.5: “Cards” are often used to show a combination of image and text information populated from structured data. Image modified from a sample image by <a href="https://www.artguru.ai/ai-art-generator-from-photo/">Artguru AI</a>
</figcaption>
</figure>
</div>
</div></div><p>Often, in addition to the text, you will want to acquire image data, links, or data from linked pages along with the information presented on the landing page. Or, you may want to acquire information from several pages with similar structure – for instance, you may want to get all departments at an institution, or information from all of the animal shelters in your state. Even when data is not in a “cards” style format, but is instead structured in a table, or something that is visually similar to a table but is not actually contained within <code>&lt;table&gt;&lt;/table&gt;</code> tags, it is typically easy enough to get the data out of the HTML markup systematically.</p>
<p>The most effective way to write code for web scraping tasks more complicated than just reading in a single table is to write custom functions to extract the components you need (and put in appropriate empty/NA values if those components are missing), and then call those custom functions from a main function that can put everything back together). You may need functions for multiple levels of pages, if you have to follow links from one main page to individual, more specific pages. These functions will need to contain error handling, because it is incredibly common for information to be missing, at which point your searches for specific nodes will come back empty. It is very annoying to have your code fail on the 99th of 100 pages and have to re-scrape everything (and, in fact, you generally don’t want to do this – it is more polite to work in a way that ensures you are saving intermediate results and don’t have to rescrape everything each time).</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Revolutionary War Battles
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we want to get information from the table of revolutionary war battles that isn’t just text (for instance, the link locations to the pages with more detailed information), then we need to write a bit more custom code – first, to get the links from the table, and second to get additional information from the specific pages for each battle.</p>
<p>In this case, it’s easiest to think of the table as a set of rows with columns that have a specific order. We can use CSS pseudo-classes (things you can append to elements): <code>:first-child</code>, <code>:nth-child(2)</code>, <code>:nth-child(3)</code> to get the information from the first 3 columns – the fourth is text that we don’t need right now, and the fifth is a citation.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>In order to reduce the load on wikipedia and the compile time for the textbook, I have saved the artifacts from this example after running the code once. I am invisibly loading those saved objects rather than re-scraping everything each time this book is re-compiled.</p>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_American_Revolutionary_War_battles"</span>) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>rev_war_rows <span class="ot">&lt;-</span> <span class="fu">html_elements</span>(doc, <span class="st">".wikitable tr"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rev_war_rows)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="do">## {xml_nodeset (6)}</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &lt;tr&gt;\n&lt;th&gt;Battle&lt;/th&gt;\n&lt;th&gt;Date&lt;/th&gt;\n&lt;th&gt;Location&lt;/th&gt;\n&lt;th&gt;Outcome\n&lt;/t ...</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &lt;tr&gt;\n&lt;td&gt;\n&lt;a href="/wiki/Powder_Alarm" title="Powder Alarm"&gt;Powder Alar ...</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] &lt;tr&gt;\n&lt;td&gt;\n&lt;a href="/wiki/Capture_of_Fort_William_and_Mary#Raid" title=" ...</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] &lt;tr&gt;\n&lt;td&gt;&lt;a href="/wiki/Battles_of_Lexington_and_Concord" title="Battles ...</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [5] &lt;tr&gt;\n&lt;td&gt;&lt;a href="/w/index.php?title=Battle_of_Meriam%27s_Corner&amp;amp;act ...</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] &lt;tr&gt;\n&lt;td&gt;&lt;a href="/wiki/Siege_of_Boston" title="Siege of Boston"&gt;Siege o ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our operational node here will be each row of the table. To keep the data together (in case, for instance, some battles don’t have their own pages, and thus don’t have a link), we need to get a node list of the rows first, and then use selectors on that list to get our data in a consistent order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>rev_war_battles <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:first-child"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">link =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:first-child &gt; a"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"href"</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:nth-child(2)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">location =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:nth-child(3)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>()</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in `tibble()`:</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ! Tibble columns must have compatible sizes.</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="do">## • Size 267: Existing data.</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="do">## • Size 266: Column `link`.</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Only values of size one are recycled.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unfortunately, that doesn’t work either! One of the battles doesn’t have a unique page, so there’s a row mismatch. We need to process each row separately and then rbind them together, or figure out how to fix the fact that if an element doesn’t have a child element <code>a</code>, then it won’t have a <code>href</code> attribute, either, and yet we don’t want to lose track of the spot where there isn’t a corresponding link.</p>
<p>Let’s fix the missing-child issue first, and then I will demonstrate the other approach. In this case, they’re approximately the same level of difficulty, but often one approach is easier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-46"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-46-1"><a href="#annotated-cell-46-1" aria-hidden="true" tabindex="-1"></a>safe_href <span class="ot">&lt;-</span> <span class="cf">function</span>(i) {</span>
<span id="annotated-cell-46-2"><a href="#annotated-cell-46-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Safely get a child link href from node i, returning NA if no such link exists</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="1">1</button><span id="annotated-cell-46-3" class="code-annotation-target"><a href="#annotated-cell-46-3" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">&lt;-</span> <span class="fu">html_element</span>(i, <span class="st">"a"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="2">2</button><span id="annotated-cell-46-4" class="code-annotation-target"><a href="#annotated-cell-46-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(j) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="annotated-cell-46-5"><a href="#annotated-cell-46-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="annotated-cell-46-6"><a href="#annotated-cell-46-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-46" data-target-annotation="3">3</button><span id="annotated-cell-46-7" class="code-annotation-target"><a href="#annotated-cell-46-7" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">html_attr</span>(j, <span class="st">"href"</span>))</span>
<span id="annotated-cell-46-8"><a href="#annotated-cell-46-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"try-error"</span> <span class="sc">%in%</span> <span class="fu">class</span>(res)) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="cf">else</span> <span class="fu">return</span>(res)</span>
<span id="annotated-cell-46-9"><a href="#annotated-cell-46-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-46-10"><a href="#annotated-cell-46-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-46-11"><a href="#annotated-cell-46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-46-12"><a href="#annotated-cell-46-12" aria-hidden="true" tabindex="-1"></a>rev_war_battles2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="annotated-cell-46-13"><a href="#annotated-cell-46-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:first-child"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(),</span>
<span id="annotated-cell-46-14"><a href="#annotated-cell-46-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">link =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:first-child"</span>) <span class="sc">|&gt;</span> <span class="fu">map_chr</span>(safe_href),</span>
<span id="annotated-cell-46-15"><a href="#annotated-cell-46-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:nth-child(2)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(),</span>
<span id="annotated-cell-46-16"><a href="#annotated-cell-46-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">location =</span> <span class="fu">html_elements</span>(rev_war_rows, <span class="st">"td:nth-child(3)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>()</span>
<span id="annotated-cell-46-17"><a href="#annotated-cell-46-17" aria-hidden="true" tabindex="-1"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-46" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-lines="3" data-code-annotation="1">First get any child of the node that is <code>a</code></span>
</dd>
<dt data-target-cell="annotated-cell-46" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-lines="4,5" data-code-annotation="2">Check if any children exist - if not, return NA</span>
</dd>
<dt data-target-cell="annotated-cell-46" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-46" data-code-lines="7,8" data-code-annotation="3">Try to get the <code>href</code> attribute from <code>a</code>, and if that works, return it; if not, return NA. In reality, every <code>a</code> element should have a <code>href</code> attribute, but this is also a good example of how to ensure your code doesn’t fail unexpectedly.</span>
</dd>
</dl>
</div>
</div>
<p>When writing custom functions for web scrapign, it’s usually helpful to give yourself an idea of what the function does in a comment – you can often reuse these functions, but that only works if you’re kind to future you and remind yourself what they actually do.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rev_war_battles2)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 4</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                               link                         date  location</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                              &lt;chr&gt;                        &lt;chr&gt; &lt;chr&gt;   </span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 &lt;NA&gt;                               &lt;NA&gt;                         &lt;NA&gt;  &lt;NA&gt;    </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Powder Alarm*                      /wiki/Powder_Alarm           Sept… Massach…</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Storming of Fort William and Mary* /wiki/Capture_of_Fort_Willi… Dece… New Ham…</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Battles of Lexington and Concord   /wiki/Battles_of_Lexington_… Apri… Massach…</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Battle of Meriam's Corner          /wiki/Battle_of_Meriam%27s_… Apri… Massach…</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Siege of Boston                    /wiki/Siege_of_Boston        Apri… Massach…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-48"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-48-1"><a href="#annotated-cell-48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="annotated-cell-48-2"><a href="#annotated-cell-48-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-48" data-target-annotation="1">1</button><span id="annotated-cell-48-3" class="code-annotation-target"><a href="#annotated-cell-48-3" aria-hidden="true" tabindex="-1"></a>process_battle_row <span class="ot">&lt;-</span> <span class="cf">function</span>(node){</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-48" data-target-annotation="2">2</button><span id="annotated-cell-48-4" class="code-annotation-target"><a href="#annotated-cell-48-4" aria-hidden="true" tabindex="-1"></a>  link <span class="ot">=</span> <span class="fu">html_element</span>(node, <span class="st">"td:first-child a"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="annotated-cell-48-5"><a href="#annotated-cell-48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="annotated-cell-48-6"><a href="#annotated-cell-48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">html_element</span>(node, <span class="st">"td:first-child"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-48" data-target-annotation="3">3</button><span id="annotated-cell-48-7" class="code-annotation-target"><a href="#annotated-cell-48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">link =</span> <span class="fu">if_else</span>(<span class="fu">length</span>(link) <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, link),</span>
<span id="annotated-cell-48-8"><a href="#annotated-cell-48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">html_element</span>(node, <span class="st">"td:nth-child(2)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(),</span>
<span id="annotated-cell-48-9"><a href="#annotated-cell-48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="fu">html_element</span>(node, <span class="st">"td:nth-child(3)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>()</span>
<span id="annotated-cell-48-10"><a href="#annotated-cell-48-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="annotated-cell-48-11"><a href="#annotated-cell-48-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-48-12"><a href="#annotated-cell-48-12" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-48" data-target-annotation="4">4</button><span id="annotated-cell-48-13" class="code-annotation-target"><a href="#annotated-cell-48-13" aria-hidden="true" tabindex="-1"></a>rev_war_battles3 <span class="ot">&lt;-</span> <span class="fu">map</span>(rev_war_rows, process_battle_row) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-48" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-48" data-code-lines="3" data-code-annotation="1">Here, the function is called on a single row of the table, so it’s much harder to “lose” a value.</span>
</dd>
<dt data-target-cell="annotated-cell-48" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-48" data-code-lines="4" data-code-annotation="2">First, get all first <code>td</code> elements with <code>a</code> children, and get the <code>href</code> attribute from those children. This will be <code>NULL</code> or <code>c()</code> (a list of length 0) if there is no <code>a</code> child of the first <code>td</code> element in the node.</span>
</dd>
<dt data-target-cell="annotated-cell-48" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-48" data-code-lines="7" data-code-annotation="3">The biggest modification here is to use <code>if_else()</code> to handle the missing values and replace them with NA instead.</span>
</dd>
<dt data-target-cell="annotated-cell-48" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-48" data-code-lines="13" data-code-annotation="4">Call <code>process_battle_row</code> on each row and bind the rows together.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<pre><code>## Error in gzfile(file, "rb"): cannot open the connection
head(rev_war_battles3)
## Error: object 'rev_war_battles3' not found</code></pre>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup, SoupStrainer</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_American_Revolutionary_War_battles"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>req <span class="op">=</span> urllib.request.Request(url)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>page_bytearray <span class="op">=</span> urllib.request.urlopen(req)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>page <span class="op">=</span> page_bytearray.read()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>page_bytearray.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our operational node here will be each row of the table. To keep the data together (in case, for instance, some battle doesn’t have its own page, and thus doesn’t have a link), we need to get a node list of the rows first, and then use selectors on that list to get our data in a consistent order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-51"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="1">1</button><span id="annotated-cell-51-1" class="code-annotation-target"><a href="#annotated-cell-51-1" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(page)</span>
<span id="annotated-cell-51-2"><a href="#annotated-cell-51-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="2">2</button><span id="annotated-cell-51-3" class="code-annotation-target"><a href="#annotated-cell-51-3" aria-hidden="true" tabindex="-1"></a>rev_war_rows <span class="op">=</span> soup.select(<span class="st">"table.sortable tr"</span>)</span>
<span id="annotated-cell-51-4"><a href="#annotated-cell-51-4" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="3">3</button><span id="annotated-cell-51-5" class="code-annotation-target"><a href="#annotated-cell-51-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getText(x):</span>
<span id="annotated-cell-51-6"><a href="#annotated-cell-51-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="annotated-cell-51-7"><a href="#annotated-cell-51-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x.text</span>
<span id="annotated-cell-51-8"><a href="#annotated-cell-51-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="annotated-cell-51-9"><a href="#annotated-cell-51-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">""</span></span>
<span id="annotated-cell-51-10"><a href="#annotated-cell-51-10" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="4">4</button><span id="annotated-cell-51-11" class="code-annotation-target"><a href="#annotated-cell-51-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getLink(x):</span>
<span id="annotated-cell-51-12"><a href="#annotated-cell-51-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="annotated-cell-51-13"><a href="#annotated-cell-51-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="dv">0</span>].find_all(<span class="st">"a"</span>)[<span class="dv">0</span>].attrs[<span class="st">"href"</span>]</span>
<span id="annotated-cell-51-14"><a href="#annotated-cell-51-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="annotated-cell-51-15"><a href="#annotated-cell-51-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.NA</span>
<span id="annotated-cell-51-16"><a href="#annotated-cell-51-16" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="5">5</button><span id="annotated-cell-51-17" class="code-annotation-target"><a href="#annotated-cell-51-17" aria-hidden="true" tabindex="-1"></a>battleCol <span class="op">=</span> [i.select(<span class="st">"td:first-child"</span>) <span class="cf">for</span> i <span class="kw">in</span> rev_war_rows][<span class="dv">1</span>:]</span>
<span id="annotated-cell-51-18"><a href="#annotated-cell-51-18" aria-hidden="true" tabindex="-1"></a>dateCol <span class="op">=</span> [i.select_one(<span class="st">":nth-child(2)"</span>) <span class="cf">for</span> i <span class="kw">in</span> rev_war_rows][<span class="dv">1</span>:]</span>
<span id="annotated-cell-51-19"><a href="#annotated-cell-51-19" aria-hidden="true" tabindex="-1"></a>locationCol <span class="op">=</span> [i.select_one(<span class="st">":nth-child(3)"</span>) <span class="cf">for</span> i <span class="kw">in</span> rev_war_rows][<span class="dv">1</span>:]</span>
<span id="annotated-cell-51-20"><a href="#annotated-cell-51-20" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="6">6</button><span id="annotated-cell-51-21" class="code-annotation-target"><a href="#annotated-cell-51-21" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> [getText(i) <span class="cf">for</span> i <span class="kw">in</span> battleCol]</span>
<span id="annotated-cell-51-22"><a href="#annotated-cell-51-22" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> [getLink(i) <span class="cf">for</span> i <span class="kw">in</span> battleCol]</span>
<span id="annotated-cell-51-23"><a href="#annotated-cell-51-23" aria-hidden="true" tabindex="-1"></a>date <span class="op">=</span> [getText(i) <span class="cf">for</span> i <span class="kw">in</span> dateCol]</span>
<span id="annotated-cell-51-24"><a href="#annotated-cell-51-24" aria-hidden="true" tabindex="-1"></a>location <span class="op">=</span> [getText(i) <span class="cf">for</span> i <span class="kw">in</span> locationCol]</span>
<span id="annotated-cell-51-25"><a href="#annotated-cell-51-25" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="7">7</button><span id="annotated-cell-51-26" class="code-annotation-target"><a href="#annotated-cell-51-26" aria-hidden="true" tabindex="-1"></a>rev_war_battles <span class="op">=</span> pd.DataFrame({<span class="st">"name"</span>: name, <span class="st">"link"</span>: link, <span class="st">"date"</span>: date, <span class="st">"location"</span>: location})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-51" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="1" data-code-annotation="1">Read the HTML for the full page</span>
</dd>
<dt data-target-cell="annotated-cell-51" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="3" data-code-annotation="2">Select the rows of the table that’s sortable (e.g.&nbsp;the main table)</span>
</dd>
<dt data-target-cell="annotated-cell-51" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="5,6,7,8,9" data-code-annotation="3">Define a helper function that will return the text of a node if there is any, and “” otherwise. This makes list comprehensions much easier to read in step 6.</span>
</dd>
<dt data-target-cell="annotated-cell-51" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="11,12,13,14,15" data-code-annotation="4">Define a helper function that will return the <code>href</code> attribute of the link of a child node, if one exists, and NA otherwise. This makes list comprehensions much easier to read in step 6.</span>
</dd>
<dt data-target-cell="annotated-cell-51" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="17,18,19" data-code-annotation="5">Select the columns of interest - battle, date, and location. Battle will create two columns in our result - one for the name of the battle, one for the link.</span>
</dd>
<dt data-target-cell="annotated-cell-51" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="21,22,23,24" data-code-annotation="6">Get the actual columns we intend to have in our data frame, using the helper functions created in steps 3-4.</span>
</dd>
<dt data-target-cell="annotated-cell-51" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="26" data-code-annotation="7">Create a DataFrame by creating a dict of lists and then converting it.</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<!-- End panel tabset -->
<p>Now that we have links to the individual pages (where they exist), we can supplement the data in the original table with data from the more detailed battle-level pages. One way to display this data might be to show an animated map that shows simultaneous actions in different locations. To do this, we need latitude and longitude that are at least approximate (and ideally, at a higher resolution than state-level). If we click on the <a href="https://en.wikipedia.org/wiki/Powder_Alarm">Powder Alarm</a> battle page, we can see a structured table on the right that contains the location of the battle and links to <a href="https://en.wikipedia.org/wiki/Suffolk_County,_Massachusetts">Suffolk County, Massachusetts</a>. The page for Suffolk County, MA has a latitude and longitude.</p>
<div id="fig-rev-war-page-chain" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rev-war-page-chain-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 45.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/advanced/rev-war-battle-page.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="(Click to enlarge) Each battle has a formatted table on the right with a sub-table that has a location field."><img src="../images/advanced/rev-war-battle-page.png" class="img-fluid figure-img" alt="The image is a composite screenshot showing a Wikipedia article titled &quot;Powder Alarm&quot; on the left and a web inspector view on the right. The Wikipedia article discusses the historical event known as the Powder Alarm, including its background and significance. It features an infobox with a picture of the Powder House in Somerville, Massachusetts, and details such as the event's date, location, and key figures like Thomas Gage and Paul Revere prominently mentioned throughout the text. The web inspector panel on the right displays HTML code related to the page, with a section highlighted in blue. The page elements are structured into tables, revealing details like styles, links, and locations mentioned in the article."></a></p>
<figcaption>(Click to enlarge) Each battle has a formatted table on the right with a sub-table that has a location field.</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 45.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/advanced/rev-war-location-page.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="(Click to enlarge) Each location also has a formatted table on the right. GPS location is located within a span element with class geo-dms."><img src="../images/advanced/rev-war-location-page.png" class="img-fluid figure-img" alt="The image is a screenshot of a webpage and includes a section of HTML source code. The left side of the image displays a Wikipedia page about Suffolk County, Massachusetts. It features a historical photograph of the Old Suffolk County Courthouse and a map showing its location within the U.S. state of Massachusetts. The page provides details about the county, including its history, government, and politics. Visible text sections include a county overview table with information such as location, founded date, population, and time zone. A voter registration and party enrollment table is also shown. On the right side, the image shows the browser's Developer Tools interface, specifically the &quot;Inspector&quot; tab, which highlights a segment of the HTML code corresponding to the webpage's content. The code focuses on a table section displaying geographic coordinates with HTML elements and classes revealed. The cursor is highlighting the span containing the latitude and longitude."></a></p>
<figcaption>(Click to enlarge) Each location also has a formatted table on the right. GPS location is located within a span element with class <code>geo-dms</code>.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rev-war-page-chain-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.6: Two steps are necessary in order to get geographic information from the information provided in the table of revolutionary war battles.
</figcaption>
</figure>
</div>
<p>So, our function needs to:</p>
<ol type="1">
<li>Identify the structured table on the battle page</li>
<li>Find the location row in that table</li>
<li>Look for a link in the location row and follow it, if it exists, to the linked location page</li>
<li>Look for a latitude/longitude entry in the location link page</li>
</ol>
<p>If the structured table doesn’t exist, the location row doesn’t exist, or there is no location link, the function should return a data frame row with <code>lat=NA, long=NA</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>get_battle_location <span class="ot">&lt;-</span> <span class="cf">function</span>(battle_link) {</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(battle_link)) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>, <span class="at">battle_link =</span> <span class="cn">NA</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  battle_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://en.wikipedia.org/"</span>, battle_link)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  battle_doc <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">read_html</span>(battle_url))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"try-error"</span> <span class="sc">%in%</span> <span class="fu">class</span>(battle_doc)) {</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>, <span class="at">battle_link =</span> battle_link, <span class="at">location_link =</span> <span class="cn">NA</span>))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get first (hopefully most specific) location link</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  location_url <span class="ot">&lt;-</span> <span class="fu">html_node</span>(battle_doc, <span class="st">".infobox .location a"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(location_url)) {</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>, <span class="at">battle_link =</span> battle_link, <span class="at">location_link =</span> <span class="cn">NA</span>))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  location_doc <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="fu">paste0</span>(<span class="st">"https://en.wikipedia.org/"</span>, location_url))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">"try-error"</span> <span class="sc">%in%</span> <span class="fu">class</span>(location_doc)) {</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">latitude =</span> <span class="cn">NA</span>, <span class="at">longitude =</span> <span class="cn">NA</span>, <span class="at">battle_link =</span> battle_link, <span class="at">location_link =</span> location_url))</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sleep for one second to limit load on servers - </span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this limits us to at most 2 requests per second, </span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># well below Wikipedia's 20rps limit</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get location coords</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  location_node <span class="ot">&lt;-</span> <span class="fu">html_node</span>(location_doc, <span class="st">".geo-dms"</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> location_node <span class="sc">|&gt;</span> <span class="fu">html_children</span>() <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"class"</span>),</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> location_node <span class="sc">|&gt;</span> <span class="fu">html_children</span>() <span class="sc">|&gt;</span> <span class="fu">html_text</span>()</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"type"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">battle_link =</span> battle_link, <span class="at">location_link =</span> location_url) <span class="co"># makes merging easier</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>battle_locations <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(rev_war_battles2<span class="sc">$</span>link, get_battle_location)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>battle_locations <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(battle_locations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>battle_locations <span class="ot">&lt;-</span> battle_locations <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="co"># filter out NA values that don't have any links at all</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>rev_war_battles3 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rev_war_battles2, battle_locations, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"link"</span> <span class="ot">=</span> <span class="st">"battle_link"</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rev_war_battles3)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 7</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                     link  date  location latitude longitude location_link</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;        </span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 &lt;NA&gt;                     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;         </span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Powder Alarm*            /wik… Sept… Massach… 42°21′3… 71°03′28… /wiki/Suffol…</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Storming of Fort Willia… /wik… Dece… New Ham… 43°04′2… 70°42′58… /wiki/New_Ca…</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Battles of Lexington an… /wik… Apri… Massach… 42°29′N  71°23′W   /wiki/Middle…</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Battle of Meriam's Corn… /wik… Apri… Massach… 42°27′3… 71°19′27… /wiki/Meriam…</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Siege of Boston          /wik… Apri… Massach… 42°21′3… 71°3′28″W /wiki/Boston</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-54"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-54-1"><a href="#annotated-cell-54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup,SoupStrainer</span>
<span id="annotated-cell-54-2"><a href="#annotated-cell-54-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="annotated-cell-54-3"><a href="#annotated-cell-54-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="1">1</button><span id="annotated-cell-54-4" class="code-annotation-target"><a href="#annotated-cell-54-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="annotated-cell-54-5"><a href="#annotated-cell-54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-54-6"><a href="#annotated-cell-54-6" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="2">2</button><span id="annotated-cell-54-7" class="code-annotation-target"><a href="#annotated-cell-54-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> req_page(url):</span>
<span id="annotated-cell-54-8"><a href="#annotated-cell-54-8" aria-hidden="true" tabindex="-1"></a>  req <span class="op">=</span> urllib.request.Request(url)</span>
<span id="annotated-cell-54-9"><a href="#annotated-cell-54-9" aria-hidden="true" tabindex="-1"></a>  page_bytearray <span class="op">=</span> urllib.request.urlopen(req)</span>
<span id="annotated-cell-54-10"><a href="#annotated-cell-54-10" aria-hidden="true" tabindex="-1"></a>  page <span class="op">=</span> page_bytearray.read()</span>
<span id="annotated-cell-54-11"><a href="#annotated-cell-54-11" aria-hidden="true" tabindex="-1"></a>  page_bytearray.close()</span>
<span id="annotated-cell-54-12"><a href="#annotated-cell-54-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> page</span>
<span id="annotated-cell-54-13"><a href="#annotated-cell-54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-54-14"><a href="#annotated-cell-54-14" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="3">3</button><span id="annotated-cell-54-15" class="code-annotation-target"><a href="#annotated-cell-54-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_battle_location(battle_link):</span>
<span id="annotated-cell-54-16"><a href="#annotated-cell-54-16" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="4">4</button><span id="annotated-cell-54-17" class="code-annotation-target"><a href="#annotated-cell-54-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="annotated-cell-54-18"><a href="#annotated-cell-54-18" aria-hidden="true" tabindex="-1"></a>    page<span class="op">=</span>req_page(<span class="st">"https://en.wikipedia.org"</span> <span class="op">+</span> battle_link)</span>
<span id="annotated-cell-54-19"><a href="#annotated-cell-54-19" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(page)</span>
<span id="annotated-cell-54-20"><a href="#annotated-cell-54-20" aria-hidden="true" tabindex="-1"></a>    location <span class="op">=</span> soup.select_one(<span class="st">".infobox .location a"</span>)</span>
<span id="annotated-cell-54-21"><a href="#annotated-cell-54-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(location) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="annotated-cell-54-22"><a href="#annotated-cell-54-22" aria-hidden="true" tabindex="-1"></a>      location_link <span class="op">=</span> location.attrs[<span class="st">'href'</span>]</span>
<span id="annotated-cell-54-23"><a href="#annotated-cell-54-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="annotated-cell-54-24"><a href="#annotated-cell-54-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"No location links found"</span>)</span>
<span id="annotated-cell-54-25"><a href="#annotated-cell-54-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="annotated-cell-54-26"><a href="#annotated-cell-54-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"latitude"</span>:pd.NA, <span class="st">"longitude"</span>:pd.NA,</span>
<span id="annotated-cell-54-27"><a href="#annotated-cell-54-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"battle_link"</span>:battle_link, <span class="st">"location_link"</span>:pd.NA}</span>
<span id="annotated-cell-54-28"><a href="#annotated-cell-54-28" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="5">5</button><span id="annotated-cell-54-29" class="code-annotation-target"><a href="#annotated-cell-54-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="annotated-cell-54-30"><a href="#annotated-cell-54-30" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="annotated-cell-54-31"><a href="#annotated-cell-54-31" aria-hidden="true" tabindex="-1"></a>    page2 <span class="op">=</span> req_page(<span class="st">"https://en.wikipedia.org"</span> <span class="op">+</span> location_link)</span>
<span id="annotated-cell-54-32"><a href="#annotated-cell-54-32" aria-hidden="true" tabindex="-1"></a>    soup2 <span class="op">=</span> BeautifulSoup(page2)</span>
<span id="annotated-cell-54-33"><a href="#annotated-cell-54-33" aria-hidden="true" tabindex="-1"></a>    location_node <span class="op">=</span> soup2.select_one(<span class="st">".geo-dms"</span>).find_all(<span class="st">"span"</span>)</span>
<span id="annotated-cell-54-34"><a href="#annotated-cell-54-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(location_node) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="annotated-cell-54-35"><a href="#annotated-cell-54-35" aria-hidden="true" tabindex="-1"></a>      coords <span class="op">=</span> [i.string <span class="cf">for</span> i <span class="kw">in</span> location_node]</span>
<span id="annotated-cell-54-36"><a href="#annotated-cell-54-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="annotated-cell-54-37"><a href="#annotated-cell-54-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Insufficient geo-dms coordinates found"</span>)</span>
<span id="annotated-cell-54-38"><a href="#annotated-cell-54-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="annotated-cell-54-39"><a href="#annotated-cell-54-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"latitude"</span>:pd.NA, <span class="st">"longitude"</span>:pd.NA,</span>
<span id="annotated-cell-54-40"><a href="#annotated-cell-54-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">"battle_link"</span>:battle_link, <span class="st">"location_link"</span>:location_link}</span>
<span id="annotated-cell-54-41"><a href="#annotated-cell-54-41" aria-hidden="true" tabindex="-1"></a>    </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="6">6</button><span id="annotated-cell-54-42" class="code-annotation-target"><a href="#annotated-cell-54-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {<span class="st">"latitude"</span>:coords[<span class="dv">0</span>], <span class="st">"longitude"</span>:coords[<span class="dv">1</span>],</span>
<span id="annotated-cell-54-43"><a href="#annotated-cell-54-43" aria-hidden="true" tabindex="-1"></a>          <span class="st">"battle_link"</span>:battle_link, <span class="st">"location_link"</span>:location_link}</span>
<span id="annotated-cell-54-44"><a href="#annotated-cell-54-44" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-54" data-target-annotation="7">7</button><span id="annotated-cell-54-45" class="code-annotation-target"><a href="#annotated-cell-54-45" aria-hidden="true" tabindex="-1"></a>battle_locations <span class="op">=</span> [get_battle_location(i) <span class="cf">for</span> i <span class="kw">in</span> rev_war_battles.link]</span>
<span id="annotated-cell-54-46"><a href="#annotated-cell-54-46" aria-hidden="true" tabindex="-1"></a>battle_locations <span class="op">=</span> pd.DataFrame(battle_locations)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-54" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="4" data-code-annotation="1">Use the <code>time</code> library to sleep for 1 second before making a 2nd request within the same function.</span>
</dd>
<dt data-target-cell="annotated-cell-54" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="7,8,9,10,11,12" data-code-annotation="2">We’ll be making multiple requests in this function, so streamline it so that we don’t have to type 4 lines each time by making a short custom function.</span>
</dd>
<dt data-target-cell="annotated-cell-54" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="15" data-code-annotation="3">Define a function that takes the local link to the battle page and (1) gets the most specific location link provided for the battle, and (2) follows the link to the location page to get the latitude and longitude of that location. Return a dict containing lat/long, battle_link, and location_link.</span>
</dd>
<dt data-target-cell="annotated-cell-54" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="17,18,19,20,21,22,23,24,25,26,27" data-code-annotation="4">Use a try/except statement to handle any errors that arise when a link doesn’t resolve or a specific element isn’t found. Get the battle page and select the first location infobox link, finding the <code>href</code> attribute within the link if there is a location (if not, raise an error that should trigger the except part of the statement). If anything fails, return a dict that has NAs for everything but the battle link.</span>
</dd>
<dt data-target-cell="annotated-cell-54" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="29,30,31,32,33,34,35,36,37,38,39,40" data-code-annotation="5">Use a try/except statement to get the location page (after sleeping for 1 sec). Look for a <code>.geo-dms</code> node and get its children. If there are exactly two children (lat/long), then extract the coords from the text of the element. Otherwise, raise an exception and return a dict with the battle and location link, but with NA values for latitude and longitude.</span>
</dd>
<dt data-target-cell="annotated-cell-54" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="42,43" data-code-annotation="6">If everything works, then return a dict with all of the relevant information.</span>
</dd>
<dt data-target-cell="annotated-cell-54" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-54" data-code-lines="45,46" data-code-annotation="7">Call the function for every link in the rev_war_battles object, and then convert the result (a list of dicts) into a DataFrame.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>rev_war_battles_full <span class="op">=</span> rev_war_battles.join(battle_locations.loc[:,[<span class="st">"latitude"</span>, <span class="st">"longitude"</span>, <span class="st">"location_link"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use the <code>.join</code> method because both DataFrames have the same index; thus, we don’t have to do a merge operation like we did in R.</p>
</div>
</div>
</div>
<!-- End panel tabset -->
<p>A spatial package could be used to transform the latitude and longitude into numerical values for plotting, but we will stop here, as this example has demonstrated the utility of using custom functions to extract components of a webpage without cataloging all of the information.</p>
</div>
</div>
<!-- End Demo -->
</section>
</section>
<section id="scraping-dynamic-webpages" class="level2 page-columns page-full" data-number="33.6">
<h2 data-number="33.6" class="anchored" data-anchor-id="scraping-dynamic-webpages"><span class="header-section-number">33.6</span> Scraping Dynamic Webpages</h2>
<p>Many modern webpages load page content dynamically using JavaScript. This can have some advantages - for instance, the page loads quickly, and as you scroll, additional content is added, saving the cost of transferring additional data if you decide not to read the full page. However, it’s very annoying when your goal is to scrape content from the page, because tools like <code>rvest</code> and <code>BeautifulSoup</code> only get the initial HTML, not the HTML after JavaScript has modified the page.</p>
<p>Sometimes, there are clever ways around this problem - you may be able to submit a second request to the page and get a response with the content you want. But more often, the best solution is just to emulate a browser and read the dynamic content out of the browser once JavaScript has changed the page.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Roller Derby Skater Names
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://en.wikipedia.org/wiki/Roller_derby">Roller Derby</a> is a team sport played on a roller skating rink, and most leagues seem to be female-dominated. The Junior Roller Derby Association (JRDA) web page contains a <a href="https://www.juniorrollerderby.org/us-leagues">list of US leagues</a>, and each league contains a list of registered organizations. Organizations can have multiple teams that are either open (anyone can join) or female-only, and each team has a <a href="https://www.juniorrollerderby.org/renegades">roster</a> on the organization page. Suppose that our goal is to examine the names that players register with (examples: “Hitty Stardust”, “Collide-a-scope”, “Malice in Wonderland”, “The Curly Dervish”, “Rainbow Bite”) that are often puns with slight hints of violence, gendered humor, or personal characteristics. In addition to players, we want to keep the league, organization, team, and team type (open/female-only).</p>
<p>In order to scrape this data, we have to consider multiple levels because of the hierarchical nature of both the website and the organization. In these cases, it is often useful to write separate functions which scrape each level of the hierarchy, and then write different functions to clean different components of the data. This provides modularity, but it also keeps your code from getting too long and complex for you to keep track of how each job is getting done.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/advanced/roller-derby-league-html-screenshot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Roller Derby leagues - 5 tabs, and each tab has a list of organizations. Organization “blocks” of information are contained in divs that have class textBlockElement – hopefully, that’s enough of a selector to get the information."><img src="../images/advanced/roller-derby-league-html-screenshot.png" class="img-fluid figure-img" alt="The left side of the image shows a map of the United States divided by regions, each in distinct colors. Below the map is the text &quot;US Leagues Registered for the 2024 - 2025 Season.&quot; A menu appears with options like &quot;NORTHWEST,&quot; &quot;SOUTHWEST,&quot; &quot;MIDWEST,&quot; &quot;NORTHEAST,&quot; and &quot;SOUTHEAST.&quot; The tab labeled &quot;NORTHWEST&quot; is selected. The right side of the image displays a web browser's developer tools window. The HTML code is visible, highlighting a section related to tab content with a class of &quot;selected&quot;."></a></p>
<figcaption>Roller Derby leagues - 5 tabs, and each tab has a list of organizations. Organization “blocks” of information are contained in divs that have class <code>textBlockElement</code> – hopefully, that’s enough of a selector to get the information.</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/advanced/roller-derby-team-html-screenshot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Roller Derby organizations are specified within the tab content div. There are several divs, only one of which is displayed (the others correspond to tabs which aren’t selected). Organization “blocks” of information are contained in divs that have class textBlockElement – hopefully, that’s enough of a selector to get the information."><img src="../images/advanced/roller-derby-team-html-screenshot.png" class="img-fluid figure-img" alt="The image is a screenshot of a webpage and its corresponding HTML/CSS code displayed in a developer tools panel. The left side of the image shows a webpage listing US roller derby leagues registered for the 2024-2025 season. The page has a white background with blue and purple accents. Section headers divide leagues into &quot;National&quot; and &quot;Recreational&quot; categories. Logos of different roller derby teams are displayed along with their names and locations. Notable logos include the 509 Junior Roller Derby and Pikes Peak Junior Roller Derby. The right side is the developer tools interface, displaying HTML code and CSS rules corresponding to the webpage. Selected elements are highlighted, showing details such as class names and style properties."></a></p>
<figcaption>Roller Derby organizations are specified within the tab content div. There are several divs, only one of which is displayed (the others correspond to tabs which aren’t selected). Organization “blocks” of information are contained in divs that have class <code>textBlockElement</code> – hopefully, that’s enough of a selector to get the information.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>What’s interesting is that the first time you click on a new tab, you see it “fill” with data. That is, the data isn’t present when the page is loaded. This page is a dynamic webpage – it is loading the data with scripts, and thus has to be treated more carefully.</p>
<p>We can do this in one of two ways</p>
<ol type="1">
<li>Mirror the entire site using a command-line tool like <code>wget</code>, and then trawl through the downloaded information to see if there’s a spreadsheet, table, CSV, or a bunch of HTML files that have the data present.</li>
<li>Launch a remote-controlled browser, click on things using commands, and then read the HTML after the script has run.</li>
</ol>
<p>The first approach is usually faster, though many sites will block <code>wget</code> using <code>robots.txt</code><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<p>The second approach tends to be more successful assuming you can get the infrastructure set up and configured (this has gotten much easier recently, at least in R), and has the bonus effect of making you feel like a very powerful programmer (or mad scientist) as you sit back and watch your computer navigate the web according to your instructions, if you decide to launch the browser window to see the magic happen.</p>
<p>You will need to install the <code>chromote</code> package in R and the <code>selenium</code> package in python.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-57"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-57-1"><a href="#annotated-cell-57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="1">1</button><span id="annotated-cell-57-2" class="code-annotation-target"><a href="#annotated-cell-57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chromote)</span>
<span id="annotated-cell-57-3"><a href="#annotated-cell-57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-57-4"><a href="#annotated-cell-57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="annotated-cell-57-5"><a href="#annotated-cell-57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="annotated-cell-57-6"><a href="#annotated-cell-57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="annotated-cell-57-7"><a href="#annotated-cell-57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="annotated-cell-57-8"><a href="#annotated-cell-57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="annotated-cell-57-9"><a href="#annotated-cell-57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-57-10"><a href="#annotated-cell-57-10" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://www.juniorrollerderby.org/us-leagues"</span></span>
<span id="annotated-cell-57-11"><a href="#annotated-cell-57-11" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="2">2</button><span id="annotated-cell-57-12" class="code-annotation-target"><a href="#annotated-cell-57-12" aria-hidden="true" tabindex="-1"></a>rmt <span class="ot">&lt;-</span> <span class="fu">read_html_live</span>(url)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="3">3</button><span id="annotated-cell-57-13" class="code-annotation-target"><a href="#annotated-cell-57-13" aria-hidden="true" tabindex="-1"></a>rmt<span class="sc">$</span><span class="fu">click</span>(<span class="st">".pageElement .contentTabs li:first-child"</span>)</span>
<span id="annotated-cell-57-14"><a href="#annotated-cell-57-14" aria-hidden="true" tabindex="-1"></a>rmt<span class="sc">$</span><span class="fu">click</span>(<span class="st">".pageElement .contentTabs li:nth-child(2)"</span>)</span>
<span id="annotated-cell-57-15"><a href="#annotated-cell-57-15" aria-hidden="true" tabindex="-1"></a>rmt<span class="sc">$</span><span class="fu">click</span>(<span class="st">".pageElement .contentTabs li:nth-child(3)"</span>)</span>
<span id="annotated-cell-57-16"><a href="#annotated-cell-57-16" aria-hidden="true" tabindex="-1"></a>rmt<span class="sc">$</span><span class="fu">click</span>(<span class="st">".pageElement .contentTabs li:nth-child(4)"</span>)</span>
<span id="annotated-cell-57-17"><a href="#annotated-cell-57-17" aria-hidden="true" tabindex="-1"></a>rmt<span class="sc">$</span><span class="fu">click</span>(<span class="st">".pageElement .contentTabs li:last-child"</span>)</span>
<span id="annotated-cell-57-18"><a href="#annotated-cell-57-18" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="4">4</button><span id="annotated-cell-57-19" class="code-annotation-target"><a href="#annotated-cell-57-19" aria-hidden="true" tabindex="-1"></a><span class="co"># rmt$view()</span></span>
<span id="annotated-cell-57-20"><a href="#annotated-cell-57-20" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="5">5</button><span id="annotated-cell-57-21" class="code-annotation-target"><a href="#annotated-cell-57-21" aria-hidden="true" tabindex="-1"></a>teams <span class="ot">&lt;-</span> rmt <span class="sc">|&gt;</span></span>
<span id="annotated-cell-57-22"><a href="#annotated-cell-57-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".tabContainer .pageEl .textBlockElement"</span>)</span>
<span id="annotated-cell-57-23"><a href="#annotated-cell-57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-57-24"><a href="#annotated-cell-57-24" aria-hidden="true" tabindex="-1"></a>is_team_node <span class="ot">&lt;-</span> <span class="fu">map_int</span>(teams, <span class="sc">~</span><span class="fu">length</span>(<span class="fu">xml_find_first</span>(., <span class="st">"div"</span>))) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="annotated-cell-57-25"><a href="#annotated-cell-57-25" aria-hidden="true" tabindex="-1"></a>teams <span class="ot">&lt;-</span> teams[is_team_node]</span>
<span id="annotated-cell-57-26"><a href="#annotated-cell-57-26" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-57" data-target-annotation="6">6</button><span id="annotated-cell-57-27" class="code-annotation-target"><a href="#annotated-cell-57-27" aria-hidden="true" tabindex="-1"></a>rmt<span class="sc">$</span><span class="fu">close</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-57" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="2" data-code-annotation="1">The <code>chromote</code> package allows you to remote control a browser, though by default it will be <strong>headless</strong> - that is, you won’t be able to see it.</span>
</dd>
<dt data-target-cell="annotated-cell-57" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="12" data-code-annotation="2"><code>rvest</code> includes a <code>read_html_live()</code> function that implicitly sets up a <code>chromote</code> session. the <code>rmt</code> object here is the browser – you can interact with it using a bunch of different methods, usually called with <code>$&lt;function&gt;</code>. <code>rmt</code> is a special type of object called a class, and works very similarly to many python objects, except that instead of using <code>.</code>. to access the class methods, you will use <code>$</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-57" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="13,14,15,16,17" data-code-annotation="3">We remotely click on each of the 5 regional tabs in order to load all of the content for each region</span>
</dd>
<dt data-target-cell="annotated-cell-57" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="19" data-code-annotation="4">This line is commented out because it doesn’t work when the book is compiled, but it will work interactively if you uncomment it – it allows you to see the browser that you’re remote controlling.</span>
</dd>
<dt data-target-cell="annotated-cell-57" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="21,22" data-code-annotation="5">You can interact with <code>rmt</code> using other <code>rvest</code> functions just like you would when using <code>read_html</code>, looking for elements and extracting content.</span>
</dd>
<dt data-target-cell="annotated-cell-57" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-57" data-code-lines="27" data-code-annotation="6">It’s good practice to close the session when you’re done with it rather than leaving it open. This saves computer memory, but also doesn’t keep a connection to the remote server alive, which is polite.</span>
</dd>
</dl>
</div>
</div>
<p>Once we’ve extracted the content from the main page, we won’t necessarily need anything else read “live” - it depends on how the content on the team pages is loaded. Our next task is to write a function to extract the info from the main page.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>get_team_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(node) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  team_img <span class="ot">&lt;-</span> <span class="fu">html_node</span>(node, <span class="st">".leftTextImage img"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"src"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  team_link <span class="ot">&lt;-</span> <span class="fu">html_node</span>(node, <span class="st">".text p:nth-child(2) a"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  team_name <span class="ot">&lt;-</span> <span class="fu">html_node</span>(node, <span class="st">".text p:nth-child(2) a"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  team_location <span class="ot">&lt;-</span> <span class="fu">html_node</span>(node, <span class="st">".text p:nth-child(3)"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name =</span> team_name, <span class="at">link =</span> team_link, <span class="at">img =</span> team_img, <span class="at">location =</span> team_location)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>team_df <span class="ot">&lt;-</span> <span class="fu">map</span>(teams, get_team_summary) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in `map()` at rlang/R/dots.R:91:3:</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ In index: 1.</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Caused by error in `xml_find_first.xml_node()`:</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ! external pointer is not valid</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-59"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-59-1"><a href="#annotated-cell-59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="annotated-cell-59-2"><a href="#annotated-cell-59-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="annotated-cell-59-3"><a href="#annotated-cell-59-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup,SoupStrainer</span>
<span id="annotated-cell-59-4"><a href="#annotated-cell-59-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="annotated-cell-59-5"><a href="#annotated-cell-59-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver <span class="im">import</span> FirefoxOptions</span>
<span id="annotated-cell-59-6"><a href="#annotated-cell-59-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.common.by <span class="im">import</span> By</span>
<span id="annotated-cell-59-7"><a href="#annotated-cell-59-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time <span class="co"># to ensure page loads before we get source</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="1">1</button><span id="annotated-cell-59-8" class="code-annotation-target"><a href="#annotated-cell-59-8" aria-hidden="true" tabindex="-1"></a>options <span class="op">=</span> FirefoxOptions()</span>
<span id="annotated-cell-59-9"><a href="#annotated-cell-59-9" aria-hidden="true" tabindex="-1"></a>options.add_argument(<span class="st">"-headless"</span>)</span>
<span id="annotated-cell-59-10"><a href="#annotated-cell-59-10" aria-hidden="true" tabindex="-1"></a>browser <span class="op">=</span> webdriver.Firefox(options <span class="op">=</span> options)</span>
<span id="annotated-cell-59-11"><a href="#annotated-cell-59-11" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="2">2</button><span id="annotated-cell-59-12" class="code-annotation-target"><a href="#annotated-cell-59-12" aria-hidden="true" tabindex="-1"></a>browser.get(<span class="st">"https://www.juniorrollerderby.org/us-leagues"</span>)</span>
<span id="annotated-cell-59-13"><a href="#annotated-cell-59-13" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">2</span>)</span>
<span id="annotated-cell-59-14"><a href="#annotated-cell-59-14" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="3">3</button><span id="annotated-cell-59-15" class="code-annotation-target"><a href="#annotated-cell-59-15" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> browser.find_element(By.CSS_SELECTOR, <span class="st">".pageElement .contentTabs li:first-child"</span>)</span>
<span id="annotated-cell-59-16"><a href="#annotated-cell-59-16" aria-hidden="true" tabindex="-1"></a>tab.click()</span>
<span id="annotated-cell-59-17"><a href="#annotated-cell-59-17" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> browser.find_element(By.CSS_SELECTOR, <span class="st">".pageElement .contentTabs li:nth-child(2)"</span>)</span>
<span id="annotated-cell-59-18"><a href="#annotated-cell-59-18" aria-hidden="true" tabindex="-1"></a>tab.click()</span>
<span id="annotated-cell-59-19"><a href="#annotated-cell-59-19" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> browser.find_element(By.CSS_SELECTOR, <span class="st">".pageElement .contentTabs li:nth-child(3)"</span>)</span>
<span id="annotated-cell-59-20"><a href="#annotated-cell-59-20" aria-hidden="true" tabindex="-1"></a>tab.click()</span>
<span id="annotated-cell-59-21"><a href="#annotated-cell-59-21" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> browser.find_element(By.CSS_SELECTOR, <span class="st">".pageElement .contentTabs li:nth-child(4)"</span>)</span>
<span id="annotated-cell-59-22"><a href="#annotated-cell-59-22" aria-hidden="true" tabindex="-1"></a>tab.click()</span>
<span id="annotated-cell-59-23"><a href="#annotated-cell-59-23" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> browser.find_element(By.CSS_SELECTOR, <span class="st">".pageElement .contentTabs li:last-child"</span>)</span>
<span id="annotated-cell-59-24"><a href="#annotated-cell-59-24" aria-hidden="true" tabindex="-1"></a>tab.click()</span>
<span id="annotated-cell-59-25"><a href="#annotated-cell-59-25" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="4">4</button><span id="annotated-cell-59-26" class="code-annotation-target"><a href="#annotated-cell-59-26" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(StringIO(browser.page_source))</span>
<span id="annotated-cell-59-27"><a href="#annotated-cell-59-27" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="5">5</button><span id="annotated-cell-59-28" class="code-annotation-target"><a href="#annotated-cell-59-28" aria-hidden="true" tabindex="-1"></a>browser.close()</span>
<span id="annotated-cell-59-29"><a href="#annotated-cell-59-29" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="6">6</button><span id="annotated-cell-59-30" class="code-annotation-target"><a href="#annotated-cell-59-30" aria-hidden="true" tabindex="-1"></a>teams <span class="op">=</span> soup.select(<span class="st">".tabContainer .pageEl .textBlockElement"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-59" data-target-annotation="7">7</button><span id="annotated-cell-59-31" class="code-annotation-target"><a href="#annotated-cell-59-31" aria-hidden="true" tabindex="-1"></a>teams <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> teams <span class="cf">if</span> <span class="bu">len</span>(i.find_all(<span class="st">'div'</span>)) <span class="op">&gt;</span> <span class="dv">0</span>]</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-59" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="8,9,10" data-code-annotation="1">Open a Firefox window (you could also use <code>webdriver.Chrome()</code> to get Chrome/Chromium if you prefer). The options() statements ensure this driver is “headless” - that is, it doesn’t actually pop open a window (this allows it to run on a server without a graphical display, like the one that builds the book automatically). You can just replace all three lines with <code>browser = webdriver.Firefox()</code> if you want to see the website.</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="12,13" data-code-annotation="2">Open the target URL and sleep 2 seconds to let the page load</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="15,16,17,18,19,20,21,22,23,24" data-code-annotation="3">Find each tab and click on it.</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="26" data-code-annotation="4">Get the HTML code from the browser after JavaScript has had fun with it (<code>browser.page_source</code>), and tell BeautifulSoup it’s HTML in string form rather than a request format (<code>StringIO</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="28" data-code-annotation="5">Close the browser - we don’t need it now that we’ve gotten the HTML.</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="30" data-code-annotation="6">Select the team div nodes (this selector will include some headings, like “National” and “Regional”)</span>
</dd>
<dt data-target-cell="annotated-cell-59" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-59" data-code-lines="31" data-code-annotation="7">Remove the extra headings that don’t have div children.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_team_summary(node):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">list</span>(<span class="bu">list</span>(node.children)[<span class="dv">1</span>].children)[<span class="dv">1</span>].attrs[<span class="st">'src'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>

<p>Next, we need to figure out how to get the team roster information from the individual team pages. A look at the HTML for the <a href="https://www.juniorrollerderby.org/renegades">Renegades team</a> shows this interesting node:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"https://docs.google.com/spreadsheets/d/e/2PACX-1vSZPNZu2hhBDjnxWH58quhER6anponm1YCl512tHLTcURYUDzCXWqT7sNy7S_wcDKy8Wnoj4VNaAYyh/pubhtml?gid=1152027622</span><span class="dv">&amp;amp;</span><span class="st">single=true</span><span class="dv">&amp;amp;</span><span class="st">widget=false</span><span class="dv">&amp;amp;</span><span class="st">headers=false</span><span class="dv">&amp;amp;</span><span class="st">chrome=false</span><span class="dv">&amp;amp;</span><span class="st">range=a1:i25"</span><span class="ot"> width</span><span class="op">=</span><span class="st">"100%"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"600"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An <code>iframe</code> allows you to include another web page inside the current webpage. In this case, we can see that this iframe is showing us a google sheet, rendered as a table. In theory, we could use the <code>googlesheets4</code> package to read in the sheet, but <code>html_table</code> should work just as well.</p>
<p>It can be helpful to know a bit about how URLs are constructed in order to simplify this URL a bit. Additional key-value information is often added to the end of a URL, separated from the main part of the URL by a <code>?</code>. So, all of the information after the question mark in the iframe <code>src</code> attribute is not necessary for our purposes.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>players <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://docs.google.com/spreadsheets/d/e/2PACX-1vSZPNZu2hhBDjnxWH58quhER6anponm1YCl512tHLTcURYUDzCXWqT7sNy7S_wcDKy8Wnoj4VNaAYyh/pubhtml"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">html_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(players)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 64</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>players[[<span class="dv">2</span>]]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 48 × 9</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="do">##       `` ``       `` ``                            ``    ``    ``    ``    ``   </span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;lgl&gt; &lt;int&gt; &lt;chr&gt;                         &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1     1 NA       NA ""                            ""    ""    NA    ""    ""   </span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2     2 NA       NA "CURRENT ACTIVE CHARTER ROST… "CUR… "CUR… NA    "LEA… "Ad …</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3     3 NA       NA "CURRENT ACTIVE CHARTER ROST… "CUR… "CUR… NA    "TEA… "Ad …</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4     4 NA       NA "Skater Number"               "Ska… "Act… NA    "DIV… "FEM…</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5     5 NA        1 "011"                         "Wic… "4/1… NA    ""    ""   </span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6     6 NA        2 "02"                          "Ken… "4/1… NA    "UNI… "WHI…</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7     7 NA        3 "09"                          "Sas… "4/1… NA    ""    "BLU…</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8     8 NA        4 "092"                         "Poc… "4/1… NA    ""    ""   </span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9     9 NA        5 "101"                         "Slu… "4/1… NA    "COA… "COA…</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10    10 NA        6 "112"                         "Gna… "4/1… NA    "Leg… "Der…</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 38 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>players <span class="op">=</span> pd.read_html(<span class="st">"https://docs.google.com/spreadsheets/d/e/2PACX-1vSZPNZu2hhBDjnxWH58quhER6anponm1YCl512tHLTcURYUDzCXWqT7sNy7S_wcDKy8Wnoj4VNaAYyh/pubhtml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(players)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">## 64</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>players[<span class="dv">1</span>]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">##     Unnamed: 0  ...                    Unnamed: 8</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 0            1  ...                           NaN</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1            2  ...  Ad Astra Junior Roller Derby</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 2            3  ...                  Ad Astra (F)</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 3            4  ...                        FEMALE</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 4            5  ...                           NaN</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 5            6  ...                         WHITE</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 6            7  ...                          BLUE</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 7            8  ...                           NaN</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 8            9  ...                COACHING STAFF</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 9           10  ...                    Derby Name</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 10          11  ...                           NaN</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 11          12  ...                           NaN</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 12          13  ...                           NaN</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 13          14  ...                           NaN</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 14          15  ...                           NaN</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 15          16  ...                           NaN</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 16          17  ...                           NaN</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 17          18  ...                           NaN</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 18          19  ...                           NaN</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 19          20  ...                           NaN</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 20          21  ...                           NaN</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 21          22  ...                           NaN</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="co">## 22          23  ...                           NaN</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co">## 23          24  ...                           NaN</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 24          25  ...                           NaN</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 25          26  ...  Ad Astra Junior Roller Derby</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="co">## 26          27  ...                  Ad Astra (O)</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="co">## 27          28  ...                          OPEN</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="co">## 28          29  ...                           NaN</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="co">## 29          30  ...                         WHITE</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="co">## 30          31  ...                          BLUE</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="co">## 31          32  ...                           NaN</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co">## 32          33  ...                           NaN</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="co">## 33          34  ...                           NaN</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="co">## 34          35  ...                           NaN</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="co">## 35          36  ...                           NaN</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="co">## 36          37  ...                           NaN</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="co">## 37          38  ...                           NaN</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="co">## 38          39  ...                           NaN</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="co">## 39          40  ...                           NaN</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="co">## 40          41  ...                           NaN</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="co">## 41          42  ...                           NaN</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="co">## 42          43  ...                           NaN</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="co">## 43          44  ...                           NaN</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="co">## 44          45  ...                           NaN</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="co">## 45          46  ...                           NaN</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="co">## 46          47  ...                           NaN</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="co">## 47          48  ...                           NaN</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="co">## [48 rows x 9 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Interesting - we can get all of the player names for all teams from the single sheet! Some organizations have multiple teams, but they all use the same basic structure for data - there are 23 rows of structured information, and there are blank lines at the top and bottom of each team.</p>
<p>So, to clean this up, we have to (roughly):</p>
<ol type="1">
<li>Identify rows that are either primarily blank or primarily NA</li>
<li>Remove any empty columns that aren’t particularly needed</li>
<li>Find “runs” of the same value indicating that a row is empty-ish</li>
<li>Compute start/end of run sequences, assuming that the run is longer than 1 value</li>
<li>Get only data frame rows corresponding to the run, separating the organization tables into separate teams.</li>
</ol>
<p>Note that for organizations with multiple teams, there are usually only one set of coaches, so by separating this information out we (somewhat) lose the ability to keep coach information with the team. On the other hand, coaches weren’t on our list of critical information.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>team_data <span class="ot">&lt;-</span> <span class="fu">map</span>(players, split_team_df) <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nrow =</span> end<span class="sc">-</span>start) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nrow <span class="sc">&gt;</span> <span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">extract2</span>(<span class="st">"data"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>team_data[[<span class="dv">1</span>]]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 19 × 7</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="do">##       ``    `` ``                            ``                ``    ``    ``   </span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;                         &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  1     2    NA CURRENT ACTIVE CHARTER ROSTER CURRENT ACTIVE C… CURR… "LEA… "509…</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  2     3    NA CURRENT ACTIVE CHARTER ROSTER CURRENT ACTIVE C… CURR… "TEA… "The…</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  3     4    NA Skater Number                 Skater Name       Acti… "DIV… "OPE…</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  4     5     1 03                            Rumble Guppy      1/14… ""    ""   </span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  5     6     2 10                            Ruby Roundhouse   1/10… "UNI… "WHI…</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  6     7     3 106                           Ferdinand         1/13… ""    "BLA…</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  7     8     4 187                           Belle of the Bra… 1/10… ""    ""   </span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  8     9     5 22                            Badadytude        1/10… "COA… "COA…</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  9    10     6 236                           Hell-no Kitty     1/13… "Leg… "Der…</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 10    11     7 247                           Snot Rocket       1/13… "Abb… ""   </span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 11    12     8 3                             Chicken Nugget    PEND… "Vir… "Cle…</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 12    13     9 312                           Slimy Booger      1/14… ""    ""   </span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 13    14    10 34                            The Postman       1/10… ""    ""   </span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 14    15    11 404                           Fatal Error       1/10… ""    ""   </span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 15    16    12 68                            Graycon The Dest… 1/10… ""    ""   </span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 16    17    13 710                           Boo Boo           1/10… ""    ""   </span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 17    18    14 77                            Hurricane         1/10… ""    ""   </span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 18    19    15 82                            Blackout          1/10… ""    ""   </span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 19    20    16 911                           Chaos             1/18… ""    ""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-65"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-65-1"><a href="#annotated-cell-65-1" aria-hidden="true" tabindex="-1"></a>split_team_df <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="annotated-cell-65-2"><a href="#annotated-cell-65-2" aria-hidden="true" tabindex="-1"></a>  is_emptyish <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">is.na</span>(df) <span class="sc">|</span> df <span class="sc">==</span> <span class="st">""</span>) <span class="sc">&gt;</span> <span class="dv">4</span></span>
<span id="annotated-cell-65-3"><a href="#annotated-cell-65-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-65-4"><a href="#annotated-cell-65-4" aria-hidden="true" tabindex="-1"></a>  emptycols <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(df))<span class="sc">==</span><span class="fu">nrow</span>(df))</span>
<span id="annotated-cell-65-5"><a href="#annotated-cell-65-5" aria-hidden="true" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> df[,<span class="sc">-</span>emptycols]</span>
<span id="annotated-cell-65-6"><a href="#annotated-cell-65-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-65-7"><a href="#annotated-cell-65-7" aria-hidden="true" tabindex="-1"></a>  run_stats <span class="ot">&lt;-</span> <span class="fu">rle</span>(is_emptyish)</span>
<span id="annotated-cell-65-8"><a href="#annotated-cell-65-8" aria-hidden="true" tabindex="-1"></a>  run_stats<span class="sc">$</span>end <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(run_stats<span class="sc">$</span>lengths)</span>
<span id="annotated-cell-65-9"><a href="#annotated-cell-65-9" aria-hidden="true" tabindex="-1"></a>  run_stats<span class="sc">$</span>start <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">lag</span>(run_stats<span class="sc">$</span>end)[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="annotated-cell-65-10"><a href="#annotated-cell-65-10" aria-hidden="true" tabindex="-1"></a>  team_dfs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">start =</span> run_stats<span class="sc">$</span>start, <span class="at">end =</span> run_stats<span class="sc">$</span>end, <span class="at">value =</span> run_stats<span class="sc">$</span>values) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-65-11"><a href="#annotated-cell-65-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>value) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-65-12"><a href="#annotated-cell-65-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(start, end, <span class="sc">~</span>df2[.x<span class="sc">:</span>.y,]))</span>
<span id="annotated-cell-65-13"><a href="#annotated-cell-65-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_team_df(df):</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  is_emptyish <span class="op">=</span> pd.isna(df).<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>) <span class="op">&gt;</span> <span class="dv">4</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  fullcols <span class="op">=</span> pd.isna(df).<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">0</span>)<span class="op">!=</span>df.shape[<span class="dv">0</span>]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://stackoverflow.com/questions/66633109/aggregating-row-repeats-in-pandas-run-lengths</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  run_vals <span class="op">=</span> (is_emptyish <span class="op">!=</span> is_emptyish.shift()).cumsum()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  run_vals_tab <span class="op">=</span> run_vals.value_counts()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  run_vals_full_idx <span class="op">=</span> run_vals[<span class="op">~</span>is_emptyish].value_counts().index</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  run_vals_idx <span class="op">=</span> run_vals_tab.index[run_vals_tab<span class="op">!=</span><span class="dv">1</span>]</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  data_idx <span class="op">=</span> np.intersect1d(run_vals_full_idx.values, run_vals_idx.values)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [df.loc[run_vals<span class="op">==</span>i, fullcols] <span class="cf">for</span> i <span class="kw">in</span> data_idx]</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> chain</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/11860476/how-to-unnest-a-nested-list</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>team_data <span class="op">=</span> [split_team_df(i) <span class="cf">for</span> i <span class="kw">in</span> players]</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>team_data <span class="op">=</span> <span class="bu">list</span>(chain(<span class="op">*</span>team_data))</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>team_data[<span class="dv">0</span>]</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">##     Unnamed: 0  Unnamed: 2  ...        Unnamed: 7               Unnamed: 8</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 1            2         NaN  ...       LEAGUE NAME  509 Junior Roller Derby</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 2            3         NaN  ...         TEAM NAME      The Killer Bees (O)</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 3            4         NaN  ...          DIVISION                     OPEN</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 4            5         1.0  ...               NaN                      NaN</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co">## 5            6         2.0  ...    UNIFORM COLORS                    WHITE</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="co">## 6            7         3.0  ...               NaN                    BLACK</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 7            8         4.0  ...               NaN                      NaN</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 8            9         5.0  ...    COACHING STAFF           COACHING STAFF</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co">## 9           10         6.0  ...        Legal Name               Derby Name</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co">## 10          11         7.0  ...      Abby Damerow                      NaN</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="co">## 11          12         8.0  ...  Virginia Thommes             Clean Willie</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co">## 12          13         9.0  ...               NaN                      NaN</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="co">## 13          14        10.0  ...               NaN                      NaN</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="co">## 14          15        11.0  ...               NaN                      NaN</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="co">## 15          16        12.0  ...               NaN                      NaN</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="co">## 16          17        13.0  ...               NaN                      NaN</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co">## 17          18        14.0  ...               NaN                      NaN</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="co">## 18          19        15.0  ...               NaN                      NaN</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="co">## 19          20        16.0  ...               NaN                      NaN</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="co">## [19 rows x 7 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Then, we need to write another set of functions to clean up the multiple tables in the spreadsheet so that they’re actually tidy data instead of a set of tables that are laid out in a format that is definitely not tidy. In this case, it seemed easier to handle the player data and then the team data with separate functions, then combine that information.</p>
<div id="fig-roller-derby-cleaning-sketch" class="quarto-float quarto-figure quarto-figure-center anchored" alt="The image depicts a spreadsheet for a roller derby team roster, titled &quot;CURRENT ACTIVE CHARTER ROSTER.&quot; The spreadsheet is segmented into different sections with a color-coded design. On the left, a blue-bordered table lists &quot;Skater Number,&quot; &quot;Skater Name,&quot; and &quot;Active Date&quot; for several players. To the right, the sections for &quot;LEAGUE NAME, TEAM NAME, DIVISION&quot; and &quot;UNIFORM COLORS&quot; are outlined in red and orange, respectively. The league is the &quot;FoCo Junior Roller Derby,&quot; the team name is the Spartans, and they compete in the open division, with uniform colors as &quot;BLACK WHITE BLUE.&quot; Below, a chart titled &quot;COACHING STAFF&quot; in grey features legal names and corresponding derby names. A red arrow connects the League, Team, and Division information to corresponding columns in the &quot;clean&quot; data representation. An orange arrow connects the uniform colors to a paste(..., collapse = &quot;,&quot;) statement, and then to the colors column in the &quot;clean&quot; data table. The player roster is connected to the final column in the &quot;clean&quot; data table with a blue arrow.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-roller-derby-cleaning-sketch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/advanced/roller-derby-cleaning-sketch.svg" class="img-fluid figure-img" alt="The image depicts a spreadsheet for a roller derby team roster, titled &quot;CURRENT ACTIVE CHARTER ROSTER.&quot; The spreadsheet is segmented into different sections with a color-coded design. On the left, a blue-bordered table lists &quot;Skater Number,&quot; &quot;Skater Name,&quot; and &quot;Active Date&quot; for several players. To the right, the sections for &quot;LEAGUE NAME, TEAM NAME, DIVISION&quot; and &quot;UNIFORM COLORS&quot; are outlined in red and orange, respectively. The league is the &quot;FoCo Junior Roller Derby,&quot; the team name is the Spartans, and they compete in the open division, with uniform colors as &quot;BLACK WHITE BLUE.&quot; Below, a chart titled &quot;COACHING STAFF&quot; in grey features legal names and corresponding derby names. A red arrow connects the League, Team, and Division information to corresponding columns in the &quot;clean&quot; data representation. An orange arrow connects the uniform colors to a paste(..., collapse = &quot;,&quot;) statement, and then to the colors column in the &quot;clean&quot; data table. The player roster is connected to the final column in the &quot;clean&quot; data table with a blue arrow.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-roller-derby-cleaning-sketch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.7: Sketch of which components of the spreadsheet need to go where.
</figcaption>
</figure>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-68"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-68-1"><a href="#annotated-cell-68-1" aria-hidden="true" tabindex="-1"></a>get_players <span class="ot">&lt;-</span> <span class="cf">function</span>(sub_df) {</span>
<span id="annotated-cell-68-2"><a href="#annotated-cell-68-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify row where player table starts</span></span>
<span id="annotated-cell-68-3"><a href="#annotated-cell-68-3" aria-hidden="true" tabindex="-1"></a>  header_row <span class="ot">&lt;-</span> <span class="fu">which</span>(sub_df[,<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"Skater Number"</span>)</span>
<span id="annotated-cell-68-4"><a href="#annotated-cell-68-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-5"><a href="#annotated-cell-68-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(header_row) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="annotated-cell-68-6"><a href="#annotated-cell-68-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-7"><a href="#annotated-cell-68-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get player info</span></span>
<span id="annotated-cell-68-8"><a href="#annotated-cell-68-8" aria-hidden="true" tabindex="-1"></a>  player_info <span class="ot">&lt;-</span> sub_df[(header_row<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(header_row<span class="sc">+</span><span class="dv">21</span>),] <span class="sc">|&gt;</span></span>
<span id="annotated-cell-68-9"><a href="#annotated-cell-68-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"Skater_Number"</span>, <span class="st">"Skater_Name"</span>, <span class="st">"Skater_Active_Date"</span>)) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-68-10"><a href="#annotated-cell-68-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>()</span>
<span id="annotated-cell-68-11"><a href="#annotated-cell-68-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-12"><a href="#annotated-cell-68-12" aria-hidden="true" tabindex="-1"></a>  player_info</span>
<span id="annotated-cell-68-13"><a href="#annotated-cell-68-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-68-14"><a href="#annotated-cell-68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-68-15"><a href="#annotated-cell-68-15" aria-hidden="true" tabindex="-1"></a>get_team_info <span class="ot">&lt;-</span> <span class="cf">function</span>(sub_df) {</span>
<span id="annotated-cell-68-16"><a href="#annotated-cell-68-16" aria-hidden="true" tabindex="-1"></a>  leagueidx <span class="ot">&lt;-</span> sub_df[,<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"LEAGUE NAME"</span></span>
<span id="annotated-cell-68-17"><a href="#annotated-cell-68-17" aria-hidden="true" tabindex="-1"></a>  league <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">length</span>(leagueidx) <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, <span class="fu">unlist</span>(sub_df[leagueidx,<span class="dv">2</span>]))</span>
<span id="annotated-cell-68-18"><a href="#annotated-cell-68-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-19"><a href="#annotated-cell-68-19" aria-hidden="true" tabindex="-1"></a>  teamidx <span class="ot">&lt;-</span> sub_df[,<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"TEAM NAME"</span></span>
<span id="annotated-cell-68-20"><a href="#annotated-cell-68-20" aria-hidden="true" tabindex="-1"></a>  team <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">length</span>(teamidx) <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, <span class="fu">unlist</span>(sub_df[teamidx,<span class="dv">2</span>]))</span>
<span id="annotated-cell-68-21"><a href="#annotated-cell-68-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-22"><a href="#annotated-cell-68-22" aria-hidden="true" tabindex="-1"></a>  divisionidx <span class="ot">&lt;-</span> sub_df[,<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"DIVISION"</span></span>
<span id="annotated-cell-68-23"><a href="#annotated-cell-68-23" aria-hidden="true" tabindex="-1"></a>  division <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">length</span>(divisionidx) <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, <span class="fu">unlist</span>(sub_df[divisionidx,<span class="dv">2</span>]))</span>
<span id="annotated-cell-68-24"><a href="#annotated-cell-68-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-25"><a href="#annotated-cell-68-25" aria-hidden="true" tabindex="-1"></a>  coloridx <span class="ot">&lt;-</span> <span class="fu">which</span>(sub_df[,<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"UNIFORM COLORS"</span>)</span>
<span id="annotated-cell-68-26"><a href="#annotated-cell-68-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(coloridx) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="annotated-cell-68-27"><a href="#annotated-cell-68-27" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> sub_df[coloridx<span class="sc">:</span>(coloridx<span class="sc">+</span><span class="dv">1</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">|&gt;</span></span>
<span id="annotated-cell-68-28"><a href="#annotated-cell-68-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>()</span>
<span id="annotated-cell-68-29"><a href="#annotated-cell-68-29" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> colors[colors <span class="sc">!=</span> <span class="st">"UNIFORM COLORS"</span>]</span>
<span id="annotated-cell-68-30"><a href="#annotated-cell-68-30" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> colors[colors <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="annotated-cell-68-31"><a href="#annotated-cell-68-31" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">na.omit</span>(colors), <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="annotated-cell-68-32"><a href="#annotated-cell-68-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="annotated-cell-68-33"><a href="#annotated-cell-68-33" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="annotated-cell-68-34"><a href="#annotated-cell-68-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-68-35"><a href="#annotated-cell-68-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-36"><a href="#annotated-cell-68-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">league =</span> league, <span class="at">team =</span> team, <span class="at">division =</span> division, <span class="at">colors =</span> colors)</span>
<span id="annotated-cell-68-37"><a href="#annotated-cell-68-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-68-38"><a href="#annotated-cell-68-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-68-39"><a href="#annotated-cell-68-39" aria-hidden="true" tabindex="-1"></a>clean_team_df <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="annotated-cell-68-40"><a href="#annotated-cell-68-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(df) <span class="sc">&lt;=</span> <span class="dv">10</span>) {</span>
<span id="annotated-cell-68-41"><a href="#annotated-cell-68-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"Insufficient number of rows, returning NULL"</span>)</span>
<span id="annotated-cell-68-42"><a href="#annotated-cell-68-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="annotated-cell-68-43"><a href="#annotated-cell-68-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-68-44"><a href="#annotated-cell-68-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(df <span class="sc">==</span> <span class="st">""</span>, <span class="at">na.rm =</span> T) <span class="sc">&gt;</span> <span class="dv">50</span>) {</span>
<span id="annotated-cell-68-45"><a href="#annotated-cell-68-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"Insufficient number of rows, returning NULL"</span>)</span>
<span id="annotated-cell-68-46"><a href="#annotated-cell-68-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="annotated-cell-68-47"><a href="#annotated-cell-68-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-68-48"><a href="#annotated-cell-68-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-49"><a href="#annotated-cell-68-49" aria-hidden="true" tabindex="-1"></a>  players <span class="ot">&lt;-</span> <span class="fu">get_players</span>(df[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="annotated-cell-68-50"><a href="#annotated-cell-68-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="annotated-cell-68-51"><a href="#annotated-cell-68-51" aria-hidden="true" tabindex="-1"></a>  team_info <span class="ot">&lt;-</span> <span class="fu">get_team_info</span>(df[,<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-68-52"><a href="#annotated-cell-68-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">players =</span> <span class="fu">list</span>(players))</span>
<span id="annotated-cell-68-53"><a href="#annotated-cell-68-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(team_info)</span>
<span id="annotated-cell-68-54"><a href="#annotated-cell-68-54" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After all of that, we’re finally ready to use our cleaning functions!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>team_data_clean <span class="ot">&lt;-</span> <span class="fu">map</span>(team_data, clean_team_df) <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> warnings <span class="im">import</span> warn</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_players(sub_df):</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  sub_df <span class="op">=</span> sub_df.reset_index().drop(<span class="st">"index"</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> sub_df.iloc[:,<span class="dv">0</span>]<span class="op">==</span><span class="st">"Skater Number"</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  header_row <span class="op">=</span> x.index[x][<span class="dv">0</span>]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> pd.isnull(header_row):</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.NA</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  stopidx <span class="op">=</span> <span class="bu">min</span>(header_row<span class="op">+</span><span class="dv">21</span>, sub_df.shape[<span class="dv">0</span>])</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  playerdf <span class="op">=</span> sub_df.iloc[(header_row<span class="op">+</span><span class="dv">1</span>):(stopidx<span class="op">+</span><span class="dv">1</span>),:].reset_index().drop(<span class="st">"index"</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  playerdf.columns <span class="op">=</span> [<span class="st">"skater_number"</span>, <span class="st">"skater_name"</span>, <span class="st">"skater_active_date"</span>]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {<span class="st">"players"</span>: playerdf.dropna()}</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_if_exists(idx, sub_df_col, replace<span class="op">=</span>pd.NA):</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  header_row <span class="op">=</span> idx.index[idx][<span class="dv">0</span>]</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> pd.isnull(header_row):</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sub_df_col[header_row]</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> replace</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_team_info(sub_df):</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>  league <span class="op">=</span> get_if_exists(sub_df.iloc[:,<span class="dv">0</span>]<span class="op">==</span><span class="st">"LEAGUE NAME"</span>, sub_df.iloc[:,<span class="dv">1</span>])</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>  team <span class="op">=</span> get_if_exists(sub_df.iloc[:,<span class="dv">0</span>]<span class="op">==</span><span class="st">"TEAM NAME"</span>, sub_df.iloc[:,<span class="dv">1</span>])</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  division <span class="op">=</span> get_if_exists(sub_df.iloc[:,<span class="dv">0</span>]<span class="op">==</span><span class="st">"DIVISION"</span>, sub_df.iloc[:,<span class="dv">1</span>])</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {<span class="st">"league"</span>: league, <span class="st">"team"</span>: team, <span class="st">"division"</span>: division}</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_team_df(df):</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (df.shape[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">8</span>):</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>    warn(<span class="st">"fewer than 8 rows in data frame, skipping"</span>)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {}</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>  players <span class="op">=</span> get_players(df.iloc[:,<span class="dv">2</span>:<span class="dv">5</span>])</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>  team_info <span class="op">=</span> get_team_info(df.iloc[:,<span class="dv">5</span>:<span class="dv">7</span>])</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>  team_info <span class="op">=</span> [team_info <span class="op">|</span> players]</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> team_info</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>team_data_clean <span class="op">=</span> [clean_team_df(i) <span class="cf">for</span> i <span class="kw">in</span> team_data] </span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(team_data_clean)</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="co">## 99</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>team_data_clean[<span class="dv">0</span>]</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a><span class="co">## [{'league': '509 Junior Roller Derby', 'team': 'The Killer Bees (O)', 'division': 'OPEN', 'players':    skater_number            skater_name skater_active_date</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a><span class="co">## 0             03           Rumble Guppy            1/14/25</span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="co">## 1             10        Ruby Roundhouse            1/10/25</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a><span class="co">## 2            106              Ferdinand            1/13/25</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="co">## 3            187     Belle of the Brawl            1/10/25</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a><span class="co">## 4             22             Badadytude            1/10/25</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a><span class="co">## 5            236          Hell-no Kitty            1/13/25</span></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a><span class="co">## 6            247            Snot Rocket            1/13/25</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a><span class="co">## 7              3         Chicken Nugget            PENDING</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a><span class="co">## 8            312           Slimy Booger            1/14/25</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="co">## 9             34            The Postman            1/10/25</span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="co">## 10           404            Fatal Error            1/10/25</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="co">## 11            68  Graycon The Destroyer            1/10/25</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="co">## 12           710                Boo Boo            1/10/25</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a><span class="co">## 13            77              Hurricane            1/10/25</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="co">## 14            82               Blackout            1/10/25</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="co">## 15           911                  Chaos            1/18/25}]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Let’s see if there are any common skater names, after all of that hard work.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>team_data_clean <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(players) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Skater_Name) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 10 × 2</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   Skater_Name [10]</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    Skater_Name          n</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;            &lt;int&gt;</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Cherry Bomb         13</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Killer Queen         6</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Lunatic              6</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Stitches             6</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Ghost                5</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Jawbreaker           5</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Sugar Rush           5</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Frightening Bolt     4</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Gnarly Quinn         4</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Hurricane            4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>player_names <span class="op">=</span> pd.concat([i[<span class="dv">0</span>][<span class="st">'players'</span>] <span class="cf">for</span> i <span class="kw">in</span> team_data_clean <span class="cf">if</span> <span class="bu">len</span>(i) <span class="op">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>player_names.skater_name.value_counts()[<span class="dv">0</span>:<span class="dv">10</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">## skater_name</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Cherry Bomb     13</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Stitches         6</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Lunatic          6</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Killer Queen     6</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Sugar Rush       5</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Firecracker      5</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Jawbreaker       5</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Ghost            5</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Hurricane        4</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Gnarly Quinn     4</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Name: count, dtype: int64</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-margin-content">
<p>There are a LOT of steps when you’re cleaning data from the internet. It can be very easy to get overwhelmed. I find it’s helpful to look at the data as it exists on the web first, and imagine what form you’d like the data to be in at the end. Then, sketching out the transformations step by step, as in <a href="#fig-roller-derby-cleaning-sketch" class="quarto-xref">Figure&nbsp;<span>33.7</span></a> can help with maintaining focus on one job at a time without getting overwhelmed.</p>
</div></div></section>
<section id="sec-webscraping-refs" class="level2" data-number="33.7">
<h2 data-number="33.7" class="anchored" data-anchor-id="sec-webscraping-refs"><span class="header-section-number">33.7</span> References</h2>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-wikimediacontributorsXML2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">Wikimedia contributors, <span>“<span>XML</span>,”</span> <em>Wikipedia</em>. Wikimedia Foundation, Jun. 03, 2025 [Online]. Available: <a href="https://en.wikipedia.org/w/index.php?title=XML&amp;oldid=1293665596">https://en.wikipedia.org/w/index.php?title=XML&amp;oldid=1293665596</a>. [Accessed: Jun. 04, 2025]</div>
</div>
<div id="ref-HTMLVsXML2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline"><span>“<span>HTML</span> vs <span>XML</span>. <span>GeeksforGeeks</span>,”</span> Jan. 2024. [Online]. Available: <a href="https://www.geeksforgeeks.org/html-vs-xml/">https://www.geeksforgeeks.org/html-vs-xml/</a>. [Accessed: Jun. 09, 2025]</div>
</div>
<div id="ref-struckIntroductionWebScraping" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">J. Struck, <em>Introduction to web scraping with r</em>. [Online]. Available: <a href="https://sscc.wisc.edu/sscc/pubs/webscraping-r/index.html">https://sscc.wisc.edu/sscc/pubs/webscraping-r/index.html</a>. [Accessed: Jun. 12, 2025]</div>
</div>
<div id="ref-polite" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">D. Perepolkin, <em>Polite: Be nice on the web</em>. 2023 [Online]. Available: <a href="https://CRAN.R-project.org/package=polite">https://CRAN.R-project.org/package=polite</a></div>
</div>
<div id="ref-kempRespectingRobotstxtYour2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">B. Kemp, <span>“Respecting robots.txt in your python web crawler: What, why, and how. Text meaning,”</span> Mar. 22, 2025. [Online]. Available: <a href="https://textmeaning.com/2025/03/22/respecting-robots-txt-in-your-python-web-crawler-what-why-and-how/">https://textmeaning.com/2025/03/22/respecting-robots-txt-in-your-python-web-crawler-what-why-and-how/</a>. [Accessed: Jun. 12, 2025]</div>
</div>
<div id="ref-b4handReppyReplacementRobotstxt2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">b4hand, E. Battaglia, D. Lecocq, and L. Reno, <span>“Reppy: Replacement robots.txt parser.”</span> Sep. 16, 2019 [Online]. Available: <a href="http://github.com/seomoz/reppy">http://github.com/seomoz/reppy</a>. [Accessed: Jun. 12, 2025]</div>
</div>
<div id="ref-EthicsRobotstxt2013" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline"><span>“Ethics of robots.txt. Stack overflow,”</span> Aug. 12, 2013. [Online]. Available: <a href="https://stackoverflow.com/q/999056">https://stackoverflow.com/q/999056</a>. [Accessed: Jun. 12, 2025]</div>
</div>
<div id="ref-pierceRiseFallRobotstxt2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div class="csl-right-inline">D. Pierce, <span>“The rise and fall of robots.txt. The verge,”</span> Feb. 14, 2024. [Online]. Available: <a href="https://www.theverge.com/24067997/robots-txt-ai-text-file-web-crawlers-spiders">https://www.theverge.com/24067997/robots-txt-ai-text-file-web-crawlers-spiders</a>. [Accessed: Jun. 12, 2025]</div>
</div>
<div id="ref-baldorPentagonsPurgeOfficials2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div><div class="csl-right-inline">L. Baldor, <span>“The pentagon’s <span>DEI</span> purge: Officials describe a scramble to remove and then restore online content. <span>AP</span> news,”</span> Mar. 22, 2025. [Online]. Available: <a href="https://apnews.com/article/pentagon-dei-diversity-social-media-purge-fb15996733408a8122a97acd3baa6820">https://apnews.com/article/pentagon-dei-diversity-social-media-purge-fb15996733408a8122a97acd3baa6820</a>. [Accessed: Jun. 12, 2025]</div>
</div>
<div id="ref-klosowskiHowWebSites2013" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div><div class="csl-right-inline">T. Klosowski, <span>“How web sites vary prices based on your information (and what you can do about it). Lifehacker,”</span> Jan. 07, 2013. [Online]. Available: <a href="https://lifehacker.com/how-web-sites-vary-prices-based-on-your-information-an-5973689">https://lifehacker.com/how-web-sites-vary-prices-based-on-your-information-an-5973689</a>. [Accessed: Jun. 12, 2025]</div>
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Technically, HTML was developed first, but it does have many of the same components as XML, and we use similar terminology to describe elements, content, attributes, and values, so it’s easiest (imo) to think of HTML as a subset of XML with additional rules and with certain rules relaxed.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This is a real rabbit hole if you are curious about the very technical details of what makes up a character in text.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><code>curl</code> is a very low-level way to interface with the web… be glad we don’t have to use it directly.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You aren’t supposed to do this because it’s hard to make sense of the information with a screen reader - users who are low vision might think the information was actually related structurally when it is not and the table is just for arrangement purposes. As there are other ways to arrange content that are arguably better in other ways, tables should be reserved for situations where the content is actually structurally tabular.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Technically, there is a flag for <code>wget</code> to ignore the robots rules, but it’s probably better to use an approach that doesn’t break the implicit rules set by the server.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/srvanderplas\.github\.io\/stat-computing-r-python\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="srvanderplas/stat-computing-r-python" data-repo-id="R_kgDOIvwd2g" data-category="General" data-category-id="DIC_kwDOIvwd2s4CTksR" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../part-advanced-topics/02-data-doc.html" class="pagination-link" aria-label="Data Documentation: Codebooks, Reproducibility, and more">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Data Documentation: Codebooks, Reproducibility, and more</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part-advanced-topics/04-xml-json-list-processing.html" class="pagination-link" aria-label="Record-based Data and List Processing Strategies">
        <span class="nav-page-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Record-based Data and List Processing Strategies</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Susan Vanderplas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-advanced-topics/03-web-scraping.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/srvanderplas">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","descPosition":"bottom","loop":false,"closeEffect":"zoom","openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>