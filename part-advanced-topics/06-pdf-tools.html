<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-07-16">
<title>36&nbsp; Working with PDFs – Statistical Computing using R and Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part-advanced-topics/07-intro-interactive-graphics.html" rel="next">
<link href="../part-advanced-topics/05-APIs.html" rel="prev">
<link href="../build_deps/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4ZFBDKXJXP"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4ZFBDKXJXP', { 'anonymize_ip': true});
</script><script src="https://kit.fontawesome.com/baac5f0610.js" crossorigin="anonymous"></script><style>
div.callout-example.callout {
  border-left-color: #f39c12;
}
div.callout-example.callout-style-default > .callout-header {
  background-color: rgba(243, 156, 18, 0.13);
}
div.callout-example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-example.callout-style-default .callout-icon::before, div.callout-example.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f206' !important;
  background-image: none;
}
div.callout-demo.callout {
  border-left-color: #91d5d4;
}
div.callout-demo.callout-style-default > .callout-header {
  background-color: rgba(145, 213, 212, 0.13);
}
div.callout-demo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-demo.callout-style-default .callout-icon::before, div.callout-demo.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f12e' !important;
  background-image: none;
}
div.callout-advanced.callout {
  border-left-color: #cbbaf9;
}
div.callout-advanced.callout-style-default > .callout-header {
  background-color: rgba(203, 186, 249, 0.13);
}
div.callout-advanced .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-advanced.callout-style-default .callout-icon::before, div.callout-advanced.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f5dc' !important;
  background-image: none;
}
div.callout-setup.callout {
  border-left-color: #f3e969;
}
div.callout-setup.callout-style-default > .callout-header {
  background-color: rgba(243, 233, 105, 0.13);
}
div.callout-setup .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-setup.callout-style-default .callout-icon::before, div.callout-setup.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f6e3' !important;
  background-image: none;
}
div.callout-learnmore.callout {
  border-left-color: #f09bb6;
}
div.callout-learnmore.callout-style-default > .callout-header {
  background-color: rgba(240, 155, 182, 0.13);
}
div.callout-learnmore .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-learnmore.callout-style-default .callout-icon::before, div.callout-learnmore.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f02d' !important;
  background-image: none;
}
</style>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../build_deps/style.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-advanced-topics/00-advanced.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../part-advanced-topics/06-pdf-tools.html"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Working with PDFs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Computing using R and Python</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/srvanderplas/stat-computing-r-python/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-tools/00-tools-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/01-computer-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/02-setting-up-computer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Computer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/03-Rstudio-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio’s Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/04-scripts-notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scripts and Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/05-git-and-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Version Control with Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/06-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducibility and Professional Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-gen-prog/00-gen-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: General Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01-basic-var-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variables and Basic Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01a-math-logical-operators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mathematical and Logical Operators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/02-prog-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Functions, Packages, and Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/03-data-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/035-matrix-calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matrix Calculations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/04-control-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/05-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/06-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/07-prog-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Programming With Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/99-extra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Other Helpful Programming Resources</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-wrangling/00-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/01-data-input.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Input</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02-basic-data-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Visualization Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02a-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02b-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02c-good-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/03-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/04-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05-data-reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05b-normal-forms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/06-data-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/07-datetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/08-functional-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/09-spatial-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-advanced-topics/00-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/01-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Simulation and Reproducibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/02-data-doc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Data Documentation: Codebooks, Reproducibility, and more</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/03-web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/04-xml-json-list-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Record-based Data and List Processing Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/05-APIs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Application Programming Interfaces</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/06-pdf-tools.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Working with PDFs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/07-intro-interactive-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/08-javascript-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/09-big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">“Big” Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/10-databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/11-arrow-parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Efficient Data Access: Arrow and Parquet Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/12-memory-handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Memory and Computational Efficiency</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../graveyard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Other Topics</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li>
<a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">36.1</span> Introduction</a>
  <ul class="collapse">
<li><a href="#pdf-file-format" id="toc-pdf-file-format" class="nav-link" data-scroll-target="#pdf-file-format"><span class="header-section-number">36.1.1</span> PDF File Format</a></li>
  <li><a href="#pdf-layers" id="toc-pdf-layers" class="nav-link" data-scroll-target="#pdf-layers"><span class="header-section-number">36.1.2</span> PDF Layers</a></li>
  </ul>
</li>
  <li>
<a href="#working-with-pdfs-programmatically" id="toc-working-with-pdfs-programmatically" class="nav-link" data-scroll-target="#working-with-pdfs-programmatically"><span class="header-section-number">36.2</span> Working with PDFs Programmatically</a>
  <ul class="collapse">
<li><a href="#reading-tabular-data-from-text-or-hybrid-pdfs" id="toc-reading-tabular-data-from-text-or-hybrid-pdfs" class="nav-link" data-scroll-target="#reading-tabular-data-from-text-or-hybrid-pdfs"><span class="header-section-number">36.2.1</span> Reading Tabular Data from Text or Hybrid PDFs</a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-advanced-topics/06-pdf-tools.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-advanced-topics/00-advanced.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../part-advanced-topics/06-pdf-tools.html"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Working with PDFs</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-pdf-data" class="quarto-section-identifier"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Working with PDFs</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><p>When I started my first job out of graduate school, one particular process used by my coworkers completely mystified me: they would print out a document, and then immediately scan it back in, with the scan emailed to themselves. This seemed like a waste of toner, paper, and time to me – why would anyone do such a thing? Eventually, I found out that the printer would automatically recognize the text and add a text layer to a PDF that previously couldn’t be highlighted. So, my coworkers found a handy workaround to manually typing out the numbers they needed from older PDF documents! As clever as this was, it was also unnecessary. A lot of paper, toner, and time could have been saved if the company had just provided <strong>Optical Character Recognition</strong> programs and made them available to workers.</p>
<p>In this chapter, you’ll learn about PDF document structure, as well as how to use OCR programs.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/advanced/xkcd-2304-preprint.png" class="img-fluid figure-img" alt="The image is a comic strip depicting a person sitting at a news desk. The person has simplistic features with a round head, short hair, and no facial features drawn. A speech bubble above them says &quot;According to a new PDF...&quot; Behind them is a sign reading &quot;Breaking News.&quot; Crossed out phrases above them include &quot;According to a new preprint...&quot;, &quot;...an unpublished study...&quot;, and &quot;According to a new paper uploaded to a preprint server, but which has not undergone peer review...&quot;. Below the main image, there's a section titled &quot;Benefits of just saying 'a PDF':&quot; followed by three bullet points. • AVOIDS IMPLICATIONS ABOUT PUBLICATION STATUS • IMMEDIATELY RAISES QUESTIONS ABOUT AUTHOR(S) • STILL IMPLIES &quot;THIS DOCUMENT WAS PROBABLY PREPARED BY A PROFESSIONAL, BECAUSE NO NORMAL HUMAN TRYING TO COMMUNICATE IN 2020 WOULD CHOOSE THIS RIDICULOUS FORMAT&quot;."></p>
<figcaption>DOWNSIDES: Adobe people may periodically email your newsroom to ask you to call it an ‘Adobe® PDF document,’ but they’ll reverse course once they learn how sarcastically you can pronounce the registered trademark symbol.<br>CC-A-NC2.5 by Randall Munroe. <a href="https://xkcd.com/2304/">source</a></figcaption></figure>
</div>
</div></div><section id="objectives" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Identify the type of PDF and the data it contains.</li>
<li>Develop a strategy to extract the data from the PDF programmatically, using strategies to improve the success of Optical Character Recognition (OCR) if necessary.</li>
<li>Augment the PDF files with OCR to add a text layer, if necessary, before extracting information.</li>
<li>Extract information from PDFs programmatically and format the information appropriately.</li>
<li>Implement quality control and data cleaning measures which handle the most common OCR errors elegantly.</li>
</ul></section><section id="introduction" class="level2 page-columns page-full" data-number="36.1"><h2 data-number="36.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">36.1</span> Introduction</h2>
<p>Over the objections of open data organizations, data archivists <span class="citation" data-cites="klindtPDFConsideredHarmful2017"><a href="#ref-klindtPDFConsideredHarmful2017" role="doc-biblioref">[1]</a></span>, and programmers <span class="citation" data-cites="edwardsWhyExtractingData2025 zhangDocumentParsingUnveiled2024"><a href="#ref-edwardsWhyExtractingData2025" role="doc-biblioref">[2]</a>, <a href="#ref-zhangDocumentParsingUnveiled2024" role="doc-biblioref">[3]</a></span>, companies and government agencies frequently use PDF (portable document format) documents to store and release data. Election results (<a href="https://sos.oregon.gov/elections/Documents/results/november-general-2024-results.pdf">Oregon, 2024</a>), property appraisals (<a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28719-2025-147568.pdf">Lancaster County, Nebraska</a>), public health reports (<a href="../data/cdc-mmwr-2025-07-10.pdf">Centers for Disease Control Morbidity and Mortality Weekly Reports</a>), and more, locked up <span class="citation" data-cites="harbertTappingPowerUnstructured2021"><a href="#ref-harbertTappingPowerUnstructured2021" role="doc-biblioref">[4]</a></span> in PDF format instead of stored properly in nicely formatted spreadsheets or databases. Even though we object to the storage mechanism, learning how to deal with data stored in PDF format is a valuable skill for the aspiring data scientist. Even if you never work with PDF data in a professional capacity (and I hope you’re that lucky), these skills are very useful for public data side projects.</p>
<section id="pdf-file-format" class="level3 page-columns page-full" data-number="36.1.1"><h3 data-number="36.1.1" class="anchored" data-anchor-id="pdf-file-format">
<span class="header-section-number">36.1.1</span> PDF File Format</h3>
<p>The PDF file format was created in 1993 by Adobe and was a proprietary format until 2008, when the format became an open standard under the control of the International Standards Organization <span class="citation" data-cites="wikimediacontributorsHistoryPDF2024"><a href="#ref-wikimediacontributorsHistoryPDF2024" role="doc-biblioref">[5]</a></span>. As the acronym suggests, Portable Document Format is intended to be readable on any computer. This was something of a novel idea in the 1990s, when Mac users used one document creation software and Windows users another, and there was not a version of e.g.&nbsp;Microsoft Office available for Mac.</p>
<p>The technical details of a PDF file are complex <span class="citation" data-cites="gnupdfprojectIntroductionPDF2014 hodsonPDFSuccinctly2012"><a href="#ref-gnupdfprojectIntroductionPDF2014" role="doc-biblioref">[6]</a>, <a href="#ref-hodsonPDFSuccinctly2012" role="doc-biblioref">[7]</a></span>. However, conceptually, there are four required components to a PDF document, as shown in <a href="#fig-pdf-doc-components" class="quarto-xref">Figure&nbsp;<span>36.1</span></a>:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div id="fig-pdf-doc-components" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A box containing four colored boxes: Header, Body, Cross-ref table, and Trailer.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pdf-doc-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/pdf-document-components.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;36.1: High-level required components of a PDF document."><img src="../images/advanced/pdf-document-components.png" class="img-fluid figure-img" alt="A box containing four colored boxes: Header, Body, Cross-ref table, and Trailer."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pdf-doc-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36.1: High-level required components of a PDF document.
</figcaption></figure>
</div>
<div id="fig-pdf-body-components" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A network diagram showing the Catalog, with an arrow leading to the Page Tree. Below the Page tree are two page nodes, Page 1 and Page 2. Arrows connect the Page tree to the pages, and the pages to the page tree. The final layer of the network contains page 1 content, resources, and page 2 content. Arrows point from page 1 and 2 to the resources node, as well as to the corresponding page content.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pdf-body-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/pdf-body-components.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;36.2: Required components of a PDF Body"><img src="../images/advanced/pdf-body-components.png" class="img-fluid figure-img" alt="A network diagram showing the Catalog, with an arrow leading to the Page Tree. Below the Page tree are two page nodes, Page 1 and Page 2. Arrows connect the Page tree to the pages, and the pages to the page tree. The final layer of the network contains page 1 content, resources, and page 2 content. Arrows point from page 1 and 2 to the resources node, as well as to the corresponding page content."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pdf-body-components-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36.2: Required components of a PDF Body
</figcaption></figure>
</div>
</div></div><ul>
<li>Header
<ul>
<li>PDF version number</li>
<li>arbitrary sequence of binary data to prevent applications from opening the document as a text file (which would corrupt the file)</li>
</ul>
</li>
<li>Body (relationships between body components shown in <a href="#fig-pdf-body-components" class="quarto-xref">Figure&nbsp;<span>36.2</span></a>)
<ul>
<li>Page tree - serves as the root of the document, and may be as simple as a list of pages.</li>
<li>Pages - each page is defined independently and contains its own metadata, links to resources, and content (defined separately).</li>
<li>Resources - objects required to render a page, such as fonts.</li>
<li>Content - text and graphics which appear visually on the page.</li>
<li>Catalog - an indication to programs as to where to start reading the document. Often this is just a link to the root page tree.</li>
</ul>
</li>
<li>Cross-reference table - Records the location in the file of each object in the body of the file so that when viewing a page, only objects from that page are loaded into memory.</li>
<li>Trailer - tells applications how to read the file
<ul>
<li>A reference to the catalog which links to the document root</li>
<li>Location of the cross-reference table</li>
<li>Size of the cross-reference table</li>
</ul>
</li>
</ul>
<p><span class="citation" data-cites="kingAdobeIntroductionInsides2005"><a href="#ref-kingAdobeIntroductionInsides2005" role="doc-biblioref">[8]</a></span> has some good examples showing pages and the PDF document code that create the pages.</p>
<p>Within the page, <strong>streams</strong> are often used to define the page’s appearance (the other option is <strong>lattices</strong>, which can be used to divide the page up into sections). To add text, commands are issued to define the font, position the text cursor, and type the text onto the page. Text is positioned from the bottom left corner, with <span class="math inline">\(Y\)</span> defining the vertical and <span class="math inline">\(X\)</span> defining the horizontal location. Line breaks and other formatting features are not a part of the PDF format – these operations are performed by another program before the file is saved as PDF. As a result, text commands in PDF can be fragmented, leading to a continuous paragraph of words being written in the PDF file as separate lines, with other page elements present in between (like figure captions, page numbers, and images). In addition, PDF documents allow for changing the kerning of text (space between letters) in specific ways that may make it difficult for the characters to be separated visually. One common example of this is the sequence of characters <code>ff</code> or <code>fi</code> in a document, which can sometimes be read in interesting ways by OCR: sometimes, as unicode ﬀ or ﬁ, sometimes as Cyrillic characters, and sometimes left out entirely or misplaced.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Hybrid PDF Fun
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider a <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28719-2025-147568.pdf">Home appraisal record from Lancaster County, NE</a>. Opening the card in a PDF reader and selecting all the text yields a <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28719-2025-147568.txt">disorganized text file</a> (and this PDF is actually created using modern methods and relatively clean!)</p>
<p>A few observations, marked up in <a href="#fig-pdf-layout-text" class="quarto-xref">Figure&nbsp;<span>36.3</span></a>:</p>
<ul>
<li>The title on page 1 is on line 39 of the file, and it appears that the data from the first column is on lines 1-38.</li>
<li>When there are multi-column tables, as in the “Inspection History” table in the middle of the first page, the values are listed by column, but missing values (the times of inspection) are not indicated at all!</li>
<li>The Appraised Values table has columns Land, Building, Total, and Method. Line 142 of the text file shows an entry for “Total Method”, and it is clear that the text for the two columns has been combined.</li>
</ul>
<div id="fig-pdf-layout-text" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A screenshot of the first page of the PDF, with boxes highlighting the locations corresponding to the points shown above. In the Appraised Values table, arrows are shown connecting the Appraised Values header, Land, Building, Total Method, Current, $45,000, $111,000, $156,000 IDXVAL, Prior, $45,000, $111,000, and $156,000 IDXVAL sequentially.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pdf-layout-text-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/Lancaster-County-NE-Real-Estate-AppraisalCard-28719-2025-147568.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;36.3: Comparing text of PDF document to the rendered PDF document."><img src="../images/advanced/Lancaster-County-NE-Real-Estate-AppraisalCard-28719-2025-147568.svg" class="img-fluid figure-img" alt="A screenshot of the first page of the PDF, with boxes highlighting the locations corresponding to the points shown above. In the Appraised Values table, arrows are shown connecting the Appraised Values header, Land, Building, Total Method, Current, $45,000, $111,000, $156,000 IDXVAL, Prior, $45,000, $111,000, and $156,000 IDXVAL sequentially."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pdf-layout-text-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36.3: Comparing text of PDF document to the rendered PDF document.
</figcaption></figure>
</div>
<p>Now, perhaps we could write a script that would disentangle some of this information and format it properly, though I think the missing values would still be unrecoverable without someone visually mapping the data to the corresponding lines.</p>
<p>The arrangement of the text you get from selecting all text is different in different PDF applications – I tried it with <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568.txt">Okular</a> and <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-Firefox.txt">Firefox</a>, and got totally different orders of text boxes.</p>
<p>The scope of the actual problem only becomes visible when you look at a second <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568.pdf">PDF document</a> and the corresponding <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568.txt">text file</a>. <a href="#fig-pdf-layout-text-parallel" class="quarto-xref">Figure&nbsp;<span>36.4</span></a> shows the two PDF files and their corresponding text files, with the comparable portion of each PDF and text file highlighted.</p>
<div id="fig-pdf-layout-text-parallel" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A screenshot of the text files and PDF files for both real estate appraisal cards. The recent appeal history and assessed value history table headers and first row of text are highlighted in both sets of documents.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pdf-layout-text-parallel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;36.4: Lancaster county, NE real estate appraisal cards and text, with correpsonding sections highlighted across two appraisal cards. The text corresponding to the same space on the PDF has different formatting because one row of the table is blank on one of the cards."><img src="../images/advanced/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568.png" class="img-fluid figure-img" alt="A screenshot of the text files and PDF files for both real estate appraisal cards. The recent appeal history and assessed value history table headers and first row of text are highlighted in both sets of documents."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pdf-layout-text-parallel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36.4: Lancaster county, NE real estate appraisal cards and text, with correpsonding sections highlighted across two appraisal cards. The text corresponding to the same space on the PDF has different formatting because one row of the table is blank on one of the cards.
</figcaption></figure>
</div>
</div>
</div>
<p>Hopefully you’re beginning to understand how challenging this whole extracting data from PDFs thing can be!</p>
</section><section id="pdf-layers" class="level3" data-number="36.1.2"><h3 data-number="36.1.2" class="anchored" data-anchor-id="pdf-layers">
<span class="header-section-number">36.1.2</span> PDF Layers</h3>
<p>Practically, we can think of PDFs as having a text layer, an image layer, or both (hybrid PDFs). A PDF with a text layer will allow you to select embedded text and copy it into a text file, while a PDF that just has an image layer does not. It is also possible to have a PDF that has an image layer with a corresponding text layer on top. Optical Character Recognition takes a PDF with only image layers and creates a text file (or layer, depending on the tool) by identifying the characters in the document and converting those characters to text with a corresponding <span class="math inline">\((x,y)\)</span> location in the document. Different OCR programs use different conventions for this process, and the quality of the image matters a lot as well - some images are just not good enough to produce a passable transcription of the text using automatic methods.</p>
<p>What about Tables? In my opinion, the <code>pdftools</code> package documentation says it best…</p>
<blockquote class="blockquote">
<p>Data scientists are often interested in data from tables. Unfortunately the pdf format is pretty dumb and does not have notion of a table (unlike for example HTML). Tabular data in a pdf file is nothing more than strategically positioned lines and text, which makes it difficult to extract the raw data… <span class="citation" data-cites="oomsPdftoolsTextExtraction2025"><a href="#ref-oomsPdftoolsTextExtraction2025" role="doc-biblioref">[9]</a></span></p>
</blockquote>
<p>Table extraction from PDFs is a challenge: hopefully, this demonstration will help you understand why it’s so challenging.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Types of PDF Files and Layers
</div>
</div>
<div class="callout-body-container callout-body">
<p>For this demo, I’ve converted the first page of one of the Lancaster county, NE property appraisal PDFs into an <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-image.pdf">image only PDF</a> and a <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-text.pdf">text-based PDF (the original form)</a>. Open these up in your favorite PDF editor and try to highlight the text in each. How does it work?</p>
<p>We can also examine the format of a PDF file using R and python libraries.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>You’ll need the <code>pdftools</code> package, which you can install with <code>install.packages("pdftools")</code>. This may require you to install <code>libpoppler</code> on Linux <i class="fa-brands fa-linux" aria-hidden="true"></i>, but versions for other operating systems should be self-contained.</p>
<p>The <code>pdf_info</code> function gives us information from the PDF header, and the <code>pdf_text</code> function tries to extract the text, if it exists.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.r-universe.dev/pdftools">pdftools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/pdftools//reference/pdftools.html">pdf_info</a></span><span class="op">(</span><span class="st">"../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-text.pdf"</span><span class="op">)</span><span class="op">$</span><span class="va">version</span></span>
<span><span class="co">## [1] "1.3"</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/pdftools//reference/pdftools.html">pdf_text</a></span><span class="op">(</span><span class="st">"../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-text.pdf"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">str_split</span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Error in str_split(pdf_text("../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-text.pdf"), : could not find function "str_split"</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/pdftools//reference/pdftools.html">pdf_info</a></span><span class="op">(</span><span class="st">"../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-image.pdf"</span><span class="op">)</span><span class="op">$</span><span class="va">version</span></span>
<span><span class="co">## [1] "1.5"</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/pdftools//reference/pdftools.html">pdf_text</a></span><span class="op">(</span><span class="st">"../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-image.pdf"</span><span class="op">)</span> </span>
<span><span class="co">## [1] ""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the text does not exist for the image-based PDF.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>You will need the <code>pdfplumber</code> package <span class="citation" data-cites="singer-vinePdfplumber2025"><a href="#ref-singer-vinePdfplumber2025" role="doc-biblioref">[10]</a></span>, which you can install with pip.</p>
<p>The <code>pdf</code> object contains <code>metadata</code> and <code>pages</code>, and page text (if it exists) can be accessed with the <code>pdf.pages[i].extract_text()</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pdfplumber</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'pdfplumber'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pdfplumber.<span class="bu">open</span>(<span class="st">"../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-text.pdf"</span>) <span class="im">as</span> pdf:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  metadata <span class="op">=</span> pdf.metadata</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  first_page <span class="op">=</span>  pdf.pages[<span class="dv">0</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> first_page.extract_text()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'pdfplumber' is not defined</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>pdf.close()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'pdf' is not defined</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>metadata</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'metadata' is not defined</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>text.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'text' is not defined</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pdfplumber.<span class="bu">open</span>(<span class="st">"../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-image.pdf"</span>) <span class="im">as</span> pdf:</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  metadata <span class="op">=</span> pdf.metadata</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  first_page <span class="op">=</span>  pdf.pages[<span class="dv">0</span>]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> first_page.extract_text()</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'pdfplumber' is not defined</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>pdf.close()</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'pdf' is not defined</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>metadata</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'metadata' is not defined</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>text.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'text' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now, I created the image version of the PDF by opening the PDF in an image editor and saving the resulting file as PDF within that image editor, so it’s not surprising that the text layer is gone in that version of the file.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preview: OCR
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Most free OCR tools are based on the <code>tesseract</code> library, which you can access using <code>pytesseract</code> in python or the <code>tesseract</code> R package. You can also run <code>tesseract</code> from the command line, if you <a href="https://tesseract-ocr.github.io/tessdoc/Installation.html">install the library</a> for your operating system and language.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Bash</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>For the sake of shorter commands, let’s assume I’m working with a 1-page PDF file named <code>file.pdf</code> and want to create <code>file.txt</code> which contains the text of the image-based PDF.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert PDF to PNG to work with Tesseract</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If file has more than one page, </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># this will create file-1.png ... file-n.png images</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">pdftoppm</span> <span class="at">-png</span> file.pdf file</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the text</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">tesseract</span>  <span class="at">-l</span> eng file-1.png file-1.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-image-1.png">PNG</a> and <a href="../data/Lancaster-County-NE-Real-Estate-AppraisalCard-28749-2025-147568-pg1-text-1.txt">text file</a> created by using tesseract on one of the Lancaster county appraisal data sheets. Note that with this text document, you can search the PDF for text, but it doesn’t provide all of the features that a hybrid PDF with both an image and a text layer provides – the text isn’t associated with the <span class="math inline">\((x,y)\)</span> location on the page(s).</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>On Mac and Linux, you will likely need to install some system packages to make the <code>tesseract</code> package installable.</p>
<pre><code>Try installing:
 * deb: libtesseract-dev libleptonica-dev (Debian, Ubuntu, etc)
 * rpm: tesseract-devel leptonica-devel (Fedora, CentOS, RHEL)
 * brew: tesseract (Mac OSX)</code></pre>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># install.packages("tesseract")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tesseract/">tesseract</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.r-universe.dev/pdftools">pdftools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/pdftools//reference/pdf_render_page.html">pdf_convert</a></span><span class="op">(</span><span class="st">"../data/file.pdf"</span>, dpi <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span><span class="co">## Converting page 1 to file_1.png... done!</span></span>
<span><span class="co">## [1] "file_1.png"</span></span>
<span><span class="va">eng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tesseract/reference/tesseract.html">tesseract</a></span><span class="op">(</span><span class="st">"eng"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tesseract/reference/ocr.html">ocr</a></span><span class="op">(</span><span class="st">"../data/file-1.png"</span>, engine <span class="op">=</span> <span class="va">eng</span><span class="op">)</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">text</span>, <span class="st">"\n"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">## Error in str_split(text, "\n", simplify = T): could not find function "str_split"</span></span>
<span><span class="va">text</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## Error in text[1, 1:5]: incorrect number of dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>If you already have the image created, it’s simple to get the text out with <code>pytesseract</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'PIL'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytesseract</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'pytesseract'</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>pytesseract.image_to_string(Image.<span class="bu">open</span>(<span class="st">'../data/file-1.png'</span>)).split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'pytesseract' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you don’t have the image created, you have to first create an image (<code>imgBlob</code>) for each page, and then run <code>image_to_string</code> on that image. Note that this method does not require that you write the image out to a separate file: the image is only stored in memory. This might be preferable over the bash method, which produces one file for each PDF page.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pdf2image <span class="im">import</span> convert_from_path</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'pdf2image'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>pages <span class="op">=</span> convert_from_path(<span class="st">"../data/file.pdf"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'convert_from_path' is not defined</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pageNum,imgBlob <span class="kw">in</span> <span class="bu">enumerate</span>(pages):</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> pytesseract.image_to_string(imgBlob, lang<span class="op">=</span><span class="st">'eng'</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f'../data/file-py-</span><span class="sc">{</span>pageNum<span class="sc">}</span><span class="ss">.txt'</span>, <span class="st">'a'</span>) <span class="im">as</span> the_file:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    the_file.write(text)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'pages' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is the <a href="../data/file-py-0.txt">text file</a> created by Python using <code>pytesseract</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preview: Creating Hybrid PDFs
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>When I need OCR and don’t necessarily want to bother with R, I prefer to use a program called <a href="https://github.com/ocrmypdf/OCRmyPDF"><code>ocrmypdf</code></a> that is based on tesseract and available for most distributions. I started using <code>ocrmypdf</code> before I realized that it’s actually a python package that can just be called from the Linux command line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ocrmypdf</span> <span class="at">-l</span> eng ../data/file.pdf ../data/file-ocrmypdf.pdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of <code>ocrmypdf</code> is a <a href="../data/file-ocrmypdf.pdf">hybrid PDF</a> that has the text and image data superimposed (the text is invisible until you highlight it).</p>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="working-with-pdfs-programmatically" class="level2 page-columns page-full" data-number="36.2"><h2 data-number="36.2" class="anchored" data-anchor-id="working-with-pdfs-programmatically">
<span class="header-section-number">36.2</span> Working with PDFs Programmatically</h2>
<section id="reading-tabular-data-from-text-or-hybrid-pdfs" class="level3 page-columns page-full" data-number="36.2.1"><h3 data-number="36.2.1" class="anchored" data-anchor-id="reading-tabular-data-from-text-or-hybrid-pdfs">
<span class="header-section-number">36.2.1</span> Reading Tabular Data from Text or Hybrid PDFs</h3>
<p>As mentioned above, tabular data is a particular challenge to read from PDF files, as the PDF specification doesn’t actually have any way to represent structured text. There are two common open-source libraries recommended for extracting tabular data from PDFs - <code>tabula</code>, which is a Java library, and <code>camelot</code>, a Python library. There are interfaces to the <code>tabula</code> library in both R and Python (<code>tabulapdf</code> and <code>tabula-py</code>, respectively), but there is no R interface to <code>camelot</code>, as far as I am aware.</p>
<p>Installation of <code>tabulapdf</code> in R depends on <code>rJava</code>, which can be a bit tricky, particularly on Windows. The <a href="https://github.com/ropensci/tabulapdf/">tabulapdf</a> github page has more detailed instructions for <a href="https://github.com/ropensci/tabulapdf/#installing-java-on-windows-with-chocolatey">how to install Java for Windows using Chocolatey</a>.</p>
<div class="callout callout-style-default callout-example callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">36.2.1.1</span> Example: BLS
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Bureau of Labor Statistics provides monthly Consumer Price Index news releases. An archive of these releases is available at https://www.bls.gov/bls/news-release/cpi.htm. Let’s acquire 2 years worth of monthly CPI reports, and focus on trying to extract the first table, “Consumer Price Index for All Urban Consumers (CPI-U): US city average, by expenditure category”.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Acquiring 2 years of BLS CPI news releases
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As this material is covered in <a href="03-web-scraping.html" class="quarto-xref"><span>Chapter 33</span></a>, I’m just going to provide the code to do this in R – you can see equivalent python commands in <a href="03-web-scraping.html" class="quarto-xref"><span>Chapter 33</span></a>. After having done this in R, I realized I probably could have accomplished the same task with a single <code>wget</code> command in <code>bash</code>, the lesson being that it is important to pick your tools wisely.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">save_dir</span> <span class="op">&lt;-</span> <span class="st">"../data/bls-pdfs/"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">save_dir</span>, showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.bls.gov/bls/news-release/cpi.htm"</span></span>
<span></span>
<span><span class="va">session</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/read_html_live.html">read_html_live</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PDFs are the 2nd link in each entry</span></span>
<span><span class="va">links</span> <span class="op">&lt;-</span> <span class="va">session</span><span class="op">$</span><span class="fu">html_elements</span><span class="op">(</span><span class="st">"li a:nth-child(2)"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Get the last 2 years of entries</span></span>
<span><span class="va">link_tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>link <span class="op">=</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_attr.html">html_attr</a></span><span class="op">(</span><span class="va">links</span>, <span class="st">"href"</span><span class="op">)</span>, </span>
<span>                   date <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">link</span>, <span class="st">"\\d{8}"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>datestr <span class="op">=</span> <span class="va">date</span>, date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">years</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">date</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ua</span> <span class="op">&lt;-</span> <span class="st">"Mozilla/5.0 (Windows NT x.y; Win64; x64; rv:10.0) Gecko/20100101 Firefox/10.0"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>HTTPUserAgent <span class="op">=</span> <span class="va">ua</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://www.bls.gov"</span>, <span class="va">link_tbl</span><span class="op">$</span><span class="va">link</span><span class="op">)</span></span>
<span><span class="va">filesave</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">save_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">link_tbl</span><span class="op">$</span><span class="va">link</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The site is finicky about user agents, so we need to </span></span>
<span><span class="co"># specifically pass that in to the download.file method.</span></span>
<span><span class="fu">walk2</span><span class="op">(</span><span class="va">filelist</span>, <span class="va">filesave</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">.x</span>, destfile <span class="op">=</span> <span class="va">.y</span>, method <span class="op">=</span> <span class="st">"wget"</span>, extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"-U \""</span>, <span class="va">ua</span>, <span class="st">"\""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>

<p>You can either run the code above (assuming you have <code>wget</code> on your machine), or you can <a href="../data/bls-pdfs/bls-cpi-pdfs.zip">download a zip file of the PDFs</a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># install.packages("tabulapdf")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tabulapdf/">tabulapdf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.r-universe.dev/pdftools">pdftools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/bls-pdfs"</span>, pattern <span class="op">=</span> <span class="st">".pdf$"</span>, full.names<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">find_page_number</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/pdftools//reference/pdftools.html">pdf_text</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>  <span class="va">txt_by_page</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">txt</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">.</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">txt_by_page</span>, <span class="st">"Table 1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">page_numbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">find_page_number</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">page_numbers</span>, <span class="op">~</span><span class="fu"><a href="https://docs.ropensci.org/tabulapdf/reference/extract_tables.html">extract_tables</a></span><span class="op">(</span><span class="va">.x</span>, page <span class="op">=</span> <span class="va">.y</span>,  output <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tables</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 47 × 5</span></span>
<span><span class="co">##    ...1                  ...2  ...3  `Unadjusted percent` Seasonally adjusted …¹</span></span>
<span><span class="co">##    &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;                 </span></span>
<span><span class="co">##  1 &lt;NA&gt;                  Rela… Unad… change               change                </span></span>
<span><span class="co">##  2 &lt;NA&gt;                  impo… &lt;NA&gt;  &lt;NA&gt;                 &lt;NA&gt;                  </span></span>
<span><span class="co">##  3 Expenditure category  tance &lt;NA&gt;  Dec. Nov.            Sep. Oct. Nov.        </span></span>
<span><span class="co">##  4 &lt;NA&gt;                  Nov.  Dec.… 2022- 2023-          2023- 2023- 2023-     </span></span>
<span><span class="co">##  5 &lt;NA&gt;                  2023  2022… Dec. Dec.            Oct. Nov. Dec.        </span></span>
<span><span class="co">##  6 &lt;NA&gt;                  &lt;NA&gt;  &lt;NA&gt;  2023 2023            2023 2023 2023        </span></span>
<span><span class="co">##  7 All items.. . . . . … 100.… 296.… 3.4 -0.1             0.0 0.1 0.3           </span></span>
<span><span class="co">##  8 Food.. . . . . . . .… 13.4… 316.… 2.7 0.1              0.3 0.2 0.2           </span></span>
<span><span class="co">##  9 Food at home.. . . .… 8.553 299.… 1.3 -0.1             0.3 0.1 0.1           </span></span>
<span><span class="co">## 10 Cereals and bakery p… 1.162 345.… 2.6 -0.7             0.2 0.5 -0.3          </span></span>
<span><span class="co">## # ℹ 37 more rows</span></span>
<span><span class="co">## # ℹ abbreviated name: ¹​`Seasonally adjusted percent`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It appears that <code>tabulapdf</code> isn’t separating the columns the way we’d prefer. Let’s see if we can fix that….</p>
<p>There’s a function, <code><a href="https://docs.ropensci.org/tabulapdf/reference/extract_areas.html">locate_areas()</a></code>, that works interactively - it opens a viewer tab and you select the table using the mouse, as in <a href="#fig-tabulapdf-locate-area" class="quarto-xref">Figure&nbsp;<span>36.6</span></a>.</p>

<p><code>locate_areas</code> provides a sequence of coordinates that are relatively consistent across multiple full-page tables, so we might try to use those coordinates to improve our table parsing.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/tabulapdf/reference/extract_areas.html">locate_areas</a></span><span class="op">(</span><span class="va">files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, pages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">page_numbers</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s what I got running this 5 times for the first PDF in the list – this gives me boundaries for each column (without including the header).</p>
<pre><code>Listening on http://127.0.0.1:6481
[[1]]
     top     left   bottom    right 
128.1042 209.2557 583.8484 244.2939 

[[2]]
     top     left   bottom    right 
128.1042 289.0649 584.8223 327.9962 

[[3]]
     top     left   bottom    right 
128.1042 369.8473 586.7699 410.7252 

[[4]]
     top     left   bottom    right 
128.1042 452.5763 586.7699 489.5611 

[[5]]
     top     left   bottom    right 
126.1566 535.3054 586.7699 575.2099 
</code></pre>
<p>We can actually run this for each column, keeping track of the left and right values, to get an even more precise way to read our data in. Here are my rough column alignments, using <code>cpi_01112024.pdf</code> as a test.</p>
<ul>
<li>Table Start - 35</li>
<li>Col2 - 209</li>
<li>Col3 - 244</li>
<li>Col4 - 289</li>
<li>Col5 - 328</li>
<li>Col6 - 370</li>
<li>Col7 - 411</li>
<li>Col8 - 453</li>
<li>Col9 - 490</li>
<li>Col10 - 535</li>
<li>Table End - 575</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">page_numbers</span>, <span class="op">~</span><span class="fu"><a href="https://docs.ropensci.org/tabulapdf/reference/extract_tables.html">extract_tables</a></span><span class="op">(</span></span>
<span>    <span class="va">.x</span>, page <span class="op">=</span> <span class="va">.y</span>, </span>
<span>    guess <span class="op">=</span> <span class="cn">F</span>,</span>
<span>    col_names <span class="op">=</span> <span class="cn">F</span>, </span>
<span>    area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">128</span>, <span class="fl">35</span>, <span class="fl">586</span>, <span class="fl">575</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">209</span>, <span class="fl">244</span>, <span class="fl">289</span>, <span class="fl">328</span>, <span class="fl">370</span>, <span class="fl">411</span>, <span class="fl">453</span>, <span class="fl">490</span>, <span class="fl">535</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">tables</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 41 × 10</span></span>
<span><span class="co">##    X1                         X2    X3    X4    X5    X6    X7    X8    X9   X10</span></span>
<span><span class="co">##    &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">##  1 All items.. . . . . .… 100     297.  307.  307.   3.4  -0.1   0     0.1   0.3</span></span>
<span><span class="co">##  2 Food.. . . . . . . . …  13.4   317.  325.  325.   2.7   0.1   0.3   0.2   0.2</span></span>
<span><span class="co">##  3 Food at home.. . . . …   8.55  299.  303.  303.   1.3  -0.1   0.3   0.1   0.1</span></span>
<span><span class="co">##  4 Cereals and bakery pr…   1.16  345.  356.  354.   2.6  -0.7   0.2   0.5  -0.3</span></span>
<span><span class="co">##  5 Meats, poultry, fish,…   1.78  320.  320.  320.  -0.1   0.1   0.7  -0.2   0.5</span></span>
<span><span class="co">##  6 Dairy and related pro…   0.78  271.  268.  268.  -1.3   0.1   0.3   0.1   0.3</span></span>
<span><span class="co">##  7 Fruits and vegetables…   1.47  349.  351.  350.   0.3  -0.1   0     0.3  -0.1</span></span>
<span><span class="co">##  8 Nonalcoholic beverage…  NA      NA    NA    NA   NA    NA    NA    NA    NA  </span></span>
<span><span class="co">##  9 materials. . . . . . …   1.03  210.  216.  216.   2.6   0.1  -0.1   0.5   0.2</span></span>
<span><span class="co">## 10 Other food at home.. …   2.33  263.  270.  270.   2.8   0     0.3  -0.1   0.1</span></span>
<span><span class="co">## # ℹ 31 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can read in the dates that are present in the header row, assuming that the major dividers stay the same between reports. I used <code><a href="https://docs.ropensci.org/tabulapdf/reference/extract_areas.html">locate_areas()</a></code> to get the coordinates of each header that we care about.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code><a href="https://docs.ropensci.org/tabulapdf/reference/extract_areas.html">locate_areas()</a></code> output
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>&gt; locate_areas(files[1], pages = page_numbers[1])

Listening on http://127.0.0.1:7339
[[1]]
      top      left    bottom     right 
 89.15168  36.98473 127.13037 572.29009 </code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="annotated-cell-14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">headers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span></span>
<span>  <span class="va">files</span>, <span class="va">page_numbers</span>,</span>
<span>  <span class="op">~</span><span class="fu"><a href="https://docs.ropensci.org/tabulapdf/reference/extract_tables.html">extract_tables</a></span><span class="op">(</span></span>
<span>    <span class="va">.x</span>, page <span class="op">=</span> <span class="va">.y</span>,</span>
<span>    guess <span class="op">=</span> <span class="cn">F</span>,</span>
<span>    col_names <span class="op">=</span> <span class="cn">F</span>,</span>
<span>    area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">89</span>, <span class="fl">35</span>, <span class="fl">128</span>, <span class="fl">575</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">209</span>, <span class="fl">244</span>, <span class="fl">289</span>, <span class="fl">328</span>, <span class="fl">370</span>, <span class="fl">411</span>, <span class="fl">453</span>, <span class="fl">490</span>, <span class="fl">535</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fix_headers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">modifiers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"Rel_imp."</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Unadj_idx."</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Unadj_pct_chg."</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Seas_adj_pct_chg."</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">7</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">9</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">10</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"\\."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"[ -]"</span>, <span class="st">"_"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">modifiers</span>, <span class="va">vars</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">headers_fixed</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">headers</span>, <span class="va">fix_headers</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">tables</span>, <span class="va">headers_fixed</span>, <span class="op">~</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">set_names</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tables</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 41 × 10</span></span>
<span><span class="co">##    Expenditure_category      Rel_imp.Nov2023 Unadj_idx.Dec2022 Unadj_idx.Nov2023</span></span>
<span><span class="co">##    &lt;chr&gt;                               &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">##  1 All items.. . . . . . . …          100                 297.              307.</span></span>
<span><span class="co">##  2 Food.. . . . . . . . . .…           13.4               317.              325.</span></span>
<span><span class="co">##  3 Food at home.. . . . . .…            8.55              299.              303.</span></span>
<span><span class="co">##  4 Cereals and bakery produ…            1.16              345.              356.</span></span>
<span><span class="co">##  5 Meats, poultry, fish, an…            1.78              320.              320.</span></span>
<span><span class="co">##  6 Dairy and related produc…            0.78              271.              268.</span></span>
<span><span class="co">##  7 Fruits and vegetables. .…            1.47              349.              351.</span></span>
<span><span class="co">##  8 Nonalcoholic beverages a…           NA                  NA                NA </span></span>
<span><span class="co">##  9 materials. . . . . . . .…            1.03              210.              216.</span></span>
<span><span class="co">## 10 Other food at home.. . .…            2.33              263.              270.</span></span>
<span><span class="co">## # ℹ 31 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: Unadj_idx.Dec2023 &lt;dbl&gt;,</span></span>
<span><span class="co">## #   Unadj_pct_chg.Dec2022_Dec2023 &lt;dbl&gt;, Unadj_pct_chg.Nov2023_Dec2023 &lt;dbl&gt;,</span></span>
<span><span class="co">## #   Seas_adj_pct_chg.Sep2023_Oct2023 &lt;dbl&gt;,</span></span>
<span><span class="co">## #   Seas_adj_pct_chg.Oct2023_Nov2023 &lt;dbl&gt;,</span></span>
<span><span class="co">## #   Seas_adj_pct_chg.Nov2023_Dec2023 &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl>
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="1,2,3,4,5,6,7,8,9,10" data-code-annotation="1">Pull headers out using roughly the same command as we used to get the tables, but with a different top and bottom area.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="12" data-code-annotation="2">Write a function to clean the headers up a bit</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="13" data-code-annotation="3"><code>modifiers</code> are the top row of the variable names that aren’t captured by our headers object. They’re consistent from report to report. We’ll separate the modifier from the dates using <code>.</code>, for easier cleaning.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="15,16,17,18,19,20,21,22,23,24" data-code-annotation="4">Extract only the components of the headers object that are needed – this depends on whether we’re talking about a single month-to-month comparison, or a time span. In the first column, we only need the “expenditure category” object.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="26,27" data-code-annotation="5">Remove all <code>.</code> characters from the names so they don’t mess up our delimiter, and replace spaces and dashes with <code>_</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="29" data-code-annotation="6">Paste the two vectors together to get the names.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="32" data-code-annotation="7">Apply the function to each header</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="35" data-code-annotation="8">Set the names of the variables in each table to the corresponding header.</span>
</dd>
</dl>
</div>
</div>
<p>Then, we just need to clean things up a bit more.</p>
<div class="cell">
<div class="sourceCode" id="annotated-cell-15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">report_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span>, <span class="st">"cpi_(.*)\\.pdf"</span>, <span class="st">"\\1"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpi_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">tables</span>, <span class="va">report_date</span>, <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">.x</span>, report_date <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpi_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>  <span class="va">cpi_data</span>, </span>
<span>  <span class="op">~</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Expenditure_category</span>, <span class="va">report_date</span><span class="op">)</span>,</span>
<span>                names_to<span class="op">=</span><span class="st">"var"</span>,</span>
<span>                values_to <span class="op">=</span> <span class="st">"val"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">var</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"varname"</span>, <span class="st">"vardate"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Expenditure_category"</span>, <span class="st">"report_date"</span>, <span class="st">"vardate"</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="st">"varname"</span>, values_from <span class="op">=</span> <span class="st">"val"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpi_data</span> <span class="op">&lt;-</span> <span class="va">cpi_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Expenditure_category <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">Expenditure_category</span>, <span class="st">"[\\. ]{1,}$"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">cpi_data</span><span class="op">)</span></span>
<span><span class="va">cpi_data</span></span>
<span><span class="co">## [1] 6601    7</span></span>
<span><span class="co">## # A tibble: 6,601 × 7</span></span>
<span><span class="co">##    Expenditure_category report_date vardate      Rel_imp Unadj_idx Unadj_pct_chg</span></span>
<span><span class="co">##    &lt;chr&gt;                &lt;date&gt;      &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">##  1 All items            2024-01-11  Nov2023        100        307.          NA  </span></span>
<span><span class="co">##  2 All items            2024-01-11  Dec2022         NA        297.          NA  </span></span>
<span><span class="co">##  3 All items            2024-01-11  Dec2023         NA        307.          NA  </span></span>
<span><span class="co">##  4 All items            2024-01-11  Dec2022_Dec…    NA         NA            3.4</span></span>
<span><span class="co">##  5 All items            2024-01-11  Nov2023_Dec…    NA         NA           -0.1</span></span>
<span><span class="co">##  6 All items            2024-01-11  Sep2023_Oct…    NA         NA           NA  </span></span>
<span><span class="co">##  7 All items            2024-01-11  Oct2023_Nov…    NA         NA           NA  </span></span>
<span><span class="co">##  8 Food                 2024-01-11  Nov2023         13.4      325.          NA  </span></span>
<span><span class="co">##  9 Food                 2024-01-11  Dec2022         NA        317.          NA  </span></span>
<span><span class="co">## 10 Food                 2024-01-11  Dec2023         NA        325.          NA  </span></span>
<span><span class="co">## # ℹ 6,591 more rows</span></span>
<span><span class="co">## # ℹ 1 more variable: Seas_adj_pct_chg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl>
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="4" data-code-annotation="1">Determine the date of the report from the filename</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="6" data-code-annotation="2">Add a column with the corresponding report date to each table</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="10,11,12" data-code-annotation="3">Convert each table to long form with expenditure category and report date as ID columns.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="13" data-code-annotation="4">Split the variable names from the period over which the variable is calculated. In theory, we should be able to determine the lag for each of these and not care about the date, but I don’t trust that the report has been that consistent over 2 years… paranoia.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="14" data-code-annotation="5">Pivot wider, so that there’s a column for each variable name.</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="18" data-code-annotation="6">Bind all the tables together into a single table</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="20" data-code-annotation="7">Clean up the expenditure category names so that the dots are gone.</span>
</dd>
</dl>
</div>
</div>
<p>We could probably get this data cleaner – the lagged columns should be specified better, but this will do for now. Let’s at least do something interesting with this data that wouldn’t have been possible without reading data in from the tables.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">cpi_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Expenditure_category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Energy"</span>, <span class="st">"Food"</span>, <span class="st">"Shelter"</span>, <span class="st">"Medical care services"</span>, <span class="st">"commodities"</span>, <span class="st">"Transportation services"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Category <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">Expenditure_category</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"commodities"</span><span class="op">=</span> <span class="st">"Non-food Goods"</span>, <span class="st">"Medical care services"</span> <span class="op">=</span> <span class="st">"Medical"</span>, <span class="st">"Transportation services"</span> <span class="op">=</span><span class="st">"Transportation"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Shelter"</span>, <span class="st">"Non-food Goods"</span>, <span class="st">"Energy"</span>, <span class="st">"Food"</span>, <span class="st">"Medical"</span>, <span class="st">"Transportation"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Category</span>, <span class="va">report_date</span>, <span class="va">Rel_importance</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">report_date</span>, y <span class="op">=</span> <span class="va">Rel_importance</span>, color <span class="op">=</span> <span class="va">Category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Relative Importance in CPI-U Calculation"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Error in `select()`:</span></span>
<span><span class="co">## ! Can't select columns that don't exist.</span></span>
<span><span class="co">## ✖ Column `Rel_importance` doesn't exist.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>If we learned anything from doing this in R, it’s that it probably won’t work the first time. So this code saves a bit of evaluation time by using some of the info we got from R, like the page numbers (I’ve adjusted these to match python indexing).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pdfplumber</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'pdfplumber'</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tabula</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'tabula'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'numpy'</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> glob(<span class="st">"../data/bls-pdfs/*.pdf"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_page_number(<span class="bu">file</span>):</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  pdf <span class="op">=</span> pdfplumber.<span class="bu">open</span>(<span class="bu">file</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  has_tb1 <span class="op">=</span> [<span class="st">"Table 1"</span> <span class="kw">in</span> i.extract_text() <span class="cf">for</span> i <span class="kw">in</span> pdf.pages]</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  pdf.close()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">int</span>(np.where(has_tb1)[<span class="dv">0</span>][<span class="dv">0</span>])</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># page_numbers = [find_page_number(i) for i in files]</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># page_numbers = [i[0] for i in page_numbers]</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>page_numbers <span class="op">=</span> [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">8</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> tabula.read_pdf(files[<span class="dv">0</span>], pages<span class="op">=</span>page_numbers[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'tabula' is not defined</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>tables</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'tables' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok, so this time, we get 5 columns, which isn’t quite right - it seems as if the major headers are determining the column structure.</p>
<p>Let’s see if we can define the table area and help things out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tbl <span class="op">=</span> tabula.read_pdf(files[<span class="dv">0</span>], pages<span class="op">=</span>page_numbers[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>, area<span class="op">=</span>[<span class="dv">128</span>, <span class="dv">35</span>, <span class="dv">586</span>, <span class="dv">575</span>], pandas_options<span class="op">=</span>{<span class="st">'header'</span>: <span class="va">None</span>})[<span class="dv">0</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'tabula' is not defined</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tbl</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'tbl' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> chain</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">## ModuleNotFoundError: No module named 'pandas'</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>header <span class="op">=</span> tabula.read_pdf(files[<span class="dv">0</span>], pages<span class="op">=</span>page_numbers[<span class="dv">0</span>]<span class="op">+</span><span class="dv">1</span>, area<span class="op">=</span>[<span class="dv">89</span>, <span class="dv">35</span>, <span class="dv">128</span>, <span class="dv">575</span>], pandas_options<span class="op">=</span>{<span class="st">'header'</span>: <span class="va">None</span>})[<span class="dv">0</span>]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'tabula' is not defined</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fix_headers(tbl):</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  modifiers<span class="op">=</span>[[<span class="st">""</span>, <span class="st">"Rel_imp."</span>], [<span class="st">"Unadj_idx."</span>]<span class="op">*</span><span class="dv">3</span>, [<span class="st">"Unadj_pct_chg."</span>]<span class="op">*</span><span class="dv">2</span>, [<span class="st">"Seas_adj_pct_chg."</span>]<span class="op">*</span><span class="dv">3</span>]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  modifiers<span class="op">=</span><span class="bu">list</span>(chain.from_iterable(modifiers))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://stackoverflow.com/questions/11860476/how-to-unnest-a-nested-list</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  spans<span class="op">=</span>pd.Series([tbl.loc[<span class="dv">0</span>,<span class="dv">0</span>], </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">1</span>:<span class="dv">2</span>,<span class="dv">1</span>]),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">1</span>:<span class="dv">2</span>,<span class="dv">2</span>]),</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">1</span>:<span class="dv">2</span>,<span class="dv">3</span>]),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">1</span>:<span class="dv">2</span>,<span class="dv">4</span>]),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">0</span>:<span class="dv">3</span>,<span class="dv">5</span>]),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">0</span>:<span class="dv">3</span>,<span class="dv">6</span>]),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">0</span>:<span class="dv">3</span>,<span class="dv">7</span>]),</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">0</span>:<span class="dv">3</span>,<span class="dv">8</span>]),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">''</span>.join(tbl.loc[<span class="dv">0</span>:<span class="dv">3</span>,<span class="dv">9</span>])])</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  spans<span class="op">=</span>spans.<span class="bu">str</span>.replace(<span class="st">"\."</span>, <span class="st">""</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  spans<span class="op">=</span>spans.<span class="bu">str</span>.replace(<span class="st">"[ -]"</span>, <span class="st">"_"</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> modifiers <span class="op">+</span> spans</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>header <span class="op">=</span> fix_headers(header)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'header' is not defined</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_table_1(<span class="bu">file</span>, page_number): </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  tbl<span class="op">=</span>tabula.read_pdf(<span class="bu">file</span>, pages<span class="op">=</span>page_number<span class="op">+</span><span class="dv">1</span>, </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>                      area<span class="op">=</span>[<span class="dv">128</span>, <span class="dv">35</span>, <span class="dv">586</span>, <span class="dv">575</span>], </span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>                      pandas_options<span class="op">=</span>{<span class="st">'header'</span>: <span class="va">None</span>})[<span class="dv">0</span>]</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  header<span class="op">=</span>tabula.read_pdf(<span class="bu">file</span>, pages<span class="op">=</span>page_number<span class="op">+</span><span class="dv">1</span>, </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>                         area<span class="op">=</span>[<span class="dv">89</span>, <span class="dv">35</span>, <span class="dv">128</span>, <span class="dv">575</span>], </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>                         pandas_options<span class="op">=</span>{<span class="st">'header'</span>: <span class="va">None</span>})[<span class="dv">0</span>]</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  header<span class="op">=</span>fix_headers(header)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  tbl <span class="op">=</span> tbl.rename(header, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tbl</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> [read_table_1(<span class="bu">file</span>, page_numbers[i]) <span class="cf">for</span> i,<span class="bu">file</span> <span class="kw">in</span> <span class="bu">enumerate</span>(files)]</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co">## NameError: name 'tabula' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>fix_headers &lt;- function(tbl) { # &lt;2&gt; modifiers &lt;- c(““,”Rel_imp.”, rep(“Unadj_idx.”, 3), rep(“Unadj_pct_chg.”, 2), rep(“Seas_adj_pct_chg.”, 3)) # &lt;3&gt;</p>
<p>vars &lt;- c(tbl[1,1], # &lt;4&gt; paste(unlist(tbl[2:3, 2]), collapse=““), # &lt;4&gt; paste(unlist(tbl[2:3, 3]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[2:3, 4]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[2:3, 5]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[1:4, 6]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[1:4, 7]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[1:4, 8]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[1:4, 9]), collapse=”“), # &lt;4&gt; paste(unlist(tbl[1:4, 10]), collapse=”“) # &lt;4&gt; ) |&gt; str_remove_all(”\.”) |&gt; # &lt;5&gt; str_replace_all(“[ -]”, “_“) # &lt;5&gt;</p>
<p>paste0(modifiers, vars) # &lt;6&gt; }</p>
<p>headers_fixed = map(headers, fix_headers) # &lt;7&gt;</p>
<p>library(magrittr) tables &lt;- map2(tables, headers_fixed, ~set_names(.x, .y)) # &lt;8&gt;</p>
</div>
</div>
</div>
</div>
</div><div class="no-row-height column-margin column-container"><div class="callout-5-contents callout-collapse collapse callout-margin-content">
<div id="fig-cpi-tab1-screenshot" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A screenshot of Table 1 of the BLS CPI report showing components of the consumer price index for urban consumers, averaged over US cities.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-cpi-tab1-screenshot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/bls-cpi-table1-screenshot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;36.5: A screenshot of Table 1 of the CPI monthly report from December 2023"><img src="../images/advanced/bls-cpi-table1-screenshot.png" class="img-fluid figure-img" alt="A screenshot of Table 1 of the BLS CPI report showing components of the consumer price index for urban consumers, averaged over US cities."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cpi-tab1-screenshot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36.5: A screenshot of Table 1 of the CPI monthly report from December 2023
</figcaption></figure>
</div>
</div><div class="callout-5-contents callout-collapse collapse callout-margin-content">
<div id="fig-tabulapdf-locate-area" class="lightbox quarto-float quarto-figure quarto-figure-center anchored" alt="A screenshot of the `tabulapdf` `locate_area()` function interactive window, showing a highlighted table region.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-tabulapdf-locate-area-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/advanced/tabula-pdf-locate-area.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;36.6: A screenshot of one page of one of the PDFs, showing how locate_areas works."><img src="../images/advanced/tabula-pdf-locate-area.png" class="img-fluid figure-img" alt="A screenshot of the `tabulapdf` `locate_area()` function interactive window, showing a highlighted table region."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tabulapdf-locate-area-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;36.6: A screenshot of one page of one of the PDFs, showing how <code>locate_areas</code> works.
</figcaption></figure>
</div>
</div></div>
<div class="callout callout-style-default callout-learnmore callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">36.3</span> Other PDF Options to Explore
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>
<code>parsemypdf</code> <span class="citation" data-cites="srivastavaGenieincodebottleParsemypdf2025"><a href="#ref-srivastavaGenieincodebottleParsemypdf2025" role="doc-biblioref">[11]</a></span>, a collection of AI-based parsing libraries</li>
</ul>
</div>
</div>
</div>
</section></section><section id="references" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-klindtPDFConsideredHarmful2017" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">M. Klindt, <span>“<span>PDF</span>/a considered harmful for digital preservation,”</span> in <em><span class="nocase">iPRES</span> 2017 conference proceedings</em>, 2017 [Online]. Available: <a href="https://phaidra.univie.ac.at/o:931063">https://phaidra.univie.ac.at/o:931063</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-edwardsWhyExtractingData2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">B. Edwards, <span>“Why extracting data from <span>PDFs</span> is still a nightmare for data experts. Ars technica,”</span> Mar. 11, 2025. [Online]. Available: <a href="https://arstechnica.com/ai/2025/03/why-extracting-data-from-pdfs-is-still-a-nightmare-for-data-experts/">https://arstechnica.com/ai/2025/03/why-extracting-data-from-pdfs-is-still-a-nightmare-for-data-experts/</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-zhangDocumentParsingUnveiled2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div>
<div class="csl-right-inline">Q. Zhang <em>et al.</em>, <span>“Document parsing unveiled: Techniques, challenges, and prospects for structured information extraction.”</span> <span>arXiv</span>, Oct. 28, 2024 [Online]. Available: <a href="http://arxiv.org/abs/2410.21169">http://arxiv.org/abs/2410.21169</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-harbertTappingPowerUnstructured2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div>
<div class="csl-right-inline">T. Harbert, <span>“Tapping the power of unstructured data. <span>MIT</span> management,”</span> Feb. 01, 2021. [Online]. Available: <a href="https://mitsloan.mit.edu/ideas-made-to-matter/tapping-power-unstructured-data">https://mitsloan.mit.edu/ideas-made-to-matter/tapping-power-unstructured-data</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-wikimediacontributorsHistoryPDF2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div>
<div class="csl-right-inline">Wikimedia contributors, <span>“History of <span>PDF</span>,”</span> <em>Wikipedia</em>. Oct. 30, 2024 [Online]. Available: <a href="https://en.wikipedia.org/w/index.php?title=History_of_PDF&amp;oldid=1254285186">https://en.wikipedia.org/w/index.php?title=History_of_PDF&amp;oldid=1254285186</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-gnupdfprojectIntroductionPDF2014" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div>
<div class="csl-right-inline">GNUpdf project, <span>“Introduction to <span>PDF</span>,”</span> Oct. 10, 2014. [Online]. Available: <a href="https://web.archive.org/web/20141010035745/http://gnupdf.org/Introduction_to_PDF">https://web.archive.org/web/20141010035745/http://gnupdf.org/Introduction_to_PDF</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-hodsonPDFSuccinctly2012" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div>
<div class="csl-right-inline">R. Hodson, <em><span>PDF</span> succinctly</em>. Morrisville, <span>NC</span>: Syncfusion, Inc, 2012 [Online]. Available: <a href="https://web.archive.org/web/20140706124739/http://www.syncfusion.com/Content/downloads/ebook/PDF_Succinctly.pdf">https://web.archive.org/web/20140706124739/http://www.syncfusion.com/Content/downloads/ebook/PDF_Succinctly.pdf</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-kingAdobeIntroductionInsides2005" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div>
<div class="csl-right-inline">J. C. King, <span>“Adobe: Introduction to the insides of <span>PDF</span>,”</span> Apr. 26, 2005 [Online]. Available: <a href="https://web.archive.org/web/20141212020737/http://www.adobe.com/content/dam/Adobe/en/technology/pdfs/PDF_Day_A_Look_Inside.pdf">https://web.archive.org/web/20141212020737/http://www.adobe.com/content/dam/Adobe/en/technology/pdfs/PDF_Day_A_Look_Inside.pdf</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-oomsPdftoolsTextExtraction2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div>
<div class="csl-right-inline">J. Ooms, <span>“Pdftools: Text extraction, rendering and converting of <span>PDF</span> documents.”</span> <span>rOpenSci</span>, Mar. 03, 2025 [Online]. Available: <a href="https://packages.ropensci.org/pdftools">https://packages.ropensci.org/pdftools</a>. [Accessed: Jul. 16, 2025]</div>
</div>
<div id="ref-singer-vinePdfplumber2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div>
<div class="csl-right-inline">J. Singer-Vine and The pdfplumber contributors, <span>“Pdfplumber.”</span> Jun. 2025 [Online]. Available: <a href="https://github.com/jsvine/pdfplumber">https://github.com/jsvine/pdfplumber</a>. [Accessed: Jul. 15, 2025]</div>
</div>
<div id="ref-srivastavaGenieincodebottleParsemypdf2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div>
<div class="csl-right-inline">R. Srivastava, <span>“Genieincodebottle/parsemypdf.”</span> Jul. 13, 2025 [Online]. Available: <a href="https://github.com/genieincodebottle/parsemypdf">https://github.com/genieincodebottle/parsemypdf</a>. [Accessed: Jul. 16, 2025]</div>
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/srvanderplas\.github\.io\/stat-computing-r-python\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="srvanderplas/stat-computing-r-python" data-repo-id="R_kgDOIvwd2g" data-category="General" data-category-id="DIC_kwDOIvwd2s4CTksR" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../part-advanced-topics/05-APIs.html" class="pagination-link" aria-label="Application Programming Interfaces">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Application Programming Interfaces</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part-advanced-topics/07-intro-interactive-graphics.html" class="pagination-link" aria-label="Interactive Graphics">
        <span class="nav-page-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Susan Vanderplas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-advanced-topics/06-pdf-tools.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/srvanderplas">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","selector":".lightbox","openEffect":"zoom","loop":false});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>