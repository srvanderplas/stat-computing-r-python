<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-02-08">
<title>22&nbsp; Data Cleaning – Statistical Computing using R and Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part-wrangling/04-strings.html" rel="next">
<link href="../part-wrangling/02c-good-graphics.html" rel="prev">
<link href="../build_deps/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4ZFBDKXJXP"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4ZFBDKXJXP', { 'anonymize_ip': true});
</script><script src="https://kit.fontawesome.com/baac5f0610.js" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../build_deps/style.css">
</head>
<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-wrangling/00-wrangling.html">Part III: Data Wrangling</a></li><li class="breadcrumb-item"><a href="../part-wrangling/03-data-cleaning.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Cleaning</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Computing using R and Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/srvanderplas/stat-computing-r-python/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-tools/00-tools-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/01-computer-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/02-setting-up-computer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Computer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/03-Rstudio-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio’s Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/04-scripts-notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scripts and Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/05-git-and-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Version Control with Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/06-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducibility and Professional Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-gen-prog/00-gen-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: General Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01-basic-var-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variables and Basic Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/02-prog-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Using Functions and Libraries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/03-data-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/035-matrix-calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Matrix Calculations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/04-control-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/05-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/06-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/07-prog-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Programming With Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/99-extra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Other Helpful Programming Resources</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-wrangling/00-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/01-data-input.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Data Input</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02-basic-data-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Visualization Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02a-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02b-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02c-good-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/03-data-cleaning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/04-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05-data-reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/06-data-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/07-datetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/08-functional-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/09-spatial-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-advanced-topics/00-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/01-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Simulation and Reproducibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/06-interactive-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../graveyard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Other Topics</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">22.1</span> <i class="fa-solid fa-bullseye" aria-label="bullseye"></i> Objectives</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">22.2</span> Introduction</a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data"><span class="header-section-number">22.3</span> Tidy Data</a></li>
  <li>
<a href="#filter-subset-rows" id="toc-filter-subset-rows" class="nav-link" data-scroll-target="#filter-subset-rows"><span class="header-section-number">22.4</span> Filter: Subset rows</a>
  <ul class="collapse">
<li><a href="#common-row-selection-tasks" id="toc-common-row-selection-tasks" class="nav-link" data-scroll-target="#common-row-selection-tasks"><span class="header-section-number">22.4.1</span> Common Row Selection Tasks</a></li>
  </ul>
</li>
  <li>
<a href="#select-pick-columns" id="toc-select-pick-columns" class="nav-link" data-scroll-target="#select-pick-columns"><span class="header-section-number">22.5</span> Select: Pick columns</a>
  <ul class="collapse">
<li><a href="#rearranging-columns" id="toc-rearranging-columns" class="nav-link" data-scroll-target="#rearranging-columns"><span class="header-section-number">22.5.1</span> Rearranging Columns</a></li>
  </ul>
</li>
  <li><a href="#mutate-add-and-transform-variables" id="toc-mutate-add-and-transform-variables" class="nav-link" data-scroll-target="#mutate-add-and-transform-variables"><span class="header-section-number">22.6</span> Mutate: Add and transform variables</a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize"><span class="header-section-number">22.7</span> Summarize</a></li>
  <li><a href="#group-by-power" id="toc-group-by-power" class="nav-link" data-scroll-target="#group-by-power"><span class="header-section-number">22.8</span> Group By + (?) = Power!</a></li>
  <li><a href="#summarizing-across-multiple-variables" id="toc-summarizing-across-multiple-variables" class="nav-link" data-scroll-target="#summarizing-across-multiple-variables"><span class="header-section-number">22.9</span> Summarizing Across Multiple Variables</a></li>
  <li><a href="#try-it-out---data-cleaning" id="toc-try-it-out---data-cleaning" class="nav-link" data-scroll-target="#try-it-out---data-cleaning"><span class="header-section-number">22.10</span> Try it out - Data Cleaning</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">22.11</span> Additional Resources</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">22.12</span> References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/03-data-cleaning.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-wrangling/00-wrangling.html">Part III: Data Wrangling</a></li><li class="breadcrumb-item"><a href="../part-wrangling/03-data-cleaning.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Cleaning</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-data-cleaning" class="quarto-section-identifier"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Cleaning</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 8, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="objectives" class="level2" data-number="22.1"><h2 data-number="22.1" class="anchored" data-anchor-id="objectives">
<span class="header-section-number">22.1</span> <i class="fa-solid fa-bullseye" aria-label="bullseye"></i> Objectives</h2>
<ul>
<li>Identify required sequence of steps for data cleaning</li>
<li>Describe step-by-step data cleaning process in lay terms appropriately</li>
<li>Apply data manipulation verbs to prepare data for analysis</li>
<li>Understand the consequences of data cleaning steps for statistical analysis</li>
<li>Create summaries of data appropriate for analysis or display using data manipulation techniques</li>
</ul></section><section id="introduction" class="level2 page-columns page-full" data-number="22.2"><h2 data-number="22.2" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">22.2</span> Introduction</h2>
<p>In this section, we’re going start learning how to work with data. Generally speaking, data doesn’t come in a form suitable for analysis<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> - you have to clean it up, create the variables you care about, get rid of those you don’t care about, and so on.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/data_cowboy.png" class="img-fluid figure-img" alt="Cartoon of a fuzzy monster with a cowboy hat and lasso, riding another fuzzy monster labeled “dplyr”, lassoing a group of angry / unruly looking creatures labeled “data.”"></p>
<figcaption>Data wrangling (by Allison Horst)</figcaption></figure>
</div>
</div></div><p>Some people call the process of cleaning and organizing your data “data wrangling”, which is a fantastic way to think about chasing down all of the issues in the data.</p>
<p>In R, we’ll be using the <code>tidyverse</code> for this. It’s a meta-package (a package that just loads other packages) that collects packages designed with the same philosophy<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and interface (basically, the commands will use predictable argument names and structure). You’ve already been introduced to parts of the tidyverse - specifically, <code>readr</code> and <code>ggplot2</code>.</p>
<p><code>dplyr</code> (one of the packages in the tidyverse) creates a “grammar of data manipulation” to make it easier to describe different operations. I find the <code>dplyr</code> grammar to be extremely useful when talking about data operations, so I’m going to attempt to show you how to do the same operations in R with dplyr, and in Python (without the underlying framework).</p>
<p>Each <code>dplyr</code> verb describes a common task when doing both exploratory data analysis and more formal statistical modeling. In all tidyverse functions, <strong>data comes first</strong> – literally, as it’s the first argument to any function. In addition, you don’t use df$variable to access a variable - you refer to the variable by its name alone (“bare” names). This makes the syntax much cleaner and easier to read, which is another principle of the tidy philosophy.</p>
<p>In Python, most data manipulation tasks are handled using <code>pandas</code><span class="citation" data-cites="pandasIndexingSelectingData2022"><a href="#ref-pandasIndexingSelectingData2022" role="doc-biblioref">[1]</a></span>. In the interests of using a single consistent “language” for describing data manipulation tasks, I’ll use the tidyverse “verbs” to describe operations in both languages. The goal of this is to help focus your attention on the essentials of the operations, instead of the specific syntax.</p>
<p>There is also the <code>datar</code> python package<span class="citation" data-cites="pwwangDatarGrammarData2022"><a href="#ref-pwwangDatarGrammarData2022" role="doc-biblioref">[2]</a></span>, which attempts to port the dplyr grammar of data wrangling into python. While pandas tends to be fairly similar to base R in basic operation, <code>datar</code> may be more useful if you prefer the <code>dplyr</code> way of handling things using a data-first API.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>I haven’t had the chance to add the <code>datar</code> package to this book, but it looks promising and may be worth your time to figure out. It’s a bit too new for me to teach right now - I want packages that will be maintained long-term if I’m going to teach them to others.</p>
</div></div><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf">There is an excellent dplyr cheatsheet available from RStudio</a>. You may want to print it out to have a copy to reference as you work through this chapter.</p>
<p><a href="https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf">Here is a data wrangling with pandas cheatsheet</a> that is formatted similarly to the dplyr cheat sheet.</p>
</div>
</div>
</section><section id="tidy-data" class="level2" data-number="22.3"><h2 data-number="22.3" class="anchored" data-anchor-id="tidy-data">
<span class="header-section-number">22.3</span> Tidy Data</h2>
<p>There are infinitely many ways to configure “messy” data, but data that is “tidy” has 3 attributes:</p>
<ol type="1">
<li>Each variable has its own column</li>
<li>Each observation has its own row</li>
<li>Each value has its own cell</li>
</ol>
<p>These attributes aren’t sufficient to define “clean” data, but they work to define “tidy” data (in the same way that you can have a “tidy” room because all of your clothes are folded, but they aren’t clean just because they’re folded; you could have folded a pile of dirty clothes).</p>
<p>We’ll get more into how to work with different “messy” data configurations in <a href="05-data-reshape.html" class="quarto-xref"><span>Chapter 24</span></a> and <a href="06-data-join.html" class="quarto-xref"><span>Chapter 25</span></a>, but it’s worth keeping rules 1 and 3 in mind while working through this module.</p>
</section><section id="filter-subset-rows" class="level2" data-number="22.4"><h2 data-number="22.4" class="anchored" data-anchor-id="filter-subset-rows">
<span class="header-section-number">22.4</span> Filter: Subset rows</h2>
<p>Filter allows us to work with a subset of a larger data frame, keeping only the rows we’re interested in. We provide one or more logical conditions, and only those rows which meet the logical conditions are returned from <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. Note that unless we store the result from <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> in the original object, we don’t change the original.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/dplyr_filter.jpg" class="img-fluid figure-img" alt="Cartoon showing three fuzzy monsters either selecting or crossing out rows of a data table. If the type of animal in the table is “otter” and the site is “bay”, a monster is drawing a purple rectangle around the row. If those conditions are not met, another monster is putting a line through the column indicating it will be excluded. Stylized text reads “dplyr::filter() - keep rows that satisfy your conditions.”"></p>
<figcaption>dplyr filter() by Allison Horst</figcaption></figure>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: starwars
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s explore how it works, using the <code>starwars</code> dataset, which contains a comprehensive list of the characters in the Star Wars movies.</p>
<p>In the interests of demonstrating the process on the same data, I’ve exported the starwars data to a CSV file using the <code>readr</code> package. I had to remove the list-columns (films, vehicles, starships) because that format isn’t supported by CSV files. You can access the csv data <a href="https://github.com/srvanderplas/datasets/raw/main/clean/starwars.csv">here</a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>This data set is included in the <code>dplyr</code> package, so we load that package and then use the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> function to load dataset into memory. The loading isn’t complete until we actually use the dataset though… so let’s print the first few rows.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></span>
<span><span class="va">starwars</span></span>
<span><span class="co">## # A tibble: 87 × 14</span></span>
<span><span class="co">##    name     height  mass hair_color skin_color eye_color birth_year sex   gender</span></span>
<span><span class="co">##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span><span class="co">##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…</span></span>
<span><span class="co">##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…</span></span>
<span><span class="co">##  3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…</span></span>
<span><span class="co">##  4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…</span></span>
<span><span class="co">##  5 Leia Or…    150    49 brown      light      brown           19   fema… femin…</span></span>
<span><span class="co">##  6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…</span></span>
<span><span class="co">##  7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…</span></span>
<span><span class="co">##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…</span></span>
<span><span class="co">##  9 Biggs D…    183    84 black      light      brown           24   male  mascu…</span></span>
<span><span class="co">## 10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…</span></span>
<span><span class="co">## # ℹ 77 more rows</span></span>
<span><span class="co">## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span></span>
<span><span class="co">## #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>We have to use the exported CSV data in python.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>starwars <span class="op">=</span> pd.read_csv(<span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/starwars.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>starwars</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">##               name  height   mass  ...     gender homeworld species</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 0   Luke Skywalker   172.0   77.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 1            C-3PO   167.0   75.0  ...  masculine  Tatooine   Droid</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 2            R2-D2    96.0   32.0  ...  masculine     Naboo   Droid</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 3      Darth Vader   202.0  136.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 4      Leia Organa   150.0   49.0  ...   feminine  Alderaan   Human</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">## ..             ...     ...    ...  ...        ...       ...     ...</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 82             Rey     NaN    NaN  ...   feminine       NaN   Human</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 83     Poe Dameron     NaN    NaN  ...  masculine       NaN   Human</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 84             BB8     NaN    NaN  ...  masculine       NaN   Droid</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 85  Captain Phasma     NaN    NaN  ...        NaN       NaN     NaN</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 86   Padmé Amidala   165.0   45.0  ...   feminine     Naboo   Human</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">## [87 rows x 11 columns]</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimpy <span class="im">import</span> skim</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>skim(starwars)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">## ╭─────────────────────────────── skimpy summary ───────────────────────────────╮</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">## │          Data Summary                Data Types                              │</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓ ┏━━━━━━━━━━━━━┳━━━━━━━┓                       │</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┃ dataframe         ┃ Values ┃ ┃ Column Type ┃ Count ┃                       │</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩ ┡━━━━━━━━━━━━━╇━━━━━━━┩                       │</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ Number of rows    │ 87     │ │ string      │ 8     │                       │</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ Number of columns │ 11     │ │ float64     │ 3     │                       │</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">## │ └───────────────────┴────────┘ └─────────────┴───────┘                       │</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">## │                                   number                                     │</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┏━━━━━━┳━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━┳━━━━┳━━━━━━┳━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┓  │</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┃ colu ┃    ┃       ┃      ┃       ┃    ┃      ┃     ┃      ┃      ┃      ┃  │</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┃ mn_n ┃    ┃       ┃      ┃       ┃    ┃      ┃     ┃      ┃      ┃      ┃  │</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┃ ame  ┃ NA ┃ NA %  ┃ mean ┃ sd    ┃ p0 ┃ p25  ┃ p50 ┃ p75  ┃ p100 ┃ hist ┃  │</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┡━━━━━━╇━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━╇━━━━╇━━━━━━╇━━━━━╇━━━━━━╇━━━━━━╇━━━━━━┩  │</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ heig │  6 │   6.9 │ 174. │ 34.77 │ 66 │  167 │ 180 │  191 │  264 │  ▁   │  │</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ ht   │    │       │    4 │       │    │      │     │      │      │ ▁▇▂  │  │</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ mass │ 28 │ 32.18 │ 97.3 │ 169.5 │ 15 │ 55.6 │  79 │ 84.5 │ 1358 │  ▇   │  │</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │      │    │       │    1 │       │    │      │     │      │      │      │  │</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ birt │ 44 │ 50.57 │ 87.5 │ 154.7 │  8 │   35 │  52 │   72 │  896 │  ▇   │  │</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ h_ye │    │       │    7 │       │    │      │     │      │      │      │  │</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ ar   │    │       │      │       │    │      │     │      │      │      │  │</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">## │ └──────┴────┴───────┴──────┴───────┴────┴──────┴─────┴──────┴──────┴──────┘  │</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">## │                                   string                                     │</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┏━━━━━━━━━━━━━━━━━━┳━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓  │</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┃ column_name      ┃ NA   ┃ NA %    ┃ words per row      ┃ total words    ┃  │</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">## │ ┡━━━━━━━━━━━━━━━━━━╇━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩  │</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ name             │    0 │       0 │                1.8 │            157 │  │</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ hair_color       │    5 │    5.75 │               0.98 │             85 │  │</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ skin_color       │    0 │       0 │                1.2 │            106 │  │</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ eye_color        │    0 │       0 │                  1 │             89 │  │</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ sex              │    4 │     4.6 │               0.95 │             83 │  │</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ gender           │    4 │     4.6 │               0.95 │             83 │  │</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ homeworld        │   10 │   11.49 │               0.98 │             85 │  │</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co">## │ │ species          │    4 │     4.6 │               0.99 │             86 │  │</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co">## │ └──────────────────┴──────┴─────────┴────────────────────┴────────────────┘  │</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">## ╰──────────────────────────────────── End ─────────────────────────────────────╯</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Once the data is set up, filtering the data (selecting certain <strong>rows</strong>) is actually very simple. Of course, we’ve talked about how to use logical indexing before in <a href="../part-gen-prog/03-data-struct.html#sec-indexing" class="quarto-xref"><span>Section 10.5.1</span></a>, but here we’ll focus on using specific functions to perform the same operation.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Base R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>The dplyr verb for selecting rows is <code>filter</code>. <code>filter</code> takes a set of one or more logical conditions, using bare column names and logical operators. Each provided condition is combined using AND.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get only the people</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 35 × 14</span></span>
<span><span class="co">##    name     height  mass hair_color skin_color eye_color birth_year sex   gender</span></span>
<span><span class="co">##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span><span class="co">##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…</span></span>
<span><span class="co">##  2 Darth V…    202   136 none       white      yellow          41.9 male  mascu…</span></span>
<span><span class="co">##  3 Leia Or…    150    49 brown      light      brown           19   fema… femin…</span></span>
<span><span class="co">##  4 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…</span></span>
<span><span class="co">##  5 Beru Wh…    165    75 brown      light      blue            47   fema… femin…</span></span>
<span><span class="co">##  6 Biggs D…    183    84 black      light      brown           24   male  mascu…</span></span>
<span><span class="co">##  7 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…</span></span>
<span><span class="co">##  8 Anakin …    188    84 blond      fair       blue            41.9 male  mascu…</span></span>
<span><span class="co">##  9 Wilhuff…    180    NA auburn, g… fair       blue            64   male  mascu…</span></span>
<span><span class="co">## 10 Han Solo    180    80 brown      fair       brown           29   male  mascu…</span></span>
<span><span class="co">## # ℹ 25 more rows</span></span>
<span><span class="co">## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span></span>
<span><span class="co">## #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></span>
<span></span>
<span><span class="co"># Get only the people who come from Tatooine</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span>, <span class="va">homeworld</span> <span class="op">==</span> <span class="st">"Tatooine"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 8 × 14</span></span>
<span><span class="co">##   name      height  mass hair_color skin_color eye_color birth_year sex   gender</span></span>
<span><span class="co">##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span><span class="co">## 1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…</span></span>
<span><span class="co">## 2 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…</span></span>
<span><span class="co">## 3 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…</span></span>
<span><span class="co">## 4 Beru Whi…    165    75 brown      light      blue            47   fema… femin…</span></span>
<span><span class="co">## 5 Biggs Da…    183    84 black      light      brown           24   male  mascu…</span></span>
<span><span class="co">## 6 Anakin S…    188    84 blond      fair       blue            41.9 male  mascu…</span></span>
<span><span class="co">## 7 Shmi Sky…    163    NA black      fair       brown           72   fema… femin…</span></span>
<span><span class="co">## 8 Cliegg L…    183    NA brown      fair       blue            82   male  mascu…</span></span>
<span><span class="co">## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span></span>
<span><span class="co">## #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get only the people</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>starwars.query(<span class="st">"species == 'Human'"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">##                    name  height   mass  ...     gender     homeworld species</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0        Luke Skywalker   172.0   77.0  ...  masculine      Tatooine   Human</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 3           Darth Vader   202.0  136.0  ...  masculine      Tatooine   Human</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 4           Leia Organa   150.0   49.0  ...   feminine      Alderaan   Human</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 5             Owen Lars   178.0  120.0  ...  masculine      Tatooine   Human</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 6    Beru Whitesun lars   165.0   75.0  ...   feminine      Tatooine   Human</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 8     Biggs Darklighter   183.0   84.0  ...  masculine      Tatooine   Human</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 9        Obi-Wan Kenobi   182.0   77.0  ...  masculine       Stewjon   Human</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 10     Anakin Skywalker   188.0   84.0  ...  masculine      Tatooine   Human</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 11       Wilhuff Tarkin   180.0    NaN  ...  masculine        Eriadu   Human</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 13             Han Solo   180.0   80.0  ...  masculine      Corellia   Human</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 16       Wedge Antilles   170.0   77.0  ...  masculine      Corellia   Human</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 17     Jek Tono Porkins   180.0  110.0  ...  masculine    Bestine IV   Human</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 19            Palpatine   170.0   75.0  ...  masculine         Naboo   Human</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 20            Boba Fett   183.0   78.2  ...  masculine        Kamino   Human</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 23     Lando Calrissian   177.0   79.0  ...  masculine       Socorro   Human</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 24                Lobot   175.0   79.0  ...  masculine        Bespin   Human</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 26           Mon Mothma   150.0    NaN  ...   feminine     Chandrila   Human</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 27         Arvel Crynyd     NaN    NaN  ...  masculine           NaN   Human</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 30         Qui-Gon Jinn   193.0   89.0  ...  masculine           NaN   Human</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 32        Finis Valorum   170.0    NaN  ...  masculine     Coruscant   Human</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 40       Shmi Skywalker   163.0    NaN  ...   feminine      Tatooine   Human</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 47           Mace Windu   188.0   84.0  ...  masculine    Haruun Kal   Human</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 56         Gregar Typho   185.0   85.0  ...  masculine         Naboo   Human</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">## 57                Cordé   157.0    NaN  ...   feminine         Naboo   Human</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">## 58          Cliegg Lars   183.0    NaN  ...  masculine      Tatooine   Human</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 62                Dormé   165.0    NaN  ...   feminine         Naboo   Human</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 63                Dooku   193.0   80.0  ...  masculine       Serenno   Human</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">## 64  Bail Prestor Organa   191.0    NaN  ...  masculine      Alderaan   Human</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">## 65           Jango Fett   183.0   79.0  ...  masculine  Concord Dawn   Human</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">## 70           Jocasta Nu   167.0    NaN  ...   feminine     Coruscant   Human</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">## 78      Raymus Antilles   188.0   79.0  ...  masculine      Alderaan   Human</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">## 81                 Finn     NaN    NaN  ...  masculine           NaN   Human</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">## 82                  Rey     NaN    NaN  ...   feminine           NaN   Human</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">## 83          Poe Dameron     NaN    NaN  ...  masculine           NaN   Human</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">## 86        Padmé Amidala   165.0   45.0  ...   feminine         Naboo   Human</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">## [35 rows x 11 columns]</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Get only the people who come from Tattoine</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>starwars.query(<span class="st">"species == 'Human' &amp; homeworld == 'Tatooine'"</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">##                   name  height   mass  ...     gender homeworld species</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">## 0       Luke Skywalker   172.0   77.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">## 3          Darth Vader   202.0  136.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co">## 5            Owen Lars   178.0  120.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">## 6   Beru Whitesun lars   165.0   75.0  ...   feminine  Tatooine   Human</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co">## 8    Biggs Darklighter   183.0   84.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co">## 10    Anakin Skywalker   188.0   84.0  ...  masculine  Tatooine   Human</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co">## 40      Shmi Skywalker   163.0    NaN  ...   feminine  Tatooine   Human</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co">## 58         Cliegg Lars   183.0    NaN  ...  masculine  Tatooine   Human</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co">## [8 rows x 11 columns]</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># This is another option if you prefer to keep the queries separate</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co"># starwars.query("species == 'Human'").query("homeworld == 'Tatooine'")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>In base R, you would perform a filtering operation using <code>subset</code></p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get only the people</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 35 × 14</span></span>
<span><span class="co">##    name     height  mass hair_color skin_color eye_color birth_year sex   gender</span></span>
<span><span class="co">##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span><span class="co">##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…</span></span>
<span><span class="co">##  2 Darth V…    202   136 none       white      yellow          41.9 male  mascu…</span></span>
<span><span class="co">##  3 Leia Or…    150    49 brown      light      brown           19   fema… femin…</span></span>
<span><span class="co">##  4 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…</span></span>
<span><span class="co">##  5 Beru Wh…    165    75 brown      light      blue            47   fema… femin…</span></span>
<span><span class="co">##  6 Biggs D…    183    84 black      light      brown           24   male  mascu…</span></span>
<span><span class="co">##  7 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…</span></span>
<span><span class="co">##  8 Anakin …    188    84 blond      fair       blue            41.9 male  mascu…</span></span>
<span><span class="co">##  9 Wilhuff…    180    NA auburn, g… fair       blue            64   male  mascu…</span></span>
<span><span class="co">## 10 Han Solo    180    80 brown      fair       brown           29   male  mascu…</span></span>
<span><span class="co">## # ℹ 25 more rows</span></span>
<span><span class="co">## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span></span>
<span><span class="co">## #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></span>
<span></span>
<span><span class="co"># Get only the people who come from Tatooine</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span> <span class="op">&amp;</span> <span class="va">homeworld</span> <span class="op">==</span> <span class="st">"Tatooine"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 8 × 14</span></span>
<span><span class="co">##   name      height  mass hair_color skin_color eye_color birth_year sex   gender</span></span>
<span><span class="co">##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span></span>
<span><span class="co">## 1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…</span></span>
<span><span class="co">## 2 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…</span></span>
<span><span class="co">## 3 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…</span></span>
<span><span class="co">## 4 Beru Whi…    165    75 brown      light      blue            47   fema… femin…</span></span>
<span><span class="co">## 5 Biggs Da…    183    84 black      light      brown           24   male  mascu…</span></span>
<span><span class="co">## 6 Anakin S…    188    84 blond      fair       blue            41.9 male  mascu…</span></span>
<span><span class="co">## 7 Shmi Sky…    163    NA black      fair       brown           72   fema… femin…</span></span>
<span><span class="co">## 8 Cliegg L…    183    NA brown      fair       blue            82   male  mascu…</span></span>
<span><span class="co">## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,</span></span>
<span><span class="co">## #   vehicles &lt;list&gt;, starships &lt;list&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that with <code>subset</code>, you have to use <code>&amp;</code> to join two logical statements; it does not by default take multiple successive arguments.</p>
</div>
</div>
</div>
</div>
</div>
<section id="common-row-selection-tasks" class="level3" data-number="22.4.1"><h3 data-number="22.4.1" class="anchored" data-anchor-id="common-row-selection-tasks">
<span class="header-section-number">22.4.1</span> Common Row Selection Tasks</h3>
<p>In <code>dplyr</code>, there are a few helper functions which may be useful when constructing filter statements. In base R or python, these tasks are still important, and so I’ll do my best to show you easy ways to handle each task in each language.</p>
<section id="filtering-by-row-number" class="level4 callout-demo" data-collapse="true" data-number="22.4.1.1"><h4 data-number="22.4.1.1" class="anchored" data-anchor-id="filtering-by-row-number">
<span class="header-section-number">22.4.1.1</span> Filtering by row number</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Base R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><code><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number()</a></code> is a helper function that is only used inside of another dplyr function (e.g.&nbsp;filter). You might want to keep only even rows, or only the first 10 rows in a table.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">poke</span>, <span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">## # A tibble: 763 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     1          2 https://img.… Ivys… &lt;NA&gt;    Gras…   405    60     62      63</span></span>
<span><span class="co">##  2     1          3 https://img.… Venu… Mega    Gras…   625    80    100     123</span></span>
<span><span class="co">##  3     1          5 https://img.… Char… &lt;NA&gt;    Fire    405    58     64      58</span></span>
<span><span class="co">##  4     1          6 https://img.… Char… Mega  X Fire…   634    78    130     111</span></span>
<span><span class="co">##  5     1          7 https://img.… Squi… &lt;NA&gt;    Water   314    44     48      65</span></span>
<span><span class="co">##  6     1          9 https://img.… Blas… &lt;NA&gt;    Water   530    79     83     100</span></span>
<span><span class="co">##  7     1         10 https://img.… Cate… &lt;NA&gt;    Bug     195    45     30      35</span></span>
<span><span class="co">##  8     1         12 https://img.… Butt… &lt;NA&gt;    Bug,…   395    60     45      50</span></span>
<span><span class="co">##  9     1         14 https://img.… Kaku… &lt;NA&gt;    Bug,…   205    45     25      50</span></span>
<span><span class="co">## 10     1         15 https://img.… Beed… Mega    Bug,…   495    65    150      40</span></span>
<span><span class="co">## # ℹ 753 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span>
<span><span class="co"># There are several pokemon who have multiple entries in the table,</span></span>
<span><span class="co"># so the pokedex_number doesn't line up with the row number.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>In python, the easiest way to accomplish filtering by row number is by using <code>.iloc</code>. But, up until now, we’ve only talked about how Python creates slices using <code>start:(end+1)</code> notation. There is an additional option with slicing - <code>start:(end+1):by</code>. So if we want to get only even rows, we can use the index <code>[::2]</code>, which will give us row 0, 2, 4, 6, … through the end of the dataset, because we didn’t specify the start and end portions of the slice.</p>
<p>Because Python is 0-indexed, using <code>::2</code> will give us the opposite set of rows from that returned in R, which is 1-indexed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> pd.read_csv(<span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>poke.iloc[<span class="dv">0</span>::<span class="dv">2</span>]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">##       gen  pokedex_no  ... height_m weight_kg</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0       1           1  ...      0.7       6.9</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 2       1           3  ...      2.0     100.0</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 4       1           4  ...      0.6       8.5</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 6       1           6  ...      1.7      90.5</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 8       1           6  ...      1.7      90.5</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">## ...   ...         ...  ...      ...       ...</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 1516    9         999  ...      0.3       5.0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 1518    9        1001  ...      1.5      74.2</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 1520    9        1003  ...      2.7     699.7</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 1522    9        1005  ...      2.0     380.0</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 1524    9        1007  ...      2.5     303.0</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">## [763 rows x 16 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we want to get only odd rows, we can use the index <code>[1::2]</code>, which will start at row 1 and give us 1, 3, 5, …</p>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>In base R, we’d use <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> to create an index vector instead of using the approach in filter and evaluating the whole index for a logical condition. Alternately, we can use <code>subset</code>, which requires a logical condition, and use <code>1:nrow(poke)</code> to create an index which we then use for deciding whether each row is even or odd.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">poke</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co">## # A tibble: 763 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     1          1 https://img.… Bulb… &lt;NA&gt;    Gras…   318    45     49      49</span></span>
<span><span class="co">##  2     1          3 https://img.… Venu… &lt;NA&gt;    Gras…   525    80     82      83</span></span>
<span><span class="co">##  3     1          4 https://img.… Char… &lt;NA&gt;    Fire    309    39     52      43</span></span>
<span><span class="co">##  4     1          6 https://img.… Char… &lt;NA&gt;    Fire…   534    78     84      78</span></span>
<span><span class="co">##  5     1          6 https://img.… Char… Mega  Y Fire…   634    78    104      78</span></span>
<span><span class="co">##  6     1          8 https://img.… Wart… &lt;NA&gt;    Water   405    59     63      80</span></span>
<span><span class="co">##  7     1          9 https://img.… Blas… Mega    Water   630    79    103     120</span></span>
<span><span class="co">##  8     1         11 https://img.… Meta… &lt;NA&gt;    Bug     205    50     20      55</span></span>
<span><span class="co">##  9     1         13 https://img.… Weed… &lt;NA&gt;    Bug,…   195    40     35      30</span></span>
<span><span class="co">## 10     1         15 https://img.… Beed… &lt;NA&gt;    Bug,…   395    65     90      40</span></span>
<span><span class="co">## # ℹ 753 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">poke</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">poke</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 763 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     1          2 https://img.… Ivys… &lt;NA&gt;    Gras…   405    60     62      63</span></span>
<span><span class="co">##  2     1          3 https://img.… Venu… Mega    Gras…   625    80    100     123</span></span>
<span><span class="co">##  3     1          5 https://img.… Char… &lt;NA&gt;    Fire    405    58     64      58</span></span>
<span><span class="co">##  4     1          6 https://img.… Char… Mega  X Fire…   634    78    130     111</span></span>
<span><span class="co">##  5     1          7 https://img.… Squi… &lt;NA&gt;    Water   314    44     48      65</span></span>
<span><span class="co">##  6     1          9 https://img.… Blas… &lt;NA&gt;    Water   530    79     83     100</span></span>
<span><span class="co">##  7     1         10 https://img.… Cate… &lt;NA&gt;    Bug     195    45     30      35</span></span>
<span><span class="co">##  8     1         12 https://img.… Butt… &lt;NA&gt;    Bug,…   395    60     45      50</span></span>
<span><span class="co">##  9     1         14 https://img.… Kaku… &lt;NA&gt;    Bug,…   205    45     25      50</span></span>
<span><span class="co">## 10     1         15 https://img.… Beed… Mega    Bug,…   495    65    150      40</span></span>
<span><span class="co">## # ℹ 753 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is less fun than using <code>dplyr</code> because you have to repeat the name of the dataset at least twice using base R, but either option will get you where you’re going. The real power of <code>dplyr</code> is in the collection of the full set of verbs with a consistent user interface; nothing done in <code>dplyr</code> is so special that it can’t be done in base R as well.</p>
</div>
</div>
</div>
</section><section id="sorting-rows-by-variable-values" class="level4 callout-demo" data-collapse="true" data-number="22.4.1.2"><h4 data-number="22.4.1.2" class="anchored" data-anchor-id="sorting-rows-by-variable-values">
<span class="header-section-number">22.4.1.2</span> Sorting rows by variable values</h4>
<p>Another common operation is to sort your data frame by the values of one or more variables.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Base R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> is a dplyr verb for sort rows in the table by one or more variables. It is often used with a helper function, <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code>, which reverses the order of a variable, sorting it in descending order. Multiple arguments can be passed to <code>arrange</code> to sort the data frame by multiple columns hierarchically; each column can be modified with <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> separately.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">poke</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1,526 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     8        890 https://img.… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">##  2     1        150 https://img.… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">##  3     1        150 https://img.… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">##  4     3        384 https://img.… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">##  5     3        382 https://img.… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">##  6     3        383 https://img.… Grou… Primal  Grou…   770   100    180     160</span></span>
<span><span class="co">##  7     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  8     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  9     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">## 10     4        493 https://img.… Arce… &lt;NA&gt;    Norm…   720   120    120     120</span></span>
<span><span class="co">## # ℹ 1,516 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>In pandas, we use the <code>sort_values</code> function, which has an argument <code>ascending</code>. Multiple columns can be passed in to sort by multiple columns in a hierarchical manner.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>poke.sort_values([<span class="st">'total'</span>], ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">##       gen  pokedex_no  ... height_m weight_kg</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 1370    8         890  ...     20.0     950.0</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 282     1         150  ...      2.0     122.0</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 283     1         150  ...      2.0     122.0</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 584     3         384  ...      7.0     206.5</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 580     3         382  ...      4.5     352.0</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">## ...   ...         ...  ...      ...       ...</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1336    8         872  ...      0.3       3.8</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 328     2         191  ...      0.3       1.8</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 1283    8         824  ...      0.4       8.0</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 1187    7         746  ...      0.2       0.3</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 1188    7         746  ...      0.2       0.3</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">## [1526 rows x 16 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>The <code><a href="https://rdrr.io/r/base/sort.html">sort()</a></code> function in R can be used to sort a vector, but when sorting a data frame we usually want to use the <code><a href="https://rdrr.io/r/base/order.html">order()</a></code> function instead. This is because <code><a href="https://rdrr.io/r/base/sort.html">sort()</a></code> orders the values of the argument directly, where <code><a href="https://rdrr.io/r/base/order.html">order()</a></code> returns a sorted index.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">25</span>, <span class="fl">98</span>, <span class="fl">45</span>, <span class="fl">31</span>, <span class="fl">19</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">## [1]  5 19 25 31 32 45 98</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">## [1] 7 6 2 5 1 4 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When working with a data frame, we want to sort the entire data frame’s rows by the variables we choose; it is easiest to do this using an index to reorder the rows.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">poke</span><span class="op">$</span><span class="va">total</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co">## # A tibble: 1,526 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     8        890 https://img.… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">##  2     1        150 https://img.… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">##  3     1        150 https://img.… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">##  4     3        384 https://img.… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">##  5     3        382 https://img.… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">##  6     3        383 https://img.… Grou… Primal  Grou…   770   100    180     160</span></span>
<span><span class="co">##  7     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  8     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  9     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">## 10     4        493 https://img.… Arce… &lt;NA&gt;    Norm…   720   120    120     120</span></span>
<span><span class="co">## # ℹ 1,516 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="keep-the-top-n-values-of-a-variable" class="level4 callout-demo" data-collapse="true" data-number="22.4.1.3"><h4 data-number="22.4.1.3" class="anchored" data-anchor-id="keep-the-top-n-values-of-a-variable">
<span class="header-section-number">22.4.1.3</span> Keep the top <span class="math inline">\(n\)</span> values of a variable</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Base R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> will keep the top values of a specified variable. This is like a filter statement, but it’s a shortcut built to handle a common task. You could write a filter statement that would do this, but it would take a few more lines of code.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">poke</span>, order_by <span class="op">=</span> <span class="va">total</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 16</span></span>
<span><span class="co">##     gen pokedex_no img_link       name  variant type  total    hp attack defense</span></span>
<span><span class="co">##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">## 1     8        890 https://img.p… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">## 2     1        150 https://img.p… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">## 3     1        150 https://img.p… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">## 4     3        384 https://img.p… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">## 5     3        382 https://img.p… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">## 6     3        383 https://img.p… Grou… Primal  Grou…   770   100    180     160</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> returns values tied with the nth value as well, which is why our result has 6 rows.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">poke</span>, order_by <span class="op">=</span> <span class="va">total</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> </span>
<span><span class="co">## # A tibble: 5 × 16</span></span>
<span><span class="co">##     gen pokedex_no img_link       name  variant type  total    hp attack defense</span></span>
<span><span class="co">##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">## 1     8        890 https://img.p… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">## 2     1        150 https://img.p… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">## 3     1        150 https://img.p… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">## 4     3        384 https://img.p… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">## 5     3        382 https://img.p… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Of course, there is a similar <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> function as well:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min</a></span><span class="op">(</span><span class="va">poke</span>, order_by <span class="op">=</span> <span class="va">total</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 16</span></span>
<span><span class="co">##     gen pokedex_no img_link       name  variant type  total    hp attack defense</span></span>
<span><span class="co">##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">## 1     7        746 https://img.p… Wish… Solo    Water   175    45     20      20</span></span>
<span><span class="co">## 2     7        746 https://img.p… Wish… Solo    Water   175    45     20      20</span></span>
<span><span class="co">## 3     2        191 https://img.p… Sunk… &lt;NA&gt;    Grass   180    30     30      30</span></span>
<span><span class="co">## 4     8        824 https://img.p… Blip… &lt;NA&gt;    Bug     180    25     20      20</span></span>
<span><span class="co">## 5     8        872 https://img.p… Snom  &lt;NA&gt;    Ice,…   185    30     25      35</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>slice_max</code> and <code>slice_min</code> also take a <code>prop</code> argument that gives you a certain proportion of the values:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">poke</span>, order_by <span class="op">=</span> <span class="va">total</span>, prop <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 30 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     8        890 https://img.… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">##  2     1        150 https://img.… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">##  3     1        150 https://img.… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">##  4     3        384 https://img.… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">##  5     3        382 https://img.… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">##  6     3        383 https://img.… Grou… Primal  Grou…   770   100    180     160</span></span>
<span><span class="co">##  7     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  8     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  9     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">## 10     4        493 https://img.… Arce… &lt;NA&gt;    Norm…   720   120    120     120</span></span>
<span><span class="co">## # ℹ 20 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>In Python, <code>nlargest</code> and <code>nsmallest</code> work roughly the same as <code>dplyr</code>’s <code>slice_max</code> and <code>slice_min</code> for integer counts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>poke.nlargest(<span class="dv">5</span>, <span class="st">'total'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">##       gen  pokedex_no  ... height_m weight_kg</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 1370    8         890  ...     20.0     950.0</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 282     1         150  ...      2.0     122.0</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 283     1         150  ...      2.0     122.0</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 584     3         384  ...      7.0     206.5</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 580     3         382  ...      4.5     352.0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 16 columns]</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>poke.nsmallest(<span class="dv">5</span>, <span class="st">'total'</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">##       gen  pokedex_no  ... height_m weight_kg</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 1187    7         746  ...      0.2       0.3</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 1188    7         746  ...      0.2       0.3</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 328     2         191  ...      0.3       1.8</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 1283    8         824  ...      0.4       8.0</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 1336    8         872  ...      0.3       3.8</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 16 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get proportions, though, we have to do some math:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>poke.nlargest(<span class="bu">int</span>(<span class="bu">len</span>(poke)<span class="op">*</span><span class="fl">0.01</span>), <span class="st">'total'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">##       gen  pokedex_no  ... height_m weight_kg</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 1370    8         890  ...     20.0     950.0</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 282     1         150  ...      2.0     122.0</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 283     1         150  ...      2.0     122.0</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 584     3         384  ...      7.0     206.5</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 580     3         382  ...      4.5     352.0</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 582     3         383  ...      3.5     950.0</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1257    7         800  ...      2.4     230.0</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 1258    7         800  ...      2.4     230.0</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 1259    7         800  ...      2.4     230.0</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 779     4         493  ...      3.2     320.0</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 1126    6         718  ...      5.0     305.0</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 1127    6         718  ...      5.0     305.0</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 1128    6         718  ...      5.0     305.0</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 405     2         248  ...      2.0     202.0</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 567     3         373  ...      1.5     102.6</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">## [15 rows x 16 columns]</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>poke.nsmallest(<span class="bu">int</span>(<span class="bu">len</span>(poke)<span class="op">*</span><span class="fl">0.01</span>), <span class="st">'total'</span>)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">##       gen  pokedex_no  ... height_m weight_kg</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 1187    7         746  ...      0.2       0.3</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 1188    7         746  ...      0.2       0.3</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 328     2         191  ...      0.3       1.8</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 1283    8         824  ...      0.4       8.0</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 1336    8         872  ...      0.3       3.8</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co">## 465     3         298  ...      0.2       2.0</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">## 616     4         401  ...      0.3       2.2</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 13      1          10  ...      0.3       2.9</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 16      1          13  ...      0.3       3.2</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co">## 431     3         265  ...      0.3       3.6</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co">## 446     3         280  ...      0.4       6.6</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="co">## 248     1         129  ...      0.9      10.0</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="co">## 524     3         349  ...      0.6       7.4</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">## 1032    6         664  ...      0.3       2.5</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co">## 1237    7         789  ...      0.2       0.1</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co">## [15 rows x 16 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<p>The simplest way to do this type of task with base R is to combine the order() function and indexing. In the case of selecting the top 1% of rows, we need to use round(nrow(poke)*.01) to get an integer.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">poke</span><span class="op">$</span><span class="va">total</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,<span class="op">]</span></span>
<span><span class="co">## # A tibble: 5 × 16</span></span>
<span><span class="co">##     gen pokedex_no img_link       name  variant type  total    hp attack defense</span></span>
<span><span class="co">##   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">## 1     8        890 https://img.p… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">## 2     1        150 https://img.p… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">## 3     1        150 https://img.p… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">## 4     3        384 https://img.p… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">## 5     3        382 https://img.p… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span>
<span><span class="va">poke</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">poke</span><span class="op">$</span><span class="va">total</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">poke</span><span class="op">)</span><span class="op">*</span><span class="fl">.01</span><span class="op">)</span><span class="op">]</span>,<span class="op">]</span></span>
<span><span class="co">## # A tibble: 15 × 16</span></span>
<span><span class="co">##      gen pokedex_no img_link      name  variant type  total    hp attack defense</span></span>
<span><span class="co">##    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1     8        890 https://img.… Eter… Eterna… Pois…  1125   255    115     250</span></span>
<span><span class="co">##  2     1        150 https://img.… Mewt… Mega  X Psyc…   780   106    190     100</span></span>
<span><span class="co">##  3     1        150 https://img.… Mewt… Mega  Y Psyc…   780   106    150      70</span></span>
<span><span class="co">##  4     3        384 https://img.… Rayq… Mega    Drag…   780   105    180     100</span></span>
<span><span class="co">##  5     3        382 https://img.… Kyog… Primal  Water   770   100    150      90</span></span>
<span><span class="co">##  6     3        383 https://img.… Grou… Primal  Grou…   770   100    180     160</span></span>
<span><span class="co">##  7     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  8     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">##  9     7        800 https://img.… Necr… Ultra   Psyc…   754    97    167      97</span></span>
<span><span class="co">## 10     4        493 https://img.… Arce… &lt;NA&gt;    Norm…   720   120    120     120</span></span>
<span><span class="co">## 11     6        718 https://img.… Zyga… Comple… Drag…   708   216    100     121</span></span>
<span><span class="co">## 12     6        718 https://img.… Zyga… Comple… Drag…   708   216    100     121</span></span>
<span><span class="co">## 13     6        718 https://img.… Zyga… Comple… Drag…   708   216    100     121</span></span>
<span><span class="co">## 14     2        248 https://img.… Tyra… Mega    Rock…   700   100    164     150</span></span>
<span><span class="co">## 15     3        373 https://img.… Sala… Mega    Drag…   700    95    145     130</span></span>
<span><span class="co">## # ℹ 6 more variables: sp_attack &lt;dbl&gt;, sp_defense &lt;dbl&gt;, speed &lt;dbl&gt;,</span></span>
<span><span class="co">## #   species &lt;chr&gt;, height_m &lt;dbl&gt;, weight_kg &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it out: Filtering
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Problem</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">Base R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>Use the <a href="https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv">Pokemon data</a> to accomplish the following:</p>
<ul>
<li>create a new data frame that has only water type Pokemon</li>
<li>write a filter statement that looks for any Pokemon which has water type for either type1 or type2</li>
</ul>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">type_1</span> <span class="op">==</span> <span class="st">"Water"</span><span class="op">)</span></span>
<span><span class="co">## Error in `filter()`:</span></span>
<span><span class="co">## ℹ In argument: `type_1 == "Water"`.</span></span>
<span><span class="co">## Caused by error:</span></span>
<span><span class="co">## ! object 'type_1' not found</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">type_1</span> <span class="op">==</span> <span class="st">"Water"</span> <span class="op">|</span> <span class="va">type_2</span> <span class="op">==</span> <span class="st">"Water"</span><span class="op">)</span></span>
<span><span class="co">## Error in `filter()`:</span></span>
<span><span class="co">## ℹ In argument: `type_1 == "Water" | type_2 == "Water"`.</span></span>
<span><span class="co">## Caused by error:</span></span>
<span><span class="co">## ! object 'type_1' not found</span></span>
<span><span class="co"># The conditions have to be separated by |, which means "or"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> pd.read_csv(<span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>poke.query(<span class="st">"type_1=='Water'"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">## pandas.errors.UndefinedVariableError: name 'type_1' is not defined</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>poke.query(<span class="st">"type_1=='Water'|type_2=='Water'"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">## pandas.errors.UndefinedVariableError: name 'type_1' is not defined</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The conditions have to be separated by |, which means "or"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">type_1</span> <span class="op">==</span> <span class="st">"Water"</span><span class="op">)</span></span>
<span><span class="co">## Error in eval(e, x, parent.frame()): object 'type_1' not found</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">type_1</span> <span class="op">==</span> <span class="st">"Water"</span> <span class="op">|</span> <span class="va">type_2</span> <span class="op">==</span> <span class="st">"Water"</span><span class="op">)</span></span>
<span><span class="co">## Error in eval(e, x, parent.frame()): object 'type_1' not found</span></span>
<span><span class="co"># The conditions have to be separated by |, which means "or"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="select-pick-columns" class="level2" data-number="22.5"><h2 data-number="22.5" class="anchored" data-anchor-id="select-pick-columns">
<span class="header-section-number">22.5</span> Select: Pick columns</h2>
<p>Sometimes, we don’t want to work with a set of 50 variables when we’re only interested in 5. When that happens, we might be able to pick the variables we want by index (e.g.&nbsp;<code>df[, c(1, 3, 5)]</code>), but this can get tedious.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Base R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>In <code>dplyr</code>, the function to pick a few columns is <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. The syntax from the help file (<code><a href="https://dplyr.tidyverse.org/reference/select.html">?select</a></code>) looks deceptively simple.</p>
<blockquote class="blockquote">
<p>select(.data, …)</p>
</blockquote>
<p>So as with just about every other tidyverse function, the first argument in a select statement is the data. After that, though, you can put just about anything that R can interpret. <code>...</code> means something along the lines of “put in any additional arguments that make sense in context or might be passed on to other functions”.</p>
<p>So what can go in there?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ways to select variables in <code>dplyr</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First, dplyr aims to work with standard R syntax, making it intuitive (and also, making it work with variable names instead of just variable indices).<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a><br>
Most <code>dplyr</code> commands work with “bare” variable names - you don’t need to put the variable name in quotes to reference it. There are a few exceptions to this rule, but they’re very explicitly exceptions.</p>
<ul>
<li><p><code>var3:var5</code>: <code>select(df, var3:var5)</code> will give you a data frame with columns var3, anything between var3 and var 5, and var5</p></li>
<li>
<p><code>!(&lt;set of variables&gt;)</code> will give you any columns that aren’t in the set of variables in parentheses</p>
<ul>
<li>
<code>(&lt;set of vars 1&gt;) &amp; (&lt;set of vars 2&gt;)</code> will give you any variables that are in both set 1 and set 2. <code>(&lt;set of vars 1&gt;) | (&lt;set of vars 2&gt;)</code> will give you any variables that are in either set 1 or set 2.</li>
<li>
<code><a href="https://rdrr.io/r/base/c.html">c()</a></code> combines sets of variables.</li>
</ul>
</li>
</ul>
<p><code>dplyr</code> also defines a lot of variable selection “helpers” that can be used inside <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> statements. These statements work with bare column names (so you don’t have to put quotes around the column names when you use them).</p>
<ul>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> matches all variables</li>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col()</a></code> matches the last variable. <code>last_col(offset = n)</code> selects the n-th to last variable.</li>
<li>
<code>starts_with("xyz")</code> will match any columns with names that start with xyz. Similarly, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code> does exactly what you’d expect as well.</li>
<li>
<code>contains("xyz")</code> will match any columns with names containing the literal string “xyz”. Note, <code>contains</code> does not work with regular expressions (you don’t need to know what that means right now).</li>
<li>
<code>matches(regex)</code> takes a regular expression as an argument and returns all columns matching that expression.</li>
<li>
<code>num_range(prefix, range)</code> selects any columns that start with prefix and have numbers matching the provided numerical range.</li>
</ul>
<p>There are also selectors that deal with character vectors. These can be useful if you have a list of important variables and want to just keep those variables.</p>
<ul>
<li>
<code>all_of(char)</code> matches all variable names in the character vector <code>char</code>. If one of the variables doesn’t exist, this will return an error.</li>
<li>
<code>any_of(char)</code> matches the contents of the character vector <code>char</code>, but does not throw an error if the variable doesn’t exist in the data set.</li>
</ul>
<p>There’s one final selector -</p>
<ul>
<li>
<code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> applies a function to each variable and selects those for which the function returns TRUE. This provides a lot of flexibility and opportunity to be creative.</li>
</ul>
</div>
</div>
</div>
<p>Let’s try these selector functions out and see what we can accomplish!</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span>
<span><span class="co">## tibble [336,776 × 19] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ year          : int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...</span></span>
<span><span class="co">##  $ month         : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ day           : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ dep_time      : int [1:336776] 517 533 542 544 554 554 555 557 557 558 ...</span></span>
<span><span class="co">##  $ sched_dep_time: int [1:336776] 515 529 540 545 600 558 600 600 600 600 ...</span></span>
<span><span class="co">##  $ dep_delay     : num [1:336776] 2 4 2 -1 -6 -4 -5 -3 -3 -2 ...</span></span>
<span><span class="co">##  $ arr_time      : int [1:336776] 830 850 923 1004 812 740 913 709 838 753 ...</span></span>
<span><span class="co">##  $ sched_arr_time: int [1:336776] 819 830 850 1022 837 728 854 723 846 745 ...</span></span>
<span><span class="co">##  $ arr_delay     : num [1:336776] 11 20 33 -18 -25 12 19 -14 -8 8 ...</span></span>
<span><span class="co">##  $ carrier       : chr [1:336776] "UA" "UA" "AA" "B6" ...</span></span>
<span><span class="co">##  $ flight        : int [1:336776] 1545 1714 1141 725 461 1696 507 5708 79 301 ...</span></span>
<span><span class="co">##  $ tailnum       : chr [1:336776] "N14228" "N24211" "N619AA" "N804JB" ...</span></span>
<span><span class="co">##  $ origin        : chr [1:336776] "EWR" "LGA" "JFK" "JFK" ...</span></span>
<span><span class="co">##  $ dest          : chr [1:336776] "IAH" "IAH" "MIA" "BQN" ...</span></span>
<span><span class="co">##  $ air_time      : num [1:336776] 227 227 160 183 116 150 158 53 140 138 ...</span></span>
<span><span class="co">##  $ distance      : num [1:336776] 1400 1416 1089 1576 762 ...</span></span>
<span><span class="co">##  $ hour          : num [1:336776] 5 5 5 5 6 5 6 6 6 6 ...</span></span>
<span><span class="co">##  $ minute        : num [1:336776] 15 29 40 45 0 58 0 0 0 0 ...</span></span>
<span><span class="co">##  $ time_hour     : POSIXct[1:336776], format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll start out with the <code>nycflights13</code> package, which contains information on all flights that left a NYC airport to destinations in the US, Puerto Rico, and the US Virgin Islands.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You might want to try out your EDA (Exploratory Data Analysis) skills to see what you can find out about the dataset, before seeing how <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> works.</p>
</div>
</div>
<p>We could get a data frame of departure information for each flight:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">flight</span>, <span class="va">year</span><span class="op">:</span><span class="va">day</span>, <span class="va">tailnum</span>, <span class="va">origin</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"dep"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 336,776 × 9</span></span>
<span><span class="co">##    flight  year month   day tailnum origin dep_time sched_dep_time dep_delay</span></span>
<span><span class="co">##     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1   1545  2013     1     1 N14228  EWR         517            515         2</span></span>
<span><span class="co">##  2   1714  2013     1     1 N24211  LGA         533            529         4</span></span>
<span><span class="co">##  3   1141  2013     1     1 N619AA  JFK         542            540         2</span></span>
<span><span class="co">##  4    725  2013     1     1 N804JB  JFK         544            545        -1</span></span>
<span><span class="co">##  5    461  2013     1     1 N668DN  LGA         554            600        -6</span></span>
<span><span class="co">##  6   1696  2013     1     1 N39463  EWR         554            558        -4</span></span>
<span><span class="co">##  7    507  2013     1     1 N516JB  EWR         555            600        -5</span></span>
<span><span class="co">##  8   5708  2013     1     1 N829AS  LGA         557            600        -3</span></span>
<span><span class="co">##  9     79  2013     1     1 N593JB  JFK         557            600        -3</span></span>
<span><span class="co">## 10    301  2013     1     1 N3ALAA  LGA         558            600        -2</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perhaps we want the plane and flight ID information to be the first columns:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">carrier</span><span class="op">:</span><span class="va">dest</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 336,776 × 19</span></span>
<span><span class="co">##    carrier flight tailnum origin dest   year month   day dep_time sched_dep_time</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 UA        1545 N14228  EWR    IAH    2013     1     1      517            515</span></span>
<span><span class="co">##  2 UA        1714 N24211  LGA    IAH    2013     1     1      533            529</span></span>
<span><span class="co">##  3 AA        1141 N619AA  JFK    MIA    2013     1     1      542            540</span></span>
<span><span class="co">##  4 B6         725 N804JB  JFK    BQN    2013     1     1      544            545</span></span>
<span><span class="co">##  5 DL         461 N668DN  LGA    ATL    2013     1     1      554            600</span></span>
<span><span class="co">##  6 UA        1696 N39463  EWR    ORD    2013     1     1      554            558</span></span>
<span><span class="co">##  7 B6         507 N516JB  EWR    FLL    2013     1     1      555            600</span></span>
<span><span class="co">##  8 EV        5708 N829AS  LGA    IAD    2013     1     1      557            600</span></span>
<span><span class="co">##  9 B6          79 N593JB  JFK    MCO    2013     1     1      557            600</span></span>
<span><span class="co">## 10 AA         301 N3ALAA  LGA    ORD    2013     1     1      558            600</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 9 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,</span></span>
<span><span class="co">## #   arr_delay &lt;dbl&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span><span class="co">## #   time_hour &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> won’t duplicate columns you’ve already added.</p>
<p>Exploring the difference between bare name selection and <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of()</a></code>/<code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code></p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">carrier</span>, <span class="va">flight</span>, <span class="va">tailnum</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 336,776 × 9</span></span>
<span><span class="co">##    carrier flight tailnum dep_time sched_dep_time arr_time sched_arr_time</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 UA        1545 N14228       517            515      830            819</span></span>
<span><span class="co">##  2 UA        1714 N24211       533            529      850            830</span></span>
<span><span class="co">##  3 AA        1141 N619AA       542            540      923            850</span></span>
<span><span class="co">##  4 B6         725 N804JB       544            545     1004           1022</span></span>
<span><span class="co">##  5 DL         461 N668DN       554            600      812            837</span></span>
<span><span class="co">##  6 UA        1696 N39463       554            558      740            728</span></span>
<span><span class="co">##  7 B6         507 N516JB       555            600      913            854</span></span>
<span><span class="co">##  8 EV        5708 N829AS       557            600      709            723</span></span>
<span><span class="co">##  9 B6          79 N593JB       557            600      838            846</span></span>
<span><span class="co">## 10 AA         301 N3ALAA       558            600      753            745</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 2 more variables: air_time &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span>
<span></span>
<span><span class="va">varlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"carrier"</span>, <span class="st">"flight"</span>, <span class="st">"tailnum"</span>,</span>
<span>             <span class="st">"dep_time"</span>, <span class="st">"sched_dep_time"</span>, <span class="st">"arr_time"</span>, <span class="st">"sched_arr_time"</span>,</span>
<span>             <span class="st">"air_time"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 336,776 × 8</span></span>
<span><span class="co">##    carrier flight tailnum dep_time sched_dep_time arr_time sched_arr_time</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 UA        1545 N14228       517            515      830            819</span></span>
<span><span class="co">##  2 UA        1714 N24211       533            529      850            830</span></span>
<span><span class="co">##  3 AA        1141 N619AA       542            540      923            850</span></span>
<span><span class="co">##  4 B6         725 N804JB       544            545     1004           1022</span></span>
<span><span class="co">##  5 DL         461 N668DN       554            600      812            837</span></span>
<span><span class="co">##  6 UA        1696 N39463       554            558      740            728</span></span>
<span><span class="co">##  7 B6         507 N516JB       555            600      913            854</span></span>
<span><span class="co">##  8 EV        5708 N829AS       557            600      709            723</span></span>
<span><span class="co">##  9 B6          79 N593JB       557            600      838            846</span></span>
<span><span class="co">## 10 AA         301 N3ALAA       558            600      753            745</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 1 more variable: air_time &lt;dbl&gt;</span></span>
<span></span>
<span><span class="va">varlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">varlist</span>, <span class="st">"whoops"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span> <span class="co"># this errors out b/c whoops doesn't exist</span></span>
<span><span class="co">## Error in `select()` at magrittr/R/pipe.R:136:3:</span></span>
<span><span class="co">## ℹ In argument: `all_of(varlist)`.</span></span>
<span><span class="co">## Caused by error in `all_of()` at rlang/R/eval-tidy.R:121:3:</span></span>
<span><span class="co">## ! Can't subset elements that don't exist.</span></span>
<span><span class="co">## ✖ Element `whoops` doesn't exist.</span></span>
<span></span>
<span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span> <span class="co"># this runs just fine</span></span>
<span><span class="co">## # A tibble: 336,776 × 8</span></span>
<span><span class="co">##    carrier flight tailnum dep_time sched_dep_time arr_time sched_arr_time</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 UA        1545 N14228       517            515      830            819</span></span>
<span><span class="co">##  2 UA        1714 N24211       533            529      850            830</span></span>
<span><span class="co">##  3 AA        1141 N619AA       542            540      923            850</span></span>
<span><span class="co">##  4 B6         725 N804JB       544            545     1004           1022</span></span>
<span><span class="co">##  5 DL         461 N668DN       554            600      812            837</span></span>
<span><span class="co">##  6 UA        1696 N39463       554            558      740            728</span></span>
<span><span class="co">##  7 B6         507 N516JB       555            600      913            854</span></span>
<span><span class="co">##  8 EV        5708 N829AS       557            600      709            723</span></span>
<span><span class="co">##  9 B6          79 N593JB       557            600      838            846</span></span>
<span><span class="co">## 10 AA         301 N3ALAA       558            600      753            745</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 1 more variable: air_time &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So for now, at least in R, you know how to cut your data down to size rowwise (with <code>filter</code>) and column-wise (with <code>select</code>).</p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p>First, let’s install the nycflights13 package<span class="citation" data-cites="chowNycflights13DataPackage2020"><a href="#ref-chowNycflights13DataPackage2020" role="doc-biblioref">[3]</a></span> in python by typing the following into your <strong>system terminal</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install nycflights13</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: nycflights13 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (0.0.3)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: pandas&gt;=0.24.0 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (from nycflights13) (2.2.2)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: numpy&gt;=1.23.2 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (from pandas&gt;=0.24.0-&gt;nycflights13) (1.26.4)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: python-dateutil&gt;=2.8.2 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (from pandas&gt;=0.24.0-&gt;nycflights13) (2.9.0.post0)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: pytz&gt;=2020.1 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (from pandas&gt;=0.24.0-&gt;nycflights13) (2024.2)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: tzdata&gt;=2022.7 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (from pandas&gt;=0.24.0-&gt;nycflights13) (2024.1)</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Requirement already satisfied: six&gt;=1.5 in /home/susan/.virtualenvs/book/lib/python3.11/site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=0.24.0-&gt;nycflights13) (1.16.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we can load the <code>flights</code> data from the <code>nycflights13</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nycflights13 <span class="im">import</span> flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Select operations are not as easy in python as they are when using <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code> with helpers, but of course you can accomplish the same tasks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> flights.columns</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rearrange column order by manual indexing</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> cols[<span class="dv">9</span>:<span class="dv">13</span>].append(cols[<span class="dv">0</span>:<span class="dv">9</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x.append(cols[<span class="dv">13</span>:<span class="dv">19</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Then use the index to rearrange the columns</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>flights.loc[:,x]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">##        carrier  flight tailnum  ... hour  minute             time_hour</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           UA    1545  N14228  ...    5      15  2013-01-01T10:00:00Z</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           UA    1714  N24211  ...    5      29  2013-01-01T10:00:00Z</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           AA    1141  N619AA  ...    5      40  2013-01-01T10:00:00Z</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 3           B6     725  N804JB  ...    5      45  2013-01-01T10:00:00Z</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 4           DL     461  N668DN  ...    6       0  2013-01-01T11:00:00Z</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">## ...        ...     ...     ...  ...  ...     ...                   ...</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 336771      9E    3393     NaN  ...   14      55  2013-09-30T18:00:00Z</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 336772      9E    3525     NaN  ...   22       0  2013-10-01T02:00:00Z</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 336773      MQ    3461  N535MQ  ...   12      10  2013-09-30T16:00:00Z</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 336774      MQ    3572  N511MQ  ...   11      59  2013-09-30T15:00:00Z</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 336775      MQ    3531  N839MQ  ...    8      40  2013-09-30T12:00:00Z</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">## [336776 rows x 19 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="list-comprehensions" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="list-comprehensions">List Comprehensions</h4>
<p>In Python, there are certain shorthands called “list comprehensions” <span class="citation" data-cites="pythonfoundationDataStructures2022"><a href="#ref-pythonfoundationDataStructures2022" role="doc-biblioref">[4]</a></span> that can perform similar functions to e.g.&nbsp;the <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> function in dplyr.</p>
<p>Suppose we want to get all columns containing the word ‘time’. We could iterate through the list of columns (<code>flights.columns</code>) and add the column name any time we detect the word ‘time’ within. That is essentially what the following code does:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This gets all columns that contain time</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>timecols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> flights.columns <span class="cf">if</span> <span class="st">'time'</span> <span class="kw">in</span> col]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>timecols</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">## ['dep_time', 'sched_dep_time', 'arr_time', 'sched_arr_time', 'air_time', 'time_hour']</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Explaining the code:</p>
<ul>
<li>
<code>for col in flights.columns</code> iterates through the list of columns, storing each column name in the variable <code>col</code>
</li>
<li>
<code>if 'time' in col</code> detects the presence of the word ‘time’ in the column name stored in <code>col</code>
</li>
<li>the <code>col</code> out front adds the column name in the variable <code>col</code> to the array of columns to keep</li>
</ul></section><section id="selecting-columns-in-python" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="selecting-columns-in-python">Selecting columns in Python</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This gets all columns that contain time</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>timecols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> flights.columns <span class="cf">if</span> <span class="st">'time'</span> <span class="kw">in</span> col]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Other columns</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>selcols <span class="op">=</span> [<span class="st">"carrier"</span>, <span class="st">"flight"</span>, <span class="st">"tailnum"</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two lists</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>selcols.extend(timecols)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data frame</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>flights.loc[:,selcols]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">##        carrier  flight tailnum  ...  sched_arr_time  air_time             time_hour</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           UA    1545  N14228  ...             819     227.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           UA    1714  N24211  ...             830     227.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           AA    1141  N619AA  ...             850     160.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 3           B6     725  N804JB  ...            1022     183.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 4           DL     461  N668DN  ...             837     116.0  2013-01-01T11:00:00Z</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">## ...        ...     ...     ...  ...             ...       ...                   ...</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 336771      9E    3393     NaN  ...            1634       NaN  2013-09-30T18:00:00Z</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 336772      9E    3525     NaN  ...            2312       NaN  2013-10-01T02:00:00Z</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 336773      MQ    3461  N535MQ  ...            1330       NaN  2013-09-30T16:00:00Z</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 336774      MQ    3572  N511MQ  ...            1344       NaN  2013-09-30T15:00:00Z</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 336775      MQ    3531  N839MQ  ...            1020       NaN  2013-09-30T12:00:00Z</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co">## [336776 rows x 9 columns]</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>selcols.extend([<span class="st">"whoops"</span>])</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>selcols</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co">## ['carrier', 'flight', 'tailnum', 'dep_time', 'sched_dep_time', 'arr_time', 'sched_arr_time', 'air_time', 'time_hour', 'whoops']</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data frame</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>flights.loc[:,selcols]</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co">## KeyError: "['whoops'] not in index"</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Error-tolerance - use list comprehension to check if </span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="co"># variable names are in the data frame</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>selcols_fixed <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> selcols <span class="cf">if</span> x <span class="kw">in</span> flights.columns]</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>flights.loc[:,selcols_fixed]</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co">##        carrier  flight tailnum  ...  sched_arr_time  air_time             time_hour</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           UA    1545  N14228  ...             819     227.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           UA    1714  N24211  ...             830     227.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           AA    1141  N619AA  ...             850     160.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="co">## 3           B6     725  N804JB  ...            1022     183.0  2013-01-01T10:00:00Z</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="co">## 4           DL     461  N668DN  ...             837     116.0  2013-01-01T11:00:00Z</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="co">## ...        ...     ...     ...  ...             ...       ...                   ...</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co">## 336771      9E    3393     NaN  ...            1634       NaN  2013-09-30T18:00:00Z</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="co">## 336772      9E    3525     NaN  ...            2312       NaN  2013-10-01T02:00:00Z</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a><span class="co">## 336773      MQ    3461  N535MQ  ...            1330       NaN  2013-09-30T16:00:00Z</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="co">## 336774      MQ    3572  N511MQ  ...            1344       NaN  2013-09-30T15:00:00Z</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a><span class="co">## 336775      MQ    3531  N839MQ  ...            1020       NaN  2013-09-30T12:00:00Z</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="co">## [336776 rows x 9 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<p>In base R, we typically select columns by name or index directly. This is nowhere near as convenient, of course, but there are little shorthand ways to replicate the functionality of e.g.&nbsp;<code>matches</code> in <code>dplyr</code>.</p>
<p><code>grepl</code> is a shorthand function for <code>grep</code>, which searches for a pattern in a vector of strings. <code>grepl</code> returns a logical vector indicating whether the pattern (<code>"dep"</code>, in this case) was found in the vector (<code>names(flights)</code>, in this case).</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">depcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"dep"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">collist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"flight"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"tailnum"</span>, <span class="st">"origin"</span>, <span class="va">depcols</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flights</span><span class="op">[</span>,<span class="va">collist</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 336,776 × 9</span></span>
<span><span class="co">##    flight  year month   day tailnum origin dep_time sched_dep_time dep_delay</span></span>
<span><span class="co">##     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1   1545  2013     1     1 N14228  EWR         517            515         2</span></span>
<span><span class="co">##  2   1714  2013     1     1 N24211  LGA         533            529         4</span></span>
<span><span class="co">##  3   1141  2013     1     1 N619AA  JFK         542            540         2</span></span>
<span><span class="co">##  4    725  2013     1     1 N804JB  JFK         544            545        -1</span></span>
<span><span class="co">##  5    461  2013     1     1 N668DN  LGA         554            600        -6</span></span>
<span><span class="co">##  6   1696  2013     1     1 N39463  EWR         554            558        -4</span></span>
<span><span class="co">##  7    507  2013     1     1 N516JB  EWR         555            600        -5</span></span>
<span><span class="co">##  8   5708  2013     1     1 N829AS  LGA         557            600        -3</span></span>
<span><span class="co">##  9     79  2013     1     1 N593JB  JFK         557            600        -3</span></span>
<span><span class="co">## 10    301  2013     1     1 N3ALAA  LGA         558            600        -2</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perhaps we want the plane and flight ID information to be the first columns:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span>
<span><span class="va">new_order</span> <span class="op">&lt;-</span> <span class="va">new_order</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">14</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">15</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">flights</span><span class="op">[</span>,<span class="va">new_order</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 336,776 × 19</span></span>
<span><span class="co">##    carrier flight tailnum origin dest   year month   day dep_time sched_dep_time</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 UA        1545 N14228  EWR    IAH    2013     1     1      517            515</span></span>
<span><span class="co">##  2 UA        1714 N24211  LGA    IAH    2013     1     1      533            529</span></span>
<span><span class="co">##  3 AA        1141 N619AA  JFK    MIA    2013     1     1      542            540</span></span>
<span><span class="co">##  4 B6         725 N804JB  JFK    BQN    2013     1     1      544            545</span></span>
<span><span class="co">##  5 DL         461 N668DN  LGA    ATL    2013     1     1      554            600</span></span>
<span><span class="co">##  6 UA        1696 N39463  EWR    ORD    2013     1     1      554            558</span></span>
<span><span class="co">##  7 B6         507 N516JB  EWR    FLL    2013     1     1      555            600</span></span>
<span><span class="co">##  8 EV        5708 N829AS  LGA    IAD    2013     1     1      557            600</span></span>
<span><span class="co">##  9 B6          79 N593JB  JFK    MCO    2013     1     1      557            600</span></span>
<span><span class="co">## 10 AA         301 N3ALAA  LGA    ORD    2013     1     1      558            600</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 9 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,</span></span>
<span><span class="co">## #   arr_delay &lt;dbl&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span><span class="co">## #   time_hour &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is less convenient than <code><a href="https://tidyselect.r-lib.org/reference/everything.html">dplyr::everything</a></code> in part because it depends on us to get the column indexes right.</p>
</div>
</div>
</div>
<section id="rearranging-columns" class="level3 callout-demo" data-collapse="true" data-number="22.5.1"><h3 data-number="22.5.1" class="anchored" data-anchor-id="rearranging-columns">
<span class="header-section-number">22.5.1</span> Rearranging Columns</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true"><code>dplyr::relocate</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>Another handy <code>dplyr</code> function is <code>relocate</code>; while you definitely can do this operation in many, many different ways, it may be simpler to do it using relocate. But, I’m covering relocate here mostly because it also comes with this amazing cartoon illustration.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/dplyr_relocate.png" class="img-fluid figure-img" alt="Cartoon of fuzzy monsters moving columns around in fork lifts, while one supervises. Stylized text reads “dplyr::relocate() - move columns around! Default: move to FRONT , or move to .before or .after a specified column."></p>
<figcaption>relocate lets you rearrange columns (by Allison Horst)</figcaption></figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Move flight specific info to the front</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">flights</span>, package <span class="op">=</span> <span class="st">"nycflights13"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">carrier</span><span class="op">:</span><span class="va">dest</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 336,776 × 19</span></span>
<span><span class="co">##    carrier flight tailnum origin dest   year month   day dep_time sched_dep_time</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1 UA        1545 N14228  EWR    IAH    2013     1     1      517            515</span></span>
<span><span class="co">##  2 UA        1714 N24211  LGA    IAH    2013     1     1      533            529</span></span>
<span><span class="co">##  3 AA        1141 N619AA  JFK    MIA    2013     1     1      542            540</span></span>
<span><span class="co">##  4 B6         725 N804JB  JFK    BQN    2013     1     1      544            545</span></span>
<span><span class="co">##  5 DL         461 N668DN  LGA    ATL    2013     1     1      554            600</span></span>
<span><span class="co">##  6 UA        1696 N39463  EWR    ORD    2013     1     1      554            558</span></span>
<span><span class="co">##  7 B6         507 N516JB  EWR    FLL    2013     1     1      555            600</span></span>
<span><span class="co">##  8 EV        5708 N829AS  LGA    IAD    2013     1     1      557            600</span></span>
<span><span class="co">##  9 B6          79 N593JB  JFK    MCO    2013     1     1      557            600</span></span>
<span><span class="co">## 10 AA         301 N3ALAA  LGA    ORD    2013     1     1      558            600</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 9 more variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,</span></span>
<span><span class="co">## #   arr_delay &lt;dbl&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span>
<span><span class="co">## #   time_hour &lt;dttm&gt;</span></span>
<span></span>
<span><span class="co"># move numeric variables to the front</span></span>
<span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 336,776 × 19</span></span>
<span><span class="co">##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">##  1  2013     1     1      517            515         2      830            819</span></span>
<span><span class="co">##  2  2013     1     1      533            529         4      850            830</span></span>
<span><span class="co">##  3  2013     1     1      542            540         2      923            850</span></span>
<span><span class="co">##  4  2013     1     1      544            545        -1     1004           1022</span></span>
<span><span class="co">##  5  2013     1     1      554            600        -6      812            837</span></span>
<span><span class="co">##  6  2013     1     1      554            558        -4      740            728</span></span>
<span><span class="co">##  7  2013     1     1      555            600        -5      913            854</span></span>
<span><span class="co">##  8  2013     1     1      557            600        -3      709            723</span></span>
<span><span class="co">##  9  2013     1     1      557            600        -3      838            846</span></span>
<span><span class="co">## 10  2013     1     1      558            600        -2      753            745</span></span>
<span><span class="co">## # ℹ 336,766 more rows</span></span>
<span><span class="co">## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, flight &lt;int&gt;, air_time &lt;dbl&gt;,</span></span>
<span><span class="co">## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, carrier &lt;chr&gt;, tailnum &lt;chr&gt;,</span></span>
<span><span class="co">## #   origin &lt;chr&gt;, dest &lt;chr&gt;, time_hour &lt;dttm&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>There are similar ways to rearrange columns in pandas, but they are a bit harder to work with - you have to specify the column names (in some way) and then perform the operation yourself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="bu">list</span>(flights.columns.values) <span class="co"># get column names</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Move flight specific info to the front</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>flightcols <span class="op">=</span> [<span class="st">'carrier'</span>, <span class="st">'flight'</span>, <span class="st">'tailnum'</span>, <span class="st">'origin'</span>, <span class="st">'dest'</span>]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>flights[flightcols <span class="op">+</span> <span class="bu">list</span>(flights.drop(flightcols, axis <span class="op">=</span> <span class="dv">1</span>))]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">##        carrier  flight tailnum  ... hour minute             time_hour</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 0           UA    1545  N14228  ...    5     15  2013-01-01T10:00:00Z</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           UA    1714  N24211  ...    5     29  2013-01-01T10:00:00Z</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           AA    1141  N619AA  ...    5     40  2013-01-01T10:00:00Z</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 3           B6     725  N804JB  ...    5     45  2013-01-01T10:00:00Z</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 4           DL     461  N668DN  ...    6      0  2013-01-01T11:00:00Z</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">## ...        ...     ...     ...  ...  ...    ...                   ...</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 336771      9E    3393     NaN  ...   14     55  2013-09-30T18:00:00Z</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 336772      9E    3525     NaN  ...   22      0  2013-10-01T02:00:00Z</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 336773      MQ    3461  N535MQ  ...   12     10  2013-09-30T16:00:00Z</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 336774      MQ    3572  N511MQ  ...   11     59  2013-09-30T15:00:00Z</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 336775      MQ    3531  N839MQ  ...    8     40  2013-09-30T12:00:00Z</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">## [336776 rows x 19 columns]</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># move numeric variables to the front</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>numcols <span class="op">=</span> <span class="bu">list</span>(flights.select_dtypes(include <span class="op">=</span> np.number).columns.values)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>flights[numcols <span class="op">+</span> <span class="bu">list</span>(flights.drop(numcols, axis <span class="op">=</span> <span class="dv">1</span>))]</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co">##         year  month  day  dep_time  ...  tailnum  origin  dest             time_hour</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 0       2013      1    1     517.0  ...   N14228     EWR   IAH  2013-01-01T10:00:00Z</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">## 1       2013      1    1     533.0  ...   N24211     LGA   IAH  2013-01-01T10:00:00Z</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co">## 2       2013      1    1     542.0  ...   N619AA     JFK   MIA  2013-01-01T10:00:00Z</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 3       2013      1    1     544.0  ...   N804JB     JFK   BQN  2013-01-01T10:00:00Z</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 4       2013      1    1     554.0  ...   N668DN     LGA   ATL  2013-01-01T11:00:00Z</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co">## ...      ...    ...  ...       ...  ...      ...     ...   ...                   ...</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="co">## 336771  2013      9   30       NaN  ...      NaN     JFK   DCA  2013-09-30T18:00:00Z</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="co">## 336772  2013      9   30       NaN  ...      NaN     LGA   SYR  2013-10-01T02:00:00Z</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co">## 336773  2013      9   30       NaN  ...   N535MQ     LGA   BNA  2013-09-30T16:00:00Z</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="co">## 336774  2013      9   30       NaN  ...   N511MQ     LGA   CLE  2013-09-30T15:00:00Z</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="co">## 336775  2013      9   30       NaN  ...   N839MQ     LGA   RDU  2013-09-30T12:00:00Z</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co">## [336776 rows x 19 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section></section><section id="mutate-add-and-transform-variables" class="level2 page-columns page-full" data-number="22.6"><h2 data-number="22.6" class="anchored" data-anchor-id="mutate-add-and-transform-variables">
<span class="header-section-number">22.6</span> Mutate: Add and transform variables</h2>
<p>Up to this point, we’ve been primarily focusing on how to decrease the dimensionality of our dataset in various ways. But frequently, we also need to add columns for derived measures (e.g.&nbsp;BMI from weight and height information), change units, and replace missing or erroneous observations. The tidyverse verb for this is <code>mutate</code>, but in base R and python, we’ll simply use assignment to add columns to our data frames.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/dplyr_mutate.png" class="img-fluid figure-img" alt="Cartoon of cute fuzzy monsters dressed up as different X-men characters, working together to add a new column to an existing data frame. Stylized title text reads “dplyr::mutate - add columns, keep existing.”"></p>
<figcaption>Mutate (by Allison Horst)</figcaption></figure>
</div>
</div></div><p>We’ll use the Pokemon data to demonstrate. Some Pokemon have a single “type”, which is usually elemental, such as Water, Ice, Fire, etc., but others have two. Let’s add a column that indicates how many types a pokemon has.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Base R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">R: <code>dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This splits type_1,type_2 into two separate variables. </span></span>
<span><span class="co"># Don't worry about the string processing (gsub) just now</span></span>
<span><span class="co"># Focus on how variables are defined.</span></span>
<span><span class="va">poke</span><span class="op">$</span><span class="va">type_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">",.*$"</span>, <span class="st">""</span>, <span class="va">poke</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="co"># Replace anything after comma with ''</span></span>
<span><span class="va">poke</span><span class="op">$</span><span class="va">type_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"^.*,"</span>, <span class="st">""</span>, <span class="va">poke</span><span class="op">$</span><span class="va">type</span><span class="op">)</span> <span class="co"># Use the 2nd type</span></span>
<span><span class="va">poke</span><span class="op">$</span><span class="va">type_2</span><span class="op">[</span><span class="va">poke</span><span class="op">$</span><span class="va">type_1</span> <span class="op">==</span> <span class="va">poke</span><span class="op">$</span><span class="va">type_2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="co"># Type 2 only exists if not same as Type 1</span></span>
<span></span>
<span><span class="va">poke</span><span class="op">$</span><span class="va">no_types</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># set a default value</span></span>
<span><span class="va">poke</span><span class="op">$</span><span class="va">no_types</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">","</span>, <span class="va">poke</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># set the value if there's not a comma in type</span></span>
<span></span>
<span><span class="co"># This is a bit faster</span></span>
<span><span class="va">poke</span><span class="op">$</span><span class="va">no_types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">","</span>, <span class="va">poke</span><span class="op">$</span><span class="va">type</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sanity check</span></span>
<span><span class="co"># This checks number of types vs. value of type_2</span></span>
<span><span class="co"># If type 2 is NA, then number of types should be 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">poke</span><span class="op">$</span><span class="va">type_2</span>, <span class="va">poke</span><span class="op">$</span><span class="va">no_types</span>, useNA <span class="op">=</span> <span class="st">'ifany'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##    </span></span>
<span><span class="co">##     Bug Dark Dragon Electric Fairy Fighting Fire Flying Ghost Grass Ground Ice</span></span>
<span><span class="co">##   1   0    0      0        0     0        0    0      0     0     0      0   0</span></span>
<span><span class="co">##   2   9   40     49       17    47       47   31    157    57    50     57  36</span></span>
<span><span class="co">##    </span></span>
<span><span class="co">##     Normal Poison Psychic Rock Steel Water &lt;NA&gt;</span></span>
<span><span class="co">##   1      0      0       0    0     0     0  673</span></span>
<span><span class="co">##   2     24     51      61   23    55    42    0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we had to type the name of the dataset at least 3 times to perform the operation we were looking for. I could reduce that to 2x with the <code>ifelse</code> function, but it’s still a lot of typing.</p>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="va">poke</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># This splits type into type_1,type_2 : two separate variables. </span></span>
<span>  <span class="co"># Don't worry about the string processing (str_extract) just now</span></span>
<span>  <span class="co"># Focus on how variables are defined: </span></span>
<span>  <span class="co">#   we use a function on the type column</span></span>
<span>  <span class="co">#   within the mutate statement.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>type_1 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">type</span>, <span class="st">"^(.*),"</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>         type_2 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">type</span>, <span class="st">"(.*),(.*)"</span>, group <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>no_types <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">type_2</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">type_2</span>, <span class="va">no_types</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>useNA <span class="op">=</span> <span class="st">'ifany'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##         type_2</span></span>
<span><span class="co">## no_types Bug Dark Dragon Electric Fairy Fighting Fire Flying Ghost Grass Ground</span></span>
<span><span class="co">##        1   0    0      0        0     0        0    0      0     0     0      0</span></span>
<span><span class="co">##        2   9   40     49       17    47       47   31    157    57    50     57</span></span>
<span><span class="co">##         type_2</span></span>
<span><span class="co">## no_types Ice Normal Poison Psychic Rock Steel Water &lt;NA&gt;</span></span>
<span><span class="co">##        1   0      0      0       0    0     0     0  673</span></span>
<span><span class="co">##        2  36     24     51      61   23    55    42    0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The last 2 rows are just to organize the output - we keep only the two variables we’re working with, and get a crosstab.</p>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<p>In python, this type of variable operation (replacing one value with another) can be most easily done with the replace function, which takes arguments (thing_to_replace, value_to_replace_with).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> pd.read_csv(<span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This splits type into two columns, type_1 and type_2, based on ","</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>poke[[<span class="st">"type_1"</span>, <span class="st">"type_2"</span>]] <span class="op">=</span> poke[<span class="st">"type"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(<span class="bu">str</span>(x).split(<span class="st">","</span>)))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This defines number of types</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>poke[<span class="st">"no_types"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="co"># default value</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>poke.loc[<span class="op">~</span>poke.type_2.isna(), <span class="st">"no_types"</span>] <span class="op">=</span> <span class="dv">2</span> <span class="co"># change those with a defined type 2</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>poke.groupby([<span class="st">"no_types"</span>, <span class="st">"type_2"</span>], dropna<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">## no_types  type_2  </span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 1         NaN         673</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 2         Bug           9</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">##           Dark         40</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">##           Dragon       49</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">##           Electric     17</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">##           Fairy        47</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">##           Fighting     47</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">##           Fire         31</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">##           Flying      157</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co">##           Ghost        57</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co">##           Grass        50</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co">##           Ground       57</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">##           Ice          36</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co">##           Normal       24</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co">##           Poison       51</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co">##           Psychic      61</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co">##           Rock         23</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co">##           Steel        55</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co">##           Water        42</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: int64</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># When type_2 is NaN, no_types is 1</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="co"># When type_2 is defined, no_types is 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another function that may be useful is the <code>assign</code> function, which can be used to create new variables if you don’t want to use the <code>["new_col"]</code> notation. In some circumstances, <code>.assign(var = ...)</code> is a bit easier to work with because Python distinguishes between modifications to data and making a copy of the entire data frame (which is something I’d like to <a href="https://stackoverflow.com/questions/23296282/what-rules-does-pandas-use-to-generate-a-view-vs-a-copy">not get into right now</a> for simplicity’s sake).</p>
</div>
</div>
</div>
<p>The learning curve here isn’t actually knowing how to assign new variables (though that’s important). The challenge comes when you want to do something <em>new</em> and have to figure out how to e.g.&nbsp;use find and replace in a string, or work with dates and times, or recode variables.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mutate and new challenges
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I’m not going to be able to teach you how to handle every mutate statement task you’ll come across (people invent new ways to screw up data all the time!) but my goal is instead to teach you how to <em>read documentation</em>, <em>google things intelligently</em>, and to <em>understand what you’re reading</em> enough to actually implement it. This is something that comes with practice (and lots of googling, stack overflow searches, etc.).</p>
<p>Google and StackOverflow are very common and important programming skills!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/twitter-google-stackoverflow.png" class="img-fluid figure-img" alt="A screenshot of a tweet from @madsbrodt. Tweet text: Googling and StackOverflow'ing is a natural part of programming. Don't think of it as cheating. Knowing what to search for, and which results will fit your given situation is an important skill (flame emoji)."></p>
<figcaption><a href="https://twitter.com/madsbrodt/status/1339127984670773251">Source</a></figcaption></figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/twitter-happy-debugging.png" class="img-fluid figure-img" alt="A screenshot of a tweet from @cszhu. Tweet text: if you're not happy single, you won't be happy in a relationship. true happiness comes from closing 100 chrome tabs after solving an obscure programming bug, not from someone else."></p>
<figcaption><a href="https://twitter.com/cszhu/status/1230954186520461312">Source</a></figcaption></figure>
</div>
<p>In this textbook, the examples will expose you to solutions to common problems (or require that you do some basic reading yourself); unfortunately, there are too many common problems for us to work through line-by-line.</p>
<p>Part of the goal of this textbook is to help you <strong>learn how to read through a package description and evaluate whether the package will do what you want</strong>. We’re going to try to build some of those skills starting now. It would be relatively easy to teach you how to do a set list of tasks, but you’ll be better statisticians and programmers if you learn the skills to solve niche problems on your own.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/twitter-teach-program.png" class="img-fluid figure-img" alt="A screenshot of a tweet from @abt_programming. Tweet text: Give a man a program, frustrate him for a day. Teach a man to program, frustrate him for a lifetime - Muhammad Waseem."></p>
<figcaption>Apologies for the noninclusive language, but the sentiment is real. <a href="https://twitter.com/abt_programming/status/459414524303785984">Source</a></figcaption></figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is a quick table of places to look in R and python to solve some of the more common problems.</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Problem</th>
<th>R</th>
<th>Python</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Dates and Times</td>
<td>
<code>lubridate</code> package (esp.&nbsp;<code><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms()</a></code> and variants, <code><a href="https://lubridate.tidyverse.org/reference/decimal_date.html">decimal_date()</a></code>, and other convenience functions)</td>
<td>
<code>pandas</code> has some date time support by default; see the <a href="https://docs.python.org/3/library/datetime.html"><code>datetime</code> module</a> for more functionality.</td>
</tr>
<tr class="even">
<td>String manipulation</td>
<td>
<code>stringr</code> package</td>
<td>Quick Tips <span class="citation" data-cites="chinguyenTipsStringManipulation2021"><a href="#ref-chinguyenTipsStringManipulation2021" role="doc-biblioref">[5]</a></span>, Whirlwind Tour of Python chapter <span class="citation" data-cites="jacobvanderplasStringManipulationRegular2016"><a href="#ref-jacobvanderplasStringManipulationRegular2016" role="doc-biblioref">[6]</a></span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="summarize" class="level2" data-number="22.7"><h2 data-number="22.7" class="anchored" data-anchor-id="summarize">
<span class="header-section-number">22.7</span> Summarize</h2>
<p>The next verb is one that we’ve already implicitly seen in action: <code>summarize</code> takes a data frame with potentially many rows of data and reduces it down to one row of data using some function. You have used it to get single-row summaries of vectorized data in R, and we’ve used e.g.&nbsp;<code>group_by</code> + <code>count</code> in Python to perform certain tasks as well.</p>
<p>Here (in a trivial example), I compute the overall average HP of a Pokemon in each generation, as well as the average number of characters in their name. Admittedly, that last computation is a bit silly, but it’s mostly for demonstration purposes.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R: <code class="unnumbered">dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span><span class="va">poke</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pokedex_no</span><span class="op">)</span>, hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span>, name_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">name_chr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 3</span></span>
<span><span class="co">##       n    hp name_chr</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1  1008  71.2     7.55</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p>In python, instead of a summarize function, there are a number of shorthand functions that we often use to summarize things, such as <code>mean</code>. You can also build custom summary functions <span class="citation" data-cites="whortonApplyingCustomFunctions2021"><a href="#ref-whortonApplyingCustomFunctions2021" role="doc-biblioref">[7]</a></span>, or use the <code>agg()</code> function to define multiple summary variables. <code>agg()</code> will even let you use different summary functions for each variable, just like <code>summarize</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> pd.read_csv(<span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> poke.assign(name_length <span class="op">=</span> poke.name.<span class="bu">str</span>.<span class="bu">len</span>())</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>poke[[<span class="st">'hp'</span>, <span class="st">'name_length'</span>]].mean()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">## hp             71.178244</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">## name_length     7.545216</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>poke[[<span class="st">'hp'</span>, <span class="st">'name_length'</span>]].agg([<span class="st">'mean'</span>, <span class="st">'min'</span>])</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">##              hp  name_length</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">## mean  71.178244     7.545216</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">## min    1.000000     3.000000</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>poke[[<span class="st">'pokedex_no'</span>, <span class="st">'hp'</span>, <span class="st">'name_length'</span>]].agg({<span class="st">'pokedex_no'</span>:<span class="st">'nunique'</span>, <span class="st">'hp'</span>:<span class="st">'mean'</span>, <span class="st">'name_length'</span>:<span class="st">'mean'</span>})</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">## pokedex_no     1008.000000</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">## hp               71.178244</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">## name_length       7.545216</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">## dtype: float64</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The real power of summarize, though, is in combination with Group By. We’ll see more summarize examples, but it’s easier to make good examples when you have all the tools - it’s hard to demonstrate how to use a hammer if you don’t also have a nail.</p>
</section><section id="group-by-power" class="level2 page-columns page-full" data-number="22.8"><h2 data-number="22.8" class="anchored" data-anchor-id="group-by-power">
<span class="header-section-number">22.8</span> Group By + (?) = Power!</h2>
<p>Frequently, we have data that is more specific than the data we need - for instance, I may have observations of the temperature at 15-minute intervals, but I might want to record the daily high and low value. To do this, I need to</p>
<ol type="1">
<li>split my dataset into smaller datasets - one for each day</li>
<li>compute summary values for each smaller dataset</li>
<li>put my summarized data back together into a single dataset</li>
</ol>
<p>This is known as the <code>split-apply-combine</code> <span class="citation" data-cites="wickhamSplitapplycombineStrategyData2011"><a href="#ref-GroupSplitapplycombine2022" role="doc-biblioref">[9]</a></span> or sometimes, <code>map-reduce</code> <span class="citation" data-cites="deanMapReduceSimplifiedData2008"><a href="#ref-deanMapReduceSimplifiedData2008" role="doc-biblioref">[10]</a></span> strategy (though map-reduce is usually on specifically large datasets and performed in parallel).</p>
<p>In tidy parlance, <code>group_by</code> is the verb that accomplishes the first task. <code>summarize</code> accomplishes the second task and implicitly accomplishes the third as well.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/ungroup_blank.png" class="img-fluid figure-img" alt="Two fuzzy monsters in the foreground in birthday party hats celebrate together because one has opened a gift with group_by() inside. Text above those two reads “Other really important parts sold separately!” In the background, a very hopeful little monster stands along holding a package labeled “ungroup”, waiting to be invited."></p>
<figcaption>The ungroup() command is just as important as the group_by() command! (by Allison Horst)</figcaption></figure>
</div>
</div></div><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R: <code class="unnumbered">dplyr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span><span class="va">poke</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">gen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">pokedex_no</span><span class="op">)</span><span class="op">)</span>, hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hp</span><span class="op">)</span>, name_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">name_chr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 9 × 4</span></span>
<span><span class="co">##     gen     n    hp name_chr</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1     1   151  65.3     7.23</span></span>
<span><span class="co">## 2     2   100  71.0     7.36</span></span>
<span><span class="co">## 3     3   135  65.8     7.16</span></span>
<span><span class="co">## 4     4   107  69.4     6.85</span></span>
<span><span class="co">## 5     5   156  75.8     7.77</span></span>
<span><span class="co">## 6     6    72  72.9     7.47</span></span>
<span><span class="co">## 7     7    88  73.2     8.04</span></span>
<span><span class="co">## 8     8    96  77.9     8.01</span></span>
<span><span class="co">## 9     9   103  75.8     8.66</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> pd.read_csv(<span class="st">"https://github.com/srvanderplas/datasets/raw/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> poke.assign(name_length <span class="op">=</span> poke.name.<span class="bu">str</span>.<span class="bu">len</span>())</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>poke.groupby(<span class="st">'gen'</span>)[[<span class="st">'hp'</span>, <span class="st">'name_length'</span>]].mean()</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">##             hp  name_length</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">## gen                        </span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    65.333333     7.231579</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    71.024194     7.362903</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    65.777202     7.160622</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    69.382022     6.853933</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 5    75.827004     7.767932</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 6    72.882353     7.470588</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 7    73.233083     8.037594</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 8    77.940299     8.014925</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 9    75.756098     8.658537</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>poke.groupby(<span class="st">'gen'</span>)[[<span class="st">'hp'</span>, <span class="st">'name_length'</span>]].agg([<span class="st">'mean'</span>, <span class="st">'min'</span>])</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co">##             hp     name_length    </span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co">##           mean min        mean min</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co">## gen                               </span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    65.333333  10    7.231579   3</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    71.024194  20    7.362903   4</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    65.777202   1    7.160622   4</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    69.382022  20    6.853933   4</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="co">## 5    75.827004  30    7.767932   4</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co">## 6    72.882353  38    7.470588   5</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="co">## 7    73.233083  25    8.037594   6</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 8    77.940299  25    8.014925   4</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 9    75.756098  10    8.658537   5</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>poke.groupby(<span class="st">'gen'</span>)[[<span class="st">'pokedex_no'</span>, <span class="st">'hp'</span>, <span class="st">'name_length'</span>]].agg({<span class="st">'pokedex_no'</span>:<span class="st">'nunique'</span>, <span class="st">'hp'</span>:<span class="st">'mean'</span>, <span class="st">'name_length'</span>:<span class="st">'mean'</span>})</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co">##      pokedex_no         hp  name_length</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="co">## gen                                    </span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="co">## 1           151  65.333333     7.231579</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="co">## 2           100  71.024194     7.362903</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="co">## 3           135  65.777202     7.160622</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co">## 4           107  69.382022     6.853933</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="co">## 5           156  75.827004     7.767932</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="co">## 6            72  72.882353     7.470588</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="co">## 7            88  73.233083     8.037594</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a><span class="co">## 8            96  77.940299     8.014925</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="co">## 9           103  75.756098     8.658537</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>When you <code>group_by</code> a variable, your result carries this grouping with it. In R, <code>summarize</code> will remove one layer of grouping (by default), but if you ever want to return to a completely ungrouped data set, you should use the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> command. In Python, you should consider using <code>reset_index</code> or <code>grouped_thing.obj()</code> to access the original information<span class="citation" data-cites="danchoAnswerThereUngroup2021"><a href="#ref-danchoAnswerThereUngroup2021" role="doc-biblioref">[11]</a></span>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Storms Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s try a non-trivial example, using the <code>storms</code> dataset that is part of the <code>dplyr</code> package.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span> <span class="co"># for the make_datetime() function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">storms</span><span class="op">)</span></span>
<span><span class="va">storms</span></span>
<span><span class="co">## # A tibble: 19,537 × 13</span></span>
<span><span class="co">##    name   year month   day  hour   lat  long status      category  wind pressure</span></span>
<span><span class="co">##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt; &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">##  1 Amy    1975     6    27     0  27.5 -79   tropical d…       NA    25     1013</span></span>
<span><span class="co">##  2 Amy    1975     6    27     6  28.5 -79   tropical d…       NA    25     1013</span></span>
<span><span class="co">##  3 Amy    1975     6    27    12  29.5 -79   tropical d…       NA    25     1013</span></span>
<span><span class="co">##  4 Amy    1975     6    27    18  30.5 -79   tropical d…       NA    25     1013</span></span>
<span><span class="co">##  5 Amy    1975     6    28     0  31.5 -78.8 tropical d…       NA    25     1012</span></span>
<span><span class="co">##  6 Amy    1975     6    28     6  32.4 -78.7 tropical d…       NA    25     1012</span></span>
<span><span class="co">##  7 Amy    1975     6    28    12  33.3 -78   tropical d…       NA    25     1011</span></span>
<span><span class="co">##  8 Amy    1975     6    28    18  34   -77   tropical d…       NA    30     1006</span></span>
<span><span class="co">##  9 Amy    1975     6    29     0  34.4 -75.8 tropical s…       NA    35     1004</span></span>
<span><span class="co">## 10 Amy    1975     6    29     6  34   -74.8 tropical s…       NA    40     1002</span></span>
<span><span class="co">## # ℹ 19,527 more rows</span></span>
<span><span class="co">## # ℹ 2 more variables: tropicalstorm_force_diameter &lt;int&gt;,</span></span>
<span><span class="co">## #   hurricane_force_diameter &lt;int&gt;</span></span>
<span></span>
<span><span class="va">storms</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Construct a time variable that behaves like a number but is formatted as a date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/storms.csv"</span>, on_bad_lines<span class="op">=</span><span class="st">'skip'</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a time variable that behaves like a number but is formatted as a date</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> storms.assign(time <span class="op">=</span> pd.to_datetime(storms[[<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>]]))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove month/day/hour </span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># (keep year for ID purposes, names are reused)</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> storms.drop([<span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We have named storms, observation time, storm location, status, wind, pressure, and diameter (for tropical storms and hurricanes).</p>
<p>One thing we might want to know is at what point each storm was the strongest. Let’s define strongest in the following way:</p>
<ol type="1">
<li>The points where the storm is at its lowest atmospheric pressure (generally, the lower the atmospheric pressure, the more trouble a tropical disturbance will cause).</li>
<li>If there’s a tie, we might want to know when the maximum wind speed occurred.</li>
<li>If that still doesn’t get us a single row for each observation, lets just pick out the status and category (these are determined by wind speed, so they should be the same if maximum wind speed is the same) and compute the average time where this occurred.</li>
</ol>
<p>Let’s start by translating these criteria into basic operations. I’ll use dplyr function names here, but I’ll also specify what I mean when there’s a conflict (e.g.&nbsp;filter in dplyr means something different than filter in python).</p>
<p>Initial attempt:</p>
<ol type="1">
<li>
<strong>For each storm</strong> (<code>group_by</code>),</li>
<li>we need the point where the storm has lowest atmospheric pressure. (<code>filter</code> - pick the row with the lowest pressure).</li>
</ol>
<p>Then we read the next part: “If there is a tie, pick the maximum wind speed.”</p>
<ol type="1">
<li><code>group_by</code></li>
<li>
<code>arrange</code> by ascending pressure and descending wind speed</li>
<li>
<code>filter</code> - pick the row(s) which have the lowest pressure and highest wind speed</li>
</ol>
<p>Then, we read the final condition: if there is still a tie, pick the status and category and compute the average time.</p>
<ol type="1">
<li><code>group_by</code></li>
<li>
<code>arrange</code> by ascending pressure and descending wind speed (this is optional if we write our filter in a particular way)</li>
<li>
<code>filter</code> - pick the row(s) which have the lowest pressure and highest wind speed</li>
<li>
<code>summarize</code> - compute the average time and category (if there are multiple rows)</li>
</ol>
<p>Let’s write the code, now that we have the order of operations straight!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">max_power_storm</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Storm names can be reused, so we need to have year to be sure it's the same instance</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">pressure</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">pressure</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">wind</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">wind</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>pressure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pressure</span><span class="op">)</span>, </span>
<span>            wind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">wind</span><span class="op">)</span>, </span>
<span>            category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, </span>
<span>            status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">status</span><span class="op">)</span>, </span>
<span>            time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">max_power_storm</span></span>
<span><span class="co">## # A tibble: 665 × 7</span></span>
<span><span class="co">##    name      year pressure  wind category status         time               </span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;          &lt;dttm&gt;             </span></span>
<span><span class="co">##  1 Amy       1975      981    60       NA tropical storm 1975-07-02 12:00:00</span></span>
<span><span class="co">##  2 Blanche   1975      980    75        1 hurricane      1975-07-28 00:00:00</span></span>
<span><span class="co">##  3 Caroline  1975      963   100        3 hurricane      1975-08-31 06:00:00</span></span>
<span><span class="co">##  4 Doris     1975      965    95        2 hurricane      1975-09-02 21:00:00</span></span>
<span><span class="co">##  5 Eloise    1975      955   110        3 hurricane      1975-09-23 12:00:00</span></span>
<span><span class="co">##  6 Faye      1975      977    75        1 hurricane      1975-09-28 18:00:00</span></span>
<span><span class="co">##  7 Gladys    1975      939   120        4 hurricane      1975-10-02 15:00:00</span></span>
<span><span class="co">##  8 Hallie    1975     1002    45       NA tropical storm 1975-10-27 03:00:00</span></span>
<span><span class="co">##  9 Belle     1976      957   105        3 hurricane      1976-08-09 00:00:00</span></span>
<span><span class="co">## 10 Dottie    1976      996    45       NA tropical storm 1976-08-20 06:00:00</span></span>
<span><span class="co">## # ℹ 655 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>grouped_storms <span class="op">=</span> storms.groupby([<span class="st">"name"</span>, <span class="st">"year"</span>])</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>grouped_storm_sum <span class="op">=</span> grouped_storms.agg({</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pressure"</span>: <span class="kw">lambda</span> x: x.<span class="bu">min</span>()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>}).reindex()</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This gets all the information from storms</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># corresponding to name/year/max pressure</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>max_power_storm <span class="op">=</span> grouped_storm_sum.merge(storms, on <span class="op">=</span> [<span class="st">"name"</span>, <span class="st">"year"</span>, <span class="st">"pressure"</span>])</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>max_power_storm <span class="op">=</span> max_power_storm.groupby([<span class="st">"name"</span>, <span class="st">"year"</span>]).agg({</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pressure"</span>: <span class="st">"min"</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wind"</span>: <span class="st">"max"</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"category"</span>: <span class="st">"mean"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"status"</span>: <span class="st">"unique"</span>,</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"time"</span>: <span class="st">"mean"</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>If we want to see a visual summary, we could plot a histogram of the minimum pressure of each storm.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">max_power_storm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pressure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/ggplot-storms-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ggplot(max_power_storm, aes(x <span class="op">=</span> <span class="st">"pressure"</span>)) <span class="op">+</span> geom_histogram(bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;Figure Size: (640 x 480)&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/ggplot-storms-py-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We could also look to see whether there has been any change over time in pressure.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">max_power_storm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">pressure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/ggplot-power-pressure-r-3.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ggplot(max_power_storm, aes(x <span class="op">=</span> <span class="st">"time"</span>, y <span class="op">=</span> <span class="st">"pressure"</span>)) <span class="op">+</span> geom_point()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;Figure Size: (640 x 480)&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/ggplot-power-pressure-py-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>It seems to me that there are fewer high-pressure storms before 1990 or so, which may be due to the fact that some weak storms may not have been observed or recorded prior to widespread radar coverage in the Atlantic.</p>

<p>Another interesting way to look at this data would be to examine the duration of time a storm existed, as a function of its maximum category. Do stronger storms exist for a longer period of time?</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">storm_strength_duration</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span>, </span>
<span>            max_strength <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">max_strength</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">storm_strength_duration</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">max_strength</span>, y <span class="op">=</span> <span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Error in `geom_boxplot()`:</span></span>
<span><span class="co">## ! Problem while computing stat.</span></span>
<span><span class="co">## ℹ Error occurred in the 1st layer.</span></span>
<span><span class="co">## Caused by error in `if (...) NULL`:</span></span>
<span><span class="co">## ! missing value where TRUE/FALSE needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>storm_strength_duration <span class="op">=</span> storms.groupby([<span class="st">"name"</span>, <span class="st">"year"</span>]).agg(duration <span class="op">=</span> (<span class="st">"time"</span>, <span class="kw">lambda</span> x: <span class="bu">max</span>(x) <span class="op">-</span> <span class="bu">min</span>(x)),max_strength <span class="op">=</span> (<span class="st">"category"</span>, <span class="st">"max"</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ggplot(aes(x <span class="op">=</span> <span class="st">"factor(max_strength)"</span>, y <span class="op">=</span> <span class="st">"duration"</span>), data <span class="op">=</span> storm_strength_duration) <span class="op">+</span> geom_boxplot()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">## TypeError: ggplot.__init__() got multiple values for argument 'data'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>You don’t need to know how to create these plots yet, but I find it much easier to look at the chart and answer the question I started out with.</p>
<p>We could also look to see how a storm’s diameter evolves over time, from when the storm is first identified (group_by + mutate)</p>
<p>Diameter measurements don’t exist for all storms, and they appear to measure the diameter of the wind field - that is, the region where the winds are hurricane or tropical storm force. (<code><a href="https://dplyr.tidyverse.org/reference/storms.html">?storms</a></code> documents the dataset and its variables).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p>Note the use of <code>as.numeric(as.character(max(category)))</code> to get the maximum (ordinal categorical) strength and convert that into something numeric that can be plotted.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">storm_evolution</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hurricane_force_diameter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_since_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="va">time</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">storm_evolution</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_since_start</span>, y <span class="op">=</span> <span class="va">hurricane_force_diameter</span>, </span>
<span>           group <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/storm-evo-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>storm_evolution <span class="op">=</span> storms.loc[storms.hurricane_force_diameter.notnull(),:]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>storm_evolution <span class="op">=</span> storm_evolution.assign(age <span class="op">=</span> storm_evolution.groupby([<span class="st">"name"</span>, <span class="st">"year"</span>], group_keys <span class="op">=</span> <span class="va">False</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.time <span class="op">-</span> x.time.<span class="bu">min</span>()))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>(ggplot(storm_evolution, </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>       aes(x <span class="op">=</span> <span class="st">"age"</span>, y <span class="op">=</span> <span class="st">"hurricane_force_diameter"</span>, </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>           group <span class="op">=</span> <span class="st">"name"</span>)) <span class="op">+</span> geom_line(alpha <span class="op">=</span> <span class="fl">.2</span>) <span class="op">+</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  facet_wrap(<span class="st">"year"</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>))</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;Figure Size: (640 x 480)&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/storm-evo-py-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>For this plot, I’ve added <code>facet_wrap(~year)</code> to produce sub-plots for each year. This helps us to be able to see some individuality, because otherwise there are far too many storms.</p>
<p>It seems that the vast majority of storms have a single bout of hurricane force winds (which either decreases or just terminates near the peak, presumably when the storm hits land and rapidly disintegrates). However, there are a few interesting exceptions - my favorite is in 2008 - the longest-lasting storm seems to have several local peaks in wind field diameter. If we want, we can examine that further by plotting it separately.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">storm_evolution</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2008</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">time_since_start</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 548 × 15</span></span>
<span><span class="co">##    name    year month   day  hour   lat  long status     category  wind pressure</span></span>
<span><span class="co">##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">##  1 Bertha  2008     7    21     6  58.5 -27   extratrop…       NA    45      990</span></span>
<span><span class="co">##  2 Bertha  2008     7    21     0  55.1 -31   extratrop…       NA    50      990</span></span>
<span><span class="co">##  3 Bertha  2008     7    20    18  53   -34   extratrop…       NA    55      990</span></span>
<span><span class="co">##  4 Bertha  2008     7    20    12  50   -37   extratrop…       NA    60      985</span></span>
<span><span class="co">##  5 Bertha  2008     7    20     6  47.6 -40   tropical …       NA    60      985</span></span>
<span><span class="co">##  6 Bertha  2008     7    20     0  45.3 -42.4 tropical …       NA    60      990</span></span>
<span><span class="co">##  7 Bertha  2008     7    19    18  43.7 -44.3 hurricane         1    65      989</span></span>
<span><span class="co">##  8 Bertha  2008     7    19    12  42.1 -46.3 hurricane         1    65      989</span></span>
<span><span class="co">##  9 Bertha  2008     7    19     6  40.4 -48   hurricane         1    65      989</span></span>
<span><span class="co">## 10 Bertha  2008     7    19     0  38.6 -49.7 hurricane         1    65      989</span></span>
<span><span class="co">## # ℹ 538 more rows</span></span>
<span><span class="co">## # ℹ 4 more variables: tropicalstorm_force_diameter &lt;int&gt;,</span></span>
<span><span class="co">## #   hurricane_force_diameter &lt;int&gt;, time &lt;dttm&gt;, time_since_start &lt;drtn&gt;</span></span>
<span></span>
<span><span class="va">storm_evolution</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Ike"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">hurricane_force_diameter</span>, color <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/storm-evo-year-3.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>storm_evolution.query(<span class="st">"year==2008"</span>).sort_values([<span class="st">'age'</span>], ascending <span class="op">=</span> <span class="va">False</span>).head()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">##      name  year  ...                time              age</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 8000  Ike  2008  ... 2008-09-14 06:00:00 13 days 00:00:00</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 7999  Ike  2008  ... 2008-09-14 00:00:00 12 days 18:00:00</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 7998  Ike  2008  ... 2008-09-13 18:00:00 12 days 12:00:00</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 7997  Ike  2008  ... 2008-09-13 12:00:00 12 days 06:00:00</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 7996  Ike  2008  ... 2008-09-13 07:00:00 12 days 01:00:00</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 12 columns]</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>(ggplot(</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  storm_evolution.query(<span class="st">"year==2008 &amp; name=='Ike'"</span>),</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  aes(x <span class="op">=</span> <span class="st">"time"</span>, y <span class="op">=</span> <span class="st">"hurricane_force_diameter"</span>, color <span class="op">=</span> <span class="st">"category"</span>)) <span class="op">+</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  geom_point())</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;Figure Size: (640 x 480)&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03-data-cleaning_files/figure-html/storm-evo-year-py-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-margin-content">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/coastal_radar_1995.png" class="img-fluid figure-img"></p>
<figcaption>Radar coverage map from 1995, from <span class="citation" data-cites="massPacificNorthwestHas2006"><a href="#ref-massPacificNorthwestHas2006" role="doc-biblioref">[12]</a></span></figcaption></figure>
</div>
</div></div></section><section id="summarizing-across-multiple-variables" class="level2" data-number="22.9"><h2 data-number="22.9" class="anchored" data-anchor-id="summarizing-across-multiple-variables">
<span class="header-section-number">22.9</span> Summarizing Across Multiple Variables</h2>
<p>Suppose we want to summarize the numerical columns of any storm which was a hurricane (over the entire period it was a hurricane). We don’t want to write out all of the summarize statements individually, so we use <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> instead (in <code>dplyr</code>).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<p>The dplyr package is filled with other handy functions for accomplishing common data-wrangling tasks. <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> is particularly useful - it allows you to make a modification to several columns at the same time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/dplyr_across.png" class="img-fluid figure-img"></p>
<figcaption>dplyr’s across() function lets you apply a mutate or summarize statement to many columns (by Allison Horst)</figcaption></figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span> <span class="co"># for the make_datetime() function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">storms</span><span class="op">)</span></span>
<span></span>
<span><span class="va">storms</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Construct a time variable that behaves like a number but is formatted as a date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use across to get average of all numeric variables</span></span>
<span><span class="va">avg_hurricane_intensity</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="st">"hurricane"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">avg_hurricane_intensity</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">wind</span>, <span class="va">pressure</span>, <span class="va">tropicalstorm_force_diameter</span>, <span class="va">hurricane_force_diameter</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">wind</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># get top 10</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Make into a pretty table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 30%">
<col style="width: 26%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">wind</th>
<th style="text-align: right;">pressure</th>
<th style="text-align: right;">tropicalstorm_force_diameter</th>
<th style="text-align: right;">hurricane_force_diameter</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Allen</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">8.000000</td>
<td style="text-align: right;">122.9688</td>
<td style="text-align: right;">941.0312</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="even">
<td style="text-align: left;">Irma</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">8.942308</td>
<td style="text-align: right;">118.8462</td>
<td style="text-align: right;">941.6154</td>
<td style="text-align: right;">249.4231</td>
<td style="text-align: right;">75.96154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Andrew</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">8.000000</td>
<td style="text-align: right;">118.2609</td>
<td style="text-align: right;">946.6522</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mitch</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10.000000</td>
<td style="text-align: right;">115.9091</td>
<td style="text-align: right;">945.3182</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rita</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">9.000000</td>
<td style="text-align: right;">114.7368</td>
<td style="text-align: right;">931.6316</td>
<td style="text-align: right;">265.2941</td>
<td style="text-align: right;">97.05882</td>
</tr>
<tr class="even">
<td style="text-align: left;">Isabel</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">9.000000</td>
<td style="text-align: right;">112.1875</td>
<td style="text-align: right;">946.5417</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gilbert</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">9.000000</td>
<td style="text-align: right;">110.8929</td>
<td style="text-align: right;">945.4286</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="even">
<td style="text-align: left;">Luis</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">8.928571</td>
<td style="text-align: right;">110.5952</td>
<td style="text-align: right;">948.6190</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NaN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wilma</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">10.000000</td>
<td style="text-align: right;">110.3030</td>
<td style="text-align: right;">939.4242</td>
<td style="text-align: right;">349.8333</td>
<td style="text-align: right;">118.33333</td>
</tr>
<tr class="even">
<td style="text-align: left;">Matthew</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">9.880952</td>
<td style="text-align: right;">109.5238</td>
<td style="text-align: right;">952.1190</td>
<td style="text-align: right;">263.5714</td>
<td style="text-align: right;">62.02381</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<p><a href="https://stackoverflow.com/questions/63200530/python-pandas-equivalent-to-dplyr-1-0-0-summarizeacross">Stackoverflow reference</a></p>
<p>We can use python’s list comprehensions in combination with <code>.agg</code> to accomplish the same task as <code>dplyr</code>’s <code>across</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/storms.csv"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a time variable that behaves like a number but is formatted as a date</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> storms.assign(time <span class="op">=</span> pd.to_datetime(storms[[<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>]]))</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove year/month/day/hour</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> storms.drop([<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove non-hurricane points</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>storms <span class="op">=</span> storms.query(<span class="st">"status == 'hurricane'"</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of all remaining numeric variables</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> storms.select_dtypes(include <span class="op">=</span>[np.number]).columns.values</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>(storms.</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>set_index(<span class="st">"name"</span>).</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span>(cols).</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>groupby(<span class="st">'name'</span>).</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>agg({col: <span class="st">'mean'</span> <span class="cf">for</span> col <span class="kw">in</span> cols}))</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="co">##                 lat  ...  hurricane_force_diameter</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="co">## name                 ...                          </span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="co">## AL121991  38.850000  ...                       NaN</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="co">## Alberto   30.836735  ...                       NaN</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="co">## Alex      32.880769  ...                 48.461538</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="co">## Alicia    28.400000  ...                       NaN</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="co">## Allison   26.166667  ...                       NaN</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="co">## ...             ...  ...                       ...</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="co">## Teddy     25.793103  ...                103.448276</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="co">## Tomas     17.346154  ...                 24.230769</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="co">## Vince     34.100000  ...                 30.000000</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="co">## Wilma     22.327273  ...                118.333333</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeta      23.227273  ...                 29.545455</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="co">## [137 rows x 7 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, pandas skips NaN values. If we want to be more clear, or want to pass another argument into the function, we can use what is called a <strong>lambda function</strong> - basically, a “dummy” function that has some arguments but not all of the arguments. Here, our lambda function is a function of <code>x</code>, and we calculate <code>x.mean(skipna=True)</code> for each x passed in (so, for each column).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of all remaining numeric variables</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> storms.select_dtypes(include <span class="op">=</span>[np.number]).columns.values</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>(storms.</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>set_index(<span class="st">"name"</span>).</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span>(cols).</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>groupby(<span class="st">'name'</span>).</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>agg({col: <span class="kw">lambda</span> x: x.mean(skipna<span class="op">=</span><span class="va">True</span>) <span class="cf">for</span> col <span class="kw">in</span> cols}))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">##                 lat  ...  hurricane_force_diameter</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">## name                 ...                          </span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">## AL121991  38.850000  ...                       NaN</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Alberto   30.836735  ...                       NaN</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Alex      32.880769  ...                 48.461538</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Alicia    28.400000  ...                       NaN</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Allison   26.166667  ...                       NaN</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">## ...             ...  ...                       ...</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">## Teddy     25.793103  ...                103.448276</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">## Tomas     17.346154  ...                 24.230769</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">## Vince     34.100000  ...                 30.000000</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Wilma     22.327273  ...                118.333333</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeta      23.227273  ...                 29.545455</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co">## [137 rows x 7 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="try-it-out---data-cleaning" class="level2" data-number="22.10"><h2 data-number="22.10" class="anchored" data-anchor-id="try-it-out---data-cleaning">
<span class="header-section-number">22.10</span> Try it out - Data Cleaning</h2>
<p>You can <a href="https://www.gapminder.org/data/documentation/">read about the gapminder project here</a>.</p>
<p>The gapminder data used for this set of problems contains data from 142 countries on 5 continents. The filtered data in <code>gapminder</code> (in R) contain data about every 5 year period between 1952 and 2007, the country’s life expectancy at birth, population, and per capita GDP (in US $, inflation adjusted). In the <code>gapminder_unfiltered</code> table, however, things are a bit different. Some countries have yearly data, observations are missing, and some countries don’t have complete data. The <code>gapminder</code> package in python (install with <code>pip install gapminder</code>) is a port of the R package, but doesn’t contain the unfiltered data, so we’ll instead use a <a href="https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/gapminder_unfiltered.csv">CSV export</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Read in the Data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"gapminder"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span></span>
<span><span class="va">gapminder_unfiltered</span></span>
<span><span class="co">## # A tibble: 3,313 × 6</span></span>
<span><span class="co">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span><span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span><span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span><span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span><span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span><span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span><span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span><span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span><span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span><span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span><span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span><span class="co">## # ℹ 3,303 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>gapminder_unfiltered <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/gapminder_unfiltered.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 1: How Bad is It?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">Problem</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-3" role="tab" aria-controls="tabset-21-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<p>Using your EDA skills, determine <em>how bad</em> the unfiltered data are. You may want to look for missing values, number of records, etc. Use query or filter to show any countries which have incomplete data. Describe, in words, what operations were necessary to get this information.</p>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder_unfiltered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, missinglifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            missingpop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            missingGDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">2007</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 83 × 5</span></span>
<span><span class="co">##    country        n missinglifeExp missingpop missingGDP</span></span>
<span><span class="co">##    &lt;fct&gt;      &lt;int&gt;          &lt;int&gt;      &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">##  1 Armenia        4              0          0          0</span></span>
<span><span class="co">##  2 Aruba          8              0          0          0</span></span>
<span><span class="co">##  3 Australia     56              0          0          0</span></span>
<span><span class="co">##  4 Austria       57              0          0          0</span></span>
<span><span class="co">##  5 Azerbaijan     4              0          0          0</span></span>
<span><span class="co">##  6 Bahamas       10              0          0          0</span></span>
<span><span class="co">##  7 Barbados      10              0          0          0</span></span>
<span><span class="co">##  8 Belarus       18              0          0          0</span></span>
<span><span class="co">##  9 Belgium       57              0          0          0</span></span>
<span><span class="co">## 10 Belize        11              0          0          0</span></span>
<span><span class="co">## # ℹ 73 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to determine what gaps were present in the gapminder dataset, I determined how many years of data were available for each country by grouping the dataset and counting the rows. There should be 12 years worth of data between 1952 and 2007; as a result, I displayed the countries which did not have exactly 12 years of data.</p>
</div>
<div id="tabset-21-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  gapminder_unfiltered.</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  set_index(<span class="st">"country"</span>).</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">filter</span>([<span class="st">"lifeExp"</span>, <span class="st">"pop"</span>, <span class="st">"gdpPercap"</span>]).</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  groupby(<span class="st">"country"</span>).</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  agg(<span class="kw">lambda</span> x: x.notnull().<span class="bu">sum</span>()).</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  query(<span class="st">"lifeExp != 12 | pop != 12 | gdpPercap != 12"</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">##                       lifeExp  pop  gdpPercap</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co">## country                                      </span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Armenia                     4    4          4</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Aruba                       8    8          8</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Australia                  56   56         56</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Austria                    57   57         57</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co">## Azerbaijan                  4    4          4</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co">## ...                       ...  ...        ...</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co">## United Arab Emirates        8    8          8</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="co">## United Kingdom             13   13         13</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="co">## United States              57   57         57</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="co">## Uzbekistan                  4    4          4</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="co">## Vanuatu                     7    7          7</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="co">## [83 rows x 3 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to determine what gaps were present in the gapminder dataset, I determined how many years of data were available for each country by grouping the dataset and counting the rows. There should be 12 years worth of data between 1952 and 2007; as a result, I displayed the countries which did not have exactly 12 years of data.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 2: Exclude any data which isn’t at 5-year increments
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Start in 1952 (so 1952, 1957, 1962, …, 2007).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder_unfiltered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">2007</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2,013 × 6</span></span>
<span><span class="co">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span><span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span><span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span><span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span><span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span><span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span><span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span><span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span><span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span><span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span><span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span><span class="co">## # ℹ 2,003 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<p><a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">Reminder about python list comprehensions</a></p>
<p><a href="https://stackoverflow.com/questions/62914335/python-pandas-query-for-values-in-list">Explanation of the query @ statement</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>years_to_keep <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1952</span>, <span class="dv">2008</span>, <span class="dv">5</span>)]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>gapminder_unfiltered.query(<span class="st">"year in @years_to_keep"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">##           country continent  year  lifeExp       pop   gdpPercap</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0     Afghanistan      Asia  1952   28.801   8425333  779.445314</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1     Afghanistan      Asia  1957   30.332   9240934  820.853030</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2     Afghanistan      Asia  1962   31.997  10267083  853.100710</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 3     Afghanistan      Asia  1967   34.020  11537966  836.197138</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 4     Afghanistan      Asia  1972   36.088  13079460  739.981106</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">## ...           ...       ...   ...      ...       ...         ...</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 3308     Zimbabwe    Africa  1987   62.351   9216418  706.157306</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 3309     Zimbabwe    Africa  1992   60.377  10704340  693.420786</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 3310     Zimbabwe    Africa  1997   46.809  11404948  792.449960</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 3311     Zimbabwe    Africa  2002   39.989  11926563  672.038623</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 3312     Zimbabwe    Africa  2007   43.487  12311143  469.709298</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co">## [2013 rows x 6 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 3: Exclude any countries that don’t have a full set of observations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder_unfiltered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1952</span>, <span class="fl">2007</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>nobs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Use mutate instead of summarize so that all rows stay</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nobs</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">nobs</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1,704 × 6</span></span>
<span><span class="co">## # Groups:   country [142]</span></span>
<span><span class="co">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span><span class="co">##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span><span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span><span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span><span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span><span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span><span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span><span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span><span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span><span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span><span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span><span class="co">## # ℹ 1,694 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>years_to_keep <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1952</span>, <span class="dv">2008</span>, <span class="dv">5</span>)]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  gapminder_unfiltered.</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove extra years</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  query(<span class="st">"year in @years_to_keep"</span>).</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  groupby(<span class="st">"country"</span>).</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate number of observations (should be exactly 12)</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is the equivalent of mutate on a grouped data set</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">apply</span>(<span class="kw">lambda</span> grp: grp.assign(nobs <span class="op">=</span> grp[<span class="st">'lifeExp'</span>].notnull().<span class="bu">sum</span>())).</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep rows with 12 observations</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  query(<span class="st">"nobs == 12"</span>).</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove nobs column</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  drop(<span class="st">"nobs"</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="co">##                       country continent  year  lifeExp       pop   gdpPercap</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="co">## country                                                                     </span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Afghanistan 0     Afghanistan      Asia  1952   28.801   8425333  779.445314</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="co">##             1     Afghanistan      Asia  1957   30.332   9240934  820.853030</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="co">##             2     Afghanistan      Asia  1962   31.997  10267083  853.100710</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="co">##             3     Afghanistan      Asia  1967   34.020  11537966  836.197138</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="co">##             4     Afghanistan      Asia  1972   36.088  13079460  739.981106</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="co">## ...                       ...       ...   ...      ...       ...         ...</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="co">## Zimbabwe    3308     Zimbabwe    Africa  1987   62.351   9216418  706.157306</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="co">##             3309     Zimbabwe    Africa  1992   60.377  10704340  693.420786</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="co">##             3310     Zimbabwe    Africa  1997   46.809  11404948  792.449960</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="co">##             3311     Zimbabwe    Africa  2002   39.989  11926563  672.038623</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="co">##             3312     Zimbabwe    Africa  2007   43.487  12311143  469.709298</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a><span class="co">## [1704 rows x 6 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="additional-resources" class="level2 callout-learnmore" data-collapse="true" data-number="22.11"><h2 data-number="22.11" class="anchored" data-anchor-id="additional-resources">
<span class="header-section-number">22.11</span> Additional Resources</h2>
<ul>
<li><p><a href="https://stat545.com/dplyr-intro.html">Introduction to dplyr</a> and <a href="https://stat545.com/dplyr-single.html">Single Table dplyr functions</a></p></li>
<li><p>R for Data Science: <a href="https://r4ds.had.co.nz/transform.html">Data Transformations</a></p></li>
<li><p>Additional practice exercises: <a href="https://stat579-at-isu.github.io/materials/03_tidyverse/01_dplyr.html#19">Intro to the tidyverse</a>, <a href="https://stat579-at-isu.github.io/materials//03_tidyverse/02_dplyr-examples.html">group_by + summarize examples</a>, <a href="https://stat579-at-isu.github.io/materials//03_tidyverse/03_dplyr-examples.html#1">group_by + mutate examples</a> (from a similar class at Iowa State)</p></li>
<li><p><a href="https://vknight.org/SAS-R/Content/R-Chapter-03/">Base R data manipulation</a></p></li>
<li>
<p><a href="https://www.youtube.com/playlist?list=PL19ev-r1GBwkuyiwnxoHTRC8TTqP8OEi8">Videos of analysis of new data from Tidy Tuesday</a> - may include use of other packages, but almost definitely includes use of dplyr as well.</p>
<ul>
<li>
<a href="https://github.com/waiyanps/TidyTuesday-Python">TidyTuesday Python github repo</a> - replicating Tidy Tuesday analyses in Python with Pandas</li>
</ul>
</li>
</ul></section><section id="references" class="level2" data-number="22.12"><h2 data-number="22.12" class="anchored" data-anchor-id="references">
<span class="header-section-number">22.12</span> References</h2>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-pandasIndexingSelectingData2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">Pandas, <span>“Indexing and selecting data,”</span> <em>Pandas 1.4.3 Documentation</em>. 2022 [Online]. Available: <a href="https://pandas.pydata.org/docs/user_guide/indexing.html#indexing">https://pandas.pydata.org/docs/user_guide/indexing.html#indexing</a>. [Accessed: Jun. 30, 2022]</div>
</div>
<div id="ref-pwwangDatarGrammarData2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">pwwang, <span>“Datar: <span>A</span> <span>Grammar</span> of <span>Data</span> <span>Manipulation</span> in python.”</span> May 2022 [Online]. Available: <a href="https://pwwang.github.io/datar/">https://pwwang.github.io/datar/</a>. [Accessed: Jun. 30, 2022]</div>
</div>
<div id="ref-chowNycflights13DataPackage2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div>
<div class="csl-right-inline">M. Chow, <span>“nycflights13: <span>A</span> data package for nyc flights (the nycflights13 <span>R</span> package).”</span> 2020 [Online]. Available: <a href="https://github.com/tidyverse/nycflights13">https://github.com/tidyverse/nycflights13</a>. [Accessed: Jun. 30, 2022]</div>
</div>
<div id="ref-pythonfoundationDataStructures2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div>
<div class="csl-right-inline">Python Foundation, <span>“Data <span>Structures</span>,”</span> <em>Python 3.10.5 documentation</em>. Jun. 2022 [Online]. Available: <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions</a>. [Accessed: Jun. 30, 2022]</div>
</div>
<div id="ref-chinguyenTipsStringManipulation2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div>
<div class="csl-right-inline">C. Nguyen, <span>“Tips for <span>String</span> <span>Manipulation</span> in <span>Python</span>,”</span> <em>Towards Data Science</em>. Sep. 2021 [Online]. Available: <a href="https://towardsdatascience.com/tips-for-string-manipulation-in-python-92b1fc3f4d9f">https://towardsdatascience.com/tips-for-string-manipulation-in-python-92b1fc3f4d9f</a>. [Accessed: Jul. 01, 2022]</div>
</div>
<div id="ref-jacobvanderplasStringManipulationRegular2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div>
<div class="csl-right-inline">J. VanderPlas, <span>“String <span>Manipulation</span> and <span>Regular</span> <span>Expressions</span>,”</span> in <em>A <span>Whirlwind</span> <span>Tour</span> of <span>Python</span></em>, O’Reilly Media, 2016 [Online]. Available: <a href="https://jakevdp.github.io/WhirlwindTourOfPython/14-strings-and-regular-expressions.html">https://jakevdp.github.io/WhirlwindTourOfPython/14-strings-and-regular-expressions.html</a>. [Accessed: Jul. 01, 2022]</div>
</div>
<div id="ref-whortonApplyingCustomFunctions2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div>
<div class="csl-right-inline">C. Whorton, <span>“Applying <span>Custom</span> <span>Functions</span> to <span>Groups</span> of <span>Data</span> in <span>Pandas</span>,”</span> <em>Medium</em>. Jul. 2021 [Online]. Available: <a href="https://towardsdatascience.com/applying-custom-functions-to-groups-of-data-in-pandas-928d7eece0aa">https://towardsdatascience.com/applying-custom-functions-to-groups-of-data-in-pandas-928d7eece0aa</a>. [Accessed: Jul. 01, 2022]</div>
</div>
<div id="ref-wickhamSplitapplycombineStrategyData2011" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div>
<div class="csl-right-inline">H. Wickham, <span>“The split-apply-combine strategy for data analysis,”</span> <em>Journal of statistical software</em>, vol. 40, pp. 1–29, 2011. </div>
</div>
<div id="ref-GroupSplitapplycombine2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div>
<div class="csl-right-inline">
<span>“Group by: Split-apply-combine,”</span> in <em>Pandas 1.4.3 documentation</em>, Python, 2022 [Online]. Available: <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html">https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html</a>. [Accessed: Jul. 01, 2022]</div>
</div>
<div id="ref-deanMapReduceSimplifiedData2008" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div>
<div class="csl-right-inline">J. Dean and S. Ghemawat, <span>“<span>MapReduce</span>: Simplified data processing on large clusters,”</span> <em>Communications of the ACM</em>, vol. 51, no. 1, pp. 107–113, Jan. 2008, doi: <a href="https://doi.org/10.1145/1327452.1327492">10.1145/1327452.1327492</a>. </div>
</div>
<div id="ref-danchoAnswerThereUngroup2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div>
<div class="csl-right-inline">M. Dancho, <span>“Answer to "<span>Is</span> there an "ungroup by" operation opposite to .groupby in pandas?",”</span> <em>Stack Overflow</em>. Mar. 2021 [Online]. Available: <a href="https://stackoverflow.com/a/66879388/2859168">https://stackoverflow.com/a/66879388/2859168</a>. [Accessed: Jul. 01, 2022]</div>
</div>
<div id="ref-massPacificNorthwestHas2006" class="csl-entry" role="listitem">
<div class="csl-left-margin">[12] </div>
<div class="csl-right-inline">C. Mass, <span>“The pacific northwest has the worst coastal weather radar coverage in the continental u.s.: Documentation of the problem and a call for action. Department of atmospheric sciences,”</span> Jan. 12, 2006. [Online]. Available: <a href="https://www.atmos.washington.edu/~cliff/coastalradarold.html">https://www.atmos.washington.edu/~cliff/coastalradarold.html</a>. [Accessed: Jan. 14, 2023]</div>
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>See <a href="https://twitter.com/JennyBryan/status/722954354198597632">this twitter thread</a> for some horror stories. <a href="https://twitter.com/jengolbeck/status/1153064308483510272?s=20">This tweet</a> is also pretty good at showing one type of messiness.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The philosophy includes a preference for pipes, but this preference stems from the belief that code should be readable in the same way that text is readable.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>It accomplishes this through the magic of quasiquotation, which we will not cover in this course because it’s basically witchcraft.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/srvanderplas\.github\.io\/stat-computing-r-python\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="srvanderplas/stat-computing-r-python" data-repo-id="R_kgDOIvwd2g" data-category="General" data-category-id="DIC_kwDOIvwd2s4CTksR" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../part-wrangling/02c-good-graphics.html" class="pagination-link" aria-label="Creating Good Charts">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part-wrangling/04-strings.html" class="pagination-link" aria-label="Working with Strings">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Working with Strings</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Susan Vanderplas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/03-data-cleaning.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/srvanderplas">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://datavis.social/%40srvanderplas">
      <i class="bi bi-mastodon" role="img" aria-label="Mastodon">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://%40srvanderplas.bsky.social">
      <i class="bi bi-bluesky" role="img" aria-label="Bluesky">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>