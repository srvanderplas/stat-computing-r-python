<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Heike Hofmann">
<meta name="dcterms.date" content="2025-09-02">
<title>25&nbsp; Normal Forms of Data – Statistical Computing using R and Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part-wrangling/06-data-join.html" rel="next">
<link href="../part-wrangling/05-data-reshape.html" rel="prev">
<link href="../build_deps/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-fced259a1985fd972ecb57c7cd45153f.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-f07762a21ba25cba39e145f6fd1c637f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4ZFBDKXJXP"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4ZFBDKXJXP', { 'anonymize_ip': true});
</script><script src="https://kit.fontawesome.com/baac5f0610.js" crossorigin="anonymous"></script><style>
div.callout-demo.callout {
  border-left-color: #91d5d4;
}
div.callout-demo.callout-style-default > .callout-header {
  background-color: rgba(145, 213, 212, 0.13);
}
div.callout-demo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-demo.callout-style-default .callout-icon::before, div.callout-demo.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f12e' !important;
  background-image: none;
}
div.callout-advanced.callout {
  border-left-color: #cbbaf9;
}
div.callout-advanced.callout-style-default > .callout-header {
  background-color: rgba(203, 186, 249, 0.13);
}
div.callout-advanced .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-advanced.callout-style-default .callout-icon::before, div.callout-advanced.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f5dc' !important;
  background-image: none;
}
div.callout-diy.callout {
  border-left-color: #b3e094;
}
div.callout-diy.callout-style-default > .callout-header {
  background-color: rgba(179, 224, 148, 0.13);
}
div.callout-diy .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-diy.callout-style-default .callout-icon::before, div.callout-diy.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f0ad' !important;
  background-image: none;
}
div.callout-example.callout {
  border-left-color: #f39c12;
}
div.callout-example.callout-style-default > .callout-header {
  background-color: rgba(243, 156, 18, 0.13);
}
div.callout-example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-example.callout-style-default .callout-icon::before, div.callout-example.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f206' !important;
  background-image: none;
}
div.callout-setup.callout {
  border-left-color: #f3e969;
}
div.callout-setup.callout-style-default > .callout-header {
  background-color: rgba(243, 233, 105, 0.13);
}
div.callout-setup .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-setup.callout-style-default .callout-icon::before, div.callout-setup.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f6e3' !important;
  background-image: none;
}
div.callout-learnmore.callout {
  border-left-color: #f09bb6;
}
div.callout-learnmore.callout-style-default > .callout-header {
  background-color: rgba(240, 155, 182, 0.13);
}
div.callout-learnmore .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-learnmore.callout-style-default .callout-icon::before, div.callout-learnmore.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f02d' !important;
  background-image: none;
}
</style>
<link rel="stylesheet" href="../build_deps/style.css">
</head>
<body class="nav-sidebar floating slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-wrangling/00-wrangling.html">Part III: Data Wrangling</a></li><li class="breadcrumb-item"><a href="../part-wrangling/05b-normal-forms.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Computing using R and Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/srvanderplas/stat-computing-r-python/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-tools/00-tools-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/01-computer-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/02-setting-up-computer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Computer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/03-Rstudio-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio’s Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/04-scripts-notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scripts and Notebooks and Terminals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/05-git-and-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Version Control with Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/06-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducibility and Professional Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-gen-prog/00-gen-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: General Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01-basic-var-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variables and Basic Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01a-math-logical-operators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mathematical and Logical Operators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/02-prog-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Functions, Packages, and Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/03-data-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/035-matrix-calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matrix Calculations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/04-control-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/05-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/06-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/07-prog-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Programming With Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-wrangling/00-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/01-data-input.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Data Input</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02-basic-data-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Visualization Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02a-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02b-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">A Grammar of Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02c-good-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/03-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/04-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05-data-reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05b-normal-forms.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/06-data-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/07-datetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/08-functional-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-advanced-topics/00-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/01-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/02-data-doc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Data Documentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/03-web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/04-xml-json-list-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Record-based Data and List Processing Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/05-APIs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Application Programming Interfaces</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/06-pdf-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Working with PDFs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/07-intro-interactive-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Animated and Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/08-javascript-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">JavaScript Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/09-big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">“Big” Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/10-databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/11-arrow-parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Efficient Data Access: Arrow and Parquet Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/12-memory-handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Memory and Computational Efficiency</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../graveyard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Other Topics</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li>
<a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">25.1</span> Introduction</a>
  <ul class="collapse">
<li><a href="#benefits-of-normal-forms" id="toc-benefits-of-normal-forms" class="nav-link" data-scroll-target="#benefits-of-normal-forms"><span class="header-section-number">25.1.1</span> Benefits of Normal forms</a></li>
  </ul>
</li>
  <li><a href="#first-normal-form" id="toc-first-normal-form" class="nav-link" data-scroll-target="#first-normal-form"><span class="header-section-number">25.2</span> First Normal Form</a></li>
  <li>
<a href="#second-normal-form" id="toc-second-normal-form" class="nav-link" data-scroll-target="#second-normal-form"><span class="header-section-number">25.3</span> Second Normal Form</a>
  <ul class="collapse">
<li><a href="#normalization-1st-nf-to-2nd-nf" id="toc-normalization-1st-nf-to-2nd-nf" class="nav-link" data-scroll-target="#normalization-1st-nf-to-2nd-nf"><span class="header-section-number">25.3.1</span> Normalization: 1st NF to 2nd NF</a></li>
  </ul>
</li>
  <li>
<a href="#third-normal-form" id="toc-third-normal-form" class="nav-link" data-scroll-target="#third-normal-form">Third Normal Form</a>
  <ul class="collapse">
<li><a href="#key-value-pairs-kvp" id="toc-key-value-pairs-kvp" class="nav-link" data-scroll-target="#key-value-pairs-kvp"><span class="header-section-number">25.3.2</span> Key-Value Pairs (KVP)</a></li>
  </ul>
</li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">25.4</span> Next steps</a></li>
  <li><a href="#other-resources" id="toc-other-resources" class="nav-link" data-scroll-target="#other-resources"><span class="header-section-number">25.5</span> Other resources</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">25.6</span> References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/05b-normal-forms.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-wrangling/00-wrangling.html">Part III: Data Wrangling</a></li><li class="breadcrumb-item"><a href="../part-wrangling/05b-normal-forms.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-data-nf" class="quarto-section-identifier"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Heike Hofmann </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><p>This chapter provides a bit of an ‘under-the-hood’ view of reshaping data and links it to some concepts in database design and data organization from the computer science view point.</p>
<section id="objectives" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Understand the origin of fsome of the parameter names in data manipulation functions, such as
<ul>
<li>the parameters <code>key</code> and <code>value</code> in <code>pandas.melt</code>
</li>
<li>why the long form of many data sets is called “tidy”</li>
</ul>
</li>
<li>Determine the <em>key variable(s)</em> in a dataset</li>
</ul></section><section id="introduction" class="level2 page-columns page-full" data-number="25.1"><h2 data-number="25.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">25.1</span> Introduction</h2>
<p>Normal forms were developed in the 1970s by <a href="https://en.wikipedia.org/wiki/Edgar_F._Codd">E.F. Codd</a> as a theoretical framework to describe data structures in (relational) data bases. For the purpose of the considerations here, you can think of a data base as a bundle of data sets that are loosely connected - e.g.&nbsp;the data sets describe (different) aspects of the same objects, or they share some aspects (such as the same time or the same geography).</p>
<p>What we mean by a data set, is a spread-sheet style (rectangular) representation, with rows representing observations and columns representing variables. We will assume that the first row in the spread sheet contains the names of the variables. Similarly, we will assume there are no row names - any existing row names can be made into a column in the data set.</p>
<p>For the purpose of assessing the normal form of a data set. we distinguish between two types of variables: <strong>keys</strong> and <strong>non-key variables</strong>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key and Non-Key Variables
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <em>key</em> of a data frame is defined as the (set of) variable(s) that uniquely identifies each row.</p>
<p>Similarly, any variable that is not a key variable is a <em>non-key variable</em>.</p>
</div>
</div>
<p>There are various ways of recognizing key variables in a dataset: the easiest might be by their name; oftentimes a key variable is called an ‘identifier’, so watch out for variables with the letters <code>ID</code> in their name. Generally, the idea of a designed study and key variables are related: in a designed study, the combination of all design variables form a key. Any variables with values that are observed during the experiment, or collected after the study design is determined, are non-key variables.</p>
<p>In order to determine whether a set of variables forms a key, we will need to determine that there are no duplications in their combined values.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: is it a key?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let us assume, that we have the following dataset on measuring (repeatedly) different aspects and body parts of <a href="http://www.statsci.org/data/oz/wallaby.html">Wallabies</a>. This data is part of the Australian data and story library <a href="https://gksmyth.github.io/ozdasl/">OzDASL</a>. See the <a href="http://www.statsci.org/data/oz/wallaby.html">help page</a> for information about this data set and each of its variables.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="va">wallaby</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"../data/wallaby.csv"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">wallaby</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption<span class="op">=</span><span class="st">"First few lines of the wallaby data."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>First few lines of the wallaby data.</caption>
<thead><tr class="header">
<th style="text-align: right;">Anim</th>
<th style="text-align: right;">Sex</th>
<th style="text-align: left;">Loca</th>
<th style="text-align: right;">Leng</th>
<th style="text-align: right;">Head</th>
<th style="text-align: right;">Ear</th>
<th style="text-align: right;">Arm</th>
<th style="text-align: right;">Leg</th>
<th style="text-align: right;">Pes</th>
<th style="text-align: right;">Tail</th>
<th style="text-align: right;">Weight</th>
<th style="text-align: right;">Age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">178</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">185</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">250</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">210</td>
<td style="text-align: right;">142</td>
<td style="text-align: right;">307</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">324</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">174</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">454</td>
<td style="text-align: right;">290</td>
<td style="text-align: right;">69</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">369</td>
<td style="text-align: right;">129</td>
<td style="text-align: right;">198</td>
<td style="text-align: right;">340</td>
<td style="text-align: right;">257</td>
<td style="text-align: right;">568</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">408</td>
<td style="text-align: right;">155</td>
<td style="text-align: right;">237</td>
<td style="text-align: right;">411</td>
<td style="text-align: right;">308</td>
<td style="text-align: right;">648</td>
<td style="text-align: right;">570</td>
<td style="text-align: right;">97</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Strategy</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Is Anim the key?</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Is Anim + Age the key?</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>When determining whether this data set has a key, we might at first consider the variable <code>Anim</code> (animal number). However, the first couple of rows already show us that this variable is not uniquely describing a row/observation in the data. What about the combination of <code>Anim</code> and <code>Age</code>? In order for these two variables to be a key, their combination needs to be unique, i.e.&nbsp;for each animal, we can only have one set of measurements at any age. We can check whether that condition is fulfilled by tallying up the combination of <code>Anim</code> and <code>Age</code>.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">wallaby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Anim</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption<span class="op">=</span><span class="st">"Anim by itself is not uniquely identifying rows in the data."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Anim by itself is not uniquely identifying rows in the data.</caption>
<thead><tr class="header">
<th style="text-align: right;">Anim</th>
<th style="text-align: right;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">53</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: right;">45</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="odd">
<td style="text-align: right;">47</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: right;">57</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="odd">
<td style="text-align: right;">55</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="even">
<td style="text-align: right;">65</td>
<td style="text-align: right;">42</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Anim by itself is not a key variable, because for some animal ids we have multiple sets of measurements.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">wallaby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Anim</span>, <span class="va">Age</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption<span class="op">=</span><span class="st">"All combinations of animal ID and an animal's age only refer to one set of measurements."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>All combinations of animal ID and an animal’s age only refer to one set of measurements.</caption>
<thead><tr class="header">
<th style="text-align: right;">Anim</th>
<th style="text-align: right;">Age</th>
<th style="text-align: right;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">44</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">44</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">44</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The combination of <code>Anim</code> and <code>Age</code> uniquely describes each observation, and is therefore a key for the data set.</p>
</div>
</div>
</div>
</div>
</div>
<section id="benefits-of-normal-forms" class="level3 page-columns page-full" data-number="25.1.1"><h3 data-number="25.1.1" class="anchored" data-anchor-id="benefits-of-normal-forms">
<span class="header-section-number">25.1.1</span> Benefits of Normal forms</h3>
<p>Normal forms are used to describe the state that a particular data set is in – lower normal forms can always be transformed into higher forms. This process is called <em>normalization</em> of data. Normalizing data has various benefits:</p>
<p>Normalization</p>
<ul>
<li>avoids data redundancies,</li>
<li>reveals inconsistencies,</li>
<li>simplifies the data design,</li>
<li>increases lookup speeds (in data bases),</li>
<li>and makes sets of data easier to maintain.</li>
</ul>
<p>Most often we are only interested in the first three normal forms. For memorization you can think of these forms as going along with</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/the-key.jpeg" class="img-fluid figure-img"></p>
<figcaption>Image of two keys as a memorization help for the three normal forms of data.</figcaption></figure>
</div>
</div></div><ol type="1">
<li>The key</li>
<li>The whole key</li>
<li>and nothing but the key</li>
</ol></section></section><section id="first-normal-form" class="level2" data-number="25.2"><h2 data-number="25.2" class="anchored" data-anchor-id="first-normal-form">
<span class="header-section-number">25.2</span> First Normal Form</h2>
<p>A table is in <em>first normal form</em> if</p>
<ol type="1">
<li>every entry in the table is a single value, and</li>
<li>the table has a key.</li>
</ol>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Wallabies First Normal Form
</div>
</div>
<div class="callout-body-container callout-body">
<p>Below is a snapshot of a reshaped version of the previous example, where all measurements for each animal are captured in the list variable <code>measurements</code>. While <code>Anim</code> now should be a key variable (presumably it uniquely identifies each animal), the data set is still not in first normal form, because the entries in the variable <code>measurements</code> are data sets by themselves, not just single values.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">wallaby2</span> <span class="op">&lt;-</span> <span class="va">wallaby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Anim"</span>, <span class="st">"Sex"</span>, <span class="st">"Loca"</span><span class="op">)</span>, .key<span class="op">=</span><span class="st">"measurements"</span><span class="op">)</span> </span>
<span><span class="va">wallaby2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">## # A tibble: 6 × 4</span></span>
<span><span class="co">##    Anim   Sex Loca  measurements     </span></span>
<span><span class="co">##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;list&gt;           </span></span>
<span><span class="co">## 1    45     1 G     &lt;tibble [49 × 9]&gt;</span></span>
<span><span class="co">## 2    47     1 G     &lt;tibble [49 × 9]&gt;</span></span>
<span><span class="co">## 3    53     2 G     &lt;tibble [50 × 9]&gt;</span></span>
<span><span class="co">## 4    57     2 G     &lt;tibble [49 × 9]&gt;</span></span>
<span><span class="co">## 5    65     2 G     &lt;tibble [42 × 9]&gt;</span></span>
<span><span class="co">## 6    79     2 K     &lt;tibble [39 × 9]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Is <code>Anim</code> the key variable of <code>wallaby2</code>? For that we check whether the <code>Anim</code> variable is unique - and find out that it is not unique!</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Anim</span>, sort<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption<span class="op">=</span><span class="st">"We see in the frequency breakdown of `Anim`, that the animal ID for 125 is used twice, i.e. 125 seems to describe two different animals. This would indicate that animal numbers do not refer to an individual animal as the data description suggests."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>We see in the frequency breakdown of <code>Anim</code>, that the animal ID for 125 is used twice, i.e.&nbsp;125 seems to describe two different animals. This would indicate that animal numbers do not refer to an individual animal as the data description suggests.</caption>
<thead><tr class="header">
<th style="text-align: right;">Anim</th>
<th style="text-align: right;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">125</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">47</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">48</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This finding is a sign of an inconsistency in the data set - and just a first example of why we care about normal forms. Here, we identify the first entry in the results below as a completely different animal - it is male and lives in a different location. Most likely, this is a wrongly identified animal.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Anim</span> <span class="op">==</span> <span class="fl">125</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>caption<span class="op">=</span><span class="st">"Based on the listing for the values of animal 125, the very first entry does not fit in well with the other values."</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Based on the listing for the values of animal 125, the very first entry does not fit in well with the other values.</caption>
<thead><tr class="header">
<th style="text-align: right;">Anim</th>
<th style="text-align: right;">Sex</th>
<th style="text-align: left;">Loca</th>
<th style="text-align: right;">Leng</th>
<th style="text-align: right;">Head</th>
<th style="text-align: right;">Ear</th>
<th style="text-align: right;">Arm</th>
<th style="text-align: right;">Leg</th>
<th style="text-align: right;">Pes</th>
<th style="text-align: right;">Tail</th>
<th style="text-align: right;">Weight</th>
<th style="text-align: right;">Age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">125</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Ha</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">566</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">354</td>
<td style="text-align: right;">766</td>
<td style="text-align: right;">642</td>
<td style="text-align: right;">1310</td>
<td style="text-align: right;">1590</td>
<td style="text-align: right;">166</td>
</tr>
<tr class="even">
<td style="text-align: right;">125</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">H1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">125</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">H1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">156</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">125</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">H1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">208</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">157</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: right;">125</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">H1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">255</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">204</td>
<td style="text-align: right;">147</td>
<td style="text-align: right;">326</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td style="text-align: right;">125</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">H1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">301</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">389</td>
<td style="text-align: right;">240</td>
<td style="text-align: right;">66</td>
</tr>
</tbody>
</table>
</div>
</div>
<details><summary><p>Some detective work shows us that the additional entry for animal 125 is probably a missing entry for animal 126.</p>
</summary><p>With a bit of detective work, we can identify animal 126 as the most likely candidate for the set of measurements wrongly attributed to animal 125 (see <a href="#fig-wallaby125" class="quarto-xref">Figure&nbsp;<span>25.1</span></a>). The orange point corresponds to the entry wrongly assigned to animal 125. Its timing (<code>Age</code>) and value (<code>Weight</code>) make it the best fit for animal 126.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-wallaby125" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-wallaby125-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05b-normal-forms_files/figure-html/fig-wallaby125-1.png" class="img-fluid figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wallaby125-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25.1: Scatterplots of Weight by Age, facetted by animal number. Only male specimen in location Ha are considered. The orange point shows the measurements of the entry wrongly assigned to animal 125 (which is female and lives in a different location).
</figcaption></figure>
</div>
</div>
</div>
<p>In <a href="#fig-wallaby126" class="quarto-xref">Figure&nbsp;<span>25.2</span></a> all measurements for wallaby 126 are shown by age (in days) when they were taken. The additional measurement wrongly assigned to animal 125 is shown in orange. All of the values are sensible within the grow curves of animal 126.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-wallaby126" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-wallaby126-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05b-normal-forms_files/figure-html/fig-wallaby126-1.png" class="img-fluid figure-img" width="2100">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wallaby126-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25.2: Growth curves of animal 126 for all the measurements taken between days 50 and 200. In orange, the additional entry for animal 125 is shown. The values are consistent with animal 126’s growth.
</figcaption></figure>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cleaning the Wallaby data
</div>
</div>
<div class="callout-body-container callout-body">
<p>As a direct result of the normalization step, we make a change (!!!) to the orignial data.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cleaning Step 1</span></span>
<span><span class="va">wallaby_cleaner</span> <span class="op">&lt;-</span> <span class="va">wallaby</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Anim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Anim</span><span class="op">==</span><span class="fl">125</span> <span class="op">&amp;</span> <span class="va">Sex</span><span class="op">==</span><span class="fl">1</span>, <span class="fl">126</span>, <span class="va">Anim</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Making any changes to a dataset should never be done light-heartedly, always be well argued and well-documented. For the present example, we keep the above investigation as argument, and the code to show the exact nature of the cleaning step.</p>
</div>
</div>
</section><section id="second-normal-form" class="level2" data-number="25.3"><h2 data-number="25.3" class="anchored" data-anchor-id="second-normal-form">
<span class="header-section-number">25.3</span> Second Normal Form</h2>
<p>A data set is in <em>second normal form</em> if</p>
<ol type="1">
<li>it is in first normal form, and</li>
<li>all non-key variables depend on all parts of the key (no split key).</li>
</ol>
<p>Note, that tables in 1st normal form with a single key variable are automatically in 2nd normal form.</p>
<p>Regarding the example of the <code>wallaby</code> dataset, we see the dataset in its basic form is not in 2nd normal form, because the two non-key variables <code>Sex</code> (biological sex of the animal) and the animal’s location (<code>Loca</code>) only depend on the animal number <code>Anim</code>, and not on the <code>Age</code> variable.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Anim</span><span class="op">)</span> </span>
<span><span class="co">## # A tibble: 78 × 4</span></span>
<span><span class="co">## # Groups:   Anim [77]</span></span>
<span><span class="co">##     Anim   Sex Loca  measurements     </span></span>
<span><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;list&gt;           </span></span>
<span><span class="co">##  1    45     1 G     &lt;tibble [49 × 9]&gt;</span></span>
<span><span class="co">##  2    47     1 G     &lt;tibble [49 × 9]&gt;</span></span>
<span><span class="co">##  3    53     2 G     &lt;tibble [50 × 9]&gt;</span></span>
<span><span class="co">##  4    57     2 G     &lt;tibble [49 × 9]&gt;</span></span>
<span><span class="co">##  5    65     2 G     &lt;tibble [42 × 9]&gt;</span></span>
<span><span class="co">##  6    79     2 K     &lt;tibble [39 × 9]&gt;</span></span>
<span><span class="co">##  7    81     2 K     &lt;tibble [36 × 9]&gt;</span></span>
<span><span class="co">##  8    87     1 G     &lt;tibble [34 × 9]&gt;</span></span>
<span><span class="co">##  9    92     2 G     &lt;tibble [28 × 9]&gt;</span></span>
<span><span class="co">## 10    93     2 W     &lt;tibble [28 × 9]&gt;</span></span>
<span><span class="co">## # ℹ 68 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="normalization-1st-nf-to-2nd-nf" class="level3" data-number="25.3.1"><h3 data-number="25.3.1" class="anchored" data-anchor-id="normalization-1st-nf-to-2nd-nf">
<span class="header-section-number">25.3.1</span> Normalization: 1st NF to 2nd NF</h3>
<p>We can bring any data set that is in 1st normal form into second normal form by splitting the data set into two parts: all non-key elements that only depend on a part of the key are moved into a second data set, together with a copy of the part of the key that those elements rely on. All duplicate rows in the second dataset then need to be removed.</p>
<p>This construction results in two tables that are in 2nd normal form.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Getting the <code>wallaby</code> data into 2nd normal form
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the example of the <code>wallaby</code> data, we have identified the non-key variables <code>Sex</code> and <code>Loca</code> to only depend on the animal’s number - i.e.&nbsp;the values of these variables are animal-specific demographics, that do not change over the course of their lifetime.</p>
<p>We separate those variables into the data set <code>wallaby_demographics</code> and reduce the number of rows by finding a tally of the number of rows we summarize.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby_demographics</span> <span class="op">&lt;-</span> <span class="va">wallaby_cleaner</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Anim</span>, <span class="va">Sex</span>, <span class="va">Loca</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Anim</span>, <span class="va">Sex</span>, <span class="va">Loca</span><span class="op">)</span> </span>
<span><span class="co"># Don't need the total number</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have verified that <code>Anim</code> is a key for <code>wallaby_demographics</code>, we know that this table is in 2nd normal form.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby_demographics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Anim</span>, sort<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##   Anim n</span></span>
<span><span class="co">## 1   44 1</span></span>
<span><span class="co">## 2   45 1</span></span>
<span><span class="co">## 3   46 1</span></span>
<span><span class="co">## 4   47 1</span></span>
<span><span class="co">## 5   48 1</span></span>
<span><span class="co">## 6   53 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the key-splitting variables <code>Sex</code> and <code>Loca</code> being taken care of in the second dataset, we can safely remove those variables from the original data. To preserve the original, we actually create a separate copy called <code>wallaby_measurements</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby_measurements</span> <span class="op">&lt;-</span> <span class="va">wallaby_cleaner</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Sex</span>, <span class="op">-</span><span class="va">Loca</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wallaby_measurements</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##   Anim Leng Head Ear Arm Leg Pes Tail Weight Age</span></span>
<span><span class="co">## 1   45   NA  123  NA  59  69  59   93     NA  14</span></span>
<span><span class="co">## 2   45   NA  178  54  90 120  92  185     NA  28</span></span>
<span><span class="co">## 3   45   NA  250  92 130 210 142  307     NA  49</span></span>
<span><span class="co">## 4   45   NA  324 108 174 284 205  454    290  69</span></span>
<span><span class="co">## 5   45   NA  369 129 198 340 257  568    410  83</span></span>
<span><span class="co">## 6   45   NA  408 155 237 411 308  648    570  97</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>wallaby_measurements</code> dataset has the combination of <code>Anim</code> and <code>Age</code> as a key, and all of the variables are measurement that depend on both the animal and its age. This data set is therefore also in second normal form.</p>
</div>
</div>
<p>In the normalization process we spotted one inconsistency (animal 125), which we resolved earlier, and we reduced the overall size of the data has been reduced from 12 x 1463 = 17,556 to the sum of 4 x 77 = 308 and 10 x 1463 = 14,630 for the <code>wallaby_demographics</code> and the <code>wallaby_measurements</code> data, respectively.</p>
</section></section><section id="third-normal-form" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="third-normal-form">Third Normal Form</h2>
<p>A table is in <em>third normal form</em> if</p>
<ul>
<li>the table is in 2nd normal form, and</li>
<li>no non-key variable determines the values of another non-key variable.</li>
</ul>
<p>Being able to determine whether any (combination of) non-key variables determine(s) the values of other non-key variables is a hard task. We would need to be the data experts in a lot of areas, and even then we might miss some dependencies and declare a table to be in third normal form when, in fact, it is not.</p>
<p>Rather than this form of the third normal form, we often employ a stricter normal form that only allows a single non-key variable to ensure that there are no dependencies left between non-key variables. This form is also called <em>key-value pairs</em></p>
<section id="key-value-pairs-kvp" class="level3" data-number="25.3.2"><h3 data-number="25.3.2" class="anchored" data-anchor-id="key-value-pairs-kvp">
<span class="header-section-number">25.3.2</span> Key-Value Pairs (KVP)</h3>
<p>A table is in <em>key-value representation</em> if</p>
<ul>
<li>the table is in 2nd form, and</li>
<li>there is only a single non-key column.</li>
</ul>
<p>Now we are finally at the point that we are connecting to the previous section on reshaping data. The way to bring data into key-value representation, is a transformation from a wide data form to a long form as described in <a href="05-data-reshape.html#sec-pivot-operations" class="quarto-xref"><span>Section 24.3</span></a> on pivot operations.</p>
<div class="callout callout-style-default callout-demo callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Demo: Wallaby key-value-pairs
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the previous section, we separated the original <code>wallaby</code> data into two parts: the <code>wallaby_demographics</code> and <code>wallaby_measurements</code> data sets.</p>
<p>There are two different ways of bringing datasets into key-value pairs using these datasets.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Splitting into parts</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Pivoting (R)</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Pivoting (Python)</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>For the <code>wallaby_demographics</code>, we will split the data into two parts: <code>wallaby_sex</code> and <code>wallaby_location</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby_sex</span> <span class="op">&lt;-</span> <span class="va">wallaby_demographics</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Anim</span>, <span class="va">Sex</span><span class="op">)</span></span>
<span><span class="va">wallaby_Location</span> <span class="op">&lt;-</span> <span class="va">wallaby_demographics</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Anim</span>, <span class="va">Loca</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Another approach to bringing a dataset into key-value pairs is to summarize the values of a set of variables by introducing a new key for the variable names.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wallaby_measurements_long</span> <span class="op">&lt;-</span> <span class="va">wallaby_measurements</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="st">'Leng'</span><span class="op">:</span><span class="st">'Weight'</span>, names_to<span class="op">=</span><span class="st">"Traits"</span>, values_to<span class="op">=</span><span class="st">"Measurements"</span>, </span>
<span>               values_drop_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">wallaby_measurements_long</span><span class="op">)</span></span>
<span><span class="co">## [1] 9905    4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">wallaby_measurements_long</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 4</span></span>
<span><span class="co">##    Anim   Age Traits Measurements</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;         &lt;int&gt;</span></span>
<span><span class="co">## 1    45    14 Head            123</span></span>
<span><span class="co">## 2    45    14 Arm              59</span></span>
<span><span class="co">## 3    45    14 Leg              69</span></span>
<span><span class="co">## 4    45    14 Pes              59</span></span>
<span><span class="co">## 5    45    14 Tail             93</span></span>
<span><span class="co">## 6    45    28 Head            178</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By specifying <code>values_drop_na</code> as <code>TRUE</code> we exclude all measurements that could not be taken, such as <code>Weight</code> for about the first 50 days of age, and <code>Leng</code> for the animal until the joey is ready to leave the safety of the pouch. Note, that while this normalization step might save space, the structural nature of missing values might be further hidden.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>Another approach to bringing a dataset into key-value pairs is to summarize the values of a set of variables by introducing a new key for the variable names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>wallaby_measurements_long <span class="op">=</span> pd.melt(r.wallaby_measurements, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  id_vars<span class="op">=</span>[<span class="st">'Anim'</span>, <span class="st">'Age'</span>], </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  var_name <span class="op">=</span> <span class="st">'Traits'</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  value_name <span class="op">=</span> <span class="st">'Measurements'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>wallaby_measurements_long <span class="op">=</span> wallaby_measurements_long[</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    wallaby_measurements_long[<span class="st">'Measurements'</span>] <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>wallaby_measurements_long  </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">##         Anim  Age  Traits  Measurements</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 24      45.0  377    Leng           844</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 25      45.0  405    Leng           855</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 26      45.0  432    Leng           873</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 27      45.0  482    Leng           902</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 28      45.0  517    Leng           905</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">## ...      ...  ...     ...           ...</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 11699  125.0  289  Weight         19840</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 11700  125.0  297  Weight         19330</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 11701  125.0  310  Weight         20910</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 11702  125.0  332  Weight         23770</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 11703  125.0  486  Weight         25000</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">## [9905 rows x 4 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Missing values in the R data set are interpreted as the value -2147483648 in python. We need to ensure that we remove all of these values (or convert them to <code>NaN</code>)</p>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="next-steps" class="level2" data-number="25.4"><h2 data-number="25.4" class="anchored" data-anchor-id="next-steps">
<span class="header-section-number">25.4</span> Next steps</h2>
<p>Units of measurements</p>
<p>Investigation of missing values: missing at random?</p>
</section><section id="other-resources" class="level2 callout-learnmore" data-number="25.5"><h2 data-number="25.5" class="anchored" data-anchor-id="other-resources">
<span class="header-section-number">25.5</span> Other resources</h2>
<p>From Decomplexify’s Youtube channel: <a href="https://www.youtube.com/watch?v=GFQaEYEc8_8">Learn Database Normalization - 1NF, 2NF, 3NF, 4NF, 5NF</a></p>
</section><section id="references" class="level2" data-number="25.6"><h2 data-number="25.6" class="anchored" data-anchor-id="references">
<span class="header-section-number">25.6</span> References</h2>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/srvanderplas\.github\.io\/stat-computing-r-python\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            trigger: 'click',
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            positionFixed: true,
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "srvanderplas/stat-computing-r-python";
    script.dataset.repoId = "R_kgDOIvwd2g";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOIvwd2s4CTksR";
    script.dataset.mapping = "pathname";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../part-wrangling/05-data-reshape.html" class="pagination-link" aria-label="Reshaping Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part-wrangling/06-data-join.html" class="pagination-link" aria-label="Joining Data">
        <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Joining Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Susan Vanderplas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/05b-normal-forms.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/srvanderplas">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>