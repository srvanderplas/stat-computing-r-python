<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-07-07">
<title>29&nbsp; Functional Programming – Statistical Computing using R and Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part-wrangling/09-spatial-formats.html" rel="next">
<link href="../part-wrangling/07-datetime.html" rel="prev">
<link href="../build_deps/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4ZFBDKXJXP"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4ZFBDKXJXP', { 'anonymize_ip': true});
</script><script src="https://kit.fontawesome.com/baac5f0610.js" crossorigin="anonymous"></script><style>
div.callout-setup.callout {
  border-left-color: #f3e969;
}
div.callout-setup.callout-style-default > .callout-header {
  background-color: rgba(243, 233, 105, 0.13);
}
div.callout-setup .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-setup.callout-style-default .callout-icon::before, div.callout-setup.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f6e3' !important;
  background-image: none;
}
div.callout-demo.callout {
  border-left-color: #91d5d4;
}
div.callout-demo.callout-style-default > .callout-header {
  background-color: rgba(145, 213, 212, 0.13);
}
div.callout-demo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-demo.callout-style-default .callout-icon::before, div.callout-demo.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f12e' !important;
  background-image: none;
}
div.callout-learnmore.callout {
  border-left-color: #f09bb6;
}
div.callout-learnmore.callout-style-default > .callout-header {
  background-color: rgba(240, 155, 182, 0.13);
}
div.callout-learnmore .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-learnmore.callout-style-default .callout-icon::before, div.callout-learnmore.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f02d' !important;
  background-image: none;
}
div.callout-example.callout {
  border-left-color: #f39c12;
}
div.callout-example.callout-style-default > .callout-header {
  background-color: rgba(243, 156, 18, 0.13);
}
div.callout-example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-example.callout-style-default .callout-icon::before, div.callout-example.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f206' !important;
  background-image: none;
}
div.callout-advanced.callout {
  border-left-color: #cbbaf9;
}
div.callout-advanced.callout-style-default > .callout-header {
  background-color: rgba(203, 186, 249, 0.13);
}
div.callout-advanced .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"></path></svg>');}
div.callout-advanced.callout-style-default .callout-icon::before, div.callout-advanced.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free', FontAwesome;
  font-style: normal;
  content: '\f5dc' !important;
  background-image: none;
}
</style>
<link rel="stylesheet" href="../build_deps/style.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-wrangling/00-wrangling.html">Part III: Data Wrangling</a></li><li class="breadcrumb-item"><a href="../part-wrangling/08-functional-prog.html"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Functional Programming</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Computing using R and Python</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/srvanderplas/stat-computing-r-python/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-tools/00-tools-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part I: Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/01-computer-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/02-setting-up-computer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Computer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/03-Rstudio-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio’s Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/04-scripts-notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Scripts and Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/05-git-and-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Version Control with Git</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/06-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducibility and Professional Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-gen-prog/00-gen-prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part II: General Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/00-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01-basic-var-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variables and Basic Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01a-math-logical-operators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Mathematical and Logical Operators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/02-prog-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Functions, Packages, and Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/03-data-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/035-matrix-calcs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Matrix Calculations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/04-control-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/05-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/06-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/07-prog-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Programming With Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/99-extra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Other Helpful Programming Resources</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-wrangling/00-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part III: Data Wrangling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/01-data-input.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Input</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02-basic-data-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Visualization Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02a-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02b-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02c-good-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/03-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/04-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Working with Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05-data-reshape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05b-normal-forms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Normal Forms of Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/06-data-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/07-datetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/08-functional-prog.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/09-spatial-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Spatial data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-advanced-topics/00-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/01-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Simulation and Reproducibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/02-data-doc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Data Documentation: Codebooks, Reproducibility, and more</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/03-web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/04-xml-json-list-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Record-based Data and List Processing Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/05-APIs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Application Programming Interfaces</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/06-pdf-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Working with PDFs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/07-intro-interactive-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/08-javascript-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Interactive Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/09-big-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">“Big” Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/10-databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Databases</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/11-arrow-parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Efficient Data Access: Arrow and Parquet Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-advanced-topics/12-memory-handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Memory and Computational Efficiency</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../graveyard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Other Topics</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li>
<a href="#programming-philosophies" id="toc-programming-philosophies" class="nav-link" data-scroll-target="#programming-philosophies"><span class="header-section-number">29.1</span> Programming Philosophies</a>
  <ul class="collapse">
<li><a href="#object-oriented-philosophy-in-r-and-python" id="toc-object-oriented-philosophy-in-r-and-python" class="nav-link" data-scroll-target="#object-oriented-philosophy-in-r-and-python"><span class="header-section-number">29.1.1</span> Object Oriented Philosophy in R and Python</a></li>
  <li><a href="#a-simple-functional-example" id="toc-a-simple-functional-example" class="nav-link" data-scroll-target="#a-simple-functional-example"><span class="header-section-number">29.1.2</span> A simple Functional Example</a></li>
  </ul>
</li>
  <li><a href="#replacing-loops-with-functional-programming" id="toc-replacing-loops-with-functional-programming" class="nav-link" data-scroll-target="#replacing-loops-with-functional-programming"><span class="header-section-number">29.2</span> Replacing Loops with Functional Programming</a></li>
  <li>
<a href="#complex-data-structures" id="toc-complex-data-structures" class="nav-link" data-scroll-target="#complex-data-structures"><span class="header-section-number">29.3</span> Complex Data Structures</a>
  <ul class="collapse">
<li><a href="#json-file-parsing" id="toc-json-file-parsing" class="nav-link" data-scroll-target="#json-file-parsing"><span class="header-section-number">29.3.1</span> JSON File Parsing</a></li>
  </ul>
</li>
  <li><a href="#assembling-hierarchical-data" id="toc-assembling-hierarchical-data" class="nav-link" data-scroll-target="#assembling-hierarchical-data"><span class="header-section-number">29.4</span> Assembling Hierarchical Data</a></li>
  <li><a href="#sec-functional-prog-refs" id="toc-sec-functional-prog-refs" class="nav-link" data-scroll-target="#sec-functional-prog-refs"><span class="header-section-number">29.5</span> References</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/08-functional-prog.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../part-wrangling/00-wrangling.html">Part III: Data Wrangling</a></li><li class="breadcrumb-item"><a href="../part-wrangling/08-functional-prog.html"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Functional Programming</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-lists" class="quarto-section-identifier"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></h1>
</div>



<div class="quarto-title-meta column-body">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><p>In this section, we’re going to change focus slightly from learning specific functions to learning programming <strong>patterns</strong>. We’re going to start this process by talking about functional programming and its connection to lists. While this topic may be a bit advanced if you’re just starting to learn how to program, it may help to skim through the deeper explanation so that you can at least recognize some of these words if you encounter them later.</p>
<section id="objectives" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Use functional programming to replace for loops</li>
<li>Articulate <em>why</em> functional programming can be preferable to using for loops</li>
<li>Use functional programming to clean data, model data subsets, and assemble hierarchical data.</li>
</ul></section><section id="programming-philosophies" class="level2 page-columns page-full" data-number="29.1"><h2 data-number="29.1" class="anchored" data-anchor-id="programming-philosophies">
<span class="header-section-number">29.1</span> Programming Philosophies</h2>
<div class="callout-advanced">
<p>This section is intended for everyone, but I do not expect that people who are just learning to program for the first time will fully absorb everything in this section. Get what you can out of this, use it to improve how you write code, and come back to it later if it’s too confusing.</p>
</div>
<p>Just as spoken languages fall into families, like Indo-European or Sino-Tibetan, programming languages also have broad classifications. Here are a few “families” or classifications of programming languages <span class="citation" data-cites="kuchlingFunctionalProgrammingHOWTO2022"><a href="#ref-kuchlingFunctionalProgrammingHOWTO2022" role="doc-biblioref">[1]</a></span>:</p>
<ul>
<li>Many languages are <strong>procedural</strong>: a program provides a list of instructions that tell the computer what to do with provided input. C, Pascal, Fortran, and UNIX shells are naturally procedural. JavaScript is also a fairly natural procedural language. Many R analysis scripts are also naturally written in a procedural style; SAS code is almost always procedural.</li>
<li>
<strong>Declarative languages</strong> use code to describe the problem that needs to be solved, and the language figures out how to solve it. SQL is the most common declarative language you’ll encounter for data-related tasks.</li>
<li>
<strong>Object oriented</strong> languages (sometimes abbreviated OOP, for object-oriented programming) manipulate collections of objects or classes. Data is stored in classes that have associated functions, which are often called methods. Java is explicitly object-oriented; C++ and Python support object-oriented programming but don’t force you to use those features.</li>
<li>
<strong>Functional</strong> programming languages describe a problem using a set of functions, which only take inputs and produce outputs. Functions don’t have any internal tracking of <strong>state</strong> - purely functional languages move from input to output without storing variables or even printing output to the command line, but it is common to adopt a functional approach to programming without requiring strict adherence to all principles of a fully functional approach. Haskell and Rust are fairly standard functional programming languages.</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="youtube-video-container margin-aside">
<p>Hadley’s talk on The Joy of Functional Programming for Data Science</p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/bzUmK0Y07ck" title="&quot;The Joy of Functional Programming (for Data Science)&quot; with Hadley Wickham" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div></div><p>Functional programming languages have a goal of writing <strong>pure functions</strong> - functions that do not change the global state (stuff stored in objects, memory, parameters, or files) of the program and thus have no side effects. The return value of a pure function is based solely on the inputs to the function. Not all functions can be pure functions - for instance, there’s no pure way to do file IO operations. But it is a nice goal to be able to move parameters into functions and have the correct object returned from that function, so that you can pipe multiple operations together into a pipeline.</p>
<p>Most general-purpose languages like C++ and Python and even some domain languages like R support multiple different programming paradigms. While preparing to write this chapter, I saw functional programming books with examples in Java <span class="citation" data-cites="urmaModernJavaAction2018"><a href="#ref-urmaModernJavaAction2018" role="doc-biblioref">[2]</a></span>, JavaScript <span class="citation" data-cites="FPJS"><a href="#ref-FPJS" role="doc-biblioref">[3]</a></span>, and C# <span class="citation" data-cites="buonannoFunctionalProgrammingHow2017"><a href="#ref-buonannoFunctionalProgrammingHow2017" role="doc-biblioref">[4]</a></span> - all languages that I would associate with OOP or procedural styles. I also found books teaching object oriented programming using Fortran 90-95 <span class="citation" data-cites="OOPfortran"><a href="#ref-OOPfortran" role="doc-biblioref">[5]</a></span>, which is something I wouldn’t have considered possible.</p>
<p>All of this is to say that while certain languages are built around principles like OOP or functional programming, almost every language has users who rely more heavily on one approach than the other. There are very few “pure” programming languages, which reminds me of one of my favorite quotes about English:</p>
<blockquote class="blockquote">
<p>“The problem with defending the purity of the English language is that English is about as pure as a cribhouse whore. We don’t just borrow words; on occasion, English has pursued other languages down alleyways to beat them unconscious and rifle their pockets for new vocabulary.” ― <a href="https://www.goodreads.com/quotes/694108-the-problem-with-defending-the-purity-of-the-english-language">James D. Nicoll</a></p>
</blockquote>
<section id="object-oriented-philosophy-in-r-and-python" class="level3 callout-demo" data-number="29.1.1"><h3 data-number="29.1.1" class="anchored" data-anchor-id="object-oriented-philosophy-in-r-and-python">
<span class="header-section-number">29.1.1</span> Object Oriented Philosophy in R and Python</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>When you call <code>df.size()</code> in Python, you are calling the <code>size</code> method that is part of the <code>df</code> object, which is a <code>DataFrame</code>. This suggests that Pandas, at least, is programmed using an object-oriented paradigm.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<!-- R is a bit of a trickier case.  -->
<!-- R has several different types of object-oriented structures that we usually avoid talking about until you start looking at developing your own R packages.  -->
<!-- R also was designed by people who enjoyed using Lisp - another multi-paradigm approach that accommodates functional programming, procedural programming, and object-oriented programming.  -->
<p>An easy example of R’s object oriented nature is that when you fit different models or perform different tests, the default output is different.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">~</span><span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Welch Two Sample t-test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  mtcars$mpg by mtcars$vs</span></span>
<span><span class="co">## t = -4.6671, df = 22.716, p-value = 0.0001098</span></span>
<span><span class="co">## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -11.462508  -4.418445</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## mean in group 0 mean in group 1 </span></span>
<span><span class="co">##        16.61667        24.55714</span></span>
<span></span>
<span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = mtcars$mpg ~ mtcars$vs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    mtcars$vs  </span></span>
<span><span class="co">##       16.62         7.94</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output is different because each test/regression model object has a different print method, which allows R to create different output for each type of object.</p>
</div>
</div>
</div>
</section><p>Functional programming allows us to write programs that are more modular, and thus, are easier to test and debug. In addition, functional programming encourages you to think about data <strong>pipelines</strong>: a sequence of steps that are reproducible and reusable for different data sets and analyses. Functional programming is convenient for another (more esoteric, but important) reason - it allows you to prove that a function or series of functions is actually correct (rather than just testing input/output combinations).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/functional-pipeline.png" class="img-fluid figure-img" alt="Cute fuzzy monsters putting rectangular data tables onto a conveyor belt. Along the conveyor belt line are different automated “stations” that update the data. A monster at the end of the conveyor belt is carrying away a table that reads “Complete analysis.”"></p>
<figcaption>A pipeline of functional data analysis. Each function (station) modifies the data in some way and the returned result is passed into the next function (station) as input. This allows a sequence of functions to format data, visualize it, model it, and then package the results. While this paradigm doesn’t require a functional approach, functional programming does make it simpler. Modified from <a href="https://github.com/allisonhorst/stats-illustrations">Allison Horst’s work</a></figcaption></figure>
</div>
<p>If you have been using the R pipe (<code>|&gt;</code> or <code>%&gt;%</code>), you didn’t realize it, but you were already using functional programming. Piping results from one function to another in a chain is a prime example of the “pure function” idea - it allows us to chain each step of a sequence together to create a sequence that is modular and testable.</p>
<section id="a-simple-functional-example" class="level3 callout-demo" data-number="29.1.2"><h3 data-number="29.1.2" class="anchored" data-anchor-id="a-simple-functional-example">
<span class="header-section-number">29.1.2</span> A simple Functional Example</h3>
<p>A <strong>functional</strong> is a function that takes another function as input and returns a vector as output.</p>
<p>One simple example of a functional that is found in both R and Python is the <code>apply</code> function (or variants in R like <code>lapply</code>, <code>sapply</code>, <code>tapply</code>). In Python, <code>.apply</code> is a method in Pandas, but we can find an even more low-level equivalent in the ideas of <strong>list comprehensions</strong> and <strong>map</strong> functions.</p>
<p>One additional concept that is helpful before we start is the idea of a <strong>lambda</strong> function - a small anonymous function (that is, a function that is not named or stored in a variable). Lambda functions are great for filling in default arguments, but they have many other uses as well.</p>
<p>Can you identify the lambda functions in each of the following examples?</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>This code generates 5 draws from a normal random variable with the specified mean and standard deviation 1.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1]  0.6652116  2.2279951  0.5638322 -0.8891574  0.3045355</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 2.305817 1.364385 2.712798 1.858802 3.475698</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] 1.5628505 1.2990412 0.5251061 2.5407071 2.8050195</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] 4.671318 3.412374 5.110232 3.996943 4.698185</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] 4.067292 3.546862 3.334648 3.657466 4.199336</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or, if you have R 4.1.0 or above, you can use a shorthand version:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] -0.6793415  3.4064359  0.0954131  0.1740986  2.6548898</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 3.2831551 1.2972347 0.4380291 3.2890082 1.5682724</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] 4.062777 2.171887 2.668378 2.802288 2.202140</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] 3.731001 5.087588 3.620371 4.698881 3.123684</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] 3.343634 5.715017 5.700827 3.669069 5.162631</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>\(x)</code> is shorthand for <code>function(x)</code> and allows you to quickly and easily define anonymous functions in R.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>This code generates 5 draws from a normal random variable with the specified mean and standard deviation 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># List comprehension approach</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> [np.random.normal(i, size <span class="op">=</span> <span class="dv">5</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>)]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r1) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([1.5640583 , 0.73298461, 0.37454742, 0.13161476, 1.05463533]), array([2.1942907 , 3.54704472, 2.34273371, 1.58699211, 1.42896473]), array([2.47799576, 3.46229152, 3.25270176, 3.66468144, 2.54508009]), array([1.58934981, 4.42855179, 3.20619176, 3.04389915, 4.15037666]), array([4.13751141, 4.91884926, 4.73111367, 4.78724875, 3.81006402])]</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Functional approach</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining a lambda function allows us to fill in non-default options</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> a: np.random.normal(a, size <span class="op">=</span> <span class="dv">5</span>), <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This is what map spits out by default</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;map object at 0x7fa7fcaa7c70&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># get your results back out with list()</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>r2b <span class="op">=</span> <span class="bu">list</span>(r2) </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2b)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([ 2.40318787,  2.52762584, -0.47847907,  2.99457109,  1.46109539]), array([1.02666147, 2.51794975, 1.32143262, 3.36346645, 1.21261538]), array([1.68141688, 0.95587671, 3.05878331, 2.9887431 , 2.95801636]), array([3.61115961, 4.58400768, 4.36828953, 5.04009114, 3.03999227]), array([6.09606091, 5.31374289, 4.40678554, 4.02987794, 5.3878085 ])]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section></section><section id="replacing-loops-with-functional-programming" class="level2 page-columns page-full" data-number="29.2"><h2 data-number="29.2" class="anchored" data-anchor-id="replacing-loops-with-functional-programming">
<span class="header-section-number">29.2</span> Replacing Loops with Functional Programming</h2>
<p>One really convenient application of functional programming is to replace loops. As Hadley Wickham says in <span class="citation" data-cites="advr"><a href="#ref-advr" role="doc-biblioref">[6]</a></span>,</p>
<blockquote class="blockquote">
<p>the real downside of for loops is that they’re very flexible: a loop conveys that you’re iterating, but not what should be done with the results</p>
</blockquote>
<p>That is, in many cases when programming with data, what we want is to iterate over a vector and return a vector of results. This is a <em>perfect</em> use case for functional programming, since we’re specifying both that we’re iterating AND more explicitly collecting the results into a form that makes sense.</p>
<p>If we work with this definition of functional programming, then python list comprehensions are also a functional approach: they specify how the results are collected (usually by putting <code>[]</code> around the statement) and how the iteration will occur <span class="citation" data-cites="rituraj_jainNestedListComprehensions2018"><a href="#ref-rituraj_jainNestedListComprehensions2018" role="doc-biblioref">[7]</a></span>.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>There is an excellent vignette comparing Base R functional programming approaches to the <code>purrr</code> package that is worth a look if you’ve used one and want to try the other <span class="citation" data-cites="hadleywickhamPurrrBase2022"><a href="#ref-hadleywickhamPurrrBase2022" role="doc-biblioref">[8]</a></span>.</p>
</div></div><p>Let’s look at a few examples.</p>
<div class="callout-demo">
<p>Suppose we want to look at the Lego data and create a decade variable that describes the decade a set was first released.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">base R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">R: <code>purrr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lego</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/lego_sets.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span><span class="op">$</span><span class="va">decade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">lego</span><span class="op">$</span><span class="va">year</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lego</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"set_num"</span>, <span class="st">"name"</span>, <span class="st">"year"</span>, <span class="st">"decade"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">##   set_num                       name year decade</span></span>
<span><span class="co">## 1   001-1                      Gears 1965   1960</span></span>
<span><span class="co">## 2  0011-2          Town Mini-Figures 1979   1970</span></span>
<span><span class="co">## 3  0011-3 Castle 2 for 1 Bonus Offer 1987   1980</span></span>
<span><span class="co">## 4  0012-1         Space Mini-Figures 1979   1970</span></span>
<span><span class="co">## 5  0013-1         Space Mini-Figures 1979   1970</span></span>
<span><span class="co">## 6  0014-1         Space Mini-Figures 1979   1970</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Strictly speaking, this use of <code>sapply</code> isn’t necessary - because R is vectorized by default, we could also have used <code>lego$decade &lt;- floor(lego$year/10)*10</code>. However, there are functions in R that are not fully vectorized, and it is useful to know this approach for those use-cases as well, and it’s easier to demonstrate this approach with a relatively simple use case.</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>In purrr, you can create anonymous functions using <code>~</code> with <code>.</code> as a placeholder. If you need more parameters, you can use <code>.x</code>, <code>.y</code> and <code>map2</code> (for now) or <code>.1</code>, <code>.2</code>, <code>.3</code>, <code>...</code> with <code>pmap</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/lego_sets.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span> <span class="op">&lt;-</span> <span class="va">lego</span> <span class="op">|&gt;</span> <span class="co"># Either pipe will work here</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>decade <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">year</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">set_num</span>, <span class="va">name</span>, <span class="va">year</span>, <span class="va">decade</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 4</span></span>
<span><span class="co">##   set_num name                        year decade</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;                      &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">## 1 001-1   Gears                       1965   1960</span></span>
<span><span class="co">## 2 0011-2  Town Mini-Figures           1979   1970</span></span>
<span><span class="co">## 3 0011-3  Castle 2 for 1 Bonus Offer  1987   1980</span></span>
<span><span class="co">## 4 0012-1  Space Mini-Figures          1979   1970</span></span>
<span><span class="co">## 5 0013-1  Space Mini-Figures          1979   1970</span></span>
<span><span class="co">## 6 0014-1  Space Mini-Figures          1979   1970</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>lego <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/lego_sets.csv"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>lego[<span class="st">'decade'</span>] <span class="op">=</span> [math.floor(i<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span> <span class="cf">for</span> i <span class="kw">in</span> lego.year]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>lego[[<span class="st">'set_num'</span>, <span class="st">'name'</span>, <span class="st">'year'</span>, <span class="st">'decade'</span>]].head()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">##   set_num                        name  year  decade</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 0   001-1                       Gears  1965    1960</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  0011-2           Town Mini-Figures  1979    1970</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  0011-3  Castle 2 for 1 Bonus Offer  1987    1980</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 3  0012-1          Space Mini-Figures  1979    1970</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 4  0013-1          Space Mini-Figures  1979    1970</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<p>For a more interesting example, though, let’s consider fitting a different linear regression for each generation of Pokemon, describing the relationship between HP (hit points) and CP (combat power, aka <code>total</code> in this dataset).</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>I am sure that the python code I’ve written here is a bit kludgy, so if you are more fluent in python/pandas than I am, please feel free to submit a pull request if you know a better or more “pretty” way to do this.</p>
</div></div><div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Pokemon modeling
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">base R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Tidy R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span><span class="co"># Get rid of mega pokemon - they're a different thing</span></span>
<span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">poke</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Mega"</span>, <span class="va">poke</span><span class="op">$</span><span class="va">variant</span><span class="op">)</span><span class="op">)</span> <span class="co"># step 1</span></span>
<span></span>
<span><span class="co"># Split into a list of data frames from each gen</span></span>
<span><span class="va">poke_gens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">poke</span><span class="op">$</span><span class="va">gen</span><span class="op">)</span> <span class="co"># step 2</span></span>
<span></span>
<span><span class="co"># Fit linear regressions for each generation of pokemon</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">poke_gens</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="co"># step 3</span></span>
<span></span>
<span><span class="co"># Pull out coefficients and r-squared values</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">models</span>, \<span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>coef1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, coef2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, rsq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span><span class="op">)</span>  <span class="co"># step 4</span></span>
<span></span>
<span><span class="co"># Join the results back into a data.frame</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">results</span><span class="op">)</span> <span class="co"># step 5</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">##      coef1    coef2       rsq</span></span>
<span><span class="co">## 1 262.4730 2.394032 0.3895255</span></span>
<span><span class="co">## 2 258.5815 2.133868 0.3165292</span></span>
<span><span class="co">## 3 245.3375 2.753912 0.2686807</span></span>
<span><span class="co">## 4 268.5792 2.792350 0.3500187</span></span>
<span><span class="co">## 5 189.1339 3.506458 0.5578802</span></span>
<span><span class="co">## 6 252.7434 2.798942 0.5278159</span></span>
<span><span class="co">## 7 234.9329 3.293730 0.4382885</span></span>
<span><span class="co">## 8 205.2726 3.500811 0.6042219</span></span>
<span><span class="co">## 9 236.8656 2.757408 0.4757028</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Data in data frame</li>
<li>Data split into a list of data frames</li>
<li>Models in a list corresponding to data in step 2</li>
<li>Results in a list of data frames corresponding to models in step 3</li>
<li>Bind results in step 4 back into a data frame</li>
</ol>
<p>In each step, we specify not only what the iterative action should be, but also what form the results will take.</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>In the tidyverse, we use <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::nest()</a></code> to accomplish a similar thing to <code>split</code> in base R.</p>
<p>This approach is designed to work entirely within a single data frame, which keeps the environment relatively clean and ensures that each step’s results are stored in a convenient, easy-to-find place.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># str_detect doesn't play nice with NAs, so replace NA with ""</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variant <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">variant</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Remove mega pokemon</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">variant</span>, <span class="st">"Mega"</span>, negate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 1</span></span>
<span>  <span class="co"># Sub-data-frames</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="va">gen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 2</span></span>
<span>  <span class="co"># Fit model</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 3</span></span>
<span>  <span class="co"># Extract coefficients</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>coef1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                                      coef2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                                      rsq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 4</span></span>
<span>  <span class="co"># Bind together</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="co"># step 5</span></span>
<span><span class="va">res</span></span>
<span><span class="co">## # A tibble: 9 × 6</span></span>
<span><span class="co">##     gen data                model  coef1 coef2   rsq</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;list&gt;              &lt;list&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1     1 &lt;tibble [269 × 15]&gt; &lt;lm&gt;    262.  2.39 0.390</span></span>
<span><span class="co">## 2     2 &lt;tibble [118 × 15]&gt; &lt;lm&gt;    259.  2.13 0.317</span></span>
<span><span class="co">## 3     3 &lt;tibble [173 × 15]&gt; &lt;lm&gt;    245.  2.75 0.269</span></span>
<span><span class="co">## 4     4 &lt;tibble [173 × 15]&gt; &lt;lm&gt;    269.  2.79 0.350</span></span>
<span><span class="co">## 5     5 &lt;tibble [236 × 15]&gt; &lt;lm&gt;    189.  3.51 0.558</span></span>
<span><span class="co">## 6     6 &lt;tibble [118 × 15]&gt; &lt;lm&gt;    253.  2.80 0.528</span></span>
<span><span class="co">## 7     7 &lt;tibble [133 × 15]&gt; &lt;lm&gt;    235.  3.29 0.438</span></span>
<span><span class="co">## 8     8 &lt;tibble [134 × 15]&gt; &lt;lm&gt;    205.  3.50 0.604</span></span>
<span><span class="co">## 9     9 &lt;tibble [123 × 15]&gt; &lt;lm&gt;    237.  2.76 0.476</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our data takes the form:</p>
<ol type="1">
<li>An ungrouped data frame</li>
<li>A data frame with 9 rows, one for each generation, with a list-column <code>data</code> that contains the full data for each generation</li>
<li>We fit our model and store the model results into another list-column named <code>model</code> that contains the fitted model object</li>
<li>We define some summary information and store it into a list-column containing each 1-row data frame</li>
<li>We “unnest” the summary information, which is equivalent to bringing the columns we defined up to the primary level and binding the rows together.</li>
</ol>
<p>At each step, we’re specifying the form of the results along with the contents.</p>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>This construct of storing everything inside a single data frame isn’t as common in Python, but we can make it work with only a little extra effort.</p>
<p>You will need to <code>pip install statsmodels</code> to get the <code>statsmodels</code> <span class="citation" data-cites="seabold2010statsmodels"><a href="#ref-seabold2010statsmodels" role="doc-biblioref">[9]</a></span> package that implements many basic statistical models. The <code>scikit-learn</code> package <span class="citation" data-cites="scikitlearn"><a href="#ref-scikitlearn" role="doc-biblioref">[10]</a></span> is another commonly used package <span class="citation" data-cites="menonLinearRegressionLines2018"><a href="#ref-menonLinearRegressionLines2018" role="doc-biblioref">[11]</a></span>, but it does not have the easy accessor functions to pull out e.g.&nbsp;coefficients and r-squared values, so we’ll use <code>statsmodels</code> here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to fit a linear regression</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># There is probably a better way to do this flexibly,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># but this approach is simple and useful for illustrative purposes</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pokereg(data):</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> data[[<span class="st">"hp"</span>]].values</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> data[[<span class="st">"total"</span>]].values</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> ols(<span class="st">'total ~ hp'</span>, data)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  results <span class="op">=</span> model.fit()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> results</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with ""</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>res[<span class="st">"variant"</span>] <span class="op">=</span> [<span class="st">""</span> <span class="cf">if</span> pd.isna(i) <span class="cf">else</span> i <span class="cf">for</span> i <span class="kw">in</span> res.variant]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove mega pokemon</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> res.query(<span class="st">'~(variant.str.contains("(?:^[mM]ega)"))'</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Group data frames and apply regression function to each group</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>res_reg <span class="op">=</span> (</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  res <span class="co"># step 1</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"gen"</span>) <span class="co"># step 2</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(pokereg) <span class="co"># step 3</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Make results into a dataframe and rename the column as 'results'</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>res_reg <span class="op">=</span> pd.DataFrame(res_reg).rename(columns <span class="op">=</span> {<span class="dv">0</span>:<span class="st">'results'</span>}) <span class="co"># step 4</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Get values of interest and store in new columns # step 5</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>res_reg <span class="op">=</span> res_reg.reset_index() <span class="co"># store gen in its own column</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>res_reg[<span class="st">'coef1'</span>] <span class="op">=</span> res_reg.results.<span class="bu">map</span>(<span class="kw">lambda</span> x: x.params[<span class="dv">0</span>])</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>res_reg[<span class="st">'coef2'</span>] <span class="op">=</span> res_reg.results.<span class="bu">map</span>(<span class="kw">lambda</span> x: x.params[<span class="dv">1</span>])</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>res_reg[<span class="st">'rsq'</span>] <span class="op">=</span> res_reg.results.<span class="bu">map</span>(<span class="kw">lambda</span> x: x.rsquared)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>res_reg[[<span class="st">'gen'</span>, <span class="st">'coef1'</span>, <span class="st">'coef2'</span>, <span class="st">'rsq'</span>]]</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">##    gen       coef1     coef2       rsq</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    1  262.472956  2.394032  0.389526</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">## 1    2  258.581538  2.133868  0.316529</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">## 2    3  245.337496  2.753912  0.268681</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">## 3    4  268.579237  2.792350  0.350019</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    5  189.133898  3.506458  0.557880</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">## 5    6  252.743437  2.798942  0.527816</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">## 6    7  234.932868  3.293730  0.438289</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">## 7    8  205.272637  3.500811  0.604222</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">## 8    9  236.865627  2.757408  0.475703</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While this doesn’t store our data in the same DataFrame as the model results, we do have a key that links the two: the <code>gen</code> variable is present in both <code>res</code> and <code>res_reg</code> and can be used to join the data to the regression results, if necessary.</p>
<ol type="1">
<li>Data in an ungrouped data frame</li>
<li>We group by <code>gen</code> (generation)</li>
<li>We apply the function <code>pokereg</code> to fit a linear regression, and the results are stored in an indexed Series where the index corresponds to <code>gen</code>.</li>
<li>We make the results into a DataFrame so that we can add extra columns, and rename the automatically created Series to <code>results</code> to be more descriptive</li>
<li>We create summary information and store the summaries in columns in the data frame.</li>
</ol>
<p>While the grouping and binding operations are in a different order in Python than in R, the basic specification of the structure of the output each time we iterate is similar.</p>
</div>
</div>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="youtube-video-container margin-aside">
<p>Here’s another demonstration of the use of the <code>tidymodels</code> package and <code>purrr</code> to fit multiple regression models to data subsets.</p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/KdDyRt9XV_g" title="Nested data frames and multiple models in R with Equitable Equations" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div></div></section><section id="complex-data-structures" class="level2 page-columns page-full" data-number="29.3"><h2 data-number="29.3" class="anchored" data-anchor-id="complex-data-structures">
<span class="header-section-number">29.3</span> Complex Data Structures</h2>
<p>Not all datasets are strictly tabular. One of the most common situations where we get data that can’t be made into a completely tabular structure is when we’re dealing with hierarchical data: tree structures, (network) graph structures, and even most webpages contain data that isn’t strictly tabular in nature. Sometimes, we can get that data into a tabular structure, but it generally depends on the data itself.</p>
<p>One of the most common structures for storing data on the web is <a href="https://www.json.org/json-en.html">JSON: JavaScript Object Notation</a><span class="citation" data-cites="wikipediacontributorsJSON2023"><a href="#ref-wikipediacontributorsJSON2023" role="doc-biblioref">[12]</a></span>.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>(JSON is pronounced “Jason”, like the person’s name).</p>
</div></div><p><img src="../images/wrangling/tmdb.svg" class="img-fluid" style="width:50.0%" alt="The Movie Database logo"> In this section we’ll work with some data gathered from TMDB (the movie database). I submitted a query for all movies that Patrick Stewart was involved with, and you can find the resulting JSON file <a href="https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Patrick_Stewart.json">here</a>.</p>
<section id="json-file-parsing" class="level3 callout-demo" data-number="29.3.1"><h3 data-number="29.3.1" class="anchored" data-anchor-id="json-file-parsing">
<span class="header-section-number">29.3.1</span> JSON File Parsing</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>We’ll use the <code>jsonlite</code> package to read the data in, but invariably this package still requires us to do some post-processing ourselves.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span><span class="va">data_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Patrick_Stewart.json"</span></span>
<span></span>
<span><span class="va">ps_json</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">data_url</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details><summary>
Exploring the output structure
</summary><div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># head(ps_json) # This output is too long</span></span>
<span><span class="va">ps_json</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span>max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ cast:'data.frame':    150 obs. of  17 variables:</span></span>
<span><span class="co">##  $ crew:'data.frame':    6 obs. of  17 variables:</span></span>
<span><span class="co">##  $ id  : int 2387</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">ps_json</span>, <span class="va">head</span><span class="op">)</span> <span class="co"># show the first 6 rows of each element in the list</span></span>
<span><span class="co">## $cast</span></span>
<span><span class="co">##   adult                    backdrop_path       genre_ids    id</span></span>
<span><span class="co">## 1 FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg 878, 28, 12, 53   193</span></span>
<span><span class="co">## 2 FALSE /wygUDDRNpeKUnkekRGeLCZM93tA.jpg 878, 28, 12, 53   199</span></span>
<span><span class="co">## 3 FALSE /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg 878, 28, 12, 53   200</span></span>
<span><span class="co">## 4 FALSE /6z9w8eidKWDDXwZNSVNaRolAYEP.jpg 878, 28, 12, 53   201</span></span>
<span><span class="co">## 5 FALSE /4ADZ2iiATjoKxZwjJRiEo1x6Fk0.jpg              99 10946</span></span>
<span><span class="co">## 6 FALSE                             &lt;NA&gt;              99 21746</span></span>
<span><span class="co">##   original_language              original_title</span></span>
<span><span class="co">## 1                en      Star Trek: Generations</span></span>
<span><span class="co">## 2                en    Star Trek: First Contact</span></span>
<span><span class="co">## 3                en     Star Trek: Insurrection</span></span>
<span><span class="co">## 4                en          Star Trek: Nemesis</span></span>
<span><span class="co">## 5                en                       Earth</span></span>
<span><span class="co">## 6                en The Secret of Life on Earth</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                overview</span></span>
<span><span class="co">## 1                                                                                                                                                                                                                                                                                                              Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years.</span></span>
<span><span class="co">## 2                                                                                                                                                                                                                                                    The Borg, a relentless race of cyborgs, are on a direct course for Earth. Violating orders to stay away from the battle, Captain Picard and the crew of the newly-commissioned USS Enterprise E pursue the Borg back in time to prevent the invaders from changing Federation history and assimilating the galaxy.</span></span>
<span><span class="co">## 3                                                                                                                                                                                                                                                                                 When an alien race and factions within Starfleet attempt to take over a planet that has "regenerative" properties, it falls upon Captain Picard and the crew of the Enterprise to defend the planet's people as well as the very ideals upon which the Federation itself was founded.</span></span>
<span><span class="co">## 4 En route to the honeymoon of William Riker to Deanna Troi on her home planet of Betazed, Captain Jean-Luc Picard and the crew of the U.S.S. Enterprise receives word from Starfleet that a coup has resulted in the installation of a new Romulan political leader, Shinzon, who claims to seek peace with the human-backed United Federation of Planets. Once in enemy territory, the captain and his crew make a startling discovery: Shinzon is human, a slave from the Romulan sister planet of Remus, and has a secret, shocking relationship to Picard himself.</span></span>
<span><span class="co">## 5                                                                                                                                                                                                                                                                                                 From the acclaimed team that brought you BBC's visual feast "Planet Earth," this feature length film incorporates some of the same footage from the series with all new scenes following three remarkable, yet sadly endangered, families of animal across the globe.</span></span>
<span><span class="co">## 6                                                                                                                                                                                                                                                                          A breathtaking adventure across five continents and through time to reveal nature's most vital secret. Watch a flying fox gorge itself on a midnight snack of figs. Climb into the prickly jaws of insect-eating plants. Witness a mantis disguised as a flower petal lure its prey to doom.</span></span>
<span><span class="co">##   popularity                      poster_path release_date</span></span>
<span><span class="co">## 1     19.783 /rHsCYDGHFUarGh5k987b0EFU6kC.jpg   1994-11-18</span></span>
<span><span class="co">## 2     29.750 /vrC1lkTktFQ4AqBfqf4PXoDDLcw.jpg   1996-11-22</span></span>
<span><span class="co">## 3     28.786 /xQCMAHeg5M9HpDIqanYbWdr4brB.jpg   1998-12-11</span></span>
<span><span class="co">## 4     33.614 /cldAwhvBmOv9jrd3bXWuqRHoXyq.jpg   2002-12-13</span></span>
<span><span class="co">## 5      9.188 /xybnXW6E28W9agiwUeGLbTYS454.jpg   2007-04-22</span></span>
<span><span class="co">## 6      1.831 /baa6T6noxiFUZcb6Jz8TjjlOoCH.jpg   1993-10-14</span></span>
<span><span class="co">##                         title video vote_average vote_count</span></span>
<span><span class="co">## 1      Star Trek: Generations FALSE        6.526       1126</span></span>
<span><span class="co">## 2    Star Trek: First Contact FALSE        7.305       1519</span></span>
<span><span class="co">## 3     Star Trek: Insurrection FALSE        6.425       1025</span></span>
<span><span class="co">## 4          Star Trek: Nemesis FALSE        6.293       1218</span></span>
<span><span class="co">## 5                       Earth FALSE        7.600        311</span></span>
<span><span class="co">## 6 The Secret of Life on Earth FALSE        6.000          1</span></span>
<span><span class="co">##                 character                credit_id order</span></span>
<span><span class="co">## 1 Captain Jean-Luc Picard 52fe4225c3a36847f80076d9     0</span></span>
<span><span class="co">## 2 Captain Jean-Luc Picard 52fe4226c3a36847f8007ba3     0</span></span>
<span><span class="co">## 3 Captain Jean-Luc Picard 52fe4226c3a36847f8007c27     0</span></span>
<span><span class="co">## 4 Captain Jean-Luc Picard 52fe4226c3a36847f8007cf1     0</span></span>
<span><span class="co">## 5                Narrator 52fe43d79251416c75020267     0</span></span>
<span><span class="co">## 6        Narrator (voice) 52fe4425c3a368484e01220f     0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $crew</span></span>
<span><span class="co">##   adult                    backdrop_path            genre_ids      id</span></span>
<span><span class="co">## 1 FALSE                             &lt;NA&gt;               99, 35 1093380</span></span>
<span><span class="co">## 2 FALSE /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg      878, 28, 12, 53     200</span></span>
<span><span class="co">## 3 FALSE /ccsLztuF4cKlfnriitwdxs0coBa.jpg 10770, 14, 18, 10751   48358</span></span>
<span><span class="co">## 4 FALSE /eMxx1QohCBbhFEiB9SYIGFo2oK3.jpg                   37   47913</span></span>
<span><span class="co">## 5 FALSE /li27iYcGbSp89YTlVRmwujteykw.jpg 18, 36, 10770, 10749   37945</span></span>
<span><span class="co">## 6 FALSE /g5CMQPz5cqUHro9pNLBRW7cT8cY.jpg               18, 14   16716</span></span>
<span><span class="co">##   original_language          original_title</span></span>
<span><span class="co">## 1                en           Red Dwarf A-Z</span></span>
<span><span class="co">## 2                en Star Trek: Insurrection</span></span>
<span><span class="co">## 3                en   The Canterville Ghost</span></span>
<span><span class="co">## 4                en           King of Texas</span></span>
<span><span class="co">## 5                en      The Lion in Winter</span></span>
<span><span class="co">## 6                en       A Christmas Carol</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 overview</span></span>
<span><span class="co">## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     A compilation of clips and interviews, originally broadcast on BBC2's Red Dwarf Night in 1998, and subsequently included on the DVD release of Red Dwarf series 2.</span></span>
<span><span class="co">## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  When an alien race and factions within Starfleet attempt to take over a planet that has "regenerative" properties, it falls upon Captain Picard and the crew of the Enterprise to defend the planet's people as well as the very ideals upon which the Federation itself was founded.</span></span>
<span><span class="co">## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                       When a teenaged girl moves to England, with her brothers and parents into the ancient Canterville Hall, she's not at all happy. Especially as there's a ghost and a mysterious re-appearing bloodstain on the hearth. She campaigns to go back home, and her dad, believing the ghost's pranks are Ginny's, is ready to send her back. But then Ginny actually meets the elusive 17th-century Sir Simon de Canterville (not to mention the cute teenaged duke next door), and she sets her hand to the task of freeing Sir Simon from his curse.</span></span>
<span><span class="co">## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               In this re-imagining of Shakespear's King Lear, Patrick Stewart stars as John Lear, a Texas cattle baron, who, after dividing his wealth among his three daughters, is rejected by them.</span></span>
<span><span class="co">## 5 King Henry II (Patrick Stewart) keeps his wife, Eleanor (Glenn Close) locked away in the towers because of her frequent attempts to overthrow him. With Eleanor out of the way he can have his dalliances with his young mistress (Yuliya Vysotskaya). Needless to say the queen is not pleased, although she still has affection for the king. Working through her sons, she plots the king's demise and the rise of her second and preferred son, Richard (Andrew Howard), to the throne. The youngest son, John (Rafe Spall), an overweight buffoon and the only son holding his father's affection is the king's choice after the death of his first son, young Henry. But John is also overly eager for power and is willing to plot his father's demise with middle brother, Geoffrey (John Light) and the young king of France, Phillip (Jonathan Rhys Meyers). Geoffrey, of course sees his younger brother's weakness and sees that route as his path to power. Obviously political and court intrigue ensues</span></span>
<span><span class="co">## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Scrooge is a miserly old businessman in 1840s London. One Christmas Eve he is visited by the ghost of Marley, his dead business partner. Marley foretells that Scrooge will be visited by three spirits, each of whom will attempt to show Scrooge the error of his ways. Will Scrooge reform his ways in time to celebrate Christmas?</span></span>
<span><span class="co">##   popularity                      poster_path release_date</span></span>
<span><span class="co">## 1      0.841                             &lt;NA&gt;   2003-02-10</span></span>
<span><span class="co">## 2     28.786 /xQCMAHeg5M9HpDIqanYbWdr4brB.jpg   1998-12-11</span></span>
<span><span class="co">## 3      9.267 /m71l7oGGKLxdQaUceVTndg2qjJJ.jpg   1996-01-27</span></span>
<span><span class="co">## 4      3.951 /jFvDJsgnLRVuRpsbm3YHIn0dHxI.jpg   2002-06-02</span></span>
<span><span class="co">## 5      7.097 /f6yEfCBBMNp6jdny9AD4ZTG9tgi.jpg   2003-12-26</span></span>
<span><span class="co">## 6     13.427 /oi1NcVDXlFEsdpLp37BJmFbVlg9.jpg   1999-12-05</span></span>
<span><span class="co">##                     title video vote_average vote_count</span></span>
<span><span class="co">## 1           Red Dwarf A-Z FALSE        0.000          0</span></span>
<span><span class="co">## 2 Star Trek: Insurrection FALSE        6.425       1025</span></span>
<span><span class="co">## 3   The Canterville Ghost FALSE        6.042         48</span></span>
<span><span class="co">## 4           King of Texas FALSE        5.100         11</span></span>
<span><span class="co">## 5      The Lion in Winter FALSE        6.100         17</span></span>
<span><span class="co">## 6       A Christmas Carol FALSE        6.800        161</span></span>
<span><span class="co">##                  credit_id department                job</span></span>
<span><span class="co">## 1 63fead85699fb70096ff260e       Crew             Thanks</span></span>
<span><span class="co">## 2 52fe4226c3a36847f8007c1d Production           Producer</span></span>
<span><span class="co">## 3 5962f6d292514122510c57a0 Production        Co-Producer</span></span>
<span><span class="co">## 4 59807f88925141491d0113a0 Production Executive Producer</span></span>
<span><span class="co">## 5 5f72da29e4b5760039f36206 Production Executive Producer</span></span>
<span><span class="co">## 6 63c31ac8d46537007dbd999a Production Executive Producer</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 2387</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><p>By default, fromJSON does a LOT of heavy lifting for us:</p>
<ol type="1">
<li>Identifying the structure of the top-level data: cast, crew, and id information</li>
<li>Parses cast information into a data frame with list-columns</li>
<li>Parses crew information into a data frame with list-columns</li>
</ol>
<p>It’s hard to explain how <em>nice</em> this is to someone who hasn’t had to parse this type of information by hand before… so let’s briefly explore that process.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_messy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">data_url</span>, simplifyVector <span class="op">=</span> <span class="cn">T</span>, simplifyDataFrame <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details><summary>
Exploring the output structure (long version)
</summary><div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Top-level objects (show the first object in the list)</span></span>
<span><span class="va">ps_messy</span><span class="op">$</span><span class="va">cast</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## $adult</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $backdrop_path</span></span>
<span><span class="co">## [1] "/mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genre_ids</span></span>
<span><span class="co">## [1] 878  28  12  53</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 193</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_language</span></span>
<span><span class="co">## [1] "en"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_title</span></span>
<span><span class="co">## [1] "Star Trek: Generations"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $overview</span></span>
<span><span class="co">## [1] "Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $popularity</span></span>
<span><span class="co">## [1] 19.783</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $poster_path</span></span>
<span><span class="co">## [1] "/rHsCYDGHFUarGh5k987b0EFU6kC.jpg"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $release_date</span></span>
<span><span class="co">## [1] "1994-11-18"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $title</span></span>
<span><span class="co">## [1] "Star Trek: Generations"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $video</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vote_average</span></span>
<span><span class="co">## [1] 6.526</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vote_count</span></span>
<span><span class="co">## [1] 1126</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $character</span></span>
<span><span class="co">## [1] "Captain Jean-Luc Picard"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $credit_id</span></span>
<span><span class="co">## [1] "52fe4225c3a36847f80076d9"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $order</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="va">ps_messy</span><span class="op">$</span><span class="va">crew</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## $adult</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $backdrop_path</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genre_ids</span></span>
<span><span class="co">## [1] 99 35</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 1093380</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_language</span></span>
<span><span class="co">## [1] "en"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_title</span></span>
<span><span class="co">## [1] "Red Dwarf A-Z"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $overview</span></span>
<span><span class="co">## [1] "A compilation of clips and interviews, originally broadcast on BBC2's Red Dwarf Night in 1998, and subsequently included on the DVD release of Red Dwarf series 2."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $popularity</span></span>
<span><span class="co">## [1] 0.841</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $poster_path</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $release_date</span></span>
<span><span class="co">## [1] "2003-02-10"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $title</span></span>
<span><span class="co">## [1] "Red Dwarf A-Z"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $video</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vote_average</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $vote_count</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $credit_id</span></span>
<span><span class="co">## [1] "63fead85699fb70096ff260e"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $department</span></span>
<span><span class="co">## [1] "Crew"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $job</span></span>
<span><span class="co">## [1] "Thanks"</span></span>
<span><span class="va">ps_messy</span><span class="op">$</span><span class="va">id</span></span>
<span><span class="co">## [1] 2387</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><p>Let’s start with the cast list. Most objects seem to be single entries; the only thing that isn’t is the <code>genre_ids</code> field. So let’s see whether we can just convert each list entry to a data frame, and then deal with the <code>genre_ids</code> column afterwards.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cast_list</span> <span class="op">&lt;-</span> <span class="va">ps_messy</span><span class="op">$</span><span class="va">cast</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details><summary>
Data frame conversion
</summary><div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">cast_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">##   adult                    backdrop_path genre_ids  id original_language</span></span>
<span><span class="co">## 1 FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg       878 193                en</span></span>
<span><span class="co">## 2 FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg        28 193                en</span></span>
<span><span class="co">## 3 FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg        12 193                en</span></span>
<span><span class="co">## 4 FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg        53 193                en</span></span>
<span><span class="co">##           original_title</span></span>
<span><span class="co">## 1 Star Trek: Generations</span></span>
<span><span class="co">## 2 Star Trek: Generations</span></span>
<span><span class="co">## 3 Star Trek: Generations</span></span>
<span><span class="co">## 4 Star Trek: Generations</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                   overview</span></span>
<span><span class="co">## 1 Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years.</span></span>
<span><span class="co">## 2 Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years.</span></span>
<span><span class="co">## 3 Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years.</span></span>
<span><span class="co">## 4 Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years.</span></span>
<span><span class="co">##   popularity                      poster_path release_date</span></span>
<span><span class="co">## 1     19.783 /rHsCYDGHFUarGh5k987b0EFU6kC.jpg   1994-11-18</span></span>
<span><span class="co">## 2     19.783 /rHsCYDGHFUarGh5k987b0EFU6kC.jpg   1994-11-18</span></span>
<span><span class="co">## 3     19.783 /rHsCYDGHFUarGh5k987b0EFU6kC.jpg   1994-11-18</span></span>
<span><span class="co">## 4     19.783 /rHsCYDGHFUarGh5k987b0EFU6kC.jpg   1994-11-18</span></span>
<span><span class="co">##                    title video vote_average vote_count               character</span></span>
<span><span class="co">## 1 Star Trek: Generations FALSE        6.526       1126 Captain Jean-Luc Picard</span></span>
<span><span class="co">## 2 Star Trek: Generations FALSE        6.526       1126 Captain Jean-Luc Picard</span></span>
<span><span class="co">## 3 Star Trek: Generations FALSE        6.526       1126 Captain Jean-Luc Picard</span></span>
<span><span class="co">## 4 Star Trek: Generations FALSE        6.526       1126 Captain Jean-Luc Picard</span></span>
<span><span class="co">##                  credit_id order</span></span>
<span><span class="co">## 1 52fe4225c3a36847f80076d9     0</span></span>
<span><span class="co">## 2 52fe4225c3a36847f80076d9     0</span></span>
<span><span class="co">## 3 52fe4225c3a36847f80076d9     0</span></span>
<span><span class="co">## 4 52fe4225c3a36847f80076d9     0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">cast_list</span>, <span class="va">as.data.frame</span><span class="op">)</span></span>
<span><span class="co">## Error in `map()`:</span></span>
<span><span class="co">## ℹ In index: 6.</span></span>
<span><span class="co">## Caused by error:</span></span>
<span><span class="co">## ! arguments imply differing number of rows: 1, 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Well, that didn’t work, but the error message at least tells us what index is causing the problem: 6. Let’s look at that data:</p>
<details><summary>
Data frame conversion errors
</summary><div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cast_list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## $adult</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $backdrop_path</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genre_ids</span></span>
<span><span class="co">## [1] 99</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 21746</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_language</span></span>
<span><span class="co">## [1] "en"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details><p>Ok, so <code>backdrop_path</code> is <code>NULL</code>, and <code>as.data.frame</code> can’t handle the fact that some fields are defined (length 1) and others are NULL (length 0). We could possibly replace the NULL with NA first?</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fix_nulls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">x</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="cn">NA</span> <span class="kw">else</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cast_list_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">cast_list</span>, <span class="va">fix_nulls</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cast_list_fix</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## $adult</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $backdrop_path</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genre_ids</span></span>
<span><span class="co">## [1] 99</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 21746</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_language</span></span>
<span><span class="co">## [1] "en"</span></span>
<span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">cast_list_fix</span>, <span class="va">as.data.frame</span><span class="op">)</span></span>
<span><span class="co">## Error in `map()`:</span></span>
<span><span class="co">## ℹ In index: 8.</span></span>
<span><span class="co">## Caused by error:</span></span>
<span><span class="co">## ! arguments imply differing number of rows: 1, 0</span></span>
<span></span>
<span><span class="va">cast_list_fix</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## $adult</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $backdrop_path</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genre_ids</span></span>
<span><span class="co">## list()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 33335</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_language</span></span>
<span><span class="co">## [1] "en"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok, well, this time, we have an issue with position 8, and we have an empty list of genre_ids.</p>
<p>An empty list and NULL both have length 0, so let’s alter our <code>fix_nulls</code> function to test for things of length 0 instead of testing for nulls. That should fix both problems using the same code, and we’re trying to directly test for the issue which was causing problems, which is perhaps a better approach anyways.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fix_nulls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">x</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="cn">NA</span> <span class="kw">else</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cast_list_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">cast_list</span>, <span class="va">fix_nulls</span><span class="op">)</span></span>
<span><span class="va">cast_list_fix</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">## $adult</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $backdrop_path</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genre_ids</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $id</span></span>
<span><span class="co">## [1] 33335</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $original_language</span></span>
<span><span class="co">## [1] "en"</span></span>
<span></span>
<span><span class="va">cast_list_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_df</a></span><span class="op">(</span><span class="va">cast_list_fix</span>, <span class="va">as.data.frame</span><span class="op">)</span></span>
<span><span class="va">cast_list_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">##    adult                    backdrop_path genre_ids  id original_language</span></span>
<span><span class="co">## 1  FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg       878 193                en</span></span>
<span><span class="co">## 2  FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg        28 193                en</span></span>
<span><span class="co">## 3  FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg        12 193                en</span></span>
<span><span class="co">## 4  FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg        53 193                en</span></span>
<span><span class="co">## 5  FALSE /wygUDDRNpeKUnkekRGeLCZM93tA.jpg       878 199                en</span></span>
<span><span class="co">## 6  FALSE /wygUDDRNpeKUnkekRGeLCZM93tA.jpg        28 199                en</span></span>
<span><span class="co">## 7  FALSE /wygUDDRNpeKUnkekRGeLCZM93tA.jpg        12 199                en</span></span>
<span><span class="co">## 8  FALSE /wygUDDRNpeKUnkekRGeLCZM93tA.jpg        53 199                en</span></span>
<span><span class="co">## 9  FALSE /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg       878 200                en</span></span>
<span><span class="co">## 10 FALSE /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg        28 200                en</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We still have too many rows for each entry because of the multiple <code>genre_ids</code>. But we can fix that with the <code>nest</code> command.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cast_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="va">cast_list_df</span>, genre_ids <span class="op">=</span> <span class="va">genre_ids</span> <span class="op">)</span></span>
<span><span class="va">cast_list</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">17</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 10 × 5</span></span>
<span><span class="co">##    adult backdrop_path                       id original_language genre_ids</span></span>
<span><span class="co">##    &lt;lgl&gt; &lt;chr&gt;                            &lt;int&gt; &lt;chr&gt;             &lt;list&gt;   </span></span>
<span><span class="co">##  1 FALSE /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg   193 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  2 FALSE /wygUDDRNpeKUnkekRGeLCZM93tA.jpg   199 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  3 FALSE /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg   200 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  4 FALSE /6z9w8eidKWDDXwZNSVNaRolAYEP.jpg   201 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  5 FALSE /4ADZ2iiATjoKxZwjJRiEo1x6Fk0.jpg 10946 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  6 FALSE &lt;NA&gt;                             21746 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  7 FALSE /cN4qq4B8JR4ekuKAIKGVa4bBssl.jpg 25224 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  8 FALSE &lt;NA&gt;                             33335 en                &lt;tibble&gt; </span></span>
<span><span class="co">##  9 FALSE /89hVgLIH55PVE7wwLCVZF1j3ZGL.jpg 26950 en                &lt;tibble&gt; </span></span>
<span><span class="co">## 10 FALSE /x6f4Axjvr5Ybi2mfdpVSWvASdxX.jpg 28123 en                &lt;tibble&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we’d have to apply this whole process to the crew list as well. Let’s see how robust our process actually is!</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crew_list</span> <span class="op">&lt;-</span> <span class="va">ps_messy</span><span class="op">$</span><span class="va">crew</span></span>
<span><span class="va">crew_list_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">crew_list</span>, <span class="va">fix_nulls</span><span class="op">)</span></span>
<span><span class="va">crew_list_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_df</a></span><span class="op">(</span><span class="va">crew_list_fix</span>, <span class="va">as.data.frame</span><span class="op">)</span></span>
<span><span class="va">crew_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="va">crew_list_df</span>, genre_ids <span class="op">=</span> <span class="va">genre_ids</span> <span class="op">)</span></span>
<span><span class="va">crew_list</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">17</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## # A tibble: 5 × 5</span></span>
<span><span class="co">##   adult backdrop_path                         id original_language genre_ids</span></span>
<span><span class="co">##   &lt;lgl&gt; &lt;chr&gt;                              &lt;int&gt; &lt;chr&gt;             &lt;list&gt;   </span></span>
<span><span class="co">## 1 FALSE &lt;NA&gt;                             1093380 en                &lt;tibble&gt; </span></span>
<span><span class="co">## 2 FALSE /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg     200 en                &lt;tibble&gt; </span></span>
<span><span class="co">## 3 FALSE /ccsLztuF4cKlfnriitwdxs0coBa.jpg   48358 en                &lt;tibble&gt; </span></span>
<span><span class="co">## 4 FALSE /eMxx1QohCBbhFEiB9SYIGFo2oK3.jpg   47913 en                &lt;tibble&gt; </span></span>
<span><span class="co">## 5 FALSE /li27iYcGbSp89YTlVRmwujteykw.jpg   37945 en                &lt;tibble&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok, so that actually worked, but only because the structure of the crew data is the same as the structure of the cast data.</p>
<p>It’s good to see what we’d have to do manually if <code><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON()</a></code> failed on us. It’s also an excellent example of functional programming in a practical setting.</p>
<p>Let’s finish this up by converting our cast and crew data frames into a single data frame with a variable indicating which source DF is relevant.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">patrick_stewart_movies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">cast_list</span>, role <span class="op">=</span> <span class="st">"cast"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">crew_list</span>, role <span class="op">=</span> <span class="st">"crew"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">patrick_stewart_movies</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 156 × 20</span></span>
<span><span class="co">##    adult backdrop_path              id original_language original_title overview</span></span>
<span><span class="co">##    &lt;lgl&gt; &lt;chr&gt;                   &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;          &lt;chr&gt;   </span></span>
<span><span class="co">##  1 FALSE /mNdsbVuRdsyo8eitW2IBW…   193 en                Star Trek: Ge… "Captai…</span></span>
<span><span class="co">##  2 FALSE /wygUDDRNpeKUnkekRGeLC…   199 en                Star Trek: Fi… "The Bo…</span></span>
<span><span class="co">##  3 FALSE /vsjuHP9RQZJgYUvvSlO3m…   200 en                Star Trek: In… "When a…</span></span>
<span><span class="co">##  4 FALSE /vsjuHP9RQZJgYUvvSlO3m…   200 en                Star Trek: In… "When a…</span></span>
<span><span class="co">##  5 FALSE /6z9w8eidKWDDXwZNSVNaR…   201 en                Star Trek: Ne… "En rou…</span></span>
<span><span class="co">##  6 FALSE /2mEXtIjgsoe5uqH70CLps…   815 en                Animal Farm    "An ani…</span></span>
<span><span class="co">##  7 FALSE /5wJ2tckpvwcxGCAgZicco…   841 en                Dune           "In the…</span></span>
<span><span class="co">##  8 FALSE /92mpNNg6v2PN2HN2C2Z4g…  1273 en                TMNT           "After …</span></span>
<span><span class="co">##  9 FALSE /wvqdJLVh0mSblly7UnYFP…  2080 en                X-Men Origins… "After …</span></span>
<span><span class="co">## 10 FALSE /hPDv0O8tvbEvcVVphIieS…  2107 en                L.A. Story     "With t…</span></span>
<span><span class="co">## # ℹ 146 more rows</span></span>
<span><span class="co">## # ℹ 14 more variables: popularity &lt;dbl&gt;, poster_path &lt;chr&gt;, release_date &lt;chr&gt;,</span></span>
<span><span class="co">## #   title &lt;chr&gt;, video &lt;lgl&gt;, vote_average &lt;dbl&gt;, vote_count &lt;int&gt;,</span></span>
<span><span class="co">## #   character &lt;chr&gt;, credit_id &lt;chr&gt;, order &lt;int&gt;, genre_ids &lt;list&gt;,</span></span>
<span><span class="co">## #   role &lt;chr&gt;, department &lt;chr&gt;, job &lt;chr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could theoretically clean this up so that movies where Patrick Stewart was in both the cast and crew are on a single row, but I think this is “good enough” for now.</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>Pandas includes a <code>read_json</code> function, so let’s try that and see if it works as well as <code><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON()</a></code> did in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Patrick_Stewart.json"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>pd.read_json(data_url)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">## ValueError: All arrays must be of the same length</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we read the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_json.html">documentation for read_json</a>, we can see that we have a few different options - maybe playing around with some of those options will help? Our top-level structure is a list with 3 values: cast, crew, and id. So let’s see if we can read things in as a series instead of a DataFrame first, and hopefully we can use that to get some traction on the situation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>patrick_stewart <span class="op">=</span> pd.read_json(data_url, typ<span class="op">=</span><span class="st">'series'</span>, orient <span class="op">=</span> <span class="st">'records'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># List the objects</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>patrick_stewart.index</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Index(['cast', 'crew', 'id'], dtype='object')</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># First item in the cast list</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>patrick_stewart.cast[<span class="dv">0</span>]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">## {'adult': False, 'backdrop_path': '/mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg', 'genre_ids': [878, 28, 12, 53], 'id': 193, 'original_language': 'en', 'original_title': 'Star Trek: Generations', 'overview': "Captain Jean-Luc Picard and the crew of the Enterprise-D find themselves at odds with the renegade scientist Soran who is destroying entire star systems. Only one man can help Picard stop Soran's scheme...and he's been dead for seventy-eight years.", 'popularity': 19.783, 'poster_path': '/rHsCYDGHFUarGh5k987b0EFU6kC.jpg', 'release_date': '1994-11-18', 'title': 'Star Trek: Generations', 'video': False, 'vote_average': 6.526, 'vote_count': 1126, 'character': 'Captain Jean-Luc Picard', 'credit_id': '52fe4225c3a36847f80076d9', 'order': 0}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So now how do we get our data into a proper form? If we read the documentation a bit further, we can see a “See also” section that has a <code>json_normalize</code> function which promises to “Normalize semi-structured JSON data into a flat table”. That sounds pretty good, let’s try it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ps_cast <span class="op">=</span> pd.json_normalize(patrick_stewart.cast)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ps_cast.head()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">##    adult                     backdrop_path  ...                 credit_id  order</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  False  /mNdsbVuRdsyo8eitW2IBW2BWRkU.jpg  ...  52fe4225c3a36847f80076d9      0</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  False  /wygUDDRNpeKUnkekRGeLCZM93tA.jpg  ...  52fe4226c3a36847f8007ba3      0</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  False  /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg  ...  52fe4226c3a36847f8007c27      0</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 3  False  /6z9w8eidKWDDXwZNSVNaRolAYEP.jpg  ...  52fe4226c3a36847f8007cf1      0</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 4  False  /4ADZ2iiATjoKxZwjJRiEo1x6Fk0.jpg  ...  52fe43d79251416c75020267      0</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 17 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Huh, that actually worked! (I’m not used to this type of thing working on the first try).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ps_crew <span class="op">=</span> pd.json_normalize(patrick_stewart.crew)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ps_crew.head()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">##    adult                     backdrop_path  ...  department                 job</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 0  False                              None  ...        Crew              Thanks</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 1  False  /vsjuHP9RQZJgYUvvSlO3mjJpXkq.jpg  ...  Production            Producer</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 2  False  /ccsLztuF4cKlfnriitwdxs0coBa.jpg  ...  Production         Co-Producer</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 3  False  /eMxx1QohCBbhFEiB9SYIGFo2oK3.jpg  ...  Production  Executive Producer</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 4  False  /li27iYcGbSp89YTlVRmwujteykw.jpg  ...  Production  Executive Producer</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 17 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can combine these as we did in R into a single data frame, and sort by movie ID to simplify the list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ps_cast[<span class="st">'role'</span>] <span class="op">=</span> <span class="st">'cast'</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ps_crew[<span class="st">'role'</span>] <span class="op">=</span> <span class="st">'crew'</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ps_movies <span class="op">=</span> pd.concat([ps_cast, ps_crew])</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>ps_movies[[<span class="st">'id'</span>, <span class="st">'original_title'</span>, <span class="st">'character'</span>, <span class="st">'job'</span>]].sort_values([<span class="st">'id'</span>])</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">##           id               original_title                character       job</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">## 0        193       Star Trek: Generations  Captain Jean-Luc Picard       NaN</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">## 1        199     Star Trek: First Contact  Captain Jean-Luc Picard       NaN</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">## 2        200      Star Trek: Insurrection  Captain Jean-Luc Picard       NaN</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">## 1        200      Star Trek: Insurrection                      NaN  Producer</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">## 3        201           Star Trek: Nemesis  Captain Jean-Luc Picard       NaN</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">## ..       ...                          ...                      ...       ...</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">## 46   1088162  The Elves and the Shoemaker         Narrator (voice)       NaN</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 140  1093380                Red Dwarf A-Z                     Self       NaN</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 0    1093380                Red Dwarf A-Z                      NaN    Thanks</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 126  1095754           John Clare: "I Am"            Cyrus Redding       NaN</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 47   1104829     In the Company of Whales                 Narrator       NaN</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">## [156 rows x 4 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try It Out: JSON File Parsing
</div>
</div>
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/tmdb.svg" class="img-fluid figure-img" style="width:50.0%" alt="The Movie Database logo"></p>
<figcaption>The Movie Database</figcaption></figure>
</div>
<p>I used TMDB to find all movies resulting from the query “Star Trek” and stored the resulting JSON file <a href="https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Star_Trek.json">here</a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Problem</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">R solution</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Python solution</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p>Create a data frame using the Star Trek <a href="https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Star_Trek.json">query results</a>. Because there were 6 pages of query results, the JSON file looks a bit different than the format used in the example above. Can you create a plot of the release date and rating of each movie?</p>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">file_loc</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Star_Trek.json"</span></span>
<span></span>
<span><span class="va">startrek</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">file_loc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="va">startrek</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">title</span>, <span class="va">release_date</span>, <span class="va">popularity</span>, <span class="va">vote_average</span>, <span class="va">vote_count</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 5</span></span>
<span><span class="co">##   title                    release_date popularity vote_average vote_count</span></span>
<span><span class="co">##   &lt;chr&gt;                    &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;      &lt;int&gt;</span></span>
<span><span class="co">## 1 Star Trek                2009-05-06         51.2         7.43       9075</span></span>
<span><span class="co">## 2 Star Trek: Nemesis       2002-12-13         33.6         6.29       1218</span></span>
<span><span class="co">## 3 Star Trek Beyond         2016-07-07         40.3         6.78       6037</span></span>
<span><span class="co">## 4 Star Trek: Insurrection  1998-12-11         28.8         6.42       1025</span></span>
<span><span class="co">## 5 Star Trek Into Darkness  2013-05-05         41.3         7.33       8370</span></span>
<span><span class="co">## 6 Star Trek: First Contact 1996-11-22         29.8         7.30       1519</span></span>
<span></span>
<span><span class="co"># convert release_date to datetime</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="va">startrek</span> <span class="op">&lt;-</span> <span class="va">startrek</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rel_date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="va">release_date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">startrek</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">rel_date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">title</span>, <span class="va">rel_date</span>, <span class="va">popularity</span>, <span class="va">vote_average</span>, <span class="va">vote_count</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 5</span></span>
<span><span class="co">##   title                            rel_date   popularity vote_average vote_count</span></span>
<span><span class="co">##   &lt;chr&gt;                            &lt;date&gt;          &lt;dbl&gt;        &lt;dbl&gt;      &lt;int&gt;</span></span>
<span><span class="co">## 1 Jr. Star Trek                    1969-01-01       0.6          0             0</span></span>
<span><span class="co">## 2 Ömer the Tourist in Star Trek    1973-01-01       1.90         6.36         38</span></span>
<span><span class="co">## 3 Star Trek: The Motion Picture    1979-12-07      26.5          6.50       1480</span></span>
<span><span class="co">## 4 Star Trek II: The Wrath of Khan  1982-06-04      21.6          7.47       1655</span></span>
<span><span class="co">## 5 Leonard Nimoy: Star Trek Memori… 1983-01-01       0.6          7             1</span></span>
<span><span class="co">## 6 Star Trek III: The Search for S… 1984-06-01      17.0          6.62       1159</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">startrek</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rel_date</span>, y <span class="op">=</span> <span class="va">popularity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Release Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-functional-prog_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">startrek</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rel_date</span>, y <span class="op">=</span> <span class="va">vote_average</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Release Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-functional-prog_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>file_loc <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/srvanderplas/stat-computing-r-python/main/data/Star_Trek.json"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>trek <span class="op">=</span> pd.read_json(file_loc)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>trek[<span class="st">'results2'</span>] <span class="op">=</span> trek.results.<span class="bu">map</span>(pd.json_normalize)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This doesn't actually keep the page info but I don't think we need that</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>trek_tidy <span class="op">=</span> pd.concat(trek.results2.to_list())</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>trek_tidy[<span class="st">'rel_date'</span>] <span class="op">=</span> pd.to_datetime(trek_tidy.release_date)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> trek_tidy.plot.scatter(<span class="st">'rel_date'</span>, <span class="st">'popularity'</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-functional-prog_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> trek_tidy.plot.scatter(<span class="st">'rel_date'</span>, <span class="st">'vote_average'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-functional-prog_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="assembling-hierarchical-data" class="level2" data-number="29.4"><h2 data-number="29.4" class="anchored" data-anchor-id="assembling-hierarchical-data">
<span class="header-section-number">29.4</span> Assembling Hierarchical Data</h2>
<p>Another common situation we find ourselves in as analysts is to have multiple levels of data.</p>
<p>Let’s start with a totally absurd hypothetical situation: Suppose I watched the documentary <a href="https://web.archive.org/web/20240803202824/https://www.imdb.com/title/tt4819510/">“Chicken People”</a> and became interested in the different breeds of chicken. As a data scientist, I want to assemble a dataset on chicken breeds that I might use to decide what breed(s) to raise.</p>
<p>A site such as <a href="https://www.cacklehatchery.com/chicken-breeds/">Cackle Hatchery</a> has an overall summary table as well as pages for each individual breed. I’m not going to show you how to web scrape here - it’s not relevant to this chapter - but we can at least outline the process:</p>
<ul>
<li>Acquire the overall table</li>
<li>Use the links to each breed in the overall table to get more specific information for each breed
<ul>
<li>This will require a function to scrape that individual data</li>
<li>We can use map to apply that function to acquire individual data from each breed</li>
</ul>
</li>
</ul>
<p>I’ve used this approach to generate two files:</p>
<ul>
<li>
<a href="https://github.com/srvanderplas/datasets/blob/main/raw/chicken-breeds.csv">chicken-breeds.csv</a> - the original table of breed information</li>
<li>
<a href="https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/chicken-breed-details.json">chicken-breed-details.json</a>, which is a JSON file assembled by scraping information off of each breed’s individual page.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try It Out: Chicken Breed Data Assembly
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Problem</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">R solution</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>Can you create a nested data frame that has all of the information from both the CSV and JSON file in a single tabular structure?</p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/chicken-breeds.csv"</span><span class="op">)</span></span>
<span><span class="va">details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/chicken-breed-details.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">overall</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 9</span></span>
<span><span class="co">##   `Chicken Breed Name`    `Egg Production` `Egg Color` `Cold Hardy` `Heat Hardy`</span></span>
<span><span class="co">##   &lt;chr&gt;                   &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       </span></span>
<span><span class="co">## 1 Austra White            220-280 eggs pe… Cream       Good         Good        </span></span>
<span><span class="co">## 2 Ayam Cemani             80-100 per year  White       Good         &lt;NA&gt;        </span></span>
<span><span class="co">## 3 Barnevelder             150-200 eggs pe… Dark Brown  Poor         &lt;NA&gt;        </span></span>
<span><span class="co">## 4 Barred Cochin Bantam    Fair             Brown       Very         &lt;NA&gt;        </span></span>
<span><span class="co">## 5 Barred Cochin Standard  110-160 eggs pe… Brown       Very         &lt;NA&gt;        </span></span>
<span><span class="co">## 6 Barred Old English Ban… 120 eggs per ye… Cream       Good         &lt;NA&gt;        </span></span>
<span><span class="co">## # ℹ 4 more variables: Purpose &lt;chr&gt;, Broody &lt;chr&gt;, `Mating Ratio` &lt;chr&gt;,</span></span>
<span><span class="co">## #   `Roost Height` &lt;chr&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">details</span><span class="op">)</span></span>
<span><span class="co">##                             name</span></span>
<span><span class="co">## 1           Austra White Chicken</span></span>
<span><span class="co">## 2            Ayam Cemani Chicken</span></span>
<span><span class="co">## 3            Barnevelder Chicken</span></span>
<span><span class="co">## 4           Barred Cochin Bantam</span></span>
<span><span class="co">## 5 Barred Cochin Standard Chicken</span></span>
<span><span class="co">## 6 Barred Old English Game Bantam</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              description</span></span>
<span><span class="co">## 1 Our Austra Whites are a cross between one of our best Cackle HatcheryÂ® production/bloodlines of Black Australorp rooster and one of our best Cackle HatcheryÂ® production/bloodlines of White Leghorn hens (parent stock). They were first developed in the early 1900â\u0080\u0099s. This cross produces offspring that are very good layers throughout the year and lay a very light brown to off white egg shell color egg. The Austra White pullet will be white with little black specks in some feathers. This cross is considered to be a heavier breed and their disposition is calmer than the pure Leghorn chicken breed. There are many benefits to raising baby chickens from this cross. These hens will lay a lot of large eggs; have good feed to egg production ratios and good for chickens for backyards. Raising chickens for eggs at home can be fun and relaxing. Free range chicken eggs are great tasting eggs and this hybrid chicken breed has good reflexes for predator avoidance, however, they are white and easily seen.\nWe also offer at limited times of the year Austra White Fertile Hatching Eggs</span></span>
<span><span class="co">## 2                                    The breed originated from the island of Java, Indonesia and has probably been used for centuries in religious and mystical purposes. The breed was first described by Dutch colonial settlers and first imported to Europe in 1998 by Dutch breeder Jan Steverink. Their beak and tongue, comb and wattles, even their meat bones and organs appear black. The blood of the Ayam Cemani is normally colored. The birdâ\u0080\u0099s black color occurs as a result of excess pigmentation of the tissues, caused by a genetic condition known as fibro melanosis. This gene is also found in some other black fowl breeds. Roosters can get some mulberry upon maturity due to testosterone and other influences. The hens lay cream-colored eggs, although they are poor setters and rarely hatch their own brood. Our Ayam Cemaniâ\u0080\u0099s bloodline includes Raven and some Greenfire.\n30% will have white color leakages in tongue, mouth and toes.\nWe cannot guarantee the distribution of black pigment on chicks.\nWe now have Ayam Cemani Fertile Hatching Eggs for sale click here!</span></span>
<span><span class="co">## 3                                                                                                                                                                                                                                                                                                                                                                          The Barnevelder chicken originates from the Barneveld region of Holland and known for laying a dark brown egg. This beautiful bird has a single comb, is hardy and quiet and doesnâ\u0080\u0099t mind being confined. The breed was first recognized by the American Standard of Perfection in 1991. Cackle HatcheryÂ®â\u0080\u0099s Barnevelders breeding stock will produce feathering of partridge single laced andÂ&nbsp; double laced feather pattern. Each year breeding season our objective is to breed more for the double laced pattern. The Barnevelder chicken is rare to find in the USA but becoming more popular each year. To buy Barnevelder chickens, please select your quantity under 50 above.\nAlso may likeÂ&nbsp;Dark Brown Egg Female Surplus.</span></span>
<span><span class="co">## 4                                                                                                                                                                                                                                                                                                                                                                                          At Cackle HatcheryÂ®, we offer several different types of the Cochin Bantam, including the Barred Cochin Bantam. If youâ\u0080\u0099re not familiar with this chicken breed, it is a miniature version of the Standard Cochin. For more than a century these chickens were admitted to the American Poultry Standard of Perfection, and they make great pets and mothers for chicks. The standard version of the breed, the Barred Cochin Bantam, is an excellent choice, so place your order today. For more details about the Barred Cochin Chicken, please contact us!\nMany people who like this breed of chicken also like the standard version of the breed, theÂ&nbsp;Barred Cochin Chicken.\nAlso may likeÂ&nbsp;Cochin Bantam Special Surplus.</span></span>
<span><span class="co">## 5                                                                                                                                          When it comes to rare breed chickens, the professionals at Cackle HatcheryÂ® have a lot to offer. We have more than 200 breeds to choose from, including the Barred Cochin Standard. This bird is one of the many color types of Cochins that we have available and it is notable for several reasons. This is a very large chicken with a lot of unique feathering and feathered legs. This chicken is also great around children, making it a perfect pet for the family farm. This is a very hard color to find of the standard cochin with very few breeders in the USA. We further improved our flock by adding some of Roland Doerr bloodline into our flock in 2009. Make a great show and exhibition type chicken. You can place your order today or you can call us for more information.\nMany people who like this breed of chicken also like the miniature version of the breed (bantam), theÂ&nbsp;Barred Cochin Bantam Chicken.\nAlso, may likeÂ&nbsp;Cochin Standard Surplus Special.\nÂ</span></span>
<span><span class="co">## 6                                                                                                                                                                                                                                                                                                                                                                                                                                             Cackle HatcheryÂ® offers several varieties of the Old English Bantam, a miniature version of the Standard Old English Game chicken. The Barred Old English Game Bantam is just one of many high-quality chicken breeds we have available, and this variety is notable for its black and white spotted coloring. Because these chickens require little space and feed they make perfect pets, and they are generally well behaved. In fact, some Barred Old English Game Bantams can even become so tame that they will sit on your arm. Get started today by placing your order for baby chicks, and contact us if you have questions!\nAlso may likeÂ&nbsp;Old English Bantam Surplus Special.</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    breed_facts</span></span>
<span><span class="co">## 1                                                                                                                                                                                                                                                                                                                                                                : Not applicable, Â Henâ\u0080\u0094â\u0080\u00935 lbs\nRoosterâ\u0080\u0094â\u0080\u00946 1/2 lbs\nPulletâ\u0080\u00944 1/2 lbs\nCockerelâ\u0080\u0094-5 1/2 lbs, Â Primary production, Egg Laying &amp; Pet/Secondary meat source, Very light brown to off white egg shell color, Â Â 220-280 eggs per year (estimates only, seeÂ FAQ), Â Large, Â Active, Â 80-85%, Fertility Percentage:Â 65-80%, Non Setter, Â 12 Females to 1 Males, Â 4 to 8 feet, Â Hybrid, Â No, Â No, Â Cackle HatcheryÂ® Poultry Breeding Farm has been developing our bloodline or strain of Austra White since 1939.</span></span>
<span><span class="co">## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                         Â Not applicable, Â Hen â\u0080\u0094â\u0080\u0094-4.1/2 lbs\nRoosterâ\u0080\u0094-7 lb\nPulletâ\u0080\u0094â\u0080\u00944Â lbs\nCockerelâ\u0080\u00945 lbs, Â Ornamental/ Meat and Egg, Â Cream, Light tan, Â 80-120 per yearÂ (estimates only, seeÂ FAQ), Docile, Â 8 Females to 1 Male, Â 4+ feet, Yes sometimes, Â Java, Indonesia, Â No, Â Not listed, Breeder Farm Source:Â Cackle HatcheryÂ® Poultry Breeding Farm has been developing our bloodline or strain of pure Ayam Cemani since 2018</span></span>
<span><span class="co">## 3                                                                                                                                                                                                                                                                                                Â Continental Class, Weights:Â Henâ\u0080\u0094â\u0080\u00936 lbs\nRoosterâ\u0080\u0094â\u0080\u00947 lbs\nPulletâ\u0080\u0094-5 lbs\nCockerelâ\u0080\u0094â\u0080\u00936 lbs, Â Egg Laying; Exhibition, Â Dark Brown, Â 150-200 eggs per year (estimates only, see FAQ), Â Large, Â Active, Â 80-85%, Fertility Percentage:Â 65-80%, Broody:Â Non Setter, Â 7 Females to 1 Male, Â 2 to 4 feet, Country of Origin:Â Holland, APA:Â Yes, Recognized by the American Standard of Perfection, TLC:Â Not Listed, BREEDER FARM SOURCE:Â Cackle HatcheryÂ® Poultry Breeding Farm has been developing our bloodline/strain of pure Barnevelder chickens since 2008.</span></span>
<span><span class="co">## 4                                                                                                                                                                                                                                                                                                                                                                           Feather Legged Bantams, Hen â\u0080\u0094â\u0080\u0094-26 oz Â Â Â Â Â Â Roosterâ\u0080\u0094â\u0080\u009330 oz, Purpose and Type:Â Pets,Very Broody, Ornamental; Exhibition, Egg Shell Color:Â Brown Bantam Sized Egg, Egg Production:Â Fair, Egg Size:Â Small, Â Docile, 75-80%, Â 40-55%, Broody:Â Setters, Â 6 Females to 1 Male, Â 0 to 2 feet, Country of Origin:Â Asia, Yes, Recognized by the Standard of Perfection in 1965, No, â\u0080\u009c Cackle HatcheryÂ® Poultry Breeding Farmâ\u0080\u009d developing our bloodline or strain of pure Cochin Bantams since 1971.</span></span>
<span><span class="co">## 5 Â Asiatic Class, Weights â\u0080\u0093Â Henâ\u0080\u0094â\u0080\u00938 1/2 lbs\nRoosterâ\u0080\u0094â\u0080\u009411 lbs\nPulletâ\u0080\u00947 lbs\nCockerelâ\u0080\u0094-9 lbs, Purpose and Type â\u0080\u0093Â OrnamentalÂ and meat; Exhibition, Â Brown, Egg ProductionÂ â\u0080\u0093 110-160 eggs per year (*estimates only, seeÂ FAQ), Egg Size:Â Medium-Large, Â Docile, Â 40-55%, Broody:Â Setter, Â 6 Females to 1 Male, Â 0 to 2 feet, Asia, Yes, Recognized by the American Standard of Perfection in 1982., Recovering Status, Considered a sustainable heritage chicken breed, Â â\u0080\u009cCackle HatcheryÂ®Â Poultry Breeding Farmâ\u0080\u009d developing our bloodline or strain of pure color varieties of standard size Cochin chickens since 1975., Breeder Farm Source:Â Cackle HatcheryÂ®Â Poultry Breeding Farmâ\u0080\u009d developing our bloodline or strain of pure color varieties of standard size Cochin chickens since 1975.</span></span>
<span><span class="co">## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Game Bantams, â\u0080\u0093Â Hen â\u0080\u0094â\u0080\u0094-22 ozÂ Â Â Â Â Â Â Â Roosterâ\u0080\u0094-24 oz\nPulletâ\u0080\u0094â\u0080\u009420 ozÂ Â Â Â Â Â Â Â Cockerelâ\u0080\u009422 oz, Purpose and TypeÂ â\u0080\u0093 Ornamental; Exhibition, Egg Shell ColorÂ â\u0080\u0093 Cream or Tinted Bantam Sized Egg, Â â\u0080\u0093Â Poor, Egg Size:Â Small, Â Active, Â 40-55%, Broody:Â Setters, Â 9 Females to 1 Male, Â 3+ feet, â\u0080\u0093Â Europe, : No, No</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    availability</span></span>
<span><span class="co">## 1                                                    04/12/2023 , 04/17/2023 , 04/19/2023 , 04/24/2023 , 04/26/2023 , 05/01/2023 , 05/03/2023 , 05/08/2023 , 05/10/2023 , 05/15/2023 , 05/17/2023 , 05/22/2023 , 05/24/2023 , 05/29/2023 , 05/31/2023 , 06/05/2023 , 06/07/2023 , 06/12/2023 , 06/14/2023 , 06/19/2023 , 06/21/2023 , 06/26/2023 , 06/28/2023 , 07/03/2023 , 07/05/2023 , 07/10/2023 , 07/12/2023 , 07/17/2023 , 07/19/2023 , 07/24/2023 , 07/26/2023 , 07/31/2023 , 08/02/2023 , 08/07/2023 , 08/09/2023 , 08/14/2023 , 08/16/2023 , 08/23/2023 , 08/30/2023 , 09/06/2023 , 09/13/2023 , 09/20/2023 , 09/27/2023 , 10/02/2023 , unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, low-availability, unavailable, low-availability, unavailable, unavailable, unavailable, low-availability, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, low-availability, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable</span></span>
<span><span class="co">## 2 04/12/2023 , 04/17/2023 , 04/19/2023 , 04/24/2023 , 04/26/2023 , 05/01/2023 , 05/03/2023 , 05/08/2023 , 05/10/2023 , 05/15/2023 , 05/17/2023 , 05/22/2023 , 05/24/2023 , 05/29/2023 , 05/31/2023 , 06/05/2023 , 06/07/2023 , 06/12/2023 , 06/14/2023 , 06/19/2023 , 06/21/2023 , 06/26/2023 , 06/28/2023 , 07/03/2023 , 07/05/2023 , 07/10/2023 , 07/12/2023 , 07/17/2023 , 07/19/2023 , 07/24/2023 , 07/26/2023 , 07/31/2023 , 08/02/2023 , 08/07/2023 , 08/09/2023 , 08/14/2023 , 08/16/2023 , 08/23/2023 , 08/30/2023 , 09/06/2023 , 09/13/2023 , 09/20/2023 , 09/27/2023 , 10/02/2023 , unavailable, low-availability, unavailable, available, low-availability, available, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, low-availability, unavailable, unavailable, low-availability, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, low-availability, low-availability, unavailable, low-availability, low-availability, low-availability, low-availability</span></span>
<span><span class="co">## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          NULL</span></span>
<span><span class="co">## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          NULL</span></span>
<span><span class="co">## 5                     04/12/2023 , 04/17/2023 , 04/19/2023 , 04/24/2023 , 04/26/2023 , 05/01/2023 , 05/03/2023 , 05/08/2023 , 05/10/2023 , 05/15/2023 , 05/17/2023 , 05/22/2023 , 05/24/2023 , 05/29/2023 , 05/31/2023 , 06/05/2023 , 06/07/2023 , 06/12/2023 , 06/14/2023 , 06/19/2023 , 06/21/2023 , 06/26/2023 , 06/28/2023 , 07/03/2023 , 07/05/2023 , 07/10/2023 , 07/12/2023 , 07/17/2023 , 07/19/2023 , 07/24/2023 , 07/26/2023 , 07/31/2023 , 08/02/2023 , 08/07/2023 , 08/09/2023 , 08/14/2023 , 08/16/2023 , 08/23/2023 , 08/30/2023 , 09/06/2023 , 09/13/2023 , 09/20/2023 , 09/27/2023 , 10/02/2023 , low-availability, low-availability, unavailable, low-availability, low-availability, available, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, available, unavailable, unavailable, unavailable, low-availability, low-availability, unavailable, unavailable, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable</span></span>
<span><span class="co">## 6                                                    04/12/2023 , 04/17/2023 , 04/19/2023 , 04/24/2023 , 04/26/2023 , 05/01/2023 , 05/03/2023 , 05/08/2023 , 05/10/2023 , 05/15/2023 , 05/17/2023 , 05/22/2023 , 05/24/2023 , 05/29/2023 , 05/31/2023 , 06/05/2023 , 06/07/2023 , 06/12/2023 , 06/14/2023 , 06/19/2023 , 06/21/2023 , 06/26/2023 , 06/28/2023 , 07/03/2023 , 07/05/2023 , 07/10/2023 , 07/12/2023 , 07/17/2023 , 07/19/2023 , 07/24/2023 , 07/26/2023 , 07/31/2023 , 08/02/2023 , 08/07/2023 , 08/09/2023 , 08/14/2023 , 08/16/2023 , 08/23/2023 , 08/30/2023 , 09/06/2023 , 09/13/2023 , 09/20/2023 , 09/27/2023 , 10/02/2023 , unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, low-availability, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable, unavailable</span></span>
<span><span class="co">##                                                                                                                            videos</span></span>
<span><span class="co">## 1                                                                                       https://www.youtube.com/embed/fnKRESJcpuY</span></span>
<span><span class="co">## 2                                            https://www.youtube.com/embed/AapH24ImQBo, https://www.youtube.com/embed/Y00jzCR7b-s</span></span>
<span><span class="co">## 3 https://www.youtube.com/embed/J7hIxdTgOPc, https://www.youtube.com/embed/sqhz7Rdc_0U, https://www.youtube.com/embed/T7UeVZe3j10</span></span>
<span><span class="co">## 4 https://www.youtube.com/embed/kr7huXt_-Fk, https://www.youtube.com/embed/dwsRHSr5scc, https://www.youtube.com/embed/k82eEH913Y8</span></span>
<span><span class="co">## 5                                            https://www.youtube.com/embed/iNwIbI3xbHA, https://www.youtube.com/embed/HbdlI_AEVQM</span></span>
<span><span class="co">## 6                                            https://www.youtube.com/embed/3tN2xqkoxLc, https://www.youtube.com/embed/dpLJK0Sc2xk</span></span>
<span><span class="co">##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            reviews</span></span>
<span><span class="co">## 1 364845, 326510, 326419, 172038, 171864, 171778, 171750, 171713, 171601, 171490, 171424, 171417, 171391, 171259, 171219, 170835, 170494, 170468, 170254, 170205, 170136, 5, 5, 5, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 5, NA, NA, NA, NA, NA, NA, Andrea , Millermcnutt , Vinny , Sharon , Chad , Alexa , Lori , Mike , mmeyer , Kasen , Raymond , rhodyray , Sonia  , Chickens R Us , Darrell , Dorothy , Jill, Indiana April 2013 , Michelle, New York May 2013 , Beth Oklahoma February 2015 , Michael Georgia February 2014 , Janie, Missouri May 2014 , 2020-07-17T16:18:08-05:00, 2020-04-18T01:05:55-05:00, 2020-03-13T03:22:27-05:00, 2018-08-08T21:29:59-05:00, 2018-03-08T20:42:45-05:00, 2017-10-30T22:18:53-05:00, 2017-09-08T01:32:20-05:00, 2017-07-29T13:21:09-05:00, 2017-05-15T06:48:03-05:00, 2017-03-08T17:41:26-05:00, 2016-12-06T03:08:46-05:00, 2016-12-03T23:16:45-05:00, 2016-11-06T05:53:01-05:00, 2016-06-16T20:08:04-05:00, 2016-05-19T10:45:33-05:00, 2015-12-25T06:23:42-05:00, 2015-11-30T14:06:01-05:00, 2015-11-27T21:42:12-05:00, 2015-11-12T15:56:18-05:00, 2015-11-10T21:37:58-05:00, 2015-11-09T15:29:51-05:00, Very good, LOOOOVE my Austra White Hen, Good, Thank You, Austra Duds, Got my Chicks!, Nice birds!, Wonderful Chicks, Motherâ\u0080\u0099s day surprise , Good, Like this bird, Good Hens, Adventurous birds! , Not your ordinary personalities, BEST\n, Yum! We used to get , Cackle Hatchery, Cackle Hatchery, Testimonal, Cackle Hatchery, Cackle Hatchery, Very happy to see my 25 hens get here on time. All of them seem, so far happy and healthy., Purchased Austra White pullet last year. I LOOOVE her, she went broody late summer, hatched 2 eggs (which I had ordered) such a good Mommy bird.  Henny Penny is very friendly, she lets me pick her up and she comes running to me when I walk out the door.  She is a precious bird!, Want to say two years later they are great birds hardy and great free rangers. 5 eggs a week from my birds. Will get this breed again. , Got my chicks, all alive and doing well. I had 2 setters and they adopted them as their own. So precious. Thank you, a very pleased customer., I ordered a handful of these last spring and have to admit I am disappointed with them. When they do lay the eggs are super large and a beautiful cream color but mine do not lay often. Two of them are broody every couple months and never seem to lay and the other two only give me eggs once in awhile. My Easter Eggers, Ameraucanas, and Welsummers are by far better layers., Got my baby chicks this morning! All healthy, all doing fantastic! The tracking for my package was spot on with much appreciated detail. I got my chicks shipped to Hawaii which has additional fees and you have to have a higher minimum of birds and it was totally 100% worth it. I will be using your service in the future and will be recommending it to others. Thank you so very much!, I have 3 of these pullets and at about 21 weeks they are just starting to lay.  They are large, handsome and very friendly birds. As youngsters they were always flying up on my shoulders and are very adventurous.  Their eggs are still smallish and are light cream in color.  Iâ\u0080\u0099m very happy with them., I received 4 Austra White pullets as part of an order of 16 chicks on March 1st and they have made beautiful hens.  One began laying at 16 weeks of age which is the earliest I have ever heard of.  I would highly recommend this breed and Cackle Hatchery as this flock of hens that also contains 4 Buff Orpingtons, 3 Turkens, 3 Cuckoo Marans and 2 Black Golden Laced Wyandottes is the nicest flock I have ever had in my 50+ years of raising chickens., I ordered 15 chicks at the end of November 2016.  10 EEâ\u0080\u0099s and 5\n Austra Whites.  All 5 of the Whites survived, but I lost 5 EE in January.  The white chicks were more aggrisive then my Easter eggers and separated them for a month until bigger.  I kept them in a large brooder box in an enclosed porch area with an electric chicken heater until April. The whites were very hungry chicks.  Iâ\u0080\u0099ve never had a leg horn breed type before.  They are certainly more assertive than my Easter egger, RIR,  and Cinnamon Queens (they lay large to jumbo eggs, but are kind of dumb birds).  Today, Motherâ\u0080\u0099s Day, one of my Austra Whites layed a small pretty cream egg!  Looking forward to seeing how big  and how many they  can lay., Good, Love this bird.  Not as skittish or as flighty as many suggest.  One was bullied by a Black Sex Link however I solved the issue by removing the Black Sex Link for three days and now everything is fine.  Lay some of the biggest eggs Iâ\u0080\u0099ve ever seen.  Two within the last two weeks measuring 3â\u0080³ X 2â\u0080³ (thatâ\u0080\u0099s big my friend).  Friendly at times and will eat from my hand., Received chicks in the middle of March and as they age have become more friendly.  Guess it takes time for them to trust humans.  Anyhow they have been consistent layers and one bird in particular has layed two eggs over the last month that measured 3â\u0080³ X 2â\u0080³.  Now they are humongeous eggs.  The Austra Whites share a coop with Red and Black Sex link hens are all are doing fine., We ordered 6 Austra Whites and received 7 on time and in excellent, healthy condition. We gave them water with electrolytes right away, and they were so much fun to handle as tiny chicks. They are now about 5 months old and we still have all 7. They havenâ\u0080\u0099t started laying yet, but they are very adventurous and have been from the time they were baby chicks. They were the first of all 5 breeds we have to fly out of the trough we kept the babies in, they were the first to scale our fence, they were the first to find their way onto the roof of our house, and they are the only breed we have that will wander far from the house (which kinda worries us because we have had hawks get a couple other breeds, and Austra Whites areâ\u0080¦wellâ\u0080¦white.) They definitely keep us on our toes! , Out of 4:  One was very mean at one month, pecking all her siblings so I had to get rid of her.  Another one escaped three weeks ago and never was seen again.  Another is an escape artists and ALWAYS climbs up over the chicken wire.  I have one ordinary one.  Phew!  This breed keeps me hopping., I am now on week number 2 with the 22 Chicks Cackle has sent me. They are all very healthy and beautiful birds. They are growing very nice and canâ\u0080\u0099t wait for them to be able to move to the Big coop so they can roam around freely. More orders to come for sure. Friendly FAST Service for sure. Already made a pre-order for some Buff Orpingtons. Can not wait to get them., Yum! We used to get green eggs all the time but my green egg layers have been on strkie lately so all we have now is rose and brown ð\u009f\u0099\u0082 I Love green eggs!, Just wanted to tell you that we received our chicks midday on the 17th..and all were perfectly perfect and adorable! Thanks soooooo much for working with us on a quicker ship date:), They all arrived yesterday in great health and lots of vigor. By far the best order we have ever received from any hatchery. Thanks, Last year I purchased a dozen chickens six barred rocks and six Austra Whites. i am pleased with them. All of these girls are healthy and ornery at a year old. They are just now at nearly a year old starting to lay eggs. All of the eggs i have found have been quite large, surprising for pullets. They are all loaded with personality. With the exception of a few chickens I obtained from neighbors and friends, at least 3/4 of my flock came from Cackle Hatchery. Even the mixed breeds that I hatched out indirectly came from your hatchery since the parent birds were hatched in your facility. We have 23 chickens in all and I am always getting compliments on how good they look, as well as how friendly they are. I just wanted to say thank you for these fine quality birds that I get to enjoy having around. Thank you, Just a quick thank you. Once again your company delivered a box full of live healthy and vibrant chickens. All arrived doing fine. We ordered 60 and weâ\u0080\u0099re not disappointed with the chicks in the least. Thanks to Cackle sending a few more chicks for warmth than we ordered.\nWe ordered Egyptian for the first time. They are the most active chicks I have ever seen. The special heavy assorted was a great bargain. The chicks were even marked as requested!!!. You have earned my business once again. I have shared your catalog with friends and relatives and will continue to do so. Thanks again and keep up the excellent service., I received my chicks today and found all but 1 made it alive not bad odds for ordering 70 chicks. Thank you for the chicks and I am looking forward to ordering more. </span></span>
<span><span class="co">## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       607315, 607316, Cackle Hatchery , Cackle Hatchery , 2022-10-05T11:35:27-05:00, 2022-10-05T11:36:06-05:00, Oh no so sorry to hear that. As stated on website possible white on wings, though rare,  is normal and always go black by first molt and 30% will have white color leakages in tongue, mouth and toes.\nWe cannot guarantee the distribution of black pigment on chicks., Oh no so sorry to hear that. As stated on website possible white on wings, though rare, is normal and always go black by first molt and 30% will have white color leakages in tongue, mouth and toes. We cannot guarantee the distribution of black pigment on chicks.</span></span>
<span><span class="co">## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  172155, 171588, 171517, 170545, 170528, 5, NA, NA, NA, NA, Mtviewranch , AnaMaria , T Rathjen , Jerry, Arizona March 2012 , Bill, Missouri February 2013 , 2019-01-07T02:35:08-05:00, 2017-05-05T20:35:00-05:00, 2017-03-20T19:00:11-05:00, 2015-12-02T21:11:34-05:00, 2015-11-30T17:33:10-05:00, Love them!!, Beautiful Birds, Beautiful Birds, Chicken order, Thank You, Iâ\u0080\u0099ve ordered from you guys twice now and I have not lost one chick. In the two orders you sent extra girls for warmth I think 7 all together bonus! Beautiful birds my barnevelders just started laying large dark speckled eggs. They have great personalities I highly recommend this breed., My 4 Barnevelders are 3 weeks old. Theyâ\u0080\u0099ve arrived in 24 hours to Atlanta, in great health. They seem to grow by the second, but weâ\u0080\u0099ve had no problems since their arrival. They are beutiful, full of personality, friendly and well behaved. Im very happy. Thank you. I will try to post a follow ip when they are older., I purchased my chicks in Sept of 2016.  Everyone of them were healthy and lived.  I purchased a combination of Sussex and Wyandotteâ\u0080\u0099s.  They were all hand raised and are very friendly and love to â\u0080\u009ctalkâ\u0080\u009d to you.  We had no issues with health or poop and they have grown into beautiful, large birds, and produce plenty of eggs.  We will definitely buy from you again when we are ready to expand our flock., I just wanted to send you some feedback on an order you sent me. They arrived all healthy and are doing great!!! My wife and I wanted to thank you for the way you handled the order and the quality of the chicks you sent us., Iâ\u0080\u0099m just wanting to express my thanks to you for the five different breeds of chicks that I got from your hatchery Feb 12th. They are doing quite well, one or two of the chicks has a soft poop but still seem to be full of energy. Being I never experienced chicks before, I was really surprised at how fast they grow. On the fifth day I had to extend my wall of the brooding area because they would jump and or fly over my twelve inch high pen. I did lose one of the barred rocks around the third or fourth day. I actually expected to lose two or three but I am blessed to have lost only one. Thanks for good service, information and kindly taking the time to answer my many questions.</span></span>
<span><span class="co">## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     325390, 325352, 325322, 325320, 325106, 170959, 170836, 5, 5, 3, 5, 2, NA, NA, farmr john , Susannah C , mudman , Crystal , Grace , Sylvia June 2008 , Fares , 2019-10-31T16:58:50-05:00, 2019-10-30T16:33:57-05:00, 2019-10-29T21:24:13-05:00, 2019-10-29T21:00:55-05:00, 2019-07-01T14:24:36-05:00, 2016-01-11T16:37:32-05:00, 2015-12-25T06:46:45-05:00, Awesome birds, Beautiful, sweet birds / consistent layers, review, Beautiful chickens and fun pets !, Not my favs, Cackle Hatchery, We had a great year , These birds are awesome . They are lively from the start unlike to golden laced cochins. The show type bred into these birds is incredible. I have 6 pullets and 3 cockerels that could stand lots of competition. They are also heavy egg layers. So very impressed with them. They should be priced at double the cost!, We brought in barred cochin bantams last spring, and with thoughtful, gentle interaction, they have grown up to be beautiful, friendly, personable birds with very sweet personalities. I have many breeds in my flock, all with their own charm, but I do think these two Barred Cochins are perhaps the sweetest, cuddliest birds Iâ\u0080\u0099ve ever had.  Highly recommend for a gentle flock. (We have Polish, Silkies, Seramas, Brahmas, Wyandottes, Ameraucanas.) These birds arenâ\u0080\u0099t bullies and would not do well with super aggressive flockmates., nice breed doing well, We absolutely love our Barred Cochin Bantams!  I bought them for my children to raise as beloved pets.  They are so beautiful and sweet tempered.  They love to be held and fed worms.  , We bought a few different kinds of bantams and these were definitely my least favorite. One died in transit, one died two days after we got them, one was a rooster, and one is a nice little pullet. We bought sexed females. All-in-all I like the one that we ended up with, but did not like how sickly the rooster and the one that died were. Our other bantams that we received, golden laced Cochin, Rhode island red, and barred Rock, have all been healthy and seem much stronger., Just wanted you to know how pleased I am with my chickens from your company. They arrived in great health and have grown into these beauties. Many Thanks!, We had a great year at county fair.  This was our fifth year doing 4-H, but our first year being on the hoetaemsd with 4-H.  We have done static (the cooking, rockets, sewing, etc) exhibits before and last year we took 3 meat goats, but we had to keep them a t a friends house for 2 months prior to fair.  Last year se moved to a rental house 1 week before fair and didnâ\u0080\u0099t get our statics turned in.  So this year, now that we have a few acres we got a little carried away and took 38 statics   between 3 kids, and we took 3 dairy goats, 5 meat goats, 3 sheep, 6 chickens and 1 rabbit. Whoo!  that was probably a bit much!  We had a great time and the kids received 100 ribbons, plaques and awards in 4-H and our family got another 15 in open class.  We tried a lot of new things and the kids were pleased that for our first year in poultry they got either champion or reserve in showmanship.  We found out we donâ\u0080\u0099t like sheep, and we like the chickens more than we thought we would.  We love 4-H and will be incorporating 4-H projects into our homeschool so that most of the projects are done by June and we donâ\u0080\u0099t have the summer scramble to finish and then we can just concentrate on the livestock.</span></span>
<span><span class="co">## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      326461, 326272, 326143, 171438, 170950, 5, 5, 5, NA, NA, Garcia  , PonyGirl , Ellen , Debbie North Carolina Jan 2017 , Larry December 2015 , 2020-04-02T06:12:50-05:00, 2020-01-11T22:50:46-05:00, 2019-12-10T23:38:08-05:00, 2017-01-04T15:23:10-05:00, 2016-01-11T15:51:18-05:00, Great Birds , Love my cacklehatchery chickens, Beautiful Birds, Cust Response, Cackle Hatchery, Great, beautiful, and wonderful mothers. My hen was only about 7 months old and she became broody and hatched out 7 chicks. They are great hens and letâ\u0080\u0099s not forget the roosters! He is very protective of his hens but at the same time, he is very nice and gentle and likes to be held by humans. Great bred for first time chicken owners or if you live in cold areas like colorado , Our chickens arrived in excellent condition and have all been incredibly healthy.  The are now 6 months old and absolutely beautiful. I get compliments on how pretty my cochins are all the time.  I highly recommend buying all your chickens from Cacklehatchery.com!!! , Ordered Barred Cochins. I love these birds. Big, sturdy birds that are beautiful, fully feathered down to their feet, and so sweet. Hands down my favorite breed!, Just wanted to say that the Standard Golden Laced Cochins and the Standard Barred Cochins I ordered and received back in April are looking just beautiful! Very beautiful chickens, with great feathering! I am pleased with both breeds, and am especially excited about the standard sized Barred Cochins because it was only when I saw them on your list of cochins did I realize that the Barred even existed in the standard size! Thank you again, I would and do recommended your hatchery to my friends and acquaintances., Liked your youtube videos!</span></span>
<span><span class="co">## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          170939, Emily Ohio April 2008 , 2016-01-11T15:27:50-05:00, Thanks You Cackle Hatchery, I received my order this morning and could not be more pleased! I ordered 30 chicks and received 57. They are beautiful! Also I want to thank you for offering a discount to 4-Hers! I really appreciate it. I will be showing my birds at the fair this year. You folks also have AWESOME customer service, so keep up the good work! You have won my business!</span></span>
<span></span>
<span><span class="va">breed_details</span> <span class="op">&lt;-</span> <span class="va">details</span> <span class="op">|&gt;</span></span>
<span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"description"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">" Chicken"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"[^\\x00-\\x7F]+"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"Standard|Game"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"D’"</span>, <span class="st">"d"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">overall</span> <span class="op">&lt;-</span> <span class="va">overall</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">`Chicken Breed Name`</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"[^\\x00-\\x7F]+"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"Standard|Game"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"D’"</span>, <span class="st">"d"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Names aren't exactly the same, but close enough after some minor string manipulation</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">overall</span>, <span class="va">breed_details</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 7 × 10</span></span>
<span><span class="co">##   `Chicken Breed Name`    `Egg Production` `Egg Color` `Cold Hardy` `Heat Hardy`</span></span>
<span><span class="co">##   &lt;chr&gt;                   &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       </span></span>
<span><span class="co">## 1 Buff Ameraucanas        180-200 eggs pe… Blue        Very         &lt;NA&gt;        </span></span>
<span><span class="co">## 2 Red Broiler             Poor             Brown       Good         Good        </span></span>
<span><span class="co">## 3 French Cuckoo Marans    180+ eggs per y… Dark Brown  Moderate     Moderate    </span></span>
<span><span class="co">## 4 Saipan Jungle Fowl      Poor             Light Brown Poor         &lt;NA&gt;        </span></span>
<span><span class="co">## 5 Splash Old English Ban… Poor             Cream       Good         &lt;NA&gt;        </span></span>
<span><span class="co">## 6 White Crested Blue Pol… Good             White       Poor         &lt;NA&gt;        </span></span>
<span><span class="co">## 7 White Rock              200 – 280 eggs … Brown       Very         &lt;NA&gt;        </span></span>
<span><span class="co">## # ℹ 5 more variables: Purpose &lt;chr&gt;, Broody &lt;chr&gt;, `Mating Ratio` &lt;chr&gt;,</span></span>
<span><span class="co">## #   `Roost Height` &lt;chr&gt;, name &lt;chr&gt;</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">breed_details</span>, <span class="va">overall</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 6</span></span>
<span><span class="co">##   name                description        breed_facts availability videos reviews</span></span>
<span><span class="co">##   &lt;chr&gt;               &lt;chr&gt;              &lt;list&gt;      &lt;list&gt;       &lt;list&gt; &lt;list&gt; </span></span>
<span><span class="co">## 1 Blue Polish         "When it comes to… &lt;df&gt;        &lt;df&gt;         &lt;chr&gt;  &lt;df&gt;   </span></span>
<span><span class="co">## 2 Buff Ameraucana     "Buff Ameraucana … &lt;df&gt;        &lt;named list&gt; &lt;chr&gt;  &lt;df&gt;   </span></span>
<span><span class="co">## 3 Cackles Red Broiler "A great alternat… &lt;df&gt;        &lt;named list&gt; &lt;chr&gt;  &lt;df&gt;   </span></span>
<span><span class="co">## 4 Saipan              "Saipan chickens … &lt;df&gt;        &lt;df&gt;         &lt;chr&gt;  &lt;df&gt;   </span></span>
<span><span class="co">## 5 White Plymouth Rock "The White Plymou… &lt;df&gt;        &lt;df&gt;         &lt;chr&gt;  &lt;df&gt;</span></span>
<span></span>
<span><span class="va">chickens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">overall</span>, <span class="va">breed_details</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">chickens</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 15</span></span>
<span><span class="co">##   `Chicken Breed Name`    `Egg Production` `Egg Color` `Cold Hardy` `Heat Hardy`</span></span>
<span><span class="co">##   &lt;chr&gt;                   &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       </span></span>
<span><span class="co">## 1 Austra White            220-280 eggs pe… Cream       Good         Good        </span></span>
<span><span class="co">## 2 Ayam Cemani             80-100 per year  White       Good         &lt;NA&gt;        </span></span>
<span><span class="co">## 3 Barnevelder             150-200 eggs pe… Dark Brown  Poor         &lt;NA&gt;        </span></span>
<span><span class="co">## 4 Barred Cochin Bantam    Fair             Brown       Very         &lt;NA&gt;        </span></span>
<span><span class="co">## 5 Barred Cochin Standard  110-160 eggs pe… Brown       Very         &lt;NA&gt;        </span></span>
<span><span class="co">## 6 Barred Old English Ban… 120 eggs per ye… Cream       Good         &lt;NA&gt;        </span></span>
<span><span class="co">## # ℹ 10 more variables: Purpose &lt;chr&gt;, Broody &lt;chr&gt;, `Mating Ratio` &lt;chr&gt;,</span></span>
<span><span class="co">## #   `Roost Height` &lt;chr&gt;, name &lt;chr&gt;, description &lt;chr&gt;, breed_facts &lt;list&gt;,</span></span>
<span><span class="co">## #   availability &lt;list&gt;, videos &lt;list&gt;, reviews &lt;list&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>overall <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/chicken-breeds.csv"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>details <span class="op">=</span> pd.read_json(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/raw/chicken-breed-details.json"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>overall[<span class="st">'name'</span>] <span class="op">=</span> overall[<span class="st">'Chicken Breed Name'</span>].<span class="bu">str</span>.replace(<span class="st">"[^</span><span class="ch">\x00</span><span class="st">-</span><span class="ch">\x7F</span><span class="st">]|Standard|Game|Chicken"</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>).<span class="bu">str</span>.replace(<span class="st">"D’"</span>, <span class="st">"d"</span>).<span class="bu">str</span>.replace(<span class="st">"\s{1,}"</span>, <span class="st">" "</span>, regex <span class="op">=</span> <span class="va">True</span>).<span class="bu">str</span>.title().<span class="bu">str</span>.strip()</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>details <span class="op">=</span> details.explode([<span class="st">'name'</span>, <span class="st">'description'</span>])</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>details[<span class="st">'name'</span>] <span class="op">=</span> details[<span class="st">'name'</span>].<span class="bu">str</span>.replace(<span class="st">"[^</span><span class="ch">\x00</span><span class="st">-</span><span class="ch">\x7F</span><span class="st">]|Standard|Game|Chicken"</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>).<span class="bu">str</span>.replace(<span class="st">"D’"</span>, <span class="st">"d"</span>).<span class="bu">str</span>.replace(<span class="st">"\s{1,}"</span>, <span class="st">" "</span>, regex <span class="op">=</span> <span class="va">True</span>).<span class="bu">str</span>.title().<span class="bu">str</span>.strip()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>chickens <span class="op">=</span> overall.merge(details, how<span class="op">=</span><span class="st">'outer'</span>, on <span class="op">=</span> <span class="st">'name'</span>,  indicator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>chickens[(chickens._merge<span class="op">!=</span><span class="st">'both'</span>)][[<span class="st">'name'</span>, <span class="st">'_merge'</span>]]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">##                           name      _merge</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 44                 Blue Polish  right_only</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 53             Buff Ameraucana  right_only</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">## 54            Buff Ameraucanas   left_only</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">## 63         Cackles Red Broiler  right_only</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">## 92        French Cuckoo Marans   left_only</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">## 128                Red Broiler   left_only</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">## 138                     Saipan  right_only</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 139         Saipan Jungle Fowl   left_only</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co">## 162  Splash Old English Bantam   left_only</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co">## 176  White Crested Blue Polish   left_only</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co">## 185        White Plymouth Rock  right_only</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co">## 187                 White Rock   left_only</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>chickens.head()</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co">##        Chicken Breed Name  ... _merge</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co">## 0            Austra White  ...   both</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co">## 1             Ayam Cemani  ...   both</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="co">## 2             Barnevelder  ...   both</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="co">## 3  Barred Cochin Standard  ...   both</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="co">## 4    Barred Cochin Bantam  ...   both</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co">## </span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co">## [5 rows x 16 columns]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try It Out: Cleaning Chicken Data
</div>
</div>
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Problem</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">R solution</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>Unnest the chicken breed facts data, cleaning the responses. Which jobs are most suitable for a functional programming approach?</p>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Column names in breed_facts are too different</span></span>
<span><span class="co"># chickens_exp &lt;- chickens |&gt; unnest('breed_facts', names_sep='facts')</span></span>
<span></span>
<span><span class="va">fix_names</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"[^A-z]"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Remove anything that isn't A-z, including spaces.</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CountryOfOrigin?"</span> <span class="op">=</span> <span class="st">"Origin"</span>, <span class="st">"Weights"</span> <span class="op">=</span> <span class="st">"Weight"</span>, <span class="st">"Tlc"</span> <span class="op">=</span> <span class="st">"TLC"</span>, <span class="st">"Albc"</span> <span class="op">=</span> <span class="st">"ALBC"</span>, <span class="st">"Apa"</span> <span class="op">=</span> <span class="st">"APA"</span>, <span class="st">"BroodyS"</span> <span class="op">=</span> <span class="st">"Broody"</span>, <span class="st">"Temperment"</span> <span class="op">=</span> <span class="st">"Temperament"</span>, <span class="st">"Broody"</span> <span class="op">=</span> <span class="st">"Broody_facts"</span>, <span class="st">"Purpose"</span> <span class="op">=</span> <span class="st">"Purpose_facts"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"Shell|FarmSource|SourceFarm|Small|PoultryShow"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"^$"</span>, <span class="st">"xxx"</span><span class="op">)</span> <span class="co"># replace blank names with xxx</span></span>
<span>    <span class="va">df</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">chickens_fix</span> <span class="op">&lt;-</span> <span class="va">chickens</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>breed_facts <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">breed_facts</span>, <span class="va">fix_names</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test names</span></span>
<span><span class="va">chickens_fix</span><span class="op">$</span><span class="va">breed_facts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##  [1] "Class"                "Weight"               "Purpose_factsAndType"</span></span>
<span><span class="co">##  [4] "EggColor"             "EggProduction"        "EggSize"             </span></span>
<span><span class="co">##  [7] "Temperament"          "GenderAccuracy"       "FertilityPercentage" </span></span>
<span><span class="co">## [10] "Broody_facts"         "MatingRatio"          "RoostHeight"         </span></span>
<span><span class="co">## [13] "Origin"               "APA"                  "TLC"                 </span></span>
<span><span class="co">## [16] "Breeder"              "Purpose_facts"        "xxx"                 </span></span>
<span><span class="co">## [19] "ALBC"                 "Rooster"              "Pullet"              </span></span>
<span><span class="co">## [22] "Cockerel"             "Exhibition"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve fixed some of the misspellings and duplications. Rooster, Pullet, and Cockerel are all likely to be parsing issues stemming from Weight, but that’s the reality of working with data that is gathered from the internet.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chickens_exp</span> <span class="op">&lt;-</span> <span class="va">chickens_fix</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="st">"breed_facts"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">chickens_exp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span><span class="op">:</span><span class="fl">37</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 23</span></span>
<span><span class="co">##   `Chicken Breed Name`      EggProduction     EggSize Temperament GenderAccuracy</span></span>
<span><span class="co">##   &lt;chr&gt;                     &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;         </span></span>
<span><span class="co">## 1 Austra White              "Â Â 220-280 egg… Â Large Â Active    Â 80-85%      </span></span>
<span><span class="co">## 2 Ayam Cemani               "Â 80-120 per ye… &lt;NA&gt;    Docile      &lt;NA&gt;          </span></span>
<span><span class="co">## 3 Barnevelder               "Â 150-200 eggs … Â Large Â Active    Â 80-85%      </span></span>
<span><span class="co">## 4 Barred Cochin Bantam      "Egg Production:… Egg Si… Â Docile    75-80%        </span></span>
<span><span class="co">## 5 Barred Cochin Standard    "Egg ProductionÂ… Egg Si… Â Docile    &lt;NA&gt;          </span></span>
<span><span class="co">## 6 Barred Old English Bantam "Â â\u0080\u0093… Egg Si… Â Active    &lt;NA&gt;          </span></span>
<span><span class="co">## # ℹ 18 more variables: FertilityPercentage &lt;chr&gt;, Broody_facts &lt;chr&gt;,</span></span>
<span><span class="co">## #   MatingRatio &lt;chr&gt;, RoostHeight &lt;chr&gt;, Origin &lt;chr&gt;, APA &lt;chr&gt;, TLC &lt;chr&gt;,</span></span>
<span><span class="co">## #   Breeder &lt;chr&gt;, Purpose_facts &lt;chr&gt;, xxx &lt;chr&gt;, ALBC &lt;chr&gt;, Rooster &lt;chr&gt;,</span></span>
<span><span class="co">## #   Pullet &lt;chr&gt;, Cockerel &lt;chr&gt;, Exhibition &lt;chr&gt;, availability &lt;list&gt;,</span></span>
<span><span class="co">## #   videos &lt;list&gt;, reviews &lt;list&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s still quite a bit of cleaning left to do to get this data to be “pretty”.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_col</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">text</span> <span class="op">=</span> <span class="st">"(?:\\(estimates only, see FAQ\\))|(?:^APA)|(?:^TLC)|EggSize|(?:Fertility Percentage)|(?:Purpose and Type)"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"[\u0600-\u06FF]"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Remove non-ascii characters</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"[Â®â¢Ââ]"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="st">"[:\\.\\?!\\*]"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"\u0094"</span>, <span class="st">"-"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="st">"-{1,}"</span>, <span class="st">"-"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">chickens_exp</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="va">Class</span><span class="op">:</span><span class="va">Purpose_facts</span>, <span class="va">tidy_col</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="fl">1</span>, <span class="va">Class</span><span class="op">:</span><span class="va">Purpose_facts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 18</span></span>
<span><span class="co">##   `Chicken Breed Name`  Class Weight Purpose_factsAndType EggColor EggProduction</span></span>
<span><span class="co">##   &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;chr&gt;    &lt;chr&gt;        </span></span>
<span><span class="co">## 1 Austra White          Not … Hen-5… Primary production,… Very li… 220-280 eggs…</span></span>
<span><span class="co">## 2 Ayam Cemani           Not … Hen -… &lt;NA&gt;                 Cream, … 80-120 per y…</span></span>
<span><span class="co">## 3 Barnevelder           Cont… Weigh… Egg Laying; Exhibit… Dark Br… 150-200 eggs…</span></span>
<span><span class="co">## 4 Barred Cochin Bantam  Feat… Hen -… Pets,Very Broody, O… Egg She… Egg Producti…</span></span>
<span><span class="co">## 5 Barred Cochin Standa… Asia… Weigh… Ornamental and meat… Brown    Egg Producti…</span></span>
<span><span class="co">## 6 Barred Old English B… Game… Hen -… Ornamental; Exhibit… Egg She… Poor         </span></span>
<span><span class="co">## # ℹ 12 more variables: EggSize &lt;chr&gt;, Temperament &lt;chr&gt;, GenderAccuracy &lt;chr&gt;,</span></span>
<span><span class="co">## #   FertilityPercentage &lt;chr&gt;, Broody_facts &lt;chr&gt;, MatingRatio &lt;chr&gt;,</span></span>
<span><span class="co">## #   RoostHeight &lt;chr&gt;, Origin &lt;chr&gt;, APA &lt;chr&gt;, TLC &lt;chr&gt;, Breeder &lt;chr&gt;,</span></span>
<span><span class="co">## #   Purpose_facts &lt;chr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we consider the use of <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> as a functional programming technique (which it is), then it is much easier to create a generic <code>tidy_col</code> function than to tidy each column individually. There are probably a few things we’ve missed, but the data looks decent for the amount of time we put in.</p>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>XXX TODO</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="sec-functional-prog-refs" class="level2" data-number="29.5"><h2 data-number="29.5" class="anchored" data-anchor-id="sec-functional-prog-refs">
<span class="header-section-number">29.5</span> References</h2>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-kuchlingFunctionalProgrammingHOWTO2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">A. M. Kuchling, <span>“Functional programming <span>HOWTO</span>. <span class="nocase">cPython</span> documentation,”</span> Oct. 31, 2022. [Online]. Available: <a href="https://docs.python.org/3/howto/functional.html">https://docs.python.org/3/howto/functional.html</a>. [Accessed: Mar. 20, 2023]</div>
</div>
<div id="ref-urmaModernJavaAction2018" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">R.-G. Urma, M. Fusco, and A. Mycroft, <em>Modern java in action: Lambdas, streams, functional and reactive programming</em>, 2nd edition. Shelter Island: Manning, 2018. </div>
</div>
<div id="ref-FPJS" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div>
<div class="csl-right-inline">M. Fogus, <em>Functional <span>JavaScript</span>: Introducing functional programming with underscore.js</em>, 1st edition. Sebastopol, <span>CA</span>: O’Reilly Media, 2013. </div>
</div>
<div id="ref-buonannoFunctionalProgrammingHow2017" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div>
<div class="csl-right-inline">E. Buonanno, <em>Functional programming in c#: How to write better c# code</em>, 1st edition. Shelter Island, <span>NY</span>: Manning, 2017. </div>
</div>
<div id="ref-OOPfortran" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div>
<div class="csl-right-inline">E. Akin, <em>Object-oriented programming via fortran 90-95</em>. Cambridge University Press, 2003. </div>
</div>
<div id="ref-advr" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div>
<div class="csl-right-inline">H. Wickham, <em>Advanced <span>R</span></em>, 2nd ed. CRC Press, 2019 [Online]. Available: <a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a>. [Accessed: May 09, 2022]</div>
</div>
<div id="ref-rituraj_jainNestedListComprehensions2018" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div>
<div class="csl-right-inline">rituraj_jain, <span>“Nested list comprehensions in python. <span>GeeksforGeeks</span>,”</span> Nov. 07, 2018. [Online]. Available: <a href="https://www.geeksforgeeks.org/nested-list-comprehensions-in-python/">https://www.geeksforgeeks.org/nested-list-comprehensions-in-python/</a>. [Accessed: Mar. 20, 2023]</div>
</div>
<div id="ref-hadleywickhamPurrrBase2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div>
<div class="csl-right-inline">Hadley Wickham, Lionel Henry, and RStudio, <span>“Purrr <span>&lt;</span>-<span>&gt;</span> base r. Purrr base r,”</span> Oct. 10, 2022. [Online]. Available: <a href="https://purrr.tidyverse.org/articles/base.html">https://purrr.tidyverse.org/articles/base.html</a>. [Accessed: Apr. 10, 2023]</div>
</div>
<div id="ref-seabold2010statsmodels" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div>
<div class="csl-right-inline">S. Seabold and J. Perktold, <span>“Statsmodels: Econometric and statistical modeling with python,”</span> in <em>9th python in science conference</em>, 2010 [Online]. Available: <a href="https://proceedings.scipy.org/articles/Majora-92bf1922-011">https://proceedings.scipy.org/articles/Majora-92bf1922-011</a>
</div>
</div>
<div id="ref-scikitlearn" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div>
<div class="csl-right-inline">F. Pedregosa <em>et al.</em>, <span>“Scikit-learn: Machine learning in python,”</span> <em>Journal of Machine Learning Research</em>, vol. 12, pp. 2825–2830, 2011. </div>
</div>
<div id="ref-menonLinearRegressionLines2018" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div>
<div class="csl-right-inline">A. Menon, <span>“Linear <span>Regression</span> in 6 lines of <span>Python</span>,”</span> <em>Medium</em>. Oct. 2018 [Online]. Available: <a href="https://towardsdatascience.com/linear-regression-in-6-lines-of-python-5e1d0cd05b8d">https://towardsdatascience.com/linear-regression-in-6-lines-of-python-5e1d0cd05b8d</a>. [Accessed: Oct. 17, 2022]</div>
</div>
<div id="ref-wikipediacontributorsJSON2023" class="csl-entry" role="listitem">
<div class="csl-left-margin">[12] </div>
<div class="csl-right-inline">Wikipedia contributors, <span>“<span>JSON</span>,”</span> <em>Wikipedia</em>. Apr. 05, 2023 [Online]. Available: <a href="https://en.wikipedia.org/w/index.php?title=JSON&amp;oldid=1148380721">https://en.wikipedia.org/w/index.php?title=JSON&amp;oldid=1148380721</a>. [Accessed: Apr. 10, 2023]</div>
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/srvanderplas\.github\.io\/stat-computing-r-python\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="srvanderplas/stat-computing-r-python" data-repo-id="R_kgDOIvwd2g" data-category="General" data-category-id="DIC_kwDOIvwd2s4CTksR" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../part-wrangling/07-datetime.html" class="pagination-link" aria-label="Dates and Times">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Dates and Times</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part-wrangling/09-spatial-formats.html" class="pagination-link" aria-label="Spatial data">
        <span class="nav-page-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Spatial data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Susan Vanderplas</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/08-functional-prog.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/srvanderplas">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>